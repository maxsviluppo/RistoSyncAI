import{r as m,a as nd,g as Vl,c as id,R as od}from"./vendor-KfUPlHYY.js";import{C as Le,B as Sa,a as tt,R as As,M as Ii,b as Ti,L as fs,c as Kt,A as Kl,d as Ze,U as bs,e as ld,S as Xa,f as en,g as cd,W as wn,h as ar,i as wa,j as ii,k as Ea,T as dd,O as oi,P as jn,l as yn,m as $t,n as Wl,o as gs,p as ft,X as Xe,q as rr,r as Mn,s as ot,t as Lt,u as nr,F as Eo,v as ir,w as ts,D as Co,H as Hl,x as Io,y as gt,z as or,E as lr,G as ud,I as Jl,J as li,K as is,N as _t,Q as ci,V as hd,Y as Ai,Z as xs,_ as di,$ as cn,a0 as Rs,a1 as dn,a2 as Oi,a3 as ui,a4 as Ha,a5 as Yl,a6 as To,a7 as un,a8 as rs,a9 as Ca,aa as hn,ab as hi,ac as Js,ad as Za,ae as md,af as xd,ag as mi,ah as pd,ai as Ia,aj as ya,ak as Na,al as Ri,am as fd,an as yt,ao as _a,ap as tn,aq as gd,ar as Pi,as as zi,at as Di,au as $i,av as Li,aw as Mi,ax as Ui,ay as Bi,az as cr,aA as Ql,aB as bd,aC as vd,aD as wd,aE as Fi,aF as Ys,aG as jd,aH as Xl,aI as mn,aJ as yd,aK as Zl,aL as sn,aM as Nd,aN as dr,aO as xn,aP as Ja,aQ as _d,aR as pn,aS as kd,aT as Sd,aU as ec,aV as Ed,aW as fn,aX as Ao,aY as qs,aZ as qa,a_ as Cd,a$ as Un,b0 as Va,b1 as Id,b2 as Td,b3 as Ad,b4 as Ka,b5 as Oo,b6 as Ro,b7 as Od,b8 as Po,b9 as zo,ba as Rd,bb as Pd,bc as zd,bd as Dd,be as $d,bf as Ld}from"./ui-XYpzChPw.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var tc={exports:{}},Nn={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Md=m,Ud=Symbol.for("react.element"),Bd=Symbol.for("react.fragment"),Fd=Object.prototype.hasOwnProperty,Gd=Md.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qd={key:!0,ref:!0,__self:!0,__source:!0};function sc(s,t,a){var r,n={},i=null,o=null;a!==void 0&&(i=""+a),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)Fd.call(t,r)&&!qd.hasOwnProperty(r)&&(n[r]=t[r]);if(s&&s.defaultProps)for(r in t=s.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:Ud,type:s,key:i,ref:o,props:n,_owner:Gd.current}}Nn.Fragment=Bd;Nn.jsx=sc;Nn.jsxs=sc;tc.exports=Nn;var e=tc.exports,xi={},Do=nd;xi.createRoot=Do.createRoot,xi.hydrateRoot=Do.hydrateRoot;var ve=(s=>(s.PENDING="In Attesa",s.COOKING="In Preparazione",s.READY="Pronto",s.DELIVERED="Servito",s))(ve||{}),J=(s=>(s.MENU_COMPLETO="Menu Completo",s.ANTIPASTI="Antipasti",s.PANINI="Panini",s.PIZZE="Pizze",s.PRIMI="Primi",s.SECONDI="Secondi",s.DOLCI="Dolci",s.BEVANDE="Bevande",s))(J||{});function _n(s,t){var a={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(a[r[n]]=s[r[n]]);return a}function Vd(s,t,a,r){function n(i){return i instanceof a?i:new a(function(o){o(i)})}return new(a||(a=Promise))(function(i,o){function l(u){try{d(r.next(u))}catch(v){o(v)}}function c(u){try{d(r.throw(u))}catch(v){o(v)}}function d(u){u.done?i(u.value):n(u.value).then(l,c)}d((r=r.apply(s,t||[])).next())})}const Kd=s=>s?(...t)=>s(...t):(...t)=>fetch(...t);class Gi extends Error{constructor(t,a="FunctionsError",r){super(t),this.name=a,this.context=r}}class Wd extends Gi{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class $o extends Gi{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Lo extends Gi{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var pi;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(pi||(pi={}));class Hd{constructor(t,{headers:a={},customFetch:r,region:n=pi.Any}={}){this.url=t,this.headers=a,this.region=n,this.fetch=Kd(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Vd(this,arguments,void 0,function*(a,r={}){var n;let i,o;try{const{headers:l,method:c,body:d,signal:u,timeout:v}=r;let j={},{region:w}=r;w||(w=this.region);const N=new URL(`${this.url}/${a}`);w&&w!=="any"&&(j["x-region"]=w,N.searchParams.set("forceFunctionRegion",w));let D;d&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(j["Content-Type"]="application/octet-stream",D=d):typeof d=="string"?(j["Content-Type"]="text/plain",D=d):typeof FormData<"u"&&d instanceof FormData?D=d:(j["Content-Type"]="application/json",D=JSON.stringify(d)):D=d;let E=u;v&&(o=new AbortController,i=setTimeout(()=>o.abort(),v),u?(E=o.signal,u.addEventListener("abort",()=>o.abort())):E=o.signal);const O=yield this.fetch(N.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},j),this.headers),l),body:D,signal:E}).catch(F=>{throw new Wd(F)}),A=O.headers.get("x-relay-error");if(A&&A==="true")throw new $o(O);if(!O.ok)throw new Lo(O);let B=((n=O.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),Z;return B==="application/json"?Z=yield O.json():B==="application/octet-stream"||B==="application/pdf"?Z=yield O.blob():B==="text/event-stream"?Z=O:B==="multipart/form-data"?Z=yield O.formData():Z=yield O.text(),{data:Z,error:null,response:O}}catch(l){return{data:null,error:l,response:l instanceof Lo||l instanceof $o?l.context:void 0}}finally{i&&clearTimeout(i)}})}}var Jd=class extends Error{constructor(s){super(s.message),this.name="PostgrestError",this.details=s.details,this.hint=s.hint,this.code=s.code}},Yd=class{constructor(s){var t,a;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(t=s.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=s.signal,this.isMaybeSingle=(a=s.isMaybeSingle)!==null&&a!==void 0?a:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,t){return this.headers=new Headers(this.headers),this.headers.set(s,t),this}then(s,t){var a=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,l=null,c=null,d=i.status,u=i.statusText;if(i.ok){var v,j;if(a.method!=="HEAD"){var w;const O=await i.text();O===""||(a.headers.get("Accept")==="text/csv"||a.headers.get("Accept")&&(!((w=a.headers.get("Accept"))===null||w===void 0)&&w.includes("application/vnd.pgrst.plan+text"))?l=O:l=JSON.parse(O))}const D=(v=a.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),E=(j=i.headers.get("content-range"))===null||j===void 0?void 0:j.split("/");D&&E&&E.length>1&&(c=parseInt(E[1])),a.isMaybeSingle&&a.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,c=null,d=406,u="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var N;const D=await i.text();try{o=JSON.parse(D),Array.isArray(o)&&i.status===404&&(l=[],o=null,d=200,u="OK")}catch{i.status===404&&D===""?(d=204,u="No Content"):o={message:D}}if(o&&a.isMaybeSingle&&(!(o==null||(N=o.details)===null||N===void 0)&&N.includes("0 rows"))&&(o=null,d=200,u="OK"),o&&a.shouldThrowOnError)throw new Jd(o)}return{error:o,data:l,count:c,status:d,statusText:u}});return this.shouldThrowOnError||(n=n.catch(i=>{var o;let l="";const c=i==null?void 0:i.cause;if(c){var d,u,v,j;const N=(d=c==null?void 0:c.message)!==null&&d!==void 0?d:"",D=(u=c==null?void 0:c.code)!==null&&u!==void 0?u:"";l=`${(v=i==null?void 0:i.name)!==null&&v!==void 0?v:"FetchError"}: ${i==null?void 0:i.message}`,l+=`

Caused by: ${(j=c==null?void 0:c.name)!==null&&j!==void 0?j:"Error"}: ${N}`,D&&(l+=` (${D})`),c!=null&&c.stack&&(l+=`
${c.stack}`)}else{var w;l=(w=i==null?void 0:i.stack)!==null&&w!==void 0?w:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:l,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(s,t)}returns(){return this}overrideTypes(){return this}},Qd=class extends Yd{select(s){let t=!1;const a=(s??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:t=!0,nullsFirst:a,foreignTable:r,referencedTable:n=r}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${s}.${t?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:t,referencedTable:a=t}={}){const r=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(r,`${s}`),this}range(s,t,{foreignTable:a,referencedTable:r=a}={}){const n=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${s}`),this.url.searchParams.set(i,`${t-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:t=!1,settings:a=!1,buffers:r=!1,wal:n=!1,format:i="text"}={}){var o;const l=[s?"analyze":null,t?"verbose":null,a?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${l};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};const Mo=new RegExp("[,()]");var ga=class extends Qd{eq(s,t){return this.url.searchParams.append(s,`eq.${t}`),this}neq(s,t){return this.url.searchParams.append(s,`neq.${t}`),this}gt(s,t){return this.url.searchParams.append(s,`gt.${t}`),this}gte(s,t){return this.url.searchParams.append(s,`gte.${t}`),this}lt(s,t){return this.url.searchParams.append(s,`lt.${t}`),this}lte(s,t){return this.url.searchParams.append(s,`lte.${t}`),this}like(s,t){return this.url.searchParams.append(s,`like.${t}`),this}likeAllOf(s,t){return this.url.searchParams.append(s,`like(all).{${t.join(",")}}`),this}likeAnyOf(s,t){return this.url.searchParams.append(s,`like(any).{${t.join(",")}}`),this}ilike(s,t){return this.url.searchParams.append(s,`ilike.${t}`),this}ilikeAllOf(s,t){return this.url.searchParams.append(s,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(s,t){return this.url.searchParams.append(s,`ilike(any).{${t.join(",")}}`),this}regexMatch(s,t){return this.url.searchParams.append(s,`match.${t}`),this}regexIMatch(s,t){return this.url.searchParams.append(s,`imatch.${t}`),this}is(s,t){return this.url.searchParams.append(s,`is.${t}`),this}isDistinct(s,t){return this.url.searchParams.append(s,`isdistinct.${t}`),this}in(s,t){const a=Array.from(new Set(t)).map(r=>typeof r=="string"&&Mo.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}notIn(s,t){const a=Array.from(new Set(t)).map(r=>typeof r=="string"&&Mo.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(s,`not.in.(${a})`),this}contains(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cs.{${t.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(t)}`),this}containedBy(s,t){return typeof t=="string"?this.url.searchParams.append(s,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(s,`cd.{${t.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(t)}`),this}rangeGt(s,t){return this.url.searchParams.append(s,`sr.${t}`),this}rangeGte(s,t){return this.url.searchParams.append(s,`nxl.${t}`),this}rangeLt(s,t){return this.url.searchParams.append(s,`sl.${t}`),this}rangeLte(s,t){return this.url.searchParams.append(s,`nxr.${t}`),this}rangeAdjacent(s,t){return this.url.searchParams.append(s,`adj.${t}`),this}overlaps(s,t){return typeof t=="string"?this.url.searchParams.append(s,`ov.${t}`):this.url.searchParams.append(s,`ov.{${t.join(",")}}`),this}textSearch(s,t,{config:a,type:r}={}){let n="";r==="plain"?n="pl":r==="phrase"?n="ph":r==="websearch"&&(n="w");const i=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${n}fts${i}.${t}`),this}match(s){return Object.entries(s).forEach(([t,a])=>{this.url.searchParams.append(t,`eq.${a}`)}),this}not(s,t,a){return this.url.searchParams.append(s,`not.${t}.${a}`),this}or(s,{foreignTable:t,referencedTable:a=t}={}){const r=a?`${a}.or`:"or";return this.url.searchParams.append(r,`(${s})`),this}filter(s,t,a){return this.url.searchParams.append(s,`${t}.${a}`),this}},Xd=class{constructor(s,{headers:t={},schema:a,fetch:r}){this.url=s,this.headers=new Headers(t),this.schema=a,this.fetch=r}select(s,t){const{head:a=!1,count:r}=t??{},n=a?"HEAD":"GET";let i=!1;const o=(s??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new ga({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:t,defaultToNull:a=!0}={}){var r;const n="POST";if(t&&this.headers.append("Prefer",`count=${t}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const i=s.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(i.length>0){const o=[...new Set(i)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new ga({method:n,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(s,{onConflict:t,ignoreDuplicates:a=!1,count:r,defaultToNull:n=!0}={}){var i;const o="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer",`count=${r}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const l=s.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(l.length>0){const c=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",c.join(","))}}return new ga({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(s,{count:t}={}){var a;const r="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new ga({method:r,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:s}={}){var t;const a="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new ga({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},Zd=class ac{constructor(t,{headers:a={},schema:r,fetch:n}={}){this.url=t,this.headers=new Headers(a),this.schemaName=r,this.fetch=n}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Xd(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new ac(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,a={},{head:r=!1,get:n=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${t}`);let d;r||n?(l=r?"HEAD":"GET",Object.entries(a).filter(([v,j])=>j!==void 0).map(([v,j])=>[v,Array.isArray(j)?`{${j.join(",")}}`:`${j}`]).forEach(([v,j])=>{c.searchParams.append(v,j)})):(l="POST",d=a);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new ga({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class eu{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const a=process.versions;if(a&&a.node){const r=a.node,n=parseInt(r.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let a=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(a+=`

Suggested solution: ${t.workaround}`),new Error(a)}static createWebSocket(t,a){const r=this.getWebSocketConstructor();return new r(t,a)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const tu="2.89.0",su=`realtime-js/${tu}`,rc="1.0.0",au="2.0.0",Uo=rc,fi=1e4,ru=1e3,nu=100;var Is;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Is||(Is={}));var rt;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(rt||(rt={}));var Zt;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(Zt||(Zt={}));var gi;(function(s){s.websocket="websocket"})(gi||(gi={}));var Ks;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Ks||(Ks={}));class iu{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,a){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return a(this._binaryEncodeUserBroadcastPush(t));let r=[t.join_ref,t.ref,t.topic,t.event,t.payload];return a(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(t){var a;return this._isArrayBuffer((a=t.payload)===null||a===void 0?void 0:a.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var a,r;const n=(r=(a=t.payload)===null||a===void 0?void 0:a.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(t){var a,r;const n=(r=(a=t.payload)===null||a===void 0?void 0:a.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,a,r){var n,i;const o=t.topic,l=(n=t.ref)!==null&&n!==void 0?n:"",c=(i=t.join_ref)!==null&&i!==void 0?i:"",d=t.payload.event,u=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(u).length===0?"":JSON.stringify(u);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`userEvent length ${d.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const j=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+l.length+o.length+d.length+v.length,w=new ArrayBuffer(this.HEADER_LENGTH+j);let N=new DataView(w),D=0;N.setUint8(D++,this.KINDS.userBroadcastPush),N.setUint8(D++,c.length),N.setUint8(D++,l.length),N.setUint8(D++,o.length),N.setUint8(D++,d.length),N.setUint8(D++,v.length),N.setUint8(D++,a),Array.from(c,O=>N.setUint8(D++,O.charCodeAt(0))),Array.from(l,O=>N.setUint8(D++,O.charCodeAt(0))),Array.from(o,O=>N.setUint8(D++,O.charCodeAt(0))),Array.from(d,O=>N.setUint8(D++,O.charCodeAt(0))),Array.from(v,O=>N.setUint8(D++,O.charCodeAt(0)));var E=new Uint8Array(w.byteLength+r.byteLength);return E.set(new Uint8Array(w),0),E.set(new Uint8Array(r),w.byteLength),E.buffer}decode(t,a){if(this._isArrayBuffer(t)){let r=this._binaryDecode(t);return a(r)}if(typeof t=="string"){const r=JSON.parse(t),[n,i,o,l,c]=r;return a({join_ref:n,ref:i,topic:o,event:l,payload:c})}return a({})}_binaryDecode(t){const a=new DataView(t),r=a.getUint8(0),n=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,a,n)}}_decodeUserBroadcast(t,a,r){const n=a.getUint8(1),i=a.getUint8(2),o=a.getUint8(3),l=a.getUint8(4);let c=this.HEADER_LENGTH+4;const d=r.decode(t.slice(c,c+n));c=c+n;const u=r.decode(t.slice(c,c+i));c=c+i;const v=r.decode(t.slice(c,c+o));c=c+o;const j=t.slice(c,t.byteLength),w=l===this.JSON_ENCODING?JSON.parse(r.decode(j)):j,N={type:this.BROADCAST_EVENT,event:u,payload:w};return o>0&&(N.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST_EVENT,payload:N}}_isArrayBuffer(t){var a;return t instanceof ArrayBuffer||((a=t==null?void 0:t.constructor)===null||a===void 0?void 0:a.name)==="ArrayBuffer"}_pick(t,a){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([r])=>a.includes(r)))}}class nc{constructor(t,a){this.callback=t,this.timerCalc=a,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=a}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var We;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(We||(We={}));const Bo=(s,t,a={})=>{var r;const n=(r=a.skipTypes)!==null&&r!==void 0?r:[];return t?Object.keys(t).reduce((i,o)=>(i[o]=ou(o,s,t,n),i),{}):{}},ou=(s,t,a,r)=>{const n=t.find(l=>l.name===s),i=n==null?void 0:n.type,o=a[s];return i&&!r.includes(i)?ic(i,o):bi(o)},ic=(s,t)=>{if(s.charAt(0)==="_"){const a=s.slice(1,s.length);return uu(t,a)}switch(s){case We.bool:return lu(t);case We.float4:case We.float8:case We.int2:case We.int4:case We.int8:case We.numeric:case We.oid:return cu(t);case We.json:case We.jsonb:return du(t);case We.timestamp:return hu(t);case We.abstime:case We.date:case We.daterange:case We.int4range:case We.int8range:case We.money:case We.reltime:case We.text:case We.time:case We.timestamptz:case We.timetz:case We.tsrange:case We.tstzrange:return bi(t);default:return bi(t)}},bi=s=>s,lu=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},cu=s=>{if(typeof s=="string"){const t=parseFloat(s);if(!Number.isNaN(t))return t}return s},du=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s},uu=(s,t)=>{if(typeof s!="string")return s;const a=s.length-1,r=s[a];if(s[0]==="{"&&r==="}"){let i;const o=s.slice(1,a);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>ic(t,l))}return s},hu=s=>typeof s=="string"?s.replace(" ","T"):s,oc=s=>{const t=new URL(s);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Bn{constructor(t,a,r={},n=fi){this.channel=t,this.event=a,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,a){var r;return this._hasReceived(t)&&a((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:a}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,a){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:a})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:a}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(a))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Fo;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Fo||(Fo={}));class er{constructor(t,a){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(a==null?void 0:a.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=er.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=er.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=er.syncDiff(this.state,n,i,o),l())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,a,r,n){const i=this.cloneDeep(t),o=this.transformState(a),l={},c={};return this.map(i,(d,u)=>{o[d]||(c[d]=u)}),this.map(o,(d,u)=>{const v=i[d];if(v){const j=u.map(E=>E.presence_ref),w=v.map(E=>E.presence_ref),N=u.filter(E=>w.indexOf(E.presence_ref)<0),D=v.filter(E=>j.indexOf(E.presence_ref)<0);N.length>0&&(l[d]=N),D.length>0&&(c[d]=D)}else l[d]=u}),this.syncDiff(i,{joins:l,leaves:c},r,n)}static syncDiff(t,a,r,n){const{joins:i,leaves:o}={joins:this.transformState(a.joins),leaves:this.transformState(a.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const v=t[l].map(w=>w.presence_ref),j=u.filter(w=>v.indexOf(w.presence_ref)<0);t[l].unshift(...j)}r(l,u,c)}),this.map(o,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(v=>v.presence_ref);d=d.filter(v=>u.indexOf(v.presence_ref)<0),t[l]=d,n(l,d,c),d.length===0&&delete t[l]}),t}static map(t,a){return Object.getOwnPropertyNames(t).map(r=>a(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((a,r)=>{const n=t[r];return"metas"in n?a[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):a[r]=n,a},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Go;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Go||(Go={}));var tr;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(tr||(tr={}));var ps;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(ps||(ps={}));class ja{constructor(t,a={config:{}},r){var n,i;if(this.topic=t,this.params=a,this.socket=r,this.bindings={},this.state=rt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},a.config),this.timeout=this.socket.timeout,this.joinPush=new Bn(this,Zt.join,this.params,this.timeout),this.rejoinTimer=new nc(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=rt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=rt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=rt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=rt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Zt.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new er(this),this.broadcastEndpointURL=oc(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,a=this.timeout){var r,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==rt.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,d=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(w=>w.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[tr.PRESENCE]&&this.bindings[tr.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,v={},j={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(w=>t==null?void 0:t(ps.CHANNEL_ERROR,w)),this._onClose(()=>t==null?void 0:t(ps.CLOSED)),this.updateJoinPayload(Object.assign({config:j},v)),this.joinedOnce=!0,this._rejoin(a),this.joinPush.receive("ok",async({postgres_changes:w})=>{var N;if(this.socket._isManualToken()||this.socket.setAuth(),w===void 0){t==null||t(ps.SUBSCRIBED);return}else{const D=this.bindings.postgres_changes,E=(N=D==null?void 0:D.length)!==null&&N!==void 0?N:0,O=[];for(let A=0;A<E;A++){const B=D[A],{filter:{event:Z,schema:F,table:H,filter:Y}}=B,x=w&&w[A];if(x&&x.event===Z&&ja.isFilterValueEqual(x.schema,F)&&ja.isFilterValueEqual(x.table,H)&&ja.isFilterValueEqual(x.filter,Y))O.push(Object.assign(Object.assign({},B),{id:x.id}));else{this.unsubscribe(),this.state=rt.errored,t==null||t(ps.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=O,t&&t(ps.SUBSCRIBED);return}}).receive("error",w=>{this.state=rt.errored,t==null||t(ps.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(w).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(ps.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,a={}){return await this.send({type:"presence",event:"track",payload:t},a.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,a,r){return this.state===rt.joined&&t===tr.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,a,r)}async httpSend(t,a,r={}){var n;if(a==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:a,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const d=await l.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(t,a={}){var r,n;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=t,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=a.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const d=this._push(t.type,t,a.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=rt.leaving;const a=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Zt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Bn(this,Zt.leave,{},t),r.receive("ok",()=>{a(),n("ok")}).receive("timeout",()=>{a(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=rt.closed,this.bindings={}}async _fetchWithTimeout(t,a,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),o=await this.socket.fetch(t,Object.assign(Object.assign({},a),{signal:n.signal}));return clearTimeout(i),o}_push(t,a,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Bn(this,t,a,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>nu){const a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(t,a,r){return a}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,a,r){var n,i;const o=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Zt;if(r&&[l,c,d,u].indexOf(o)>=0&&r!==this._joinRef())return;let j=this._onMessage(o,a,r);if(a&&!j)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(w=>{var N,D,E;return((N=w.filter)===null||N===void 0?void 0:N.event)==="*"||((E=(D=w.filter)===null||D===void 0?void 0:D.event)===null||E===void 0?void 0:E.toLocaleLowerCase())===o}).map(w=>w.callback(j,r)):(i=this.bindings[o])===null||i===void 0||i.filter(w=>{var N,D,E,O,A,B;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in w){const Z=w.id,F=(N=w.filter)===null||N===void 0?void 0:N.event;return Z&&((D=a.ids)===null||D===void 0?void 0:D.includes(Z))&&(F==="*"||(F==null?void 0:F.toLocaleLowerCase())===((E=a.data)===null||E===void 0?void 0:E.type.toLocaleLowerCase()))}else{const Z=(A=(O=w==null?void 0:w.filter)===null||O===void 0?void 0:O.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return Z==="*"||Z===((B=a==null?void 0:a.event)===null||B===void 0?void 0:B.toLocaleLowerCase())}else return w.type.toLocaleLowerCase()===o}).map(w=>{if(typeof j=="object"&&"ids"in j){const N=j.data,{schema:D,table:E,commit_timestamp:O,type:A,errors:B}=N;j=Object.assign(Object.assign({},{schema:D,table:E,commit_timestamp:O,eventType:A,new:{},old:{},errors:B}),this._getPayloadRecords(N))}w.callback(j,r)})}_isClosed(){return this.state===rt.closed}_isJoined(){return this.state===rt.joined}_isJoining(){return this.state===rt.joining}_isLeaving(){return this.state===rt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,a,r){const n=t.toLocaleLowerCase(),i={type:n,filter:a,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(t,a){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&ja.isEqual(n.filter,a))})),this}static isEqual(t,a){if(Object.keys(t).length!==Object.keys(a).length)return!1;for(const r in t)if(t[r]!==a[r])return!1;return!0}static isFilterValueEqual(t,a){return(t??void 0)===(a??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Zt.close,{},t)}_onError(t){this._on(Zt.error,{},a=>t(a))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=rt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const a={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(a.new=Bo(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(a.old=Bo(t.columns,t.old_record)),a}}const Fn=()=>{},Wr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},mu=[1e3,2e3,5e3,1e4],xu=1e4,pu=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class fu{constructor(t,a){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=fi,this.transport=null,this.heartbeatIntervalMs=Wr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Fn,this.ref=0,this.reconnectTimer=null,this.vsn=Uo,this.logger=Fn,this.conn=null,this.sendBuffer=[],this.serializer=new iu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((r=a==null?void 0:a.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=a.params.apikey,this.endPoint=`${t}/${gi.websocket}`,this.httpEndpoint=oc(t),this._initializeOptions(a),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(a==null?void 0:a.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=eu.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const a=t.message;throw a.includes("Node.js")?new Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,a){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,a??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const a=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),a}async removeAllChannels(){const t=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,a,r){this.logger(t,a,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Is.connecting:return Ks.Connecting;case Is.open:return Ks.Open;case Is.closing:return Ks.Closing;default:return Ks.Closed}}isConnected(){return this.connectionState()===Ks.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,a={config:{}}){const r=`realtime:${t}`,n=this.getChannels().find(i=>i.topic===r);if(n)return n;{const i=new ja(`realtime:${t}`,a,this);return this.channels.push(i),i}}push(t){const{topic:a,event:r,payload:n,ref:i}=t,o=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${a} ${r} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(ru,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout()},Wr.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let a=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));a&&(this.log("transport",`leaving duplicate topic "${t}"`),a.unsubscribe())}_remove(t){this.channels=this.channels.filter(a=>a.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,a=>{if(a.topic==="phoenix"&&a.event==="phx_reply")try{this.heartbeatCallback(a.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:i,ref:o}=a,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${n} ${l}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(n,i,o)),this._triggerStateCallbacks("message",a)})}_clearTimer(t){var a;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((a=this.reconnectTimer)===null||a===void 0||a.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Is.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Is.open||this.conn.readyState===Is.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(a=>{this.log("error","error waiting for auth on connect",a),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this._terminateWorker()},this.workerRef.onmessage=a=>{a.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var a;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Zt.error))}_appendParams(t,a){if(Object.keys(a).length===0)return t;const r=t.match(/\?/)?"&":"?",n=new URLSearchParams(a);return`${t}${r}${n}`}_workerObjectUrl(t){let a;if(t)a=t;else{const r=new Blob([pu],{type:"application/javascript"});a=URL.createObjectURL(r)}return a}_setConnectionState(t,a=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=a)}async _performAuth(t=null){let a,r=!1;if(t)a=t,r=!0;else if(this.accessToken)try{a=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),a=this.accessTokenValue}else a=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=a&&(this.accessTokenValue=a,this.channels.forEach(n=>{const i={access_token:a,version:su};a&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(Zt.access_token,{access_token:a})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(a=>{this.log("error",`Error setting auth in ${t}`,a)})}_triggerStateCallbacks(t,a){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(a)}catch(n){this.log("error",`error in ${t} callback`,n)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new nc(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Wr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var a,r,n,i,o,l,c,d,u,v,j,w;switch(this.transport=(a=t==null?void 0:t.transport)!==null&&a!==void 0?a:null,this.timeout=(r=t==null?void 0:t.timeout)!==null&&r!==void 0?r:fi,this.heartbeatIntervalMs=(n=t==null?void 0:t.heartbeatIntervalMs)!==null&&n!==void 0?n:Wr.HEARTBEAT_INTERVAL,this.worker=(i=t==null?void 0:t.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=t==null?void 0:t.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=t==null?void 0:t.heartbeatCallback)!==null&&l!==void 0?l:Fn,this.vsn=(c=t==null?void 0:t.vsn)!==null&&c!==void 0?c:Uo,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=t==null?void 0:t.reconnectAfterMs)!==null&&d!==void 0?d:N=>mu[N-1]||xu,this.vsn){case rc:this.encode=(u=t==null?void 0:t.encode)!==null&&u!==void 0?u:(N,D)=>D(JSON.stringify(N)),this.decode=(v=t==null?void 0:t.decode)!==null&&v!==void 0?v:(N,D)=>D(JSON.parse(N));break;case au:this.encode=(j=t==null?void 0:t.encode)!==null&&j!==void 0?j:this.serializer.encode.bind(this.serializer),this.decode=(w=t==null?void 0:t.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var ur=class extends Error{constructor(s,t){var a;super(s),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((a=t.icebergType)==null?void 0:a.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function gu(s,t,a){const r=new URL(t,s);if(a)for(const[n,i]of Object.entries(a))i!==void 0&&r.searchParams.set(n,i);return r.toString()}async function bu(s){return!s||s.type==="none"?{}:s.type==="bearer"?{Authorization:`Bearer ${s.token}`}:s.type==="header"?{[s.name]:s.value}:s.type==="custom"?await s.getHeaders():{}}function vu(s){const t=s.fetchImpl??globalThis.fetch;return{async request({method:a,path:r,query:n,body:i,headers:o}){const l=gu(s.baseUrl,r,n),c=await bu(s.auth),d=await t(l,{method:a,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),u=await d.text(),v=(d.headers.get("content-type")||"").includes("application/json"),j=v&&u?JSON.parse(u):u;if(!d.ok){const w=v?j:void 0,N=w==null?void 0:w.error;throw new ur((N==null?void 0:N.message)??`Request failed with status ${d.status}`,{status:d.status,icebergType:N==null?void 0:N.type,icebergCode:N==null?void 0:N.code,details:w})}return{status:d.status,headers:d.headers,data:j}}}}function Hr(s){return s.join("")}var wu=class{constructor(s,t=""){this.client=s,this.prefix=t}async listNamespaces(s){const t=s?{parent:Hr(s.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(s,t){const a={namespace:s.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:a})).data}async dropNamespace(s){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Hr(s.namespace)}`})}async loadNamespaceMetadata(s){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Hr(s.namespace)}`})).data.properties}}async namespaceExists(s){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Hr(s.namespace)}`}),!0}catch(t){if(t instanceof ur&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(s,t){try{return await this.createNamespace(s,t)}catch(a){if(a instanceof ur&&a.status===409)return;throw a}}};function ca(s){return s.join("")}var ju=class{constructor(s,t="",a){this.client=s,this.prefix=t,this.accessDelegation=a}async listTables(s){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ca(s.namespace)}/tables`})).data.identifiers}async createTable(s,t){const a={};return this.accessDelegation&&(a["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ca(s.namespace)}/tables`,body:t,headers:a})).data.metadata}async updateTable(s,t){const a=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ca(s.namespace)}/tables/${s.name}`,body:t});return{"metadata-location":a.data["metadata-location"],metadata:a.data.metadata}}async dropTable(s,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ca(s.namespace)}/tables/${s.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(s){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ca(s.namespace)}/tables/${s.name}`,headers:t})).data.metadata}async tableExists(s){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ca(s.namespace)}/tables/${s.name}`,headers:t}),!0}catch(a){if(a instanceof ur&&a.status===404)return!1;throw a}}async createTableIfNotExists(s,t){try{return await this.createTable(s,t)}catch(a){if(a instanceof ur&&a.status===409)return await this.loadTable({namespace:s.namespace,name:t.name});throw a}}},yu=class{constructor(s){var r;let t="v1";s.catalogName&&(t+=`/${s.catalogName}`);const a=s.baseUrl.endsWith("/")?s.baseUrl:`${s.baseUrl}/`;this.client=vu({baseUrl:a,auth:s.auth,fetchImpl:s.fetch}),this.accessDelegation=(r=s.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new wu(this.client,t),this.tableOps=new ju(this.client,t,this.accessDelegation)}async listNamespaces(s){return this.namespaceOps.listNamespaces(s)}async createNamespace(s,t){return this.namespaceOps.createNamespace(s,t)}async dropNamespace(s){await this.namespaceOps.dropNamespace(s)}async loadNamespaceMetadata(s){return this.namespaceOps.loadNamespaceMetadata(s)}async listTables(s){return this.tableOps.listTables(s)}async createTable(s,t){return this.tableOps.createTable(s,t)}async updateTable(s,t){return this.tableOps.updateTable(s,t)}async dropTable(s,t){await this.tableOps.dropTable(s,t)}async loadTable(s){return this.tableOps.loadTable(s)}async namespaceExists(s){return this.namespaceOps.namespaceExists(s)}async tableExists(s){return this.tableOps.tableExists(s)}async createNamespaceIfNotExists(s,t){return this.namespaceOps.createNamespaceIfNotExists(s,t)}async createTableIfNotExists(s,t){return this.tableOps.createTableIfNotExists(s,t)}},kn=class extends Error{constructor(s){super(s),this.__isStorageError=!0,this.name="StorageError"}};function Qe(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}var Nu=class extends kn{constructor(s,t,a){super(s),this.name="StorageApiError",this.status=t,this.statusCode=a}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},vi=class extends kn{constructor(s,t){super(s),this.name="StorageUnknownError",this.originalError=t}};const qi=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),_u=()=>Response,wi=s=>{if(Array.isArray(s))return s.map(a=>wi(a));if(typeof s=="function"||s!==Object(s))return s;const t={};return Object.entries(s).forEach(([a,r])=>{const n=a.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[n]=wi(r)}),t},ku=s=>{if(typeof s!="object"||s===null)return!1;const t=Object.getPrototypeOf(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},Su=s=>!s||typeof s!="string"||s.length===0||s.length>100||s.trim()!==s||s.includes("/")||s.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(s);function hr(s){"@babel/helpers - typeof";return hr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hr(s)}function Eu(s,t){if(hr(s)!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var r=a.call(s,t);if(hr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function Cu(s){var t=Eu(s,"string");return hr(t)=="symbol"?t:t+""}function Iu(s,t,a){return(t=Cu(t))in s?Object.defineProperty(s,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[t]=a,s}function qo(s,t){var a=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),a.push.apply(a,r)}return a}function Ee(s){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?qo(Object(a),!0).forEach(function(r){Iu(s,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):qo(Object(a)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(a,r))})}return s}const Gn=s=>{var t;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(t=s.error)===null||t===void 0?void 0:t.message)||JSON.stringify(s)},Tu=async(s,t,a)=>{s instanceof await _u()&&!(a!=null&&a.noResolveJson)?s.json().then(r=>{const n=s.status||500,i=(r==null?void 0:r.statusCode)||n+"";t(new Nu(Gn(r),n,i))}).catch(r=>{t(new vi(Gn(r),r))}):t(new vi(Gn(s),s))},Au=(s,t,a,r)=>{const n={method:s,headers:(t==null?void 0:t.headers)||{}};return s==="GET"||!r?n:(ku(r)?(n.headers=Ee({"Content-Type":"application/json"},t==null?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,t!=null&&t.duplex&&(n.duplex=t.duplex),Ee(Ee({},n),a))};async function Nr(s,t,a,r,n,i){return new Promise((o,l)=>{s(a,Au(t,r,n,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Tu(c,l,r))})}async function mr(s,t,a,r){return Nr(s,"GET",t,a,r)}async function Xt(s,t,a,r,n){return Nr(s,"POST",t,r,n,a)}async function ji(s,t,a,r,n){return Nr(s,"PUT",t,r,n,a)}async function Ou(s,t,a,r){return Nr(s,"HEAD",t,Ee(Ee({},a),{},{noResolveJson:!0}),r)}async function Vi(s,t,a,r,n){return Nr(s,"DELETE",t,r,n,a)}var Ru=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t}then(s,t){return this.execute().then(s,t)}async execute(){var s=this;try{return{data:(await s.downloadFn()).body,error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(Qe(t))return{data:null,error:t};throw t}}};let lc;lc=Symbol.toStringTag;var Pu=class{constructor(s,t){this.downloadFn=s,this.shouldThrowOnError=t,this[lc]="BlobDownloadBuilder",this.promise=null}asStream(){return new Ru(this.downloadFn,this.shouldThrowOnError)}then(s,t){return this.getPromise().then(s,t)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var s=this;try{return{data:await(await s.downloadFn()).blob(),error:null}}catch(t){if(s.shouldThrowOnError)throw t;if(Qe(t))return{data:null,error:t};throw t}}};const zu={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Vo={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Du=class{constructor(s,t={},a,r){this.shouldThrowOnError=!1,this.url=s,this.headers=t,this.bucketId=a,this.fetch=qi(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(s,t,a,r){var n=this;try{let i;const o=Ee(Ee({},Vo),r);let l=Ee(Ee({},n.headers),s==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&a instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",n.encodeMetadata(c)),i.append("",a)):typeof FormData<"u"&&a instanceof FormData?(i=a,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",n.encodeMetadata(c))):(i=a,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=n.toBase64(n.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(l=Ee(Ee({},l),r.headers));const d=n._removeEmptyFolders(t),u=n._getFinalPath(d),v=await(s=="PUT"?ji:Xt)(n.fetch,`${n.url}/object/${u}`,i,Ee({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:d,id:v.Id,fullPath:v.Key},error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Qe(i))return{data:null,error:i};throw i}}async upload(s,t,a){return this.uploadOrUpdate("POST",s,t,a)}async uploadToSignedUrl(s,t,a,r){var n=this;const i=n._removeEmptyFolders(s),o=n._getFinalPath(i),l=new URL(n.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const d=Ee({upsert:Vo.upsert},r),u=Ee(Ee({},n.headers),{"x-upsert":String(d.upsert)});return typeof Blob<"u"&&a instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",a)):typeof FormData<"u"&&a instanceof FormData?(c=a,c.append("cacheControl",d.cacheControl)):(c=a,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType),{data:{path:i,fullPath:(await ji(n.fetch,l.toString(),c,{headers:u})).Key},error:null}}catch(c){if(n.shouldThrowOnError)throw c;if(Qe(c))return{data:null,error:c};throw c}}async createSignedUploadUrl(s,t){var a=this;try{let r=a._getFinalPath(s);const n=Ee({},a.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=await Xt(a.fetch,`${a.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(a.url+i.url),l=o.searchParams.get("token");if(!l)throw new kn("No token returned by API");return{data:{signedUrl:o.toString(),path:s,token:l},error:null}}catch(r){if(a.shouldThrowOnError)throw r;if(Qe(r))return{data:null,error:r};throw r}}async update(s,t,a){return this.uploadOrUpdate("PUT",s,t,a)}async move(s,t,a){var r=this;try{return{data:await Xt(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:s,destinationKey:t,destinationBucket:a==null?void 0:a.destinationBucket},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Qe(n))return{data:null,error:n};throw n}}async copy(s,t,a){var r=this;try{return{data:{path:(await Xt(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:s,destinationKey:t,destinationBucket:a==null?void 0:a.destinationBucket},{headers:r.headers})).Key},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Qe(n))return{data:null,error:n};throw n}}async createSignedUrl(s,t,a){var r=this;try{let n=r._getFinalPath(s),i=await Xt(r.fetch,`${r.url}/object/sign/${n}`,Ee({expiresIn:t},a!=null&&a.transform?{transform:a.transform}:{}),{headers:r.headers});const o=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return i={signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Qe(n))return{data:null,error:n};throw n}}async createSignedUrls(s,t,a){var r=this;try{const n=await Xt(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:t,paths:s},{headers:r.headers}),i=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return{data:n.map(o=>Ee(Ee({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Qe(n))return{data:null,error:n};throw n}}download(s,t){const a=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),n=r?`?${r}`:"",i=this._getFinalPath(s),o=()=>mr(this.fetch,`${this.url}/${a}/${i}${n}`,{headers:this.headers,noResolveJson:!0});return new Pu(o,this.shouldThrowOnError)}async info(s){var t=this;const a=t._getFinalPath(s);try{return{data:wi(await mr(t.fetch,`${t.url}/object/info/${a}`,{headers:t.headers})),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Qe(r))return{data:null,error:r};throw r}}async exists(s){var t=this;const a=t._getFinalPath(s);try{return await Ou(t.fetch,`${t.url}/object/${a}`,{headers:t.headers}),{data:!0,error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Qe(r)&&r instanceof vi){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}}getPublicUrl(s,t){const a=this._getFinalPath(s),r=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&r.push(n);const i=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});o!==""&&r.push(o);let l=r.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${a}${l}`)}}}async remove(s){var t=this;try{return{data:await Vi(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:s},{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}async list(s,t,a){var r=this;try{const n=Ee(Ee(Ee({},zu),t),{},{prefix:s||""});return{data:await Xt(r.fetch,`${r.url}/object/list/${r.bucketId}`,n,{headers:r.headers},a),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Qe(n))return{data:null,error:n};throw n}}async listV2(s,t){var a=this;try{const r=Ee({},s);return{data:await Xt(a.fetch,`${a.url}/object/list-v2/${a.bucketId}`,r,{headers:a.headers},t),error:null}}catch(r){if(a.shouldThrowOnError)throw r;if(Qe(r))return{data:null,error:r};throw r}}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const t=[];return s.width&&t.push(`width=${s.width}`),s.height&&t.push(`height=${s.height}`),s.resize&&t.push(`resize=${s.resize}`),s.format&&t.push(`format=${s.format}`),s.quality&&t.push(`quality=${s.quality}`),t.join("&")}};const cc="2.89.0",dc={"X-Client-Info":`storage-js/${cc}`};var $u=class{constructor(s,t={},a,r){this.shouldThrowOnError=!1;const n=new URL(s);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=Ee(Ee({},dc),t),this.fetch=qi(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(s){var t=this;try{const a=t.listBucketOptionsToQueryString(s);return{data:await mr(t.fetch,`${t.url}/bucket${a}`,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}async getBucket(s){var t=this;try{return{data:await mr(t.fetch,`${t.url}/bucket/${s}`,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}async createBucket(s,t={public:!1}){var a=this;try{return{data:await Xt(a.fetch,`${a.url}/bucket`,{id:s,name:s,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:a.headers}),error:null}}catch(r){if(a.shouldThrowOnError)throw r;if(Qe(r))return{data:null,error:r};throw r}}async updateBucket(s,t){var a=this;try{return{data:await ji(a.fetch,`${a.url}/bucket/${s}`,{id:s,name:s,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:a.headers}),error:null}}catch(r){if(a.shouldThrowOnError)throw r;if(Qe(r))return{data:null,error:r};throw r}}async emptyBucket(s){var t=this;try{return{data:await Xt(t.fetch,`${t.url}/bucket/${s}/empty`,{},{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}async deleteBucket(s){var t=this;try{return{data:await Vi(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}listBucketOptionsToQueryString(s){const t={};return s&&("limit"in s&&(t.limit=String(s.limit)),"offset"in s&&(t.offset=String(s.offset)),s.search&&(t.search=s.search),s.sortColumn&&(t.sortColumn=s.sortColumn),s.sortOrder&&(t.sortOrder=s.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},Lu=class{constructor(s,t={},a){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Ee(Ee({},dc),t),this.fetch=qi(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(s){var t=this;try{return{data:await Xt(t.fetch,`${t.url}/bucket`,{name:s},{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}async listBuckets(s){var t=this;try{const a=new URLSearchParams;(s==null?void 0:s.limit)!==void 0&&a.set("limit",s.limit.toString()),(s==null?void 0:s.offset)!==void 0&&a.set("offset",s.offset.toString()),s!=null&&s.sortColumn&&a.set("sortColumn",s.sortColumn),s!=null&&s.sortOrder&&a.set("sortOrder",s.sortOrder),s!=null&&s.search&&a.set("search",s.search);const r=a.toString(),n=r?`${t.url}/bucket?${r}`:`${t.url}/bucket`;return{data:await mr(t.fetch,n,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}async deleteBucket(s){var t=this;try{return{data:await Vi(t.fetch,`${t.url}/bucket/${s}`,{},{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Qe(a))return{data:null,error:a};throw a}}from(s){var t=this;if(!Su(s))throw new kn("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const a=new yu({baseUrl:this.url,catalogName:s,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(a,{get(n,i){const o=n[i];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(n,l),error:null}}catch(c){if(r)throw c;return{data:null,error:c}}}}})}};const Ki={"X-Client-Info":`storage-js/${cc}`,"Content-Type":"application/json"};var uc=class extends Error{constructor(s){super(s),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function zt(s){return typeof s=="object"&&s!==null&&"__isStorageVectorsError"in s}var qn=class extends uc{constructor(s,t,a){super(s),this.name="StorageVectorsApiError",this.status=t,this.statusCode=a}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Mu=class extends uc{constructor(s,t){super(s),this.name="StorageVectorsUnknownError",this.originalError=t}};const Wi=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),Uu=s=>{if(typeof s!="object"||s===null)return!1;const t=Object.getPrototypeOf(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},Ko=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Bu=async(s,t,a)=>{if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!(a!=null&&a.noResolveJson)){const r=s.status||500,n=s;if(typeof n.json=="function")n.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||r+"";t(new qn(Ko(i),r,o))}).catch(()=>{const i=r+"";t(new qn(n.statusText||`HTTP ${r} error`,r,i))});else{const i=r+"";t(new qn(n.statusText||`HTTP ${r} error`,r,i))}}else t(new Mu(Ko(s),s))},Fu=(s,t,a,r)=>{const n={method:s,headers:(t==null?void 0:t.headers)||{}};return r?(Uu(r)?(n.headers=Ee({"Content-Type":"application/json"},t==null?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,Ee(Ee({},n),a)):n};async function Gu(s,t,a,r,n,i){return new Promise((o,l)=>{s(a,Fu(t,r,n,i)).then(c=>{if(!c.ok)throw c;if(r!=null&&r.noResolveJson)return c;const d=c.headers.get("content-type");return!d||!d.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>Bu(c,l,r))})}async function Dt(s,t,a,r,n){return Gu(s,"POST",t,r,n,a)}var qu=class{constructor(s,t={},a){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Ee(Ee({},Ki),t),this.fetch=Wi(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(s){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/CreateIndex`,s,{headers:t.headers})||{},error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async getIndex(s,t){var a=this;try{return{data:await Dt(a.fetch,`${a.url}/GetIndex`,{vectorBucketName:s,indexName:t},{headers:a.headers}),error:null}}catch(r){if(a.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}async listIndexes(s){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/ListIndexes`,s,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async deleteIndex(s,t){var a=this;try{return{data:await Dt(a.fetch,`${a.url}/DeleteIndex`,{vectorBucketName:s,indexName:t},{headers:a.headers})||{},error:null}}catch(r){if(a.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}},Vu=class{constructor(s,t={},a){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Ee(Ee({},Ki),t),this.fetch=Wi(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(s){var t=this;try{if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Dt(t.fetch,`${t.url}/PutVectors`,s,{headers:t.headers})||{},error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async getVectors(s){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/GetVectors`,s,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async listVectors(s){var t=this;try{if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return{data:await Dt(t.fetch,`${t.url}/ListVectors`,s,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async queryVectors(s){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/QueryVectors`,s,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async deleteVectors(s){var t=this;try{if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Dt(t.fetch,`${t.url}/DeleteVectors`,s,{headers:t.headers})||{},error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}},Ku=class{constructor(s,t={},a){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Ee(Ee({},Ki),t),this.fetch=Wi(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(s){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{},error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async getBucket(s){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:s},{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async listBuckets(s={}){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/ListVectorBuckets`,s,{headers:t.headers}),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}async deleteBucket(s){var t=this;try{return{data:await Dt(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:t.headers})||{},error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(zt(a))return{data:null,error:a};throw a}}},Wu=class extends Ku{constructor(s,t={}){super(s,t.headers||{},t.fetch)}from(s){return new Hu(this.url,this.headers,s,this.fetch)}async createBucket(s){var t=()=>super.createBucket,a=this;return t().call(a,s)}async getBucket(s){var t=()=>super.getBucket,a=this;return t().call(a,s)}async listBuckets(s={}){var t=()=>super.listBuckets,a=this;return t().call(a,s)}async deleteBucket(s){var t=()=>super.deleteBucket,a=this;return t().call(a,s)}},Hu=class extends qu{constructor(s,t,a,r){super(s,t,r),this.vectorBucketName=a}async createIndex(s){var t=()=>super.createIndex,a=this;return t().call(a,Ee(Ee({},s),{},{vectorBucketName:a.vectorBucketName}))}async listIndexes(s={}){var t=()=>super.listIndexes,a=this;return t().call(a,Ee(Ee({},s),{},{vectorBucketName:a.vectorBucketName}))}async getIndex(s){var t=()=>super.getIndex,a=this;return t().call(a,a.vectorBucketName,s)}async deleteIndex(s){var t=()=>super.deleteIndex,a=this;return t().call(a,a.vectorBucketName,s)}index(s){return new Ju(this.url,this.headers,this.vectorBucketName,s,this.fetch)}},Ju=class extends Vu{constructor(s,t,a,r,n){super(s,t,n),this.vectorBucketName=a,this.indexName=r}async putVectors(s){var t=()=>super.putVectors,a=this;return t().call(a,Ee(Ee({},s),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName}))}async getVectors(s){var t=()=>super.getVectors,a=this;return t().call(a,Ee(Ee({},s),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName}))}async listVectors(s={}){var t=()=>super.listVectors,a=this;return t().call(a,Ee(Ee({},s),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName}))}async queryVectors(s){var t=()=>super.queryVectors,a=this;return t().call(a,Ee(Ee({},s),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName}))}async deleteVectors(s){var t=()=>super.deleteVectors,a=this;return t().call(a,Ee(Ee({},s),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName}))}},Yu=class extends $u{constructor(s,t={},a,r){super(s,t,a,r)}from(s){return new Du(this.url,this.headers,s,this.fetch)}get vectors(){return new Wu(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Lu(this.url+"/iceberg",this.headers,this.fetch)}};const hc="2.89.0",ba=30*1e3,yi=3,Vn=yi*ba,Qu="http://localhost:9999",Xu="supabase.auth.token",Zu={"X-Client-Info":`gotrue-js/${hc}`},Ni="X-Supabase-Api-Version",mc={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},eh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,th=10*60*1e3;class xr extends Error{constructor(t,a,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=a,this.code=r}}function Ne(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class sh extends xr{constructor(t,a,r){super(t,a,r),this.name="AuthApiError",this.status=a,this.code=r}}function ah(s){return Ne(s)&&s.name==="AuthApiError"}class Ws extends xr{constructor(t,a){super(t),this.name="AuthUnknownError",this.originalError=a}}class vs extends xr{constructor(t,a,r,n){super(t,r,n),this.name=a,this.status=r}}class Pt extends vs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function rh(s){return Ne(s)&&s.name==="AuthSessionMissingError"}class da extends vs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Jr extends vs{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Yr extends vs{constructor(t,a=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function nh(s){return Ne(s)&&s.name==="AuthImplicitGrantRedirectError"}class Wo extends vs{constructor(t,a=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ih extends vs{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class _i extends vs{constructor(t,a){super(t,"AuthRetryableFetchError",a,void 0)}}function Kn(s){return Ne(s)&&s.name==="AuthRetryableFetchError"}class Ho extends vs{constructor(t,a,r){super(t,"AuthWeakPasswordError",a,"weak_password"),this.reasons=r}}class ki extends vs{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const gn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Jo=` 	
\r=`.split(""),oh=(()=>{const s=new Array(128);for(let t=0;t<s.length;t+=1)s[t]=-1;for(let t=0;t<Jo.length;t+=1)s[Jo[t].charCodeAt(0)]=-2;for(let t=0;t<gn.length;t+=1)s[gn[t].charCodeAt(0)]=t;return s})();function Yo(s,t,a){if(s!==null)for(t.queue=t.queue<<8|s,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;a(gn[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;a(gn[r]),t.queuedBits-=6}}function xc(s,t,a){const r=oh[s];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)a(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function Qo(s){const t=[],a=o=>{t.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{dh(o,r,a)};for(let o=0;o<s.length;o+=1)xc(s.charCodeAt(o),n,i);return t.join("")}function lh(s,t){if(s<=127){t(s);return}else if(s<=2047){t(192|s>>6),t(128|s&63);return}else if(s<=65535){t(224|s>>12),t(128|s>>6&63),t(128|s&63);return}else if(s<=1114111){t(240|s>>18),t(128|s>>12&63),t(128|s>>6&63),t(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function ch(s,t){for(let a=0;a<s.length;a+=1){let r=s.charCodeAt(a);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(a+1)-56320&65535|n)+65536,a+=1}lh(r,t)}}function dh(s,t,a){if(t.utf8seq===0){if(s<=127){a(s);return}for(let r=1;r<6;r+=1)if(!(s>>7-r&1)){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=s&31;else if(t.utf8seq===3)t.codepoint=s&15;else if(t.utf8seq===4)t.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|s&63,t.utf8seq-=1,t.utf8seq===0&&a(t.codepoint)}}function ka(s){const t=[],a={queue:0,queuedBits:0},r=n=>{t.push(n)};for(let n=0;n<s.length;n+=1)xc(s.charCodeAt(n),a,r);return new Uint8Array(t)}function uh(s){const t=[];return ch(s,a=>t.push(a)),new Uint8Array(t)}function Hs(s){const t=[],a={queue:0,queuedBits:0},r=n=>{t.push(n)};return s.forEach(n=>Yo(n,a,r)),Yo(null,a,r),t.join("")}function hh(s){return Math.round(Date.now()/1e3)+s}function mh(){return Symbol("auth-callback")}const ht=()=>typeof window<"u"&&typeof document<"u",Us={tested:!1,writable:!1},pc=()=>{if(!ht())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Us.tested)return Us.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Us.tested=!0,Us.writable=!0}catch{Us.tested=!0,Us.writable=!1}return Us.writable};function xh(s){const t={},a=new URL(s);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((n,i)=>{t[i]=n})}catch{}return a.searchParams.forEach((r,n)=>{t[n]=r}),t}const fc=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),ph=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",va=async(s,t,a)=>{await s.setItem(t,JSON.stringify(a))},Bs=async(s,t)=>{const a=await s.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch{return a}},dt=async(s,t)=>{await s.removeItem(t)};class Sn{constructor(){this.promise=new Sn.promiseConstructor((t,a)=>{this.resolve=t,this.reject=a})}}Sn.promiseConstructor=Promise;function Wn(s){const t=s.split(".");if(t.length!==3)throw new ki("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!eh.test(t[r]))throw new ki("JWT not in base64url format");return{header:JSON.parse(Qo(t[0])),payload:JSON.parse(Qo(t[1])),signature:ka(t[2]),raw:{header:t[0],payload:t[1]}}}async function fh(s){return await new Promise(t=>{setTimeout(()=>t(null),s)})}function gh(s,t){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await s(i);if(!t(i,null,o)){r(o);return}}catch(o){if(!t(i,o)){n(o);return}}})()})}function bh(s){return("0"+s.toString(16)).substr(-2)}function vh(){const t=new Uint32Array(56);if(typeof crypto>"u"){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=a.length;let n="";for(let i=0;i<56;i++)n+=a.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(t),Array.from(t,bh).join("")}async function wh(s){const a=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",a),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function jh(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const a=await wh(s);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ua(s,t,a=!1){const r=vh();let n=r;a&&(n+="/PASSWORD_RECOVERY"),await va(s,`${t}-code-verifier`,n);const i=await jh(r);return[i,r===i?"plain":"s256"]}const yh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Nh(s){const t=s.headers.get(Ni);if(!t||!t.match(yh))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function _h(s){if(!s)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(s<=t)throw new Error("JWT has expired")}function kh(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Sh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ha(s){if(!Sh.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Hn(){const s={};return new Proxy(s,{get:(t,a)=>{if(a==="__isUserNotAvailableProxy")return!0;if(typeof a=="symbol"){const r=a.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${a}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Eh(s,t){return new Proxy(s,{get:(a,r,n)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(a,r,n)}return!t.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(a,r,n)}})}function Xo(s){return JSON.parse(JSON.stringify(s))}const Vs=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Ch=[502,503,504];async function Zo(s){var t;if(!ph(s))throw new _i(Vs(s),0);if(Ch.includes(s.status))throw new _i(Vs(s),s.status);let a;try{a=await s.json()}catch(i){throw new Ws(Vs(i),i)}let r;const n=Nh(s);if(n&&n.getTime()>=mc["2024-01-01"].timestamp&&typeof a=="object"&&a&&typeof a.code=="string"?r=a.code:typeof a=="object"&&a&&typeof a.error_code=="string"&&(r=a.error_code),r){if(r==="weak_password")throw new Ho(Vs(a),s.status,((t=a.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new Pt}else if(typeof a=="object"&&a&&typeof a.weak_password=="object"&&a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ho(Vs(a),s.status,a.weak_password.reasons);throw new sh(Vs(a),s.status||500,r)}const Ih=(s,t,a,r)=>{const n={method:s,headers:(t==null?void 0:t.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),a))};async function Se(s,t,a,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[Ni]||(i[Ni]=mc["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Th(s,t,a+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Th(s,t,a,r,n,i){const o=Ih(t,r,n,i);let l;try{l=await s(a,Object.assign({},o))}catch(c){throw console.error(c),new _i(Vs(c),0)}if(l.ok||await Zo(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await Zo(c)}}function Qt(s){var t;let a=null;Rh(s)&&(a=Object.assign({},s),s.expires_at||(a.expires_at=hh(s.expires_in)));const r=(t=s.user)!==null&&t!==void 0?t:s;return{data:{session:a,user:r},error:null}}function el(s){const t=Qt(s);return!t.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((a,r)=>a&&typeof r=="string",!0)&&(t.data.weak_password=s.weak_password),t}function Os(s){var t;return{data:{user:(t=s.user)!==null&&t!==void 0?t:s},error:null}}function Ah(s){return{data:s,error:null}}function Oh(s){const{action_link:t,email_otp:a,hashed_token:r,redirect_to:n,verification_type:i}=s,o=_n(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:a,hashed_token:r,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function tl(s){return s}function Rh(s){return s.access_token&&s.refresh_token&&s.expires_in}const Jn=["global","local","others"];class Ph{constructor({url:t="",headers:a={},fetch:r}){this.url=t,this.headers=a,this.fetch=fc(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,a=Jn[0]){if(Jn.indexOf(a)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Jn.join(", ")}`);try{return await Se(this.fetch,"POST",`${this.url}/logout?scope=${a}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,a={}){try{return await Se(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:a.data},headers:this.headers,redirectTo:a.redirectTo,xform:Os})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:a}=t,r=_n(t,["options"]),n=Object.assign(Object.assign({},r),a);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await Se(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Oh,redirectTo:a==null?void 0:a.redirectTo})}catch(a){if(Ne(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(t){try{return await Se(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Os})}catch(a){if(Ne(a))return{data:{user:null},error:a};throw a}}async listUsers(t){var a,r,n,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await Se(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(a=t==null?void 0:t.page)===null||a===void 0?void 0:a.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=t==null?void 0:t.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:tl});if(u.error)throw u.error;const v=await u.json(),j=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,w=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return w.length>0&&(w.forEach(N=>{const D=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(N.split(";")[1].split("=")[1]);d[`${E}Page`]=D}),d.total=parseInt(j)),{data:Object.assign(Object.assign({},v),d),error:null}}catch(d){if(Ne(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){ha(t);try{return await Se(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Os})}catch(a){if(Ne(a))return{data:{user:null},error:a};throw a}}async updateUserById(t,a){ha(t);try{return await Se(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:a,headers:this.headers,xform:Os})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,a=!1){ha(t);try{return await Se(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:a},xform:Os})}catch(r){if(Ne(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){ha(t.userId);try{const{data:a,error:r}=await Se(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:a,error:r}}catch(a){if(Ne(a))return{data:null,error:a};throw a}}async _deleteFactor(t){ha(t.userId),ha(t.id);try{return{data:await Se(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(a){if(Ne(a))return{data:null,error:a};throw a}}async _listOAuthClients(t){var a,r,n,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await Se(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(a=t==null?void 0:t.page)===null||a===void 0?void 0:a.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=t==null?void 0:t.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:tl});if(u.error)throw u.error;const v=await u.json(),j=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,w=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return w.length>0&&(w.forEach(N=>{const D=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(N.split(";")[1].split("=")[1]);d[`${E}Page`]=D}),d.total=parseInt(j)),{data:Object.assign(Object.assign({},v),d),error:null}}catch(d){if(Ne(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(t){try{return await Se(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Ne(a))return{data:null,error:a};throw a}}async _getOAuthClient(t){try{return await Se(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Ne(a))return{data:null,error:a};throw a}}async _updateOAuthClient(t,a){try{return await Se(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:a,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ne(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await Se(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(Ne(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(t){try{return await Se(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Ne(a))return{data:null,error:a};throw a}}}function sl(s={}){return{getItem:t=>s[t]||null,setItem:(t,a)=>{s[t]=a},removeItem:t=>{delete s[t]}}}const ma={debug:!!(globalThis&&pc()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class gc extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class zh extends gc{}async function Dh(s,t,a){ma.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),ma.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){ma.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await a()}finally{ma.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(t===0)throw ma.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new zh(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(ma.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await a()}}))}function $h(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function bc(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function Lh(s){return parseInt(s,16)}function Mh(s){const t=new TextEncoder().encode(s);return"0x"+Array.from(t,r=>r.toString(16).padStart(2,"0")).join("")}function Uh(s){var t;const{chainId:a,domain:r,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:c,resources:d,scheme:u,uri:v,version:j}=s;{if(!Number.isInteger(a))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${a}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(j!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${j}`);if(!((t=s.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const w=bc(s.address),N=u?`${u}://${r}`:r,D=s.statement?`${s.statement}
`:"",E=`${N} wants you to sign in with your Ethereum account:
${w}

${D}`;let O=`URI: ${v}
Version: ${j}
Chain ID: ${a}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(O+=`
Expiration Time: ${n.toISOString()}`),l&&(O+=`
Not Before: ${l.toISOString()}`),c&&(O+=`
Request ID: ${c}`),d){let A=`
Resources:`;for(const B of d){if(!B||typeof B!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${B}`);A+=`
- ${B}`}O+=A}return`${E}
${O}`}class st extends Error{constructor({message:t,code:a,cause:r,name:n}){var i;super(t,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=n??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=a}}class bn extends st{constructor(t,a){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a,message:t}),this.name="WebAuthnUnknownError",this.originalError=a}}function Bh({error:s,options:t}){var a,r,n;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new st({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((a=i.authenticatorSelection)===null||a===void 0?void 0:a.requireResidentKey)===!0)return new st({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(t.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new st({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new st({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new st({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new st({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new st({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new st({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(vc(o)){if(i.rp.id!==o)return new st({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new st({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new st({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new st({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new st({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function Fh({error:s,options:t}){const{publicKey:a}=t;if(!a)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(t.signal instanceof AbortSignal)return new st({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new st({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const r=window.location.hostname;if(vc(r)){if(a.rpId!==r)return new st({message:`The RP ID "${a.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new st({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new st({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new st({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class Gh{createNewAbortSignal(){if(this.controller){const a=new Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const qh=new Gh;function Vh(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:t,user:a,excludeCredentials:r}=s,n=_n(s,["challenge","user","excludeCredentials"]),i=ka(t).buffer,o=Object.assign(Object.assign({},a),{id:ka(a.id).buffer}),l=Object.assign(Object.assign({},n),{challenge:i,user:o});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const d=r[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:ka(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function Kh(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:t,allowCredentials:a}=s,r=_n(s,["challenge","allowCredentials"]),n=ka(t).buffer,i=Object.assign(Object.assign({},r),{challenge:n});if(a&&a.length>0){i.allowCredentials=new Array(a.length);for(let o=0;o<a.length;o++){const l=a[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:ka(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function Wh(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const a=s;return{id:s.id,rawId:s.id,response:{attestationObject:Hs(new Uint8Array(s.response.attestationObject)),clientDataJSON:Hs(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(t=a.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Hh(s){var t;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const a=s,r=s.getClientExtensionResults(),n=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:Hs(new Uint8Array(n.authenticatorData)),clientDataJSON:Hs(new Uint8Array(n.clientDataJSON)),signature:Hs(new Uint8Array(n.signature)),userHandle:n.userHandle?Hs(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(t=a.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function vc(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function al(){var s,t;return!!(ht()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator==null?void 0:navigator.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Jh(s){try{const t=await navigator.credentials.create(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new bn("Browser returned unexpected credential type",t)}:{data:null,error:new bn("Empty credential response",t)}}catch(t){return{data:null,error:Bh({error:t,options:s})}}}async function Yh(s){try{const t=await navigator.credentials.get(s);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new bn("Browser returned unexpected credential type",t)}:{data:null,error:new bn("Empty credential response",t)}}catch(t){return{data:null,error:Fh({error:t,options:s})}}}const Qh={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Xh={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function vn(...s){const t=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),a=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),r={};for(const n of s)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(a(o))r[i]=o;else if(t(o)){const l=r[i];t(l)?r[i]=vn(l,o):r[i]=vn(o)}else r[i]=o}return r}function Zh(s,t){return vn(Qh,s,t||{})}function e0(s,t){return vn(Xh,s,t||{})}class t0{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:a,friendlyName:r,signal:n},i){try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:a});if(!o)return{data:null,error:l};const c=n??qh.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:d}=o.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${r}`),d.displayName||(d.displayName=d.name)}switch(o.webauthn.type){case"create":{const d=Zh(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:v}=await Jh({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:v}}case"request":{const d=e0(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:v}=await Yh(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:u}},error:null}:{data:null,error:v}}}}catch(o){return Ne(o)?{data:null,error:o}:{data:null,error:new Ws("Unexpected error in challenge",o)}}}async _verify({challengeId:t,factorId:a,webauthn:r}){return this.client.mfa.verify({factorId:a,challengeId:t,webauthn:r})}async _authenticate({factorId:t,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!a)return{data:null,error:new xr("rpId is required for WebAuthn authentication")};try{if(!al())return{data:null,error:new Ws("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:t,webauthn:{rpId:a,rpOrigins:r},signal:n},{request:i});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:c.type,rpId:a,rpOrigins:r,credential_response:c.credential_response}})}catch(o){return Ne(o)?{data:null,error:o}:{data:null,error:new Ws("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!a)return{data:null,error:new xr("rpId is required for WebAuthn registration")};try{if(!al())return{data:null,error:new Ws("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(u=>{var v;return(v=u.data)===null||v===void 0?void 0:v.all.find(j=>j.factor_type==="webauthn"&&j.friendly_name===t&&j.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:a,rpOrigins:r},signal:n},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:a,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(o){return Ne(o)?{data:null,error:o}:{data:null,error:new Ws("Unexpected error in register",o)}}}}$h();const s0={url:Qu,storageKey:Xu,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Zu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function rl(s,t,a){return await a()}const xa={};class pr{get jwks(){var t,a;return(a=(t=xa[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&a!==void 0?a:{keys:[]}}set jwks(t){xa[this.storageKey]=Object.assign(Object.assign({},xa[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,a;return(a=(t=xa[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&a!==void 0?a:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){xa[this.storageKey]=Object.assign(Object.assign({},xa[this.storageKey]),{cachedAt:t})}constructor(t){var a,r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},s0),t);if(this.storageKey=i.storageKey,this.instanceID=(a=pr.nextInstanceID[this.storageKey])!==null&&a!==void 0?a:0,pr.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&ht()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Ph({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=fc(i.fetch),this.lock=i.lock||rl,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&ht()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=Dh:this.lock=rl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new t0(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:pc()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=sl(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=sl(this.memoryStorage)),ht()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${hc}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let a={},r="none";if(ht()&&(a=xh(window.location.href),this._isImplicitGrantCallback(a)?r="implicit":await this._isPKCECallback(a)&&(r="pkce")),ht()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(a,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),nh(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(a){return Ne(a)?this._returnResult({error:a}):this._returnResult({error:new Ws("Unexpected error during initialization",a)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var a,r,n;try{const i=await Se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=t==null?void 0:t.options)===null||n===void 0?void 0:n.captchaToken}},xform:Qt}),{data:o,error:l}=i;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(Ne(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(t){var a,r,n;try{let i;if("email"in t){const{email:u,password:v,options:j}=t;let w=null,N=null;this.flowType==="pkce"&&([w,N]=await ua(this.storage,this.storageKey)),i=await Se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:j==null?void 0:j.emailRedirectTo,body:{email:u,password:v,data:(a=j==null?void 0:j.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:j==null?void 0:j.captchaToken},code_challenge:w,code_challenge_method:N},xform:Qt})}else if("phone"in t){const{phone:u,password:v,options:j}=t;i=await Se(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:v,data:(r=j==null?void 0:j.data)!==null&&r!==void 0?r:{},channel:(n=j==null?void 0:j.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:j==null?void 0:j.captchaToken}},xform:Qt})}else throw new Jr("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return await dt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(await dt(this.storage,`${this.storageKey}-code-verifier`),Ne(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(t){try{let a;if("email"in t){const{email:i,password:o,options:l}=t;a=await Se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:el})}else if("phone"in t){const{phone:i,password:o,options:l}=t;a=await Se(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:el})}else throw new Jr("You must provide either an email or phone number and a password");const{data:r,error:n}=a;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!r||!r.session||!r.user){const i=new da;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(a){if(Ne(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOAuth(t){var a,r,n,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(a=t.options)===null||a===void 0?void 0:a.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=t.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:a}=t;switch(a){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${a}"`)}}async signInWithEthereum(t){var a,r,n,i,o,l,c,d,u,v,j;let w,N;if("message"in t)w=t.message,N=t.signature;else{const{chain:D,wallet:E,statement:O,options:A}=t;let B;if(ht())if(typeof E=="object")B=E;else{const b=window;if("ethereum"in b&&typeof b.ethereum=="object"&&"request"in b.ethereum&&typeof b.ethereum.request=="function")B=b.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!(A!=null&&A.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");B=E}const Z=new URL((a=A==null?void 0:A.url)!==null&&a!==void 0?a:window.location.href),F=await B.request({method:"eth_requestAccounts"}).then(b=>b).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!F||F.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const H=bc(F[0]);let Y=(r=A==null?void 0:A.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!Y){const b=await B.request({method:"eth_chainId"});Y=Lh(b)}const x={domain:Z.host,address:H,statement:O,uri:Z.href,version:"1",chainId:Y,nonce:(n=A==null?void 0:A.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=A==null?void 0:A.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=A==null?void 0:A.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=A==null?void 0:A.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=A==null?void 0:A.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=A==null?void 0:A.signInWithEthereum)===null||u===void 0?void 0:u.resources};w=Uh(x),N=await B.request({method:"personal_sign",params:[Mh(w),H]})}try{const{data:D,error:E}=await Se(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:w,signature:N},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(j=t.options)===null||j===void 0?void 0:j.captchaToken}}:null),xform:Qt});if(E)throw E;if(!D||!D.session||!D.user){const O=new da;return this._returnResult({data:{user:null,session:null},error:O})}return D.session&&(await this._saveSession(D.session),await this._notifyAllSubscribers("SIGNED_IN",D.session)),this._returnResult({data:Object.assign({},D),error:E})}catch(D){if(Ne(D))return this._returnResult({data:{user:null,session:null},error:D});throw D}}async signInWithSolana(t){var a,r,n,i,o,l,c,d,u,v,j,w;let N,D;if("message"in t)N=t.message,D=t.signature;else{const{chain:E,wallet:O,statement:A,options:B}=t;let Z;if(ht())if(typeof O=="object")Z=O;else{const H=window;if("solana"in H&&typeof H.solana=="object"&&("signIn"in H.solana&&typeof H.solana.signIn=="function"||"signMessage"in H.solana&&typeof H.solana.signMessage=="function"))Z=H.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof O!="object"||!(B!=null&&B.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Z=O}const F=new URL((a=B==null?void 0:B.url)!==null&&a!==void 0?a:window.location.href);if("signIn"in Z&&Z.signIn){const H=await Z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},B==null?void 0:B.signInWithSolana),{version:"1",domain:F.host,uri:F.href}),A?{statement:A}:null));let Y;if(Array.isArray(H)&&H[0]&&typeof H[0]=="object")Y=H[0];else if(H&&typeof H=="object"&&"signedMessage"in H&&"signature"in H)Y=H;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Y&&"signature"in Y&&(typeof Y.signedMessage=="string"||Y.signedMessage instanceof Uint8Array)&&Y.signature instanceof Uint8Array)N=typeof Y.signedMessage=="string"?Y.signedMessage:new TextDecoder().decode(Y.signedMessage),D=Y.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Z)||typeof Z.signMessage!="function"||!("publicKey"in Z)||typeof Z!="object"||!Z.publicKey||!("toBase58"in Z.publicKey)||typeof Z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");N=[`${F.host} wants you to sign in with your Solana account:`,Z.publicKey.toBase58(),...A?["",A,""]:[""],"Version: 1",`URI: ${F.href}`,`Issued At: ${(n=(r=B==null?void 0:B.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=B==null?void 0:B.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${B.signInWithSolana.notBefore}`]:[],...!((o=B==null?void 0:B.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${B.signInWithSolana.expirationTime}`]:[],...!((l=B==null?void 0:B.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${B.signInWithSolana.chainId}`]:[],...!((c=B==null?void 0:B.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${B.signInWithSolana.nonce}`]:[],...!((d=B==null?void 0:B.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${B.signInWithSolana.requestId}`]:[],...!((v=(u=B==null?void 0:B.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||v===void 0)&&v.length?["Resources",...B.signInWithSolana.resources.map(Y=>`- ${Y}`)]:[]].join(`
`);const H=await Z.signMessage(new TextEncoder().encode(N),"utf8");if(!H||!(H instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");D=H}}try{const{data:E,error:O}=await Se(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:N,signature:Hs(D)},!((j=t.options)===null||j===void 0)&&j.captchaToken?{gotrue_meta_security:{captcha_token:(w=t.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Qt});if(O)throw O;if(!E||!E.session||!E.user){const A=new da;return this._returnResult({data:{user:null,session:null},error:A})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:O})}catch(E){if(Ne(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async _exchangeCodeForSession(t){const a=await Bs(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(a??"").split("/");try{if(!r&&this.flowType==="pkce")throw new ih;const{data:i,error:o}=await Se(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:Qt});if(await dt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const l=new da;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(await dt(this.storage,`${this.storageKey}-code-verifier`),Ne(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(t){try{const{options:a,provider:r,token:n,access_token:i,nonce:o}=t,l=await Se(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Qt}),{data:c,error:d}=l;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const u=new da;return this._returnResult({data:{user:null,session:null},error:u})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(a){if(Ne(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOtp(t){var a,r,n,i,o;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await ua(this.storage,this.storageKey));const{error:v}=await Se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await Se(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u})}throw new Jr("You must provide either an email or phone number.")}catch(l){if(await dt(this.storage,`${this.storageKey}-code-verifier`),Ne(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(t){var a,r;try{let n,i;"options"in t&&(n=(a=t.options)===null||a===void 0?void 0:a.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await Se(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Qt});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(n){if(Ne(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(t){var a,r,n,i,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await ua(this.storage,this.storageKey));const d=await Se(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(a=t.options)===null||a===void 0?void 0:a.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=t==null?void 0:t.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:Ah});return!((i=d.data)===null||i===void 0)&&i.url&&ht()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(l){if(await dt(this.storage,`${this.storageKey}-code-verifier`),Ne(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:a},error:r}=t;if(r)throw r;if(!a)throw new Pt;const{error:n}=await Se(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:a.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(t){if(Ne(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const a=`${this.url}/resend`;if("email"in t){const{email:r,type:n,options:i}=t,{error:o}=await Se(this.fetch,"POST",a,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:r,type:n,options:i}=t,{data:o,error:l}=await Se(this.fetch,"POST",a,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l})}throw new Jr("You must provide either an email or phone number and a type")}catch(a){if(Ne(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(t,a){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await a()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=a();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const a=await this.__loadSession();return await t(a)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const a=await Bs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",a),a!==null&&(this._isValidSession(a)?t=a:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<Vn:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const o=await Bs(this.userStorage,this.storageKey+"-user");o!=null&&o.user?t.user=o.user:t.user=Hn()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=Eh(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:n,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const a=await this._acquireLock(-1,async()=>await this._getUser());return a.data.user&&(this.suppressGetSessionWarning=!0),a}async _getUser(t){try{return t?await Se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Os}):await this._useSession(async a=>{var r,n,i;const{data:o,error:l}=a;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Pt}:await Se(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Os})})}catch(a){if(Ne(a))return rh(a)&&(await this._removeSession(),await dt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:a});throw a}}async updateUser(t,a={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,a))}async _updateUser(t,a={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new Pt;const o=n.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await ua(this.storage,this.storageKey));const{data:d,error:u}=await Se(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:a==null?void 0:a.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Os});if(u)throw u;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await dt(this.storage,`${this.storageKey}-code-verifier`),Ne(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Pt;const a=Date.now()/1e3;let r=a,n=!0,i=null;const{payload:o}=Wn(t.access_token);if(o.exp&&(r=o.exp,n=r<=a),n){const{data:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:r-a,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(a){if(Ne(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async a=>{var r;if(!t){const{data:o,error:l}=a;if(l)throw l;t=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(t!=null&&t.refresh_token))throw new Pt;const{data:n,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(a){if(Ne(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _getSessionFromURL(t,a){try{if(!ht())throw new Yr("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Yr(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(a){case"implicit":if(this.flowType==="pkce")throw new Wo("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Yr("Not a valid implicit grant flow url.");break;default:}if(a==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Wo("No code detected.");const{data:A,error:B}=await this._exchangeCodeForSession(t.code);if(B)throw B;const Z=new URL(window.location.href);return Z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Z.toString()),{data:{session:A.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=t;if(!i||!l||!o||!d)throw new Yr("No session defined in URL");const u=Math.round(Date.now()/1e3),v=parseInt(l);let j=u+v;c&&(j=parseInt(c));const w=j-u;w*1e3<=ba&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${w}s, should have been closer to ${v}s`);const N=j-v;u-N>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",N,j,u):u-N<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",N,j,u);const{data:D,error:E}=await this._getUser(i);if(E)throw E;const O={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:v,expires_at:j,refresh_token:o,token_type:d,user:D.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:O,redirectType:t.type},error:null})}catch(r){if(Ne(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const a=await Bs(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&a)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async a=>{var r;const{data:n,error:i}=a;if(i)return this._returnResult({error:i});const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,t);if(l&&!(ah(l)&&(l.status===404||l.status===401||l.status===403)))return this._returnResult({error:l})}return t!=="others"&&(await this._removeSession(),await dt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const a=mh(),r={id:a,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",a),this.stateChangeEmitters.delete(a)}};return this._debug("#onAuthStateChange()","registered callback with id",a),this.stateChangeEmitters.set(a,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(a)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async a=>{var r,n;try{const{data:{session:i},error:o}=a;if(o)throw o;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,a={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await ua(this.storage,this.storageKey,!0));try{return await Se(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:a.captchaToken}},headers:this.headers,redirectTo:a.redirectTo})}catch(i){if(await dt(this.storage,`${this.storageKey}-code-verifier`),Ne(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var t;try{const{data:a,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(t=a.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var a;try{const{data:r,error:n}=await this._useSession(async i=>{var o,l,c,d,u;const{data:v,error:j}=i;if(j)throw j;const w=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Se(this.fetch,"GET",w,{headers:this.headers,jwt:(u=(d=v.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return ht()&&!(!((a=t.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:t.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Ne(r))return this._returnResult({data:{provider:t.provider,url:null},error:r});throw r}}async linkIdentityIdToken(t){return await this._useSession(async a=>{var r;try{const{error:n,data:{session:i}}=a;if(n)throw n;const{options:o,provider:l,token:c,access_token:d,nonce:u}=t,v=await Se(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:l,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Qt}),{data:j,error:w}=v;return w?this._returnResult({data:{user:null,session:null},error:w}):!j||!j.session||!j.user?this._returnResult({data:{user:null,session:null},error:new da}):(j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("USER_UPDATED",j.session)),this._returnResult({data:j,error:w}))}catch(n){if(await dt(this.storage,`${this.storageKey}-code-verifier`),Ne(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(t){try{return await this._useSession(async a=>{var r,n;const{data:i,error:o}=a;if(o)throw o;return await Se(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}}async _refreshAccessToken(t){const a=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{const r=Date.now();return await gh(async n=>(n>0&&await fh(200*Math.pow(2,n-1)),this._debug(a,"refreshing attempt",n),await Se(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Qt})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Kn(i)&&Date.now()+o-r<ba})}catch(r){if(this._debug(a,"error",r),Ne(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(a,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,a){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:a.redirectTo,scopes:a.scopes,queryParams:a.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",a,"url",r),ht()&&!a.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,a;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await Bs(this.storage,this.storageKey);if(n&&this.userStorage){let o=await Bs(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await va(this.userStorage,this.storageKey+"-user",o)),n.user=(t=o==null?void 0:o.user)!==null&&t!==void 0?t:Hn()}else if(n&&!n.user&&!n.user){const o=await Bs(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,await dt(this.storage,this.storageKey+"-user"),await va(this.storage,this.storageKey,n)):n.user=Hn()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const i=((a=n.expires_at)!==null&&a!==void 0?a:1/0)*1e3-Date.now()<Vn;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Vn}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Kn(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(n.access_token);!l&&(o!=null&&o.user)?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var a,r;if(!t)throw new Pt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Sn;const{data:i,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!i.session)throw new Pt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),Ne(i)){const o={data:null,error:i};return Kn(i)||await this._removeSession(),(a=this.refreshingDeferred)===null||a===void 0||a.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(t,a,r=!0){const n=`#_notifyAllSubscribers(${t})`;this._debug(n,"begin",a,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:a});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,a)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await dt(this.storage,`${this.storageKey}-code-verifier`);const a=Object.assign({},t),r=a.user&&a.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&a.user&&await va(this.userStorage,this.storageKey+"-user",{user:a.user});const n=Object.assign({},a);delete n.user;const i=Xo(n);await va(this.storage,this.storageKey,i)}else{const n=Xo(a);await va(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await dt(this.storage,this.storageKey),await dt(this.storage,this.storageKey+"-code-verifier"),await dt(this.storage,this.storageKey+"-user"),this.userStorage&&await dt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ht()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(a){console.error("removing visibilitychange callback failed",a)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),ba);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async a=>{const{data:{session:r}}=a;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-t)/ba);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${ba}ms, refresh threshold is ${yi} ticks`),n<=yi&&await this._callRefreshToken(r.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof gc)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ht()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const a=`#_onVisibilityChanged(${t})`;this._debug(a,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(a,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,a,r){const n=[`provider=${encodeURIComponent(a)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await ua(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${n.join("&")}`}async _unenroll(t){try{return await this._useSession(async a=>{var r;const{data:n,error:i}=a;return i?this._returnResult({data:null,error:i}):await Se(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}}async _enroll(t){try{return await this._useSession(async a=>{var r,n;const{data:i,error:o}=a;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:d}=await Se(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?this._returnResult({data:null,error:d}):(t.factorType==="totp"&&c.type==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var r;const{data:n,error:i}=a;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Wh(t.webauthn.credential_response):Hh(t.webauthn.credential_response)})}:{code:t.code}),{data:l,error:c}=await Se(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var r;const{data:n,error:i}=a;if(i)return this._returnResult({data:null,error:i});const o=await Se(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:Vh(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:Kh(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}})}async _challengeAndVerify(t){const{data:a,error:r}=await this._challenge({factorId:t.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:t.factorId,challengeId:a.id,code:t.code})}async _listFactors(){var t;const{data:{user:a},error:r}=await this.getUser();if(r)return{data:null,error:r};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(t=a==null?void 0:a.factors)!==null&&t!==void 0?t:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var t,a;const{data:{session:r},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Wn(r.access_token);let o=null;i.aal&&(o=i.aal);let l=o;((a=(t=r.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(l="aal2");const d=i.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async a=>{const{data:{session:r},error:n}=a;return n?this._returnResult({data:null,error:n}):r?await Se(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Pt})})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}}async _approveAuthorization(t,a){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Pt});const o=await Se(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&ht()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ne(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(t,a){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Pt});const o=await Se(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&ht()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ne(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:a},error:r}=t;return r?this._returnResult({data:null,error:r}):a?await Se(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new Pt})})}catch(t){if(Ne(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async a=>{const{data:{session:r},error:n}=a;return n?this._returnResult({data:null,error:n}):r?(await Se(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Pt})})}catch(a){if(Ne(a))return this._returnResult({data:null,error:a});throw a}}async fetchJwk(t,a={keys:[]}){let r=a.keys.find(l=>l.kid===t);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(l=>l.kid===t),r&&this.jwks_cached_at+th>n)return r;const{data:i,error:o}=await Se(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,r=i.keys.find(l=>l.kid===t),!r)?null:r}async getClaims(t,a={}){try{let r=t;if(!r){const{data:w,error:N}=await this.getSession();if(N||!w.session)return this._returnResult({data:null,error:N});r=w.session.access_token}const{header:n,payload:i,signature:o,raw:{header:l,payload:c}}=Wn(r);a!=null&&a.allowExpired||_h(i.exp);const d=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,a!=null&&a.keys?{keys:a.keys}:a==null?void 0:a.jwks);if(!d){const{error:w}=await this.getUser(r);if(w)throw w;return{data:{claims:i,header:n,signature:o},error:null}}const u=kh(n.alg),v=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,v,o,uh(`${l}.${c}`)))throw new ki("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(r){if(Ne(r))return this._returnResult({data:null,error:r});throw r}}}pr.nextInstanceID={};const a0=pr,r0="2.89.0";let Ya="";typeof Deno<"u"?Ya="deno":typeof document<"u"?Ya="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ya="react-native":Ya="node";const n0={"X-Client-Info":`supabase-js-${Ya}/${r0}`},i0={headers:n0},o0={schema:"public"},l0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},c0={};function fr(s){"@babel/helpers - typeof";return fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fr(s)}function d0(s,t){if(fr(s)!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var r=a.call(s,t);if(fr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(s)}function u0(s){var t=d0(s,"string");return fr(t)=="symbol"?t:t+""}function h0(s,t,a){return(t=u0(t))in s?Object.defineProperty(s,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[t]=a,s}function nl(s,t){var a=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),a.push.apply(a,r)}return a}function et(s){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?nl(Object(a),!0).forEach(function(r){h0(s,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):nl(Object(a)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(a,r))})}return s}const m0=s=>s?(...t)=>s(...t):(...t)=>fetch(...t),x0=()=>Headers,p0=(s,t,a)=>{const r=m0(a),n=x0();return async(i,o)=>{var l;const c=(l=await t())!==null&&l!==void 0?l:s;let d=new n(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",s),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,et(et({},o),{},{headers:d}))}};function f0(s){return s.endsWith("/")?s:s+"/"}function g0(s,t){var a,r;const{db:n,auth:i,realtime:o,global:l}=s,{db:c,auth:d,realtime:u,global:v}=t,j={db:et(et({},c),n),auth:et(et({},d),i),realtime:et(et({},u),o),storage:{},global:et(et(et({},v),l),{},{headers:et(et({},(a=v==null?void 0:v.headers)!==null&&a!==void 0?a:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return s.accessToken?j.accessToken=s.accessToken:delete j.accessToken,j}function b0(s){const t=s==null?void 0:s.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(f0(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var v0=class extends a0{constructor(s){super(s)}},w0=class{constructor(s,t,a){var r,n;this.supabaseUrl=s,this.supabaseKey=t;const i=b0(s);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,l={db:o0,realtime:c0,auth:et(et({},l0),{},{storageKey:o}),global:i0},c=g0(a??{},l);if(this.storageKey=(r=c.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(n=c.global.headers)!==null&&n!==void 0?n:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(u,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var d;this.auth=this._initSupabaseAuthClient((d=c.auth)!==null&&d!==void 0?d:{},this.headers,c.global.fetch)}this.fetch=p0(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(et({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&this.accessToken().then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new Zd(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new Yu(this.storageUrl.href,this.headers,this.fetch,a==null?void 0:a.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new Hd(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,t={},a={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,t,a)}channel(s,t={config:{}}){return this.realtime.channel(s,t)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s=this,t,a;if(s.accessToken)return await s.accessToken();const{data:r}=await s.auth.getSession();return(t=(a=r.session)===null||a===void 0?void 0:a.access_token)!==null&&t!==void 0?t:s.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:t,detectSessionInUrl:a,storage:r,userStorage:n,storageKey:i,flowType:o,lock:l,debug:c,throwOnError:d},u,v){const j={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new v0({url:this.authUrl.href,headers:et(et({},j),u),storageKey:i,autoRefreshToken:s,persistSession:t,detectSessionInUrl:a,storage:r,userStorage:n,flowType:o,lock:l,debug:c,throwOnError:d,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new fu(this.realtimeUrl.href,et(et({},s),{},{params:et(et({},{apikey:this.supabaseKey}),s==null?void 0:s.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,t)=>{this._handleTokenChanged(s,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(s,t,a){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==a?(this.changedAccessToken=a,this.realtime.setAuth(a)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const j0=(s,t,a)=>new w0(s,t,a);function y0(){if(typeof window<"u"||typeof process>"u")return!1;const s=process.version;if(s==null)return!1;const t=s.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}y0()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Hi="ristosync_supabase_url",Ji="ristosync_supabase_key",N0="https://fksidwjclgqosgctpfti.supabase.co",_0="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrc2lkd2pjbGdxb3NnY3RwZnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3OTMxNTcsImV4cCI6MjA4MDM2OTE1N30.smxTUUy2vMb2ta4YjjMXIJO4i6IBEeR5vAo5egXgqkc",il="https://fksidwjclgqosgctpfti.supabase.co",ol="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrc2lkd2pjbGdxb3NnY3RwZnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3OTMxNTcsImV4cCI6MjA4MDM2OTE1N30.smxTUUy2vMb2ta4YjjMXIJO4i6IBEeR5vAo5egXgqkc",wc=s=>s&&s.length>5&&!s.includes("your-project"),k0=localStorage.getItem(Hi),S0=localStorage.getItem(Ji),E0=wc(il)?il:k0||N0,C0=wc(ol)?ol:S0||_0,an="castro.massimo@yahoo.com",q=j0(E0,C0),I0=(s,t)=>{!s||!t||(localStorage.setItem(Hi,s.trim()),localStorage.setItem(Ji,t.trim()),window.location.reload())},T0=()=>{localStorage.removeItem(Hi),localStorage.removeItem(Ji),window.location.reload()},Qa=async()=>{q&&(await q.auth.signOut(),localStorage.clear(),window.location.reload())},_r="ristosync_orders",Yi="ristosync_waiter_name",Ta="ristosync_menu_items",A0="ristosync_settings_notifications",En="ristosync_app_settings",Cn="ristosync_google_api_key",Si="ristosync_orders_metadata",Yn=[{id:"demo_a1",name:"Tagliere del Contadino",price:18,category:J.ANTIPASTI,description:"Selezione di salumi nostrani, formaggi stagionati, miele di castagno e noci.",allergens:["Latticini","Frutta a guscio"],ingredients:"Prosciutto crudo, Salame felino, Pecorino, Miele, Noci"},{id:"demo_a2",name:"Bruschette Miste",price:8,category:J.ANTIPASTI,description:"Tris di bruschette: pomodoro fresco, pat di olive, crema di carciofi.",allergens:["Glutine"],ingredients:"Pane casereccio, Pomodoro, Aglio, Olio EVO, Olive"},{id:"demo_p1",name:"Spaghetti alla Carbonara",price:12,category:J.PRIMI,description:"La vera ricetta romana con guanciale croccante, uova bio e pecorino.",allergens:["Glutine","Uova","Latticini"],ingredients:"Spaghetti, Guanciale, Tuorlo d'uovo, Pecorino Romano, Pepe nero"},{id:"demo_p2",name:"Tonnarelli Cacio e Pepe",price:11,category:J.PRIMI,description:"Cremosit unica con pecorino romano DOP e pepe nero tostato.",allergens:["Glutine","Latticini"],ingredients:"Tonnarelli freschi, Pecorino Romano, Pepe nero"},{id:"demo_s1",name:"Tagliata di Manzo",price:22,category:J.SECONDI,description:"Controfiletto servito con rucola selvatica e scaglie di grana.",allergens:["Latticini"],ingredients:"Manzo, Rucola, Grana Padano, Aceto Balsamico"},{id:"demo_pz1",name:"Margherita DOP",price:8,category:J.PIZZE,description:"Pomodoro San Marzano, Mozzarella di Bufala, Basilico fresco.",allergens:["Glutine","Latticini"],ingredients:"Impasto, Pomodoro, Mozzarella di Bufala, Basilico, Olio EVO"},{id:"demo_b1",name:"Acqua Naturale 0.75cl",price:2.5,category:J.BEVANDE,description:"Bottiglia in vetro."},{id:"demo_b2",name:"Coca Cola 33cl",price:3.5,category:J.BEVANDE,description:"In vetro."},{id:"demo_b3",name:"Caff Espresso",price:1.5,category:J.BEVANDE,description:"Miscela 100% Arabica."}];let Ae=null,Qn=null;const xt=(s,t)=>{var a;try{localStorage.setItem(s,t)}catch(r){if(r.name==="QuotaExceededError"||(a=r.message)!=null&&a.toLowerCase().includes("quota")){if(console.warn(" STORAGE FULL: Operating in Cloud-Only mode."),s===_r)try{const n=JSON.parse(t),i=n.filter(o=>o.status!==ve.DELIVERED);if(i.length<n.length)try{localStorage.setItem(s,JSON.stringify(i)),console.log(` Cache cleaned: Removed ${n.length-i.length} delivered orders.`);return}catch{}}catch(n){console.error("Cleanup failed:",n)}window.dispatchEvent(new Event("storage-quota-exceeded"))}}},ll=async()=>{if(!q)return;const{data:{session:s}}=await q.auth.getSession();if(s!=null&&s.user){Ae=s.user.id,await Xn(),await cl(),await dl(),await Zn(),await ul(),await hl();const{data:t}=await q.from("profiles").select("google_api_key").eq("id",Ae).single();t!=null&&t.google_api_key&&xt(Cn,t.google_api_key),q.channel(`room:${Ae}`).on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`user_id=eq.${Ae}`},()=>{Xn()}).on("postgres_changes",{event:"*",schema:"public",table:"menu_items",filter:`user_id=eq.${Ae}`},()=>{cl()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:`id=eq.${Ae}`},r=>{r.new.settings&&(xt(En,JSON.stringify(r.new.settings)),window.dispatchEvent(new Event("local-settings-update")))}).on("postgres_changes",{event:"*",schema:"public",table:"marketing_promotions",filter:`user_id=eq.${Ae}`},()=>{Zn()}).on("postgres_changes",{event:"*",schema:"public",table:"marketing_automations",filter:`user_id=eq.${Ae}`},()=>{ul()}).on("postgres_changes",{event:"*",schema:"public",table:"social_posts",filter:`user_id=eq.${Ae}`},()=>{hl()}).subscribe(),Qn&&clearInterval(Qn),Qn=setInterval(()=>{Xn(),dl(),Zn()},5e3)}},In=s=>{if(s)return console.error("Supabase Error:",s),s},Xn=async()=>{if(!q||!Ae)return;const s=new Date;s.setDate(s.getDate()-2);const{data:t,error:a}=await q.from("orders").select("*").eq("user_id",Ae).or(`status.neq.${ve.DELIVERED},created_at.gt.${s.toISOString()}`);if(a){In(a);return}const r=t.map(i=>{const o={id:i.id,tableNumber:i.table_number,status:i.status,timestamp:parseInt(i.timestamp)||new Date(i.created_at).getTime(),createdAt:new Date(i.created_at).getTime(),items:i.items,waiterName:i.waiter_name};if(o.items&&o.items.length>0){const l=o.items[0];if(l._meta){const c=l._meta;o.deliveryTime=c.deliveryTime,o.deliveryNotes=c.deliveryNotes,o.customerName=c.customerName,o.customerAddress=c.customerAddress,o.customerPhone=c.customerPhone,o.notes=c.notes}}return o}),n=R0(r);xt(_r,JSON.stringify(n)),window.dispatchEvent(new Event("local-storage-update"))},cl=async()=>{if(!q||!Ae)return;const{data:s,error:t}=await q.from("menu_items").select("*").eq("user_id",Ae);if(t&&In(t),!t&&s){const a=s.map(r=>({id:r.id,name:r.name,price:r.price,category:r.category,description:r.description,ingredients:r.ingredients,allergens:r.allergens,image:r.image,isCombo:r.category===J.MENU_COMPLETO,comboItems:r.combo_items||[],specificDepartment:r.specific_department}));xt(Ta,JSON.stringify(a)),window.dispatchEvent(new Event("local-menu-update"))}},dl=async()=>{if(!q)return;if(!Ae){const{data:{session:a}}=await q.auth.getSession();if(a!=null&&a.user)Ae=a.user.id;else return}const{data:s,error:t}=await q.from("profiles").select("settings").eq("id",Ae).single();!t&&(s!=null&&s.settings)&&(xt(En,JSON.stringify(s.settings)),window.dispatchEvent(new Event("local-settings-update")))},Zn=async()=>{if(!q||!Ae)return;const{data:s}=await q.from("marketing_promotions").select("*").eq("user_id",Ae);if(s){const t=s.map(a=>({id:a.id,title:a.title,description:a.description,discountValue:a.discount_value,discountType:a.discount_type,startDate:a.start_date,endDate:a.end_date,isActive:a.is_active,targetAudience:a.target_audience}));Tn(t,!1)}},ul=async()=>{if(!q||!Ae)return;const{data:s}=await q.from("marketing_automations").select("*").eq("user_id",Ae);if(s&&s.length>0){const t=s.map(a=>({id:a.id,type:a.type,title:a.title,isActive:a.is_active,config:a.config}));kc(t,!1)}},hl=async()=>{if(!q||!Ae)return;const{data:s}=await q.from("social_posts").select("*").eq("user_id",Ae);if(s){const t=s.map(a=>({id:a.id,topic:a.topic,content:a.content,image:a.image,overlayText:a.overlay_text,date:parseInt(a.date),platform:a.platform}));An(t,!1)}},Mt=()=>{const s=localStorage.getItem(_r);return s?JSON.parse(s):[]},Xs=s=>{O0(s),xt(_r,JSON.stringify(s)),window.dispatchEvent(new Event("local-storage-update"))},O0=s=>{try{const t=localStorage.getItem(Si),a=t?JSON.parse(t):{};let r=!1;s.forEach(n=>{(n.deliveryTime||n.customerName||n.customerPhone||n.deliveryNotes)&&(a[n.id]={deliveryTime:n.deliveryTime,deliveryNotes:n.deliveryNotes,customerName:n.customerName,customerAddress:n.customerAddress,customerPhone:n.customerPhone,notes:n.notes},r=!0)}),r&&localStorage.setItem(Si,JSON.stringify(a))}catch(t){console.error("Meta cache error",t)}},R0=s=>{try{const t=localStorage.getItem(Si);if(!t)return s;const a=JSON.parse(t);return s.map(r=>{const n=a[r.id];return n?{...r,deliveryTime:r.deliveryTime||n.deliveryTime,deliveryNotes:r.deliveryNotes||n.deliveryNotes,customerName:r.customerName||n.customerName,customerAddress:r.customerAddress||n.customerAddress,customerPhone:r.customerPhone||n.customerPhone,notes:r.notes||n.notes}:r})}catch{return s}},Zs=async(s,t=!1)=>{if(!(!q||!Ae))try{if(t)await q.from("orders").delete().eq("id",s.id);else{const a=s.items.map(n=>({...n}));a.length>0&&(a[0]._meta={deliveryTime:s.deliveryTime,deliveryNotes:s.deliveryNotes,customerName:s.customerName,customerAddress:s.customerAddress,customerPhone:s.customerPhone,notes:s.notes});const r={id:s.id,user_id:Ae,table_number:s.tableNumber,status:s.status,items:a,timestamp:s.timestamp,waiter_name:s.waiterName};await q.from("orders").upsert(r)}}catch(a){console.warn("Cloud sync warning:",a)}},Ei=async s=>{const t=Mt(),a=It(),r=Date.now(),n={...s,timestamp:r,createdAt:r,items:s.items.map(o=>{const c=(a.categoryDestinations?a.categoryDestinations[o.menuItem.category]:"Cucina")==="Sala";return{...o,completed:c,served:!1,isAddedLater:!1,comboCompletedParts:[],comboServedParts:[]}})},i=[...t,n];Xs(i),Zs(n)},rn=(s,t)=>{const a=Mt(),r=a.find(o=>o.id===s);if(!r)return;const n={...r,status:t},i=a.map(o=>o.id===s?n:o);Xs(i),Zs(n)},P0=s=>{const t=Mt(),a=t.find(n=>n.id===s);if(!a)return;const r=t.filter(n=>n.id!==s);Xs(r),Zs(a,!0)},z0=async(s,t)=>{const a=Mt(),r=a.find(d=>d.id===s),n=It();if(!r)return;const i=[...r.items];t.forEach(d=>{const u=i.findIndex(v=>v.menuItem.id===d.menuItem.id&&(v.notes||"")===(d.notes||""));if(u>=0){const v=i[u];i[u]={...v,quantity:v.quantity+d.quantity,completed:!1,served:!1,isAddedLater:!0,comboCompletedParts:v.comboCompletedParts||[],comboServedParts:v.comboServedParts||[]}}else{const j=(n.categoryDestinations?n.categoryDestinations[d.menuItem.category]:"Cucina")==="Sala";i.push({...d,completed:j,served:!1,isAddedLater:!0,comboCompletedParts:[],comboServedParts:[]})}});let o=r.status;(r.status===ve.DELIVERED||r.status===ve.READY)&&(o=ve.PENDING);const l={...r,items:i,timestamp:Date.now(),status:o},c=a.map(d=>d.id===s?l:d);Xs(c),Zs(l)},ei=(s,t,a)=>{const r=Mt(),n=r.find(j=>j.id===s);if(!n)return;const i=[...n.items],o=i[t];if(o)if(a&&o.menuItem.category===J.MENU_COMPLETO&&o.menuItem.comboItems){const j=o.comboCompletedParts||[];let w;j.includes(a)?w=j.filter(D=>D!==a):w=[...j,a],i[t]={...o,comboCompletedParts:w};const N=o.menuItem.comboItems.every(D=>w.includes(D));i[t].completed=N}else i[t]={...o,completed:!o.completed};const l=i.every(j=>j.completed),c=i.some(j=>j.completed||j.comboCompletedParts&&j.comboCompletedParts.length>0);let d=n.status;n.status!==ve.DELIVERED&&(l?d=ve.READY:c?d=ve.COOKING:c||(d=ve.PENDING));const u={...n,items:i,status:d},v=r.map(j=>j.id===s?u:j);Xs(v),Zs(u)},D0=(s,t,a)=>{const r=Mt(),n=r.find(v=>v.id===s);if(!n)return;const i=[...n.items],o=i[t];o&&(i[t]={...o,served:!0});const l=i.every(v=>v.served);let c=n.status;l&&(c===ve.READY||c===ve.COOKING)&&(c=ve.PENDING);const d={...n,items:i,status:c,timestamp:Date.now()},u=r.map(v=>v.id===s?d:v);Xs(u),Zs(d)},$0=async s=>{const t=Mt(),a=t.filter(o=>o.tableNumber===s),r=t.filter(o=>o.tableNumber!==s),n=a.map(o=>({...o,status:ve.DELIVERED,tableNumber:`${o.tableNumber}_HISTORY`,timestamp:Date.now()})),i=[...r,...n];if(Xs(i),q&&Ae)for(const o of n)await Zs(o)},L0=async()=>{xt(_r,"[]"),xt(Ta,"[]"),window.dispatchEvent(new Event("local-storage-update")),window.dispatchEvent(new Event("local-menu-update")),q&&Ae&&(await q.from("orders").delete().eq("user_id",Ae),await q.from("menu_items").delete().eq("user_id",Ae))},M0=async()=>{if(xt(Ta,"[]"),window.dispatchEvent(new Event("local-menu-update")),q&&Ae){const{error:s}=await q.from("menu_items").delete().eq("user_id",Ae);s&&In(s)}},U0=async()=>{if(Ae&&q){const n=Yn.map(o=>({id:o.id,user_id:Ae,name:o.name,price:o.price,category:o.category,description:o.description,ingredients:o.ingredients,allergens:o.allergens,image:o.image,combo_items:o.comboItems,specific_department:o.specificDepartment})),{error:i}=await q.from("menu_items").upsert(n);i&&(In(i),console.error("Errore sincronizzazione cloud:",i))}const s=Nt(),t=Yn.map(n=>n.id),r=[...s.filter(n=>!t.includes(n.id)),...Yn];xt(Ta,JSON.stringify(r)),window.dispatchEvent(new Event("local-menu-update"))},jc=()=>{var t;return((t=It().restaurantProfile)==null?void 0:t.tableCount)||12},yc=()=>localStorage.getItem(Yi),B0=s=>{xt(Yi,s)},F0=()=>{localStorage.removeItem(Yi)},Nt=()=>{const s=localStorage.getItem(Ta);return s?JSON.parse(s):[]},Qi=async(s,t=!1)=>{if(!(!q||!Ae))try{if(t)await q.from("menu_items").delete().eq("id",s.id);else{const a={id:s.id,user_id:Ae,name:s.name,price:s.price,category:s.category,description:s.description,ingredients:s.ingredients,allergens:s.allergens,image:s.image,combo_items:s.comboItems,specific_department:s.specificDepartment};await q.from("menu_items").upsert(a)}}catch(a){console.warn("Menu sync failed",a)}},Xi=s=>{xt(Ta,JSON.stringify(s)),window.dispatchEvent(new Event("local-menu-update"))},ti=s=>{const t=Nt();t.push(s),Xi(t),Qi(s)},ml=s=>{const a=Nt().map(r=>r.id===s.id?s:r);Xi(a),Qi(s)},G0=s=>{const t=Nt(),a=t.find(n=>n.id===s),r=t.filter(n=>n.id!==s);Xi(r),a&&Qi(a,!0)},os=()=>localStorage.getItem(Cn),q0=async s=>{if(xt(Cn,s),q&&Ae){const{error:t}=await q.from("profiles").update({google_api_key:s}).eq("id",Ae);t&&console.error("Failed to save API Key to cloud",t)}},V0=async()=>{if(localStorage.removeItem(Cn),q&&Ae){const{error:s}=await q.from("profiles").update({google_api_key:null}).eq("id",Ae);s&&console.error("Failed to remove API Key from cloud",s)}},pa={categoryDestinations:{[J.MENU_COMPLETO]:"Cucina",[J.ANTIPASTI]:"Cucina",[J.PANINI]:"Pub",[J.PIZZE]:"Pizzeria",[J.PRIMI]:"Cucina",[J.SECONDI]:"Cucina",[J.DOLCI]:"Cucina",[J.BEVANDE]:"Sala"},printEnabled:{Cucina:!1,Pizzeria:!1,Pub:!1,Sala:!1,Cassa:!1},restaurantProfile:{tableCount:12},tableReservations:[],sharedTables:{},activeCollaborations:[]},It=()=>{const s=localStorage.getItem(En);if(!s)return pa;try{const t=JSON.parse(s);return{...pa,...t,categoryDestinations:{...pa.categoryDestinations,...t.categoryDestinations||{}},printEnabled:{...pa.printEnabled,...t.printEnabled||{}},restaurantProfile:{...pa.restaurantProfile,...t.restaurantProfile||{}},tableReservations:t.tableReservations||[],sharedTables:t.sharedTables||{},activeCollaborations:t.activeCollaborations||[]}}catch{return pa}},Cs=async s=>{if(xt(En,JSON.stringify(s)),window.dispatchEvent(new Event("local-settings-update")),window.dispatchEvent(new Event("local-storage-update")),q&&Ae)try{await q.from("profiles").update({settings:s}).eq("id",Ae)}catch(t){console.warn("Settings sync failed",t)}},K0=()=>{const s=localStorage.getItem(A0);return s?JSON.parse(s):{kitchenSound:!0,waiterSound:!0,pushEnabled:!1}},Nc="ristosync_marketing_promos",gr=()=>{const s=localStorage.getItem(Nc);return s?JSON.parse(s):[]},Tn=(s,t=!0)=>{xt(Nc,JSON.stringify(s)),window.dispatchEvent(new Event("local-marketing-update"))},Zi=async(s,t=!1)=>{if(!(!q||!Ae))try{t?await q.from("marketing_promotions").delete().eq("id",s.id):await q.from("marketing_promotions").upsert({id:s.id,user_id:Ae,title:s.title,description:s.description,discount_value:s.discountValue,discount_type:s.discountType,start_date:s.startDate,end_date:s.endDate,is_active:s.isActive,target_audience:s.targetAudience})}catch(a){console.warn("Promo Sync Error",a)}},W0=s=>{const t=gr();t.push(s),Tn(t),Zi(s)},xl=s=>{const a=gr().map(r=>r.id===s.id?s:r);Tn(a),Zi(s)},H0=s=>{const a=gr().filter(r=>r.id!==s);Tn(a),Zi({id:s},!0)},_c="ristosync_marketing_automation",br=()=>{const s=localStorage.getItem(_c);return s?JSON.parse(s):[{id:"auto_bday",type:"birthday_promo",title:"Buono Compleanno",isActive:!1,config:{discountValue:20,discountType:"percentage",message:"Tanti Auguri! Ecco un regalo per te."}},{id:"auto_review",type:"review_request",title:"Richiesta Recensione",isActive:!1,config:{reviewPlatform:"all",message:"Ti  piaciuta la serata? Lasciaci una recensione!"}},{id:"auto_happy",type:"happy_hour",title:"Happy Hour Automatico",isActive:!1,config:{startTime:"18:00",endTime:"20:00",daysOfWeek:[1,2,3,4,5],message:"Happy Hour! 50% sui drink."}}]},kc=(s,t=!0)=>{xt(_c,JSON.stringify(s)),window.dispatchEvent(new Event("local-automation-update"))},J0=async s=>{if(!(!q||!Ae))try{await q.from("marketing_automations").upsert({id:s.id,user_id:Ae,type:s.type,title:s.title,is_active:s.isActive,config:s.config})}catch(t){console.warn("Auto Sync Error",t)}},pl=s=>{const a=br().map(r=>r.id===s.id?s:r);kc(a),J0(s)},Sc="ristosync_social_posts",vr=()=>{const s=localStorage.getItem(Sc);return s?JSON.parse(s):[]},An=(s,t=!0)=>{xt(Sc,JSON.stringify(s)),window.dispatchEvent(new Event("local-social-update"))},eo=async(s,t=!1)=>{if(!(!q||!Ae))try{t?await q.from("social_posts").delete().eq("id",s.id):await q.from("social_posts").upsert({id:s.id,user_id:Ae,topic:s.topic,content:s.content,image:s.image,overlay_text:s.overlayText,date:s.date,platform:s.platform})}catch(a){console.warn("Social Sync Error",a)}},Y0=s=>{const t=vr();t.unshift(s),An(t),eo(s)},Q0=s=>{const a=vr().map(r=>r.id===s.id?s:r);An(a),eo(s)},X0=s=>{const a=vr().filter(r=>r.id!==s);An(a),eo({id:s},!0)},fl={[J.MENU_COMPLETO]:0,[J.ANTIPASTI]:1,[J.PANINI]:2,[J.PIZZE]:3,[J.PRIMI]:4,[J.SECONDI]:5,[J.DOLCI]:6,[J.BEVANDE]:7},Z0=15,nn=25,Wa=s=>{try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;const a=new t,r=a.createOscillator(),n=a.createGain();r.connect(n),n.connect(a.destination);const i=a.currentTime;if(s==="new")r.type="square",r.frequency.setValueAtTime(440,i),r.frequency.setValueAtTime(554,i+.1),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(0,i+.3),r.start(),r.stop(i+.3);else if(s==="ready")r.type="sine",r.frequency.setValueAtTime(523.25,i),r.frequency.exponentialRampToValueAtTime(1046.5,i+.1),n.gain.setValueAtTime(.05,i),n.gain.exponentialRampToValueAtTime(.001,i+1),r.start(),r.stop(i+1);else if(s==="alert"){r.type="sawtooth",r.frequency.setValueAtTime(220,i),r.frequency.setValueAtTime(220,i+.2),n.gain.setValueAtTime(.1,i),n.gain.linearRampToValueAtTime(0,i+.4);const o=a.createOscillator(),l=a.createGain();o.type="sawtooth",o.connect(l),l.connect(a.destination),o.frequency.setValueAtTime(220,i+.5),l.gain.setValueAtTime(.1,i+.5),l.gain.linearRampToValueAtTime(0,i+.9),r.start(),r.stop(i+.4),o.start(i+.5),o.stop(i+.9)}}catch(t){console.error("Audio error",t)}},em=(s,t,a,r,n,i)=>{const o=new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),l=new Date().toLocaleDateString("it-IT");return`
    <html>
        <head>
            <title>Stampa ${t} - Tavolo ${a}</title>
            <style>
                body { font-family: 'Courier New', monospace; width: 300px; margin: 0; padding: 10px; font-size: 14px; color: black; background: white; }
                .header { text-align: center; border-bottom: 2px dashed black; padding-bottom: 10px; margin-bottom: 10px; }
                .title { font-size: 18px; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
                .dept { font-size: 24px; font-weight: bold; background: black; color: white; display: inline-block; padding: 2px 10px; margin: 5px 0; }
                .meta { font-size: 14px; margin: 2px 0; font-weight: bold; }
                .item { display: flex; margin-bottom: 4px; align-items: baseline; }
                .qty { font-weight: bold; width: 30px; font-size: 16px; }
                .name { flex: 1; font-weight: bold; font-size: 16px; }
                .notes { display: block; font-size: 12px; margin-left: 30px; font-style: italic; margin-bottom: 4px; }
                .sub-items { margin-left: 30px; font-size: 12px; margin-bottom: 8px; color: #333; }
                .footer { border-top: 2px dashed black; margin-top: 15px; padding-top: 10px; text-align: center; font-size: 10px; }
                .close-btn { display: block; width: 100%; background-color: #ef4444; color: white; text-align: center; padding: 15px 0; font-weight: bold; font-size: 16px; border: none; cursor: pointer; position: fixed; bottom: 0; left: 0; right: 0; text-transform: uppercase; }
                @media print { .no-print { display: none !important; } }
            </style>
        </head>
        <body>
            <div class="header"><div class="title">${n}</div><div class="dept">${t}</div><div class="meta">TAVOLO: ${a}</div><div class="meta">Staff: ${r}</div><div style="font-size: 12px; margin-top:5px;">${l} - ${o}</div></div>
            ${s.map(c=>{let d="";if(c.menuItem.category===J.MENU_COMPLETO&&c.menuItem.comboItems){const u=c.menuItem.comboItems.map(v=>{var j;return(j=i.find(w=>w.id===v))==null?void 0:j.name}).filter(Boolean);u.length>0&&(d=`<div class="sub-items">${u.map(v=>`<div>- ${v}</div>`).join("")}</div>`)}return`
                <div class="item"><span class="qty">${c.quantity}</span><span class="name">${c.menuItem.name}</span></div>
                ${d}
                ${c.notes?`<span class="notes">Note: ${c.notes}</span>`:""}
                `}).join("")}
            <div class="footer">RistoSync AI - Copia di Cortesia</div>
            <button class="no-print close-btn" onclick="window.close()"> CHIUDI FINESTRA</button>
            <script>window.onload = function() { setTimeout(function(){ window.focus(); window.print(); }, 500); }<\/script>
        </body>
    </html>`},tm=({timestamp:s,status:t,onCritical:a})=>{const[r,n]=m.useState(Math.floor((Date.now()-s)/6e4));if(m.useEffect(()=>{const u=setInterval(()=>{const v=Math.floor((Date.now()-s)/6e4);n(v),v===nn&&t!==ve.READY&&t!==ve.DELIVERED&&a()},3e4);return()=>clearInterval(u)},[s,t,a]),t===ve.READY||t===ve.DELIVERED)return e.jsxs("div",{className:"text-green-800 bg-green-100 px-2 py-1 rounded font-bold text-xs flex items-center gap-1 border border-green-300",children:[e.jsx(Le,{size:14})," COMPLETA"]});let i="text-slate-400",o="bg-slate-700",l=e.jsx(dd,{size:14}),c="In corso",d="";return r>=nn?(i="text-white",o="bg-red-600 border border-red-400 shadow-[0_0_10px_rgba(220,38,38,0.5)]",l=e.jsx(Sa,{size:16,className:"animate-wiggle"}),c="RITARDO CRITICO",d="animate-pulse"):r>=Z0&&(i="text-slate-900",o="bg-orange-400 border border-orange-500",l=e.jsx(oi,{size:14}),c="RITARDO"),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg transition-colors duration-500 ${o} ${d}`,children:[e.jsx("span",{className:`${i} ${r>=nn?"animate-wiggle":""}`,children:l}),e.jsxs("div",{className:"flex flex-col leading-none",children:[e.jsx("span",{className:`text-[9px] font-black uppercase ${i} opacity-80`,children:c}),e.jsxs("span",{className:`text-sm font-black font-mono ${i}`,children:[r," min"]})]})]})},si=({onExit:s,department:t="Cucina"})=>{const[a,r]=m.useState([]),[n,i]=m.useState("active"),[o,l]=m.useState(It()),[c,d]=m.useState(null),[u,v]=m.useState([]),[j,w]=m.useState([]),[N,D]=m.useState(new Date),E=m.useRef([]),O=m.useRef(!0),A=m.useRef(0),[B,Z]=m.useState(!1),F=m.useRef(a),H=m.useRef(o),Y=m.useRef(t),x=m.useRef(u),b=m.useRef({updateOrderStatus:rn,toggleOrderItemCompletion:ei});m.useEffect(()=>{F.current=a},[a]),m.useEffect(()=>{H.current=o},[o]),m.useEffect(()=>{Y.current=t},[t]),m.useEffect(()=>{x.current=u},[u]),m.useEffect(()=>{b.current={updateOrderStatus:rn,toggleOrderItemCompletion:ei}});const[S,K]=m.useState(!1),M=m.useRef(null);m.useEffect(()=>{const k=window.SpeechRecognition||window.webkitSpeechRecognition;if(!k)return;const Q=new k;Q.continuous=!0,Q.interimResults=!1,Q.lang="it-IT";const xe={uno:"1",due:"2",tre:"3",quattro:"4",cinque:"5",sei:"6",sette:"7",otto:"8",nove:"9",dieci:"10"};if(Q.onresult=fe=>{const Ce=fe.results[fe.results.length-1];if(!Ce.isFinal)return;let ae=Ce[0].transcript.trim().toLowerCase();console.log(" Raw Voice:",ae),Object.keys(xe).forEach(we=>{ae=ae.replace(new RegExp(`\\b${we}\\b`,"g"),xe[we])}),console.log(" Processed:",ae);const _e=ae.match(/(\d+)/),Ge=ae.includes("pronto")||ae.includes("fatto")||ae.includes("via")||ae.includes("completa");if(_e&&Ge){const we=_e[1];console.log(` Searching for table: ${we} in`,F.current.length,"orders");const ze=F.current.find(z=>z.status!==ve.DELIVERED&&(z.tableNumber===we||z.tableNumber.toLowerCase()===we||z.tableNumber.endsWith(` ${we}`)||z.tableNumber.endsWith(`_${we}`)||z.tableNumber===`Tavolo ${we}`||z.tableNumber.endsWith(we)));ze?(g(` VOCALE: Tavolo ${we} PRONTO!`,"success"),Wa("ready"),ze.items.forEach((z,P)=>{const _=H.current,h=Y.current,C=x.current;let L=!1;z.menuItem.category!==J.MENU_COMPLETO?L=(z.menuItem.specificDepartment||_.categoryDestinations[z.menuItem.category])===h:z.menuItem.comboItems&&(L=C.filter(G=>{var me;return(me=z.menuItem.comboItems)==null?void 0:me.includes(G.id)}).some(G=>(G.specificDepartment||_.categoryDestinations[G.category])===h)),L&&!z.completed&&z.menuItem.category!==J.MENU_COMPLETO&&b.current.toggleOrderItemCompletion(ze.id,P)}),b.current.updateOrderStatus(ze.id,ve.READY)):g(` VOCALE: Tavolo ${we} non trovato`,"alert")}else ae.includes("scorri gi")||ae.includes("sotto")?window.scrollBy({top:400,behavior:"smooth"}):ae.includes("scorri su")||ae.includes("sopra")?window.scrollBy({top:-400,behavior:"smooth"}):g(` Sentito: "${ae}" (Ripeti?)`,"info")},Q.onerror=fe=>{console.error(" Speech Error:",fe.error),fe.error==="not-allowed"&&(K(!1),g(" Accesso Microfono Negato","alert"))},Q.onend=()=>{S&&setTimeout(()=>{try{Q.start()}catch{}},300)},S)try{Q.start()}catch{}return M.current=Q,()=>{Q.onend=null;try{Q.stop()}catch{}}},[S]);const ee=()=>{var k,Q;S?(K(!1),(k=M.current)==null||k.stop(),g("Comandi Vocali Disattivati","info")):(K(!0),(Q=M.current)==null||Q.start(),g(" In ascolto... (Es: 'Tavolo 4 Pronto')","success"))},ge=t==="Pizzeria",ye=t==="Pub";let ce="orange",U=tt;ge?(ce="red",U=jn):ye&&(ce="amber",U=yn);const te=k=>k.menuItem.category!==J.MENU_COMPLETO||!k.menuItem.comboItems?[]:u.filter(Q=>{var xe;return(xe=k.menuItem.comboItems)==null?void 0:xe.includes(Q.id)}),p=k=>k.menuItem.category!==J.MENU_COMPLETO?(k.menuItem.specificDepartment||o.categoryDestinations[k.menuItem.category])===t:te(k).some(xe=>(xe.specificDepartment||o.categoryDestinations[xe.category])===t),g=(k,Q)=>{d({msg:k,type:Q}),setTimeout(()=>d(null),5e3)},y=k=>{Wa("alert"),g(` RITARDO CRITICO: Tavolo ${k}!`,"alert")},T=()=>{var fe;const Q=Mt().sort((Ce,ae)=>Ce.timestamp-ae.timestamp),xe=Nt();if(v(xe),!O.current){const Ce=E.current,ae=Ce.map(we=>we.id),Ge=Q.filter(we=>!ae.includes(we.id)).filter(we=>we.items.some(ze=>p(ze)));if(Ge.length>0){const we=Ge[0];if(Wa("new"),g(`Nuovo Ordine ${t}: Tavolo ${we.tableNumber}`,"info"),o.printEnabled&&o.printEnabled[t]){const ze=we.items.filter(z=>p(z));if(ze.length>0){const z=em(ze,t,we.tableNumber,we.waiterName||"Staff",((fe=o.restaurantProfile)==null?void 0:fe.name)||"Ristorante",xe);setTimeout(()=>{g(` Stampa Comanda ${t}...`,"info");const P=window.open("",`AUTO_PRINT_${t}_${Date.now()}`,"height=600,width=400");P&&(P.document.write(z),P.document.close(),P.focus())},800)}}}Q.forEach(we=>{const ze=Ce.find(z=>z.id===we.id);ze&&ze.status!==ve.READY&&we.status===ve.READY&&(Wa("ready"),A.current+=1,A.current>0&&A.current%3===0?(Wa("ready"),Z(!0),setTimeout(()=>Z(!1),4e3)):g(`Tavolo ${we.tableNumber}  PRONTO!`,"success")),ze&&ze.status!==ve.DELIVERED&&we.status===ve.DELIVERED&&(w(z=>[...z,we.id]),setTimeout(()=>{w(z=>z.filter(P=>P!==we.id))},5e3))})}O.current&&(O.current=!1),E.current=Q,r(Q)};m.useEffect(()=>{T();const k=fe=>{fe.key==="ristosync_orders"&&T()},Q=()=>T(),xe=()=>{l(It()),T()};return window.addEventListener("storage",k),window.addEventListener("local-storage-update",Q),window.addEventListener("local-settings-update",xe),window.addEventListener("local-menu-update",Q),()=>{window.removeEventListener("storage",k),window.removeEventListener("local-storage-update",Q),window.removeEventListener("local-settings-update",xe),window.removeEventListener("local-menu-update",Q)}},[o,t]);const I=(k,Q)=>{let xe=Q;Q===ve.PENDING?xe=ve.COOKING:Q===ve.COOKING?xe=ve.READY:Q===ve.READY&&(xe=ve.DELIVERED),rn(k,xe)},X=(k,Q,xe)=>{ei(k,Q,xe)},he=k=>new Date(k).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),se=k=>k.toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long"}),ue=k=>{switch(k){case ve.PENDING:return"bg-yellow-100 border-yellow-400 text-yellow-800";case ve.COOKING:return`bg-${ce}-100 border-${ce}-400 text-${ce}-800`;case ve.READY:return"bg-green-200 border-green-500 text-green-900 shadow-green-500/20";case ve.DELIVERED:return"bg-slate-700 border-slate-500 text-slate-300 opacity-80";default:return"bg-gray-100 border-gray-400"}},ie=m.useMemo(()=>a.filter(k=>{if(k.status!==ve.DELIVERED)return!1;const Q=new Date(k.createdAt||k.timestamp);return Q.getDate()===N.getDate()&&Q.getMonth()===N.getMonth()&&Q.getFullYear()===N.getFullYear()}).sort((k,Q)=>(Q.createdAt||Q.timestamp)-(k.createdAt||k.timestamp)),[a,N]),ne=m.useMemo(()=>{let k=0,Q=0;return ie.forEach(xe=>{const fe=xe.items.filter(ae=>p(ae)),Ce=fe.reduce((ae,_e)=>ae+_e.menuItem.price*_e.quantity,0);k+=Ce,fe.forEach(ae=>Q+=ae.quantity)}),{totalRevenue:k,totalItems:Q}},[ie,t,o,u]),re=k=>{const Q=new Date(N);Q.setDate(Q.getDate()+k),D(Q)},V=a.filter(k=>n==="active"&&k.status!==ve.DELIVERED||j.includes(k.id)),$e=o.printEnabled&&o.printEnabled[t];return e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white p-6 font-sans flex flex-col relative overflow-hidden",children:[e.jsx("style",{children:"@keyframes wiggle { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } } .animate-wiggle { animation: wiggle 0.3s ease-in-out infinite; } .receipt-edge { clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 95% 95%, 90% 100%, 85% 95%, 80% 100%, 75% 95%, 70% 100%, 65% 95%, 60% 100%, 55% 95%, 50% 100%, 45% 95%, 40% 100%, 35% 95%, 30% 100%, 25% 95%, 20% 100%, 15% 95%, 10% 100%, 5% 95%, 0% 100%); }"}),c&&e.jsxs("div",{className:`fixed top-24 left-1/2 transform -translate-x-1/2 z-50 px-8 py-4 rounded-2xl shadow-2xl flex items-center gap-4 animate-slide-down border-2 ${c.type==="success"?"bg-green-600 border-green-400":c.type==="alert"?"bg-red-600 border-red-400 animate-pulse":"bg-blue-600 border-blue-400"}`,children:[c.type==="success"?e.jsx(Le,{size:32,className:"animate-bounce"}):c.type==="alert"?e.jsx(Sa,{size:32,className:"animate-wiggle"}):e.jsx(Sa,{size:32,className:"animate-swing"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-2xl uppercase",children:c.type==="success"?"ORDINE PRONTO":c.type==="alert"?"ATTENZIONE RITARDO":"NUOVO ORDINE"}),e.jsx("p",{className:"font-medium text-lg",children:c.msg})]})]}),B&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-md animate-fade-in",children:e.jsx("div",{className:"bg-gradient-to-br from-orange-600 to-red-600 p-1 rounded-3xl shadow-[0_0_50px_rgba(234,88,12,0.6)] animate-scale-in",children:e.jsxs("div",{className:"bg-slate-900 rounded-[22px] px-12 py-10 flex flex-col items-center justify-center gap-6 border border-white/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"}),e.jsx("div",{className:"absolute -top-20 -left-20 w-40 h-40 bg-orange-500 rounded-full blur-[80px] opacity-40"}),e.jsx("div",{className:"absolute -bottom-20 -right-20 w-40 h-40 bg-red-500 rounded-full blur-[80px] opacity-40"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[e.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:""}),e.jsx("h2",{className:"text-5xl font-black italic text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 tracking-tighter uppercase drop-shadow-sm",children:"Cucina in Fiamme!"}),e.jsx("h3",{className:"text-3xl font-bold text-white mt-2",children:"3 Tavoli Completati di fila!"}),e.jsx("p",{className:"text-slate-400 mt-4 text-lg font-mono uppercase tracking-widest border border-slate-700 px-4 py-1 rounded-full",children:"Ottimo Lavoro Chef"})]})]})})}),e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-700 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-14 h-14 rounded-full flex items-center justify-center ${ge?"bg-red-600":ye?"bg-amber-500":"bg-orange-500"}`,children:e.jsx(U,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Risto",e.jsx("span",{className:`${ge?"text-red-500":ye?"text-amber-500":"text-orange-500"}`,children:"Sync"}),e.jsx("span",{className:"text-blue-500 font-black ml-1",children:"AI"})]}),e.jsxs("p",{className:"text-slate-400 text-xs uppercase font-semibold",children:[ge?"Pizzeria":ye?"Pub":"Kitchen"," Dashboard"]})]}),e.jsxs("div",{className:"ml-4 flex bg-slate-800 rounded-lg p-1 border border-slate-700",children:[e.jsx("button",{onClick:()=>i("active"),className:`px-6 py-2 rounded-md font-bold text-sm uppercase transition-all ${n==="active"?"bg-slate-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"Attivi"}),e.jsx("button",{onClick:()=>i("history"),className:`px-6 py-2 rounded-md font-bold text-sm uppercase transition-all ${n==="history"?"bg-slate-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"Archivio"})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[$e&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-900/30 border border-green-500/30 rounded-lg text-green-400 text-xs font-bold uppercase animate-pulse",children:[e.jsx(As,{size:14})," Auto-Print ON"]}),e.jsxs("button",{onClick:ee,className:`flex items-center gap-2 px-3 py-2 rounded-lg border font-bold text-xs uppercase transition-all ${S?"bg-red-600 text-white border-red-500 animate-pulse":"bg-slate-800 text-slate-400 border-slate-700 hover:text-white"}`,children:[S?e.jsx(Ii,{size:16}):e.jsx(Ti,{size:16}),S?"Ascolto...":"Vocale Off"]}),e.jsx("div",{className:"bg-slate-800 px-4 py-2 rounded-lg border border-slate-700",children:e.jsx("span",{className:`text-2xl font-mono font-bold ${ge?"text-red-400":ye?"text-amber-400":"text-orange-400"}`,children:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})}),e.jsx("button",{onClick:s,className:"bg-slate-800 text-slate-400 hover:text-white p-2.5 rounded-lg",children:e.jsx(fs,{size:20})})]})]}),n==="active"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 pb-10",children:V.map(k=>{const Q=Date.now(),fe=Math.floor((Q-k.timestamp)/6e4)>=nn&&k.status!==ve.READY&&k.status!==ve.DELIVERED,Ce=j.includes(k.id),ae=k.items.map((G,me)=>({item:G,originalIndex:me})).filter(({item:G})=>p(G)).sort((G,me)=>(fl[G.item.menuItem.category]||99)-(fl[me.item.menuItem.category]||99));if(ae.length===0)return null;const _e=ae.every(({item:G})=>{if(G.menuItem.category===J.MENU_COMPLETO&&G.menuItem.comboItems){const me=te(G).filter(pe=>(pe.specificDepartment||o.categoryDestinations[pe.category])===t);return me.length===0?!0:me.every(pe=>{var Te;return(Te=G.comboCompletedParts)==null?void 0:Te.includes(pe.id)})}return G.completed});let Ge=ue(k.status).replace("text","border").replace("bg-","border-"),we="bg-slate-800/95 bg-gradient-to-br from-slate-800 to-slate-900";_e&&!Ce?(Ge="border-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.3)]",we="bg-emerald-950/80 bg-gradient-to-br from-emerald-950 to-slate-900"):fe?Ge="border-red-600 animate-pulse shadow-[0_0_20px_rgba(220,38,38,0.4)]":Ce&&(Ge="border-green-500 shadow-[0_0_30px_rgba(34,197,94,0.4)] bg-green-900/20");const ze=k.items.filter(G=>!p(G)&&G.menuItem.category!==J.BEVANDE),z=ze.length>0;let P=k.tableNumber.replace("_HISTORY","");const _=k.tableNumber.match(/(\d+)/),h=_?_[1]:"1";k.tableNumber.includes("JUST-EAT")||k.tableNumber.startsWith("DEL_JUST-EAT")?P=`JE ${h}`:k.tableNumber.includes("GLOVO")||k.tableNumber.startsWith("DEL_GLOVO")?P=`GL ${h}`:k.tableNumber.includes("DELIVEROO")||k.tableNumber.startsWith("DEL_DELIVEROO")?P=`DE ${h}`:k.tableNumber.includes("UBER-EATS")||k.tableNumber.startsWith("DEL_UBER-EATS")?P=`UE ${h}`:k.tableNumber.includes("PHONE")||k.tableNumber.startsWith("DEL_PHONE")?P=`TEL ${h}`:k.tableNumber.startsWith("ASP_")||k.tableNumber.includes("TAKEAWAY")?P=`ASP ${h}`:k.tableNumber.startsWith("DEL_")?P=`DEL ${h}`:P=P.replace("DEL_","").replace("ASP_","");const C=k.tableNumber.startsWith("DEL_")||k.tableNumber.startsWith("ASP_")||["JE","GL","DE","UE","TEL","ASP"].some(G=>P.startsWith(G));let L=null,le=k.deliveryTime;if(!le&&k.notes){const G=k.notes.match(/Orario:\s*(\d{2}:\d{2})/);G&&(le=G[1])}if(C&&le){const[G,me]=le.split(":").map(Number),pe=new Date,Te=new Date;Te.setHours(G,me,0,0),pe.getHours()>22&&G<3&&Te.setDate(pe.getDate()+1);const Pe=(Te.getTime()-pe.getTime())/6e4;let lt="bg-blue-900/60 border-blue-500/40";Pe<=15&&Pe>-60?(lt="bg-red-900/80 border-red-500 animate-pulse",L={minutes:Math.ceil(Pe),status:"URGENTE",color:"red",bg:lt}):Pe<=30?(lt="bg-orange-900/60 border-orange-500/40",L={minutes:Math.ceil(Pe),status:"ATTENZIONE",color:"orange",bg:lt}):L={minutes:Math.ceil(Pe),status:"DELIVERY",color:"blue",bg:lt}}return C&&!Ce&&!_e&&((L==null?void 0:L.status)==="URGENTE"?(Ge="border-red-500 shadow-[0_0_20px_rgba(239,68,68,0.4)]",we="bg-red-950 bg-gradient-to-br from-red-950 to-slate-900"):(Ge="border-purple-500 shadow-lg",we="bg-slate-800 bg-gradient-to-br from-indigo-950 to-slate-900")),e.jsxs("div",{className:`flex flex-col rounded-xl shadow-2xl border-t-8 ${Ge} ${we} text-slate-200 overflow-hidden relative ${Ce||(L==null?void 0:L.status)==="URGENTE"?"animate-pulse":"hover:-translate-y-1"} transition-transform`,children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex justify-between items-start bg-black/20",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[C&&e.jsx(Kt,{className:"text-white",size:20}),e.jsxs("h2",{className:"text-xl font-black bg-gradient-to-br from-white to-slate-400 bg-clip-text text-transparent",children:[P.startsWith("JE")||P.startsWith("GL")||P.startsWith("DE")||P.startsWith("UE")||P.startsWith("TEL")||P.startsWith("ASP")||P.startsWith("DEL")?"":"Tav. ",P]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs font-bold uppercase ${Ce?"bg-green-600 text-white":ue(k.status)}`,children:Ce?"ARCHIVIAZIONE...":k.status===ve.READY?"TAVOLO PRONTO":k.status}),_e&&!Ce&&e.jsxs("span",{className:"inline-block px-2 py-0.5 rounded text-xs font-bold uppercase bg-emerald-500 text-black flex items-center gap-1",children:[e.jsx(Le,{size:10})," REPARTO OK"]})]}),z&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-[9px] font-black uppercase text-blue-200 bg-blue-900/60 px-2 py-1.5 rounded-lg border border-blue-500/40 animate-pulse w-max shadow-lg shadow-blue-900/20",children:[e.jsx(Kl,{size:12,className:"text-blue-400"}),e.jsxs("span",{children:["SYNC: ",ze.length," ALTRI"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1.5",children:[e.jsxs("div",{className:"flex flex-col items-end gap-1 mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 font-mono bg-slate-800/80 px-1.5 py-0.5 rounded flex items-center gap-1 border border-slate-700",children:["Entrata: ",e.jsx("span",{className:"text-white font-bold",children:he(k.createdAt||k.timestamp)})]}),L&&e.jsxs("div",{className:`flex items-center gap-1.5 text-[10px] font-black uppercase text-white px-2 py-1 rounded border shadow-sm ${L.status==="URGENTE"?"bg-red-600 border-red-400":"bg-blue-600 border-blue-400"}`,children:[e.jsx(Ze,{size:10}),e.jsxs("span",{children:["OUT: ",le]})]})]}),e.jsx(tm,{timestamp:k.timestamp,status:k.status,onCritical:()=>y(k.tableNumber)}),e.jsxs("div",{className:"flex items-center justify-end gap-1 text-slate-500 text-xs font-bold",children:[e.jsx(bs,{size:12})," ",k.waiterName||"Staff"]})]})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-y-auto max-h-[300px] bg-black/10",children:[e.jsx("ul",{className:"space-y-4",children:ae.map(({item:G,originalIndex:me})=>{if(G.menuItem.category===J.MENU_COMPLETO){const Te=te(G).filter(Pe=>(Pe.specificDepartment||o.categoryDestinations[Pe.category])===t);return e.jsxs("li",{className:"flex flex-col border-b border-dashed border-slate-700 pb-3 last:border-0 rounded-lg p-2 bg-slate-800/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("p",{className:"text-[10px] font-bold uppercase tracking-wider text-pink-500 flex items-center gap-1",children:[e.jsx(ld,{size:10})," MENU COMBO (",G.menuItem.name,")"]}),e.jsxs("span",{className:`font-black text-xs px-2 py-0.5 rounded shadow-inner ${G.completed?"bg-green-900/30 text-green-400":"bg-slate-700 text-white"}`,children:["x",G.quantity]})]}),e.jsxs("div",{className:"flex flex-col gap-2 pl-2",children:[Te.map((Pe,lt)=>{var qe;const kt=(qe=G.comboCompletedParts)==null?void 0:qe.includes(Pe.id);return e.jsx("div",{onClick:()=>k.status!==ve.DELIVERED&&X(k.id,me,Pe.id),className:`flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${kt?"bg-green-900/20 opacity-60":"bg-slate-700/50 hover:bg-slate-700 border border-slate-600"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`pt-0.5 ${kt?"text-green-500":"text-slate-400"}`,children:kt?e.jsx(Xa,{size:20}):e.jsx(en,{size:20})}),e.jsx("span",{className:`font-black text-xl leading-none ${kt?"text-slate-500 line-through":"text-orange-400"}`,children:Pe.name})]})},Pe.id)}),Te.length===0&&e.jsx("p",{className:"text-xs text-slate-500 italic px-2",children:"Nessun elemento per questo reparto."})]}),G.notes&&e.jsx("div",{className:"mt-2 space-y-1 ml-2",children:G.notes.split("|||").map((Pe,lt)=>e.jsxs("p",{className:"text-red-300 text-xs font-bold bg-red-900/20 px-2 py-1 rounded border border-red-900/30 shadow-sm",children:[" ",Pe.trim()]},lt))})]},`${k.id}-${me}`)}return e.jsx("li",{onClick:()=>k.status!==ve.DELIVERED&&X(k.id,me),className:`flex justify-between items-start border-b border-dashed border-slate-700 pb-3 last:border-0 rounded-lg p-2 transition-colors ${G.completed?"bg-green-900/10 opacity-70":"hover:bg-slate-800/50 cursor-pointer"}`,children:e.jsxs("div",{className:"w-full",children:[G.isAddedLater&&k.status!==ve.DELIVERED&&e.jsxs("div",{className:"flex items-center gap-1 mb-1 bg-blue-600 w-max px-2 py-0.5 rounded-md shadow-sm border border-blue-400",children:[e.jsx(cd,{size:10,className:"text-white animate-pulse"}),e.jsx("span",{className:"text-[10px] font-black text-white uppercase tracking-wide",children:"AGGIUNTA"})]}),e.jsxs("div",{className:"flex gap-4 items-start w-full",children:[e.jsx("div",{className:`pt-1 ${G.completed?"text-green-500":"text-slate-600"}`,children:G.completed?e.jsx(Xa,{size:28}):e.jsx(en,{size:28})}),e.jsx("span",{className:`font-black text-2xl w-10 h-10 flex items-center justify-center rounded-lg shadow-inner ${G.completed?"bg-green-900/30 text-green-400":"bg-slate-700 text-white"}`,children:G.quantity}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:`text-[10px] font-bold uppercase tracking-wider mb-0.5 ${ge?"text-red-500":ye?"text-amber-500":"text-orange-500"}`,children:G.menuItem.category})}),e.jsx("p",{className:`font-black text-2xl leading-none tracking-tight break-words ${G.completed?"text-slate-500 line-through decoration-slate-600 decoration-2":"bg-gradient-to-br from-white to-slate-400 bg-clip-text text-transparent"}`,children:G.menuItem.name}),G.menuItem.ingredients&&e.jsx("p",{className:"text-[10px] text-slate-500 mt-1 italic",children:G.menuItem.ingredients}),G.notes&&e.jsx("div",{className:"mt-2 space-y-1",children:G.notes.split("|||").map((Te,Pe)=>e.jsxs("p",{className:"text-red-300 text-sm font-bold bg-red-900/20 px-3 py-1 rounded border border-red-900/30 shadow-sm",children:[" ",Te.trim()]},Pe))})]})]})]})},`${k.id}-${me}`)})}),C&&(()=>{const G=k.items.map((me,pe)=>({item:me,originalIndex:pe})).filter(({item:me})=>(me.menuItem.specificDepartment||o.categoryDestinations[me.menuItem.category])==="Sala");return console.log(` Delivery ${k.tableNumber}: Sala items found:`,G.length,G.map(me=>me.item.menuItem.name)),G.length===0?null:e.jsxs("div",{className:"mt-3 pt-3 border-t border-dashed border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2",children:[e.jsx(wn,{size:14,className:"text-blue-400"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-wider text-blue-400",children:"Prodotti Sala (Bevande)"})]}),e.jsx("ul",{className:"space-y-2",children:G.map(({item:me,originalIndex:pe})=>e.jsxs("li",{onClick:()=>{console.log(` Sala item clicked: Order ${k.id}, Index ${pe}, Current completed: ${me.completed}`),k.status!==ve.DELIVERED&&X(k.id,pe)},className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-all border ${me.completed?"bg-blue-900/20 border-blue-800/30 opacity-60":"bg-blue-900/30 border-blue-500/30 hover:bg-blue-800/40"}`,children:[e.jsx("div",{className:`${me.completed?"text-blue-400":"text-blue-500"}`,children:me.completed?e.jsx(Xa,{size:20}):e.jsx(en,{size:20})}),e.jsxs("span",{className:`font-bold text-sm px-2 py-0.5 rounded ${me.completed?"bg-blue-900/50 text-blue-300":"bg-blue-700/50 text-white"}`,children:["x",me.quantity]}),e.jsx("span",{className:`font-bold ${me.completed?"text-blue-400/60 line-through":"text-blue-200"}`,children:me.menuItem.name})]},`sala-${k.id}-${pe}`))})]})})()]}),e.jsx("button",{onClick:()=>I(k.id,k.status),className:`w-full py-5 text-center font-black text-lg uppercase tracking-wider transition-all flex items-center justify-center gap-2 hover:brightness-110 ${k.status===ve.READY?"bg-green-600 text-white":_e?"bg-emerald-600 text-white":`bg-${ce}-500 text-white`}`,children:k.status===ve.READY?e.jsxs(e.Fragment,{children:[e.jsx(Le,{})," COMPLETA (ATTENDI RITIRO)"]}):_e?e.jsxs(e.Fragment,{children:[e.jsx(Le,{})," REPARTO COMPLETO"]}):e.jsxs(e.Fragment,{children:["AVANZA STATO ",k.status===ve.PENDING&&" PREPARAZIONE"," ",k.status===ve.COOKING&&" PRONTO"]})})]},k.id)})}):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-6",children:[e.jsxs("div",{className:"flex items-center bg-slate-800 rounded-xl p-1 border border-slate-700",children:[e.jsx("button",{onClick:()=>re(-1),className:"p-3 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white",children:e.jsx(ar,{})}),e.jsxs("div",{className:"px-6 font-bold text-white flex items-center gap-2 uppercase tracking-wide",children:[e.jsx(wa,{size:18,className:`${ge?"text-red-500":ye?"text-amber-500":"text-orange-500"}`})," ",se(N)]}),e.jsx("button",{onClick:()=>re(1),className:"p-3 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white",children:e.jsx(ii,{})})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 p-4 rounded-2xl flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-900/20 rounded-xl text-blue-500",children:e.jsx(Ea,{})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-400 text-xs font-bold uppercase",children:["Piatti ",t]}),e.jsx("p",{className:"text-2xl font-black text-white",children:ne.totalItems})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 overflow-y-auto pb-10",children:[ie.map(k=>{var fe;const Q=k.items.filter(Ce=>p(Ce));if(Q.length===0)return null;Q.reduce((Ce,ae)=>Ce+ae.menuItem.price*ae.quantity,0);const xe=k.tableNumber.replace("_HISTORY","");return e.jsxs("div",{className:"bg-slate-200 text-slate-900 p-0 relative shadow-xl font-mono text-sm leading-tight receipt-edge pb-6",children:[e.jsxs("div",{className:"p-4 pb-2 text-center border-b border-dashed border-slate-400 mx-2",children:[e.jsx("h3",{className:"font-bold text-lg uppercase mb-1",children:((fe=o.restaurantProfile)==null?void 0:fe.name)||"RistoSync"}),e.jsx("p",{className:"text-xs font-bold uppercase",children:t}),e.jsxs("p",{className:"text-xs",children:["Tavolo: ",xe]}),e.jsxs("p",{className:"text-xs",children:[se(new Date(k.createdAt||k.timestamp))," - ",he(k.timestamp)]}),e.jsxs("p",{className:"text-[10px] mt-1 uppercase",children:["Staff: ",k.waiterName||"?"]})]}),e.jsx("div",{className:"p-4 space-y-2",children:Q.map((Ce,ae)=>e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-bold",children:[Ce.quantity,"x"]}),e.jsx("span",{className:"uppercase",children:Ce.menuItem.name})]})},ae))}),e.jsx("div",{className:"text-center text-[10px] text-slate-500 mt-4",children:"*** COPIA NON FISCALE ***"})]},k.id)}),ie.every(k=>k.items.filter(Q=>p(Q)).length===0)&&e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-20 text-slate-600",children:[e.jsx(As,{size:64,className:"opacity-20 mb-4"}),e.jsx("p",{className:"font-bold text-lg",children:"Nessuno scontrino presente"}),e.jsxs("p",{className:"text-sm",children:["Non ci sono comande chiuse per ",t," in questa data."]})]})]})]})]})},Yt={"just-eat":{label:"Just Eat",color:"#ff8000",iconStr:"JE",bg:"bg-orange-500",border:"border-orange-500"},glovo:{label:"Glovo",color:"#facd3d",iconStr:"GL",bg:"bg-yellow-400",border:"border-yellow-400"},deliveroo:{label:"Deliveroo",color:"#00ccbc",iconStr:"DE",bg:"bg-teal-500",border:"border-teal-500"},"uber-eats":{label:"Uber Eats",color:"#06c167",iconStr:"UE",bg:"bg-green-500",border:"border-green-500"},phone:{label:"Telefono",color:"#3b82f6",iconStr:"TEL",bg:"bg-blue-500",border:"border-blue-500"},takeaway:{label:"Asporto",color:"#8b5cf6",iconStr:"ASP",bg:"bg-purple-500",border:"border-purple-500"}};function sm({onExit:s,menuItems:t,showToast:a}){const[r,n]=m.useState(t.length>0?t:[]),[i,o]=m.useState([]),[l,c]=m.useState(!1),[d,u]=m.useState("just-eat"),[v,j]=m.useState(""),[w,N]=m.useState(""),[D,E]=m.useState(""),[O,A]=m.useState(""),[B,Z]=m.useState(""),[F,H]=m.useState(""),[Y,x]=m.useState([]),[b,S]=m.useState(""),[K,M]=m.useState("TUTTI"),[ee,ge]=m.useState("columns"),[ye,ce]=m.useState("ALL"),[U,te]=m.useState("urgency"),[p,g]=m.useState(!1),[y,T]=m.useState(null),[I,X]=m.useState("just-eat"),[he,se]=m.useState(!1),ue=m.useRef(null);m.useEffect(()=>{ie(),n(Nt());const z=()=>ie(),P=()=>n(Nt());return window.addEventListener("local-storage-update",z),window.addEventListener("local-menu-update",P),()=>{window.removeEventListener("local-storage-update",z),window.removeEventListener("local-menu-update",P)}},[]);const ie=()=>{const P=Mt().filter(_=>{if(_.status===ve.DELIVERED)return!1;const h=_.tableNumber&&(_.tableNumber.startsWith("DEL_")||_.tableNumber.startsWith("ASP_")),C=_.source!==void 0,L=!isNaN(Number(_.tableNumber));return h||C||!L}).sort((_,h)=>h.timestamp-_.timestamp);o(P)},ne=ie,re=z=>{x(P=>P.find(h=>h.item.id===z.id)?P.map(h=>h.item.id===z.id?{...h,quantity:h.quantity+1}:h):[...P,{item:z,quantity:1}])},V=z=>{x(P=>P.filter((_,h)=>h!==z))},$e=(z,P)=>{x(_=>{const h=[..._];return h[z].quantity+=P,h[z].quantity<=0?_.filter((C,L)=>L!==z):h})},k=async()=>{var z,P;if(Y.length===0){a("Aggiungi almeno un piatto!","error");return}try{const h=d==="takeaway"||d==="phone"?"ASP":"DEL",C=v||new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}).replace(":",""),L=`${h}_${d.toUpperCase()}_${C}`,le=Y.map(Pe=>({menuItem:Pe.item,quantity:Pe.quantity,notes:Pe.notes||""})),G=Math.random().toString(36).substring(2,8),pe={id:`delivery_${Date.now()}_${G}`,tableNumber:L,items:le,status:ve.PENDING,timestamp:Date.now(),createdAt:Date.now(),waiterName:`${((z=Yt[d])==null?void 0:z.label)||"Delivery"}${w?` - ${w}`:""}`,customerName:w,customerAddress:D,customerPhone:O,deliveryTime:B,deliveryNotes:F,notes:`Cliente: ${w||"N/A"}, Tel: ${O||"N/A"}, Indirizzo: ${D||"N/A"}, Note: ${F||""}, Orario: ${B||"ASAP"}`};console.log("Creating order via addOrder:",pe),await Ei(pe);const Te=((P=Yt[d])==null?void 0:P.label)||d;a(` Ordine ${Te} #${C} creato con successo!`,"success"),c(!1),x([]),j(""),N(""),E(""),A(""),Z(""),H(""),ne()}catch(_){console.error("Order creation error:",_),a(`Errore: ${_.message||"Errore sconosciuto"}`,"error")}},Q=async(z,P)=>{rn(z,P)},xe=async z=>{confirm("Sei sicuro di voler eliminare questo ordine?")&&P0(z)},fe=async z=>{var h;const P=(h=z.target.files)==null?void 0:h[0];if(!P)return;const _=os();if(!_){a("Configura la API Key di Google AI nelle impostazioni!","error");return}g(!0),a("Analisi scontrino in corso...","info");try{const C=new FileReader;C.onload=async()=>{var Pe,lt,kt,qe,bt,ct;const L=C.result.split(",")[1],me=await(await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${_}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Analizza questa immagine di uno scontrino/ordine delivery e estrai i dati in formato JSON.
                
Estrai:
- orderId: numero/codice ordine se presente
- items: array di oggetti con { name: nome piatto, quantity: quantit, price: prezzo unitario se visibile }
- total: totale ordine se visibile
- deliveryTime: orario di consegna richiesto se presente
- customerName: nome cliente se presente
- customerAddress: indirizzo se presente
- notes: eventuali note speciali

Rispondi SOLO con il JSON valido, senza markdown o altro testo.
Se un campo non  presente, omettilo.

Esempio output:
{"orderId":"123","items":[{"name":"Pizza Margherita","quantity":2,"price":8.00}],"total":16.00}`},{inlineData:{mimeType:P.type,data:L}}]}]})})).json(),Te=(((bt=(qe=(kt=(lt=(Pe=me==null?void 0:me.candidates)==null?void 0:Pe[0])==null?void 0:lt.content)==null?void 0:kt.parts)==null?void 0:qe[0])==null?void 0:bt.text)||"").match(/\{[\s\S]*\}/);if(Te){const vt=JSON.parse(Te[0]);T({orderId:vt.orderId,items:vt.items||[],total:vt.total,deliveryTime:vt.deliveryTime,customerName:vt.customerName,customerAddress:vt.customerAddress,notes:vt.notes}),se(!0),a(` Trovati ${((ct=vt.items)==null?void 0:ct.length)||0} prodotti!`,"success")}else a("Impossibile estrarre dati dallo scontrino","error")},C.readAsDataURL(P)}catch(C){console.error("Scan error:",C),a("Errore durante la scansione","error")}finally{g(!1),ue.current&&(ue.current.value="")}},Ce=async()=>{var z,P;if(!(!y||y.items.length===0))try{const h=I==="takeaway"||I==="phone"?"ASP":"DEL",C=y.orderId||new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}).replace(":",""),L=`${h}_${I.toUpperCase()}_${C}`,le=y.items.map(Pe=>({menuItem:r.find(qe=>qe.name.toLowerCase().includes(Pe.name.toLowerCase())||Pe.name.toLowerCase().includes(qe.name.toLowerCase()))||{id:`scan_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:Pe.name,price:Pe.price||0,category:J.PRIMI},quantity:Pe.quantity,notes:""})),G=Math.random().toString(36).substring(2,8),pe={id:`scan_${Date.now()}_${G}`,tableNumber:L,items:le,status:ve.PENDING,timestamp:Date.now(),createdAt:Date.now(),waiterName:`AI Scan - ${((z=Yt[I])==null?void 0:z.label)||I}`};await Ei(pe);const Te=((P=Yt[I])==null?void 0:P.label)||I;a(` Ordine ${Te} creato da scansione AI!`,"success"),se(!1),T(null),ne()}catch(_){a(`Errore: ${_.message||"Errore sconosciuto"}`,"error")}},ae=z=>{let P=z.deliveryTime;if(!P&&z.notes){const _=z.notes.match(/Orario:\s*(\d{2}:\d{2})/);_&&(P=_[1])}if(P){const[_,h]=P.split(":").map(Number),C=new Date,L=new Date;L.setHours(_,h,0,0),C.getHours()>22&&_<3&&L.setDate(C.getDate()+1);const le=(L.getTime()-C.getTime())/6e4,G=Math.ceil(le);return G<=15&&G>-60?{status:"urgent",color:"text-red-500",bg:"bg-red-900/40 border-red-500 animate-pulse",label:`URGENTE (${G}m)`,time:P}:G<=30?{status:"warning",color:"text-orange-400",bg:"bg-orange-900/30 border-orange-500/50",label:`ATTENZIONE (${G}m)`,time:P}:{status:"normal",color:"text-blue-400",bg:"bg-slate-800/80 border-slate-700",label:`Tra ${G}m`,time:P}}return null},_e=z=>{const P=Yt[z],_=i.filter(h=>{var L;const C=((L=h.tableNumber)==null?void 0:L.toUpperCase())||"";return C.includes(z.toUpperCase().replace("-","_"))||C.includes(z.toUpperCase())});return e.jsxs("div",{className:"flex flex-col h-full min-w-[300px] max-w-[320px] bg-slate-900/50 rounded-2xl border border-slate-800 backdrop-blur-sm overflow-hidden",children:[e.jsx("div",{className:`p-4 ${P.bg} text-slate-900 border-b ${P.border}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 font-black uppercase tracking-wider",children:[e.jsx("span",{className:"bg-white/20 p-1.5 rounded-lg text-xs backdrop-blur-md",children:P.iconStr}),P.label]}),e.jsx("span",{className:"bg-slate-900/20 text-slate-900 px-2 py-0.5 rounded-full text-xs font-bold",children:_.length})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3 custom-scroll",children:[_.length===0&&e.jsxs("div",{className:"text-center py-10 text-slate-600 opacity-50",children:[e.jsx(Mn,{className:"mx-auto mb-2",size:32}),e.jsx("p",{className:"text-xs",children:"Nessun ordine"})]}),_.map(h=>{var le;const C=ae(h),L=(C==null?void 0:C.status)==="urgent"?"bg-red-950/30 border-red-500/50":"bg-slate-800 border-slate-700";return e.jsxs("div",{className:`${L} rounded-xl p-4 border shadow-lg group hover:border-slate-500 transition-all relative overflow-hidden`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-white text-lg flex items-center gap-2",children:["#",((le=h.tableNumber)==null?void 0:le.split("_").pop())||h.id.slice(-6)]}),e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1",children:["Entrata: ",new Date(h.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),C&&e.jsxs("p",{className:`text-xs font-bold mt-1 ${C.color} flex items-center gap-1`,children:[C.status==="urgent"&&e.jsx(ot,{size:12}),"Consegna: ",C.time]})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase ${h.status==="Servito"?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-300"}`,children:h.status})]}),(h.customerName||h.customerAddress)&&e.jsxs("div",{className:"bg-slate-900/50 p-2 rounded-lg mb-3 border border-slate-700/50",children:[h.customerName&&e.jsxs("p",{className:"text-sm font-semibold text-slate-200 flex items-center gap-1.5",children:[e.jsx(bs,{size:12,className:"text-slate-500"})," ",h.customerName]}),h.customerAddress&&e.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1.5 mt-1",children:[e.jsx(rr,{size:12,className:"text-slate-500"})," ",h.customerAddress]}),h.deliveryNotes&&e.jsxs("p",{className:"text-[10px] text-yellow-500/80 mt-1 italic pl-4 border-l-2 border-yellow-500/30",children:['"',h.deliveryNotes,'"']})]}),e.jsxs("div",{className:"space-y-1 mb-3",children:[h.items.slice(0,4).map((G,me)=>e.jsx("div",{className:"flex justify-between text-xs text-slate-300",children:e.jsxs("span",{children:[e.jsxs("span",{className:"font-bold text-slate-500",children:[G.quantity,"x"]})," ",G.menuItem.name]})},me)),h.items.length>4&&e.jsxs("p",{className:"text-[10px] text-slate-500 text-center",children:["+ altri ",h.items.length-4," prodotti"]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-slate-700",children:[e.jsxs("span",{className:"font-black text-white text-lg",children:[" ",h.items.reduce((G,me)=>G+me.menuItem.price*me.quantity,0).toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.status==="In Attesa"&&e.jsx("button",{onClick:()=>Q(h.id,"In Preparazione"),className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold transition-colors",children:"INIZIA"}),h.status==="In Preparazione"&&e.jsx("button",{onClick:()=>Q(h.id,"Pronto"),className:"px-3 py-1 bg-orange-600 hover:bg-orange-500 text-white rounded-lg text-xs font-bold transition-colors",children:"PRONTO"}),h.status==="Pronto"&&e.jsxs("button",{onClick:()=>Q(h.id,"Servito"),className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded-lg text-xs font-bold transition-colors flex items-center gap-1",children:[e.jsx(Kt,{size:14})," AFFIDA"]}),e.jsx("button",{onClick:()=>xe(h.id),className:"text-slate-500 hover:text-red-500 transition-colors p-2 bg-slate-800 rounded-lg hover:bg-slate-700",children:e.jsx(Lt,{size:16})})]})]})]},h.id)})]})]})},Ge=()=>e.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 w-full max-w-6xl h-[90vh] rounded-[2rem] border border-slate-700 flex overflow-hidden shadow-2xl relative",children:[e.jsxs("div",{className:"w-2/3 border-r border-slate-800 flex flex-col p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-black text-white flex items-center gap-3",children:[e.jsx(tt,{className:"text-blue-500"})," Seleziona Piatti"]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scroll",children:[e.jsx("button",{onClick:()=>M("TUTTI"),className:`px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all ${K==="TUTTI"?"bg-white text-slate-900":"bg-slate-800 text-slate-400 hover:text-white"}`,children:"TUTTI"}),Object.values(J).map(z=>e.jsx("button",{onClick:()=>M(z),className:`px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all ${K===z?"bg-blue-600 text-white":"bg-slate-800 text-slate-400 hover:text-white"}`,children:z},z))]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(nr,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500",size:20}),e.jsx("input",{type:"text",placeholder:"Cerca piatto...",value:b,onChange:z=>S(z.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl pl-12 pr-4 py-4 text-white outline-none focus:border-blue-500"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4 overflow-y-auto pr-2 custom-scroll flex-1 content-start",children:r.filter(z=>K==="TUTTI"||z.category===K).filter(z=>z.name.toLowerCase().includes(b.toLowerCase())).map(z=>e.jsxs("button",{onClick:()=>re(z),className:"bg-slate-800 border-2 border-transparent hover:border-blue-500 p-4 rounded-2xl text-left transition-all active:scale-95 flex flex-col justify-between min-h-[120px]",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white leading-tight mb-1",children:z.name}),e.jsx("p",{className:"text-xs text-slate-400 line-clamp-2",children:z.description})]}),e.jsxs("div",{className:"flex justify-between items-end mt-3",children:[e.jsxs("span",{className:"font-mono font-bold text-blue-400",children:[" ",z.price.toFixed(2)]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-white",children:e.jsx(gs,{size:16})})]})]},z.id))})]}),e.jsxs("div",{className:"w-1/3 flex flex-col bg-slate-950",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 bg-slate-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Nuovo Ordine"}),e.jsx("button",{onClick:()=>c(!1),className:"bg-slate-800 p-2 rounded-lg text-slate-400 hover:text-white",children:e.jsx(Xe,{size:20})})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:Object.entries(Yt).map(([z,P])=>e.jsx("button",{onClick:()=>u(z),className:`flex flex-col items-center justify-center p-2 rounded-xl border-2 transition-all ${d===z?`${P.border} ${P.bg} text-white`:"border-slate-800 bg-slate-900 text-slate-500 hover:border-slate-600"}`,children:e.jsx("span",{className:"text-[10px] font-black uppercase",children:P.iconStr})},z))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:z=>j(z.target.value),placeholder:d==="table"?"Tavolo":"ID Ordine (es. #123)",className:"flex-1 bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white outline-none focus:border-blue-500"}),e.jsx("input",{type:"time",value:B,onChange:z=>Z(z.target.value),className:"w-24 bg-slate-950 border border-slate-700 rounded-lg px-2 py-2 text-sm text-white outline-none focus:border-blue-500"})]}),e.jsx("input",{type:"text",value:w,onChange:z=>N(z.target.value),placeholder:"Nome Cliente",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white outline-none focus:border-blue-500"}),(d==="takeaway"||d==="phone")&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:O,onChange:z=>A(z.target.value),placeholder:"Telefono",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white outline-none focus:border-blue-500"}),e.jsx("input",{type:"text",value:D,onChange:z=>E(z.target.value),placeholder:"Indirizzo Consegna",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white outline-none focus:border-blue-500"})]}),e.jsx("input",{type:"text",value:F,onChange:z=>H(z.target.value),placeholder:"Note (citofono, resto...)",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white outline-none focus:border-blue-500"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scroll",children:Y.length===0?e.jsxs("div",{className:"text-center text-slate-600 mt-10",children:[e.jsx(Mn,{className:"mx-auto mb-2 opacity-50",size:32}),e.jsx("p",{className:"text-sm",children:"Carrello vuoto"})]}):Y.map((z,P)=>e.jsxs("div",{className:"flex justify-between items-center bg-slate-900 p-3 rounded-lg border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 rounded-lg px-1",children:[e.jsx("button",{onClick:()=>$e(P,-1),className:"p-1 hover:text-white text-slate-500",children:"-"}),e.jsx("span",{className:"text-sm font-bold w-4 text-center",children:z.quantity}),e.jsx("button",{onClick:()=>$e(P,1),className:"p-1 hover:text-white text-slate-500",children:"+"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-300 truncate max-w-[120px]",children:z.item.name})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-bold text-white",children:[" ",(z.item.price*z.quantity).toFixed(2)]}),e.jsx("button",{onClick:()=>V(P),className:"text-slate-600 hover:text-red-500",children:e.jsx(Xe,{size:14})})]})]},P))}),e.jsxs("div",{className:"p-6 bg-slate-900 border-t border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-slate-400 uppercase text-xs font-bold",children:"Totale Stimato"}),e.jsxs("span",{className:"text-3xl font-black text-white",children:[" ",Y.reduce((z,P)=>z+P.item.price*P.quantity,0).toFixed(2)]})]}),e.jsxs("button",{onClick:k,disabled:Y.length===0,className:"w-full py-4 bg-green-600 hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-black rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2",children:[e.jsx(Le,{size:20})," CONFERMA ORDINE"]})]})]})]})}),we=z=>{var h;const P=((h=z.tableNumber)==null?void 0:h.toUpperCase())||"";return Object.keys(Yt).find(C=>P.includes(C.toUpperCase().replace("-","_"))||P.includes(C.toUpperCase()))||"phone"},ze=()=>{let z=[...i];return ye!=="ALL"&&(z=z.filter(P=>we(P)===ye)),z.sort((P,_)=>{if(U==="urgency"){const h=C=>{let L=C.deliveryTime;if(!L&&C.notes){const Te=C.notes.match(/Orario:\s*(\d{2}:\d{2})/);Te&&(L=Te[1])}if(!L)return 999999;const[le,G]=L.split(":").map(Number),me=new Date;let pe=new Date;return pe.setHours(le,G,0,0),me.getHours()>20&&le<5&&pe.setDate(me.getDate()+1),pe.getTime()-me.getTime()};return h(P)-h(_)}else{const h=we(P),C=we(_);return h.localeCompare(C)}}),e.jsxs("div",{className:"w-full h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-700 flex flex-col md:flex-row gap-4 justify-between items-center shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto w-full md:w-auto pb-1 no-scrollbar mask-gradient-right",children:[e.jsx(Eo,{size:16,className:"text-slate-500 mr-2 shrink-0"}),e.jsx("button",{onClick:()=>ce("ALL"),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all shrink-0 border ${ye==="ALL"?"bg-white text-slate-900 border-white":"bg-slate-800 text-slate-400 border-slate-700 hover:border-slate-500 hover:text-white"}`,children:"TUTTI"}),Object.entries(Yt).map(([P,_])=>e.jsxs("button",{onClick:()=>ce(P),className:`px-3 py-2 rounded-xl text-xs font-bold transition-all shrink-0 flex items-center gap-2 border ${ye===P?`${_.bg} text-white ${_.border}`:"bg-slate-800 text-slate-400 border-slate-700 hover:text-white hover:border-slate-500"}`,children:[e.jsx("span",{className:"font-black",children:_.iconStr}),e.jsx("span",{className:"hidden sm:inline",children:_.label})]},P))]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 p-1 rounded-xl border border-slate-800 shrink-0",children:[e.jsxs("button",{onClick:()=>te("urgency"),className:`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1 transition-all ${U==="urgency"?"bg-slate-700 text-white shadow":"text-slate-500 hover:text-slate-300"}`,children:[e.jsx(Ze,{size:12})," Urgenza"]}),e.jsxs("button",{onClick:()=>te("platform"),className:`px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1 transition-all ${U==="platform"?"bg-slate-700 text-white shadow":"text-slate-500 hover:text-slate-300"}`,children:[e.jsx(ir,{size:12})," Gruppo"]})]})]}),e.jsxs("div",{className:"flex-1 bg-slate-900/50 rounded-2xl border border-slate-800 backdrop-blur-sm overflow-hidden flex flex-col relative",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 bg-slate-950/50 text-slate-400 text-xs font-bold uppercase border-b border-slate-800 sticky top-0 z-10 backdrop-blur-sm",children:[e.jsx("div",{className:"col-span-1",children:"Piattaforma"}),e.jsx("div",{className:"col-span-1",children:"ID / Orario"}),e.jsx("div",{className:"col-span-1",children:"Cliente"}),e.jsx("div",{className:"col-span-2",children:"Dettagli Ordine"}),e.jsx("div",{className:"col-span-1 text-right",children:"Stato & Azioni"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scroll",children:z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 opacity-60",children:[e.jsx(Eo,{size:48,className:"mb-2"}),e.jsx("p",{children:"Nessun ordine trovato con questi filtri"})]}):z.map(P=>{var C;const _=we(P),h=Yt[_];return e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 bg-slate-800/50 rounded-xl items-center border border-slate-700/50 hover:border-slate-600 transition-all animate-fade-in",children:[e.jsxs("div",{className:"col-span-1 flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center font-black ${(h==null?void 0:h.bg)||"bg-slate-700"} text-slate-900 border border-white/10 shadow-lg`,children:(h==null?void 0:h.iconStr)||"?"}),e.jsx("span",{className:"font-bold text-white text-sm hidden xl:block",children:h==null?void 0:h.label})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("p",{className:"font-bold text-white",children:["#",((C=P.tableNumber)==null?void 0:C.split("_").pop())||P.id.slice(-6)]}),(()=>{const L=ae(P);return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-slate-500 flex items-center gap-1 mt-1",children:[e.jsx(Ze,{size:12})," Ent: ",new Date(P.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),L&&e.jsxs("span",{className:`flex items-center gap-1 text-[10px] font-bold uppercase mt-1 px-1.5 py-0.5 rounded w-max ${L.bg} ${L.color} border`,children:[L.status==="urgent"&&e.jsx(ot,{size:10}),L.time," (",L.label,")"]})]})})()]}),e.jsx("div",{className:"col-span-1",children:P.customerName?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-slate-200 text-sm truncate",children:P.customerName}),e.jsx("p",{className:"text-xs text-slate-500 truncate",children:P.customerAddress})]}):e.jsx("span",{className:"text-slate-600 italic",children:"--"})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-slate-300 truncate",children:P.items.map(L=>`${L.quantity}x ${L.menuItem.name}`).join(", ")}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1 font-bold",children:["Totale:  ",P.items.reduce((L,le)=>L+le.menuItem.price*le.quantity,0).toFixed(2)]})]}),e.jsxs("div",{className:"col-span-1 flex justify-end items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase mr-2 border ${P.status==="Servito"?"bg-green-500/10 text-green-400 border-green-500/20":"bg-slate-700/50 text-slate-300 border-slate-600"}`,children:P.status}),P.status==="In Attesa"&&e.jsx("button",{onClick:()=>Q(P.id,"In Preparazione"),className:"p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg shadow-lg hover:scale-105 transition-all",title:"Inizia Preparazione",children:e.jsx(tt,{size:16})}),P.status==="In Preparazione"&&e.jsx("button",{onClick:()=>Q(P.id,"Pronto"),className:"p-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg shadow-lg hover:scale-105 transition-all",title:"Segna come Pronto",children:e.jsx(Mn,{size:16})}),P.status==="Pronto"&&e.jsx("button",{onClick:()=>Q(P.id,"Servito"),className:"p-2 bg-green-600 hover:bg-green-500 text-white rounded-lg shadow-lg hover:scale-105 transition-all",title:"Affida al Rider",children:e.jsx(Kt,{size:16})}),e.jsx("button",{onClick:()=>xe(P.id),className:"p-2 text-slate-500 hover:text-red-500 hover:bg-red-950/30 rounded-lg transition-colors",title:"Elimina Ordine",children:e.jsx(Lt,{size:16})})]})]},P.id)})})]})]})};return e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white p-6 font-sans flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-slate-700 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center bg-green-600",children:e.jsx(Kt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Risto",e.jsx("span",{className:"text-green-500",children:"Sync"}),e.jsx("span",{className:"text-blue-500 font-black ml-1",children:"AI"})]}),e.jsx("p",{className:"text-slate-400 text-xs uppercase font-semibold",children:"Delivery & Asporto"})]}),e.jsxs("div",{className:"ml-4 flex bg-slate-800 rounded-lg p-1 border border-slate-700",children:[e.jsx("button",{onClick:()=>ge("columns"),className:`px-6 py-2 rounded-md font-bold text-sm uppercase transition-all ${ee==="columns"?"bg-slate-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"Colonne"}),e.jsx("button",{onClick:()=>ge("list"),className:`px-6 py-2 rounded-md font-bold text-sm uppercase transition-all ${ee==="list"?"bg-slate-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"Lista"})]})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("input",{ref:ue,type:"file",accept:"image/*",capture:"environment",onChange:fe,className:"hidden"}),e.jsxs("button",{onClick:()=>{var z;return(z=ue.current)==null?void 0:z.click()},disabled:p,className:"bg-purple-600 hover:bg-purple-500 disabled:opacity-50 text-white px-4 py-2.5 rounded-xl font-bold text-sm shadow-lg flex items-center gap-2 transition-all active:scale-95",children:[p?e.jsx($t,{size:18,className:"animate-spin"}):e.jsx(Wl,{size:18}),p?"Analisi...":"SCANSIONA"]}),e.jsxs("button",{onClick:()=>c(!0),className:"bg-green-600 hover:bg-green-500 text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-lg flex items-center gap-2 transition-all active:scale-95",children:[e.jsx(gs,{size:18})," NUOVO ORDINE"]}),e.jsx("div",{className:"bg-slate-800 px-4 py-2 rounded-lg border border-slate-700",children:e.jsx("span",{className:"text-2xl font-mono font-bold text-green-400",children:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})})}),e.jsx("button",{onClick:s,className:"bg-slate-800 text-slate-400 hover:text-white p-2.5 rounded-lg",children:e.jsx(fs,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden p-6 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-slate-700 to-transparent opacity-50"}),ee==="columns"?e.jsx("div",{className:"h-full overflow-x-auto [transform:rotateX(180deg)] [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-track]:bg-slate-800/20 [&::-webkit-scrollbar-track]:rounded-full [&::-webkit-scrollbar-thumb]:bg-slate-600/60 [&::-webkit-scrollbar-thumb]:rounded-full hover:[&::-webkit-scrollbar-thumb]:bg-blue-500/80 transition-colors cursor-w-resize",children:e.jsx("div",{className:"h-full flex gap-4 min-w-max [transform:rotateX(180deg)] pt-2 pb-0 px-1",children:Object.keys(Yt).map(z=>_e(z))})}):ze()]}),l&&Ge(),he&&y&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-3xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden flex flex-col animate-slide-up",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-r from-purple-900/50 to-slate-900 border-b border-slate-800 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-600 flex items-center justify-center",children:e.jsx(ft,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-white",children:"Ordine Rilevato"}),e.jsx("p",{className:"text-purple-400 text-xs font-bold",children:"Analisi AI completata"})]})]}),e.jsx("button",{onClick:()=>{se(!1),T(null)},className:"text-slate-400 hover:text-white p-2 rounded-xl hover:bg-slate-800",children:e.jsx(Xe,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold mb-2 block",children:"Seleziona Piattaforma"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(Yt).map(([z,P])=>e.jsxs("button",{onClick:()=>X(z),className:`p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all ${I===z?`${P.bg} border-white text-white`:"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-500"}`,children:[e.jsx("span",{className:"font-black text-lg",children:P.iconStr}),e.jsx("span",{className:"text-[10px] uppercase font-bold",children:P.label})]},z))})]}),y.orderId&&e.jsxs("div",{className:"flex items-center gap-2 bg-slate-800 p-3 rounded-xl",children:[e.jsx("span",{className:"text-slate-500 text-xs uppercase font-bold",children:"ID Ordine:"}),e.jsx("span",{className:"text-white font-bold",children:y.orderId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-slate-500 uppercase font-bold mb-2 block",children:["Prodotti (",y.items.length,")"]}),e.jsx("div",{className:"space-y-2",children:y.items.map((z,P)=>e.jsxs("div",{className:"bg-slate-800 p-3 rounded-xl flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"w-8 h-8 bg-slate-700 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:[z.quantity,"x"]}),e.jsx("span",{className:"text-white font-medium",children:z.name})]}),z.price!==void 0&&e.jsxs("span",{className:"text-green-400 font-bold",children:[" ",z.price.toFixed(2)]})]},P))})]}),(y.customerName||y.customerAddress||y.deliveryTime)&&e.jsxs("div",{className:"space-y-2",children:[y.customerName&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(bs,{size:14,className:"text-slate-500"}),e.jsx("span",{className:"text-slate-400",children:y.customerName})]}),y.customerAddress&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(rr,{size:14,className:"text-slate-500"}),e.jsx("span",{className:"text-slate-400",children:y.customerAddress})]}),y.deliveryTime&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ze,{size:14,className:"text-slate-500"}),e.jsx("span",{className:"text-slate-400",children:y.deliveryTime})]})]}),y.total!==void 0&&e.jsxs("div",{className:"bg-green-900/30 border border-green-500/30 p-4 rounded-xl flex justify-between items-center",children:[e.jsx("span",{className:"text-green-400 uppercase text-xs font-bold",children:"Totale Ordine"}),e.jsxs("span",{className:"text-3xl font-black text-green-400",children:[" ",y.total.toFixed(2)]})]})]}),e.jsx("div",{className:"p-6 bg-slate-950 border-t border-slate-800",children:e.jsxs("button",{onClick:Ce,disabled:y.items.length===0,className:"w-full py-4 bg-purple-600 hover:bg-purple-500 disabled:opacity-50 text-white font-black rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2",children:[e.jsx(Le,{size:20})," CREA ORDINE DA SCANSIONE"]})})]})})]})}const am=[J.MENU_COMPLETO,J.ANTIPASTI,J.PRIMI,J.SECONDI,J.PIZZE,J.PANINI,J.DOLCI,J.BEVANDE],rm=s=>{switch(s){case J.MENU_COMPLETO:return e.jsx(gt,{size:16});case J.ANTIPASTI:return e.jsx(Ea,{size:16});case J.PANINI:return e.jsx(yn,{size:16});case J.PIZZE:return e.jsx(jn,{size:16});case J.PRIMI:return e.jsx(tt,{size:16});case J.SECONDI:return e.jsx(gt,{size:16});case J.DOLCI:return e.jsx(Jl,{size:16});case J.BEVANDE:return e.jsx(wn,{size:16});default:return e.jsx(gt,{size:16})}},nm=({onExit:s})=>{const[t,a]=m.useState([]),[r,n]=m.useState([]),[i,o]=m.useState(12),[l,c]=m.useState(null),[d,u]=m.useState("tables"),[v,j]=m.useState(J.ANTIPASTI),[w,N]=m.useState([]),[D,E]=m.useState(""),[O,A]=m.useState(!1),[B,Z]=m.useState(!1),[F,H]=m.useState(!1),[Y,x]=m.useState(!1),b=m.useRef(0),[S,K]=m.useState(!1),[M,ee]=m.useState("Google"),[ge,ye]=m.useState(""),[ce,U]=m.useState(!1),[te,p]=m.useState(null),g=m.useRef(null),[y,T]=m.useState(null),I=yc(),X=()=>{try{const _=Mt()||[],h=Nt()||[],C=jc()||12;a(_),n(h),o(C)}catch(_){console.error("Critical Error loading WaiterPad data:",_),a([]),n([])}};m.useEffect(()=>{X();const _=()=>X();return window.addEventListener("local-storage-update",_),window.addEventListener("local-menu-update",_),window.addEventListener("local-settings-update",_),()=>{window.removeEventListener("local-storage-update",_),window.removeEventListener("local-menu-update",_),window.removeEventListener("local-settings-update",_)}},[]);const he=_=>{if(!t)return"free";const h=t.filter(pe=>pe.tableNumber===_&&pe.status!==ve.DELIVERED);if(h.length===0)return"free";if(h.every(pe=>(pe.items||[]).every(Te=>Te.served)))return"completed";if(h.some(pe=>(pe.items||[]).some(Te=>Te.completed&&!Te.served)))return"ready";const le=h.find(pe=>pe.status===ve.COOKING||pe.status===ve.PENDING);return le&&(Date.now()-le.timestamp)/6e4>25?"delayed":h.some(pe=>pe.status===ve.COOKING)?"cooking":(It().tableReservations||[]).includes(_)?"reserved":"occupied"},se=_=>{const h=t.find(L=>L.tableNumber===_&&(L.status===ve.COOKING||L.status===ve.PENDING));return h?`${Math.floor((Date.now()-h.timestamp)/6e4)}m`:null},ue=l?t.find(_=>_.tableNumber===l&&_.status!==ve.DELIVERED):null,ie=_=>{c(_),N([]),u("tables")},ne=_=>{N(h=>h.find(L=>L.menuItem.id===_.id&&!L.notes)?h.map(L=>L.menuItem.id===_.id&&!L.notes?{...L,quantity:L.quantity+1}:L):[...h,{menuItem:_,quantity:1,served:!1,completed:!1}])},re=_=>{N(h=>h.filter((C,L)=>L!==_))},V=(_,h)=>{N(C=>{const L=[...C],le=L[_],G=le.quantity+h;return G<=0?C.filter((me,pe)=>pe!==_):(L[_]={...le,quantity:G},L)})},$e=_=>{if(ce)g.current&&g.current.stop(),U(!1);else{p(_),U(!0);const h=window.SpeechRecognition||window.webkitSpeechRecognition;if(!h){alert("Il tuo browser non supporta il riconoscimento vocale. Usa Chrome o Edge."),U(!1);return}const C=new h;C.lang="it-IT",C.continuous=!1,C.interimResults=!0,C.onresult=L=>{let le="";for(let G=0;G<L.results.length;G++)le+=L.results[G][0].transcript;ye(le)},C.onend=()=>{U(!1)},C.onerror=L=>{console.error("Speech recognition error:",L.error),U(!1),L.error==="no-speech"&&alert("Nessun audio rilevato. Riprova.")},g.current=C,C.start()}},k=_=>{ge.trim()&&(N(h=>{const C=[...h],L=C[_].notes||"",le=L?L.split("|||"):[];return le.push(ge.trim()),C[_]={...C[_],notes:le.join("|||")},C}),ce&&g.current&&(g.current.stop(),U(!1)),ye(""),p(null))},Q=(_,h)=>{N(C=>{const L=[...C],G=(L[_].notes||"").split("|||");return G.splice(h,1),L[_]={...L[_],notes:G.length>0?G.join("|||"):void 0},L})},xe=(_,h,C)=>{N(L=>{const le=[...L],me=(le[_].notes||"").split("|||");return me[h]=C,le[_]={...le[_],notes:me.join("|||")},le})},fe=()=>{!l||w.length===0||A(!0)},Ce=async()=>{var _;try{if(!l||w.length===0)return;Z(!0);const C=Mt().find(L=>L.tableNumber===l&&L.status!==ve.DELIVERED);if(C)await z0(C.id,w);else{const L=Math.random().toString(36).substring(2,8),G={id:`order_${Date.now()}_${L}`,tableNumber:l,items:w,status:ve.PENDING,timestamp:Date.now(),createdAt:Date.now(),waiterName:I||"Staff"};await Ei(G)}N([]),A(!1),c(null),u("tables"),setTimeout(()=>X(),100)}catch(h){console.error("Errore invio ordine:",h),(_=h.message)!=null&&_.includes("quota")||alert(`Si  verificato un errore: ${h.message}`),A(!1)}finally{Z(!1)}},ae=()=>{l&&H(!0)},_e=async()=>{var _,h;if(l)try{await $0(l),c(null),H(!1);try{const L=br().find(le=>le.type==="review_request"&&le.isActive);if(L){b.current+=1;const le=b.current===1?3:b.current%4===0?4:b.current%3===0?3:0;if(b.current>=3&&b.current%3===0){const G=((_=L.config)==null?void 0:_.reviewPlatform)==="google"?"Google":((h=L.config)==null?void 0:h.reviewPlatform)==="tripadvisor"?"TripAdvisor":"Google/TripAdvisor";ee(G),setTimeout(()=>{K(!0),setTimeout(()=>K(!1),5e3)},600)}}}catch(C){console.error("Auto error",C)}setTimeout(X,200)}catch(C){console.error("Failed to free table:",C),alert("Errore durante la liberazione del tavolo. Riprova."),H(!1)}},Ge=(_,h)=>{D0(_,h),setTimeout(X,50)},we=()=>{N([]),u("tables")},ze=()=>{x(!0)},z=()=>{F0(),s()},P=(r||[]).filter(_=>{const h=_.name.toLowerCase().includes(D.toLowerCase()),C=_.category===v;return h&&C});return!t||!r?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center text-white",children:"Caricamento dati..."}):e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white flex flex-col font-sans relative",children:[O&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-slide-up text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600/20 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-500 animate-pulse",children:e.jsx(ts,{size:32,className:"ml-1"})}),e.jsx("h3",{className:"text-2xl font-black text-white mb-2",children:"Confermi l'ordine?"}),e.jsxs("p",{className:"text-slate-400 mb-6",children:["Stai per inviare ",e.jsxs("strong",{children:[w.reduce((_,h)=>_+h.quantity,0)," piatti"]}),e.jsx("br",{}),"al ",e.jsxs("strong",{children:["Tavolo ",l]}),"."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:Ce,disabled:B,className:"w-full py-4 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 text-white font-black text-lg rounded-2xl shadow-lg shadow-blue-600/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:B?"INVIO IN CORSO...":e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:20})," S, INVIA IN CUCINA"]})}),e.jsx("button",{onClick:()=>A(!1),disabled:B,className:"w-full py-4 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold rounded-2xl transition-all",children:"ANNULLA"})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-slide-up text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-600/20 rounded-full flex items-center justify-center mx-auto mb-4 text-orange-500 animate-pulse",children:e.jsx(Co,{size:32,className:"ml-1"})}),e.jsx("h3",{className:"text-2xl font-black text-white mb-2",children:"Libera Tavolo"}),e.jsxs("p",{className:"text-slate-400 mb-6",children:["Vuoi davvero liberare il ",e.jsxs("strong",{children:["Tavolo ",l]}),"?",e.jsx("br",{}),"L'azione canceller lo stato del tavolo."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:_e,className:"w-full py-4 bg-orange-600 hover:bg-orange-500 text-white font-black text-lg rounded-2xl shadow-lg shadow-orange-600/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[e.jsx(Le,{size:20})," S, LIBERA"]}),e.jsx("button",{onClick:()=>H(!1),className:"w-full py-4 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold rounded-2xl transition-all",children:"ANNULLA"})]})]})}),Y&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-slide-up text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500 animate-pulse",children:e.jsx(fs,{size:32,className:"ml-1"})}),e.jsx("h3",{className:"text-2xl font-black text-white mb-2",children:"Cambio Account"}),e.jsxs("p",{className:"text-slate-400 mb-6",children:["Vuoi uscire dalla sessione di ",e.jsx("strong",{children:I||"Staff"}),"?",e.jsx("br",{}),"Dovrai selezionare nuovamente il profilo."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:z,className:"w-full py-4 bg-red-600 hover:bg-red-500 text-white font-black text-lg rounded-2xl shadow-lg shadow-red-600/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[e.jsx(fs,{size:20})," S, ESCI"]}),e.jsx("button",{onClick:()=>x(!1),className:"w-full py-4 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold rounded-2xl transition-all",children:"ANNULLA"})]})]})}),S&&e.jsx("div",{className:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[200] animate-slide-down",children:e.jsxs("div",{className:"bg-gradient-to-r from-yellow-500/90 to-orange-500/90 backdrop-blur-md px-6 py-4 rounded-2xl shadow-2xl border border-yellow-400/50 flex items-center gap-4 max-w-sm",children:[e.jsx("div",{className:"text-4xl animate-bounce",children:""}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-black text-lg",children:"Chiedi una Recensione!"}),e.jsxs("p",{className:"text-yellow-100 text-sm font-medium",children:["Ricorda: ",M," "]})]}),e.jsx("button",{onClick:()=>K(!1),className:"ml-2 text-white/80 hover:text-white text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/20 transition-colors",children:""})]})}),y&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 w-full max-w-md rounded-3xl p-6 shadow-2xl animate-slide-up",children:[e.jsx("h3",{className:"text-xl font-black text-white mb-4",children:"Modifica Nota"}),e.jsx("input",{type:"text",value:y.currentText,onChange:_=>T({...y,currentText:_.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none mb-6",autoFocus:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>T(null),className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold rounded-xl transition-all",children:"Annulla"}),e.jsx("button",{onClick:()=>{y.currentText.trim()&&xe(y.itemIndex,y.noteIndex,y.currentText.trim()),T(null)},className:"flex-1 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg shadow-blue-600/20 transition-all",children:"Salva"})]})]})}),e.jsxs("div",{className:"p-4 bg-slate-800 border-b border-slate-700 flex justify-between items-center shadow-lg z-30 relative shrink-0",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(bs,{size:18,className:"text-white"})})," ",I||"Waiter Pad"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"bg-slate-700 p-2 rounded-full text-slate-300 hover:text-white hover:bg-blue-600 transition-colors",title:"Torna alla Home (Mantieni Sessione)",children:e.jsx(Hl,{size:20})}),e.jsx("button",{onClick:ze,className:"bg-slate-700 p-2 rounded-full text-slate-300 hover:text-white hover:bg-red-600 transition-colors",title:"Cambia Cameriere (Logout)",children:e.jsx(fs,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col relative",children:[d==="tables"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 relative",children:[l&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 w-full sm:max-w-md h-[85vh] sm:h-auto sm:rounded-3xl rounded-t-3xl border border-slate-700 shadow-2xl flex flex-col overflow-hidden animate-slide-up",children:[e.jsxs("div",{className:"p-5 border-b border-slate-800 flex justify-between items-center bg-slate-800",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black text-white",children:["Tavolo ",l]}),e.jsx("p",{className:`text-xs font-bold uppercase ${ue?"text-green-400":he(l)==="reserved"?"text-purple-400":"text-slate-400"}`,children:ue?"Occupato":he(l)==="reserved"?"Prenotato":"Libero"})]}),e.jsx("button",{onClick:()=>c(null),className:"p-2 bg-slate-700 rounded-full text-slate-400 hover:text-white",children:e.jsx(ar,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5 pb-24",children:ue?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase",children:[e.jsx(Ze,{size:14})," Iniziato alle"]}),e.jsx("div",{className:"font-mono font-bold",children:new Date(ue.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-2",children:"Comanda Attuale"}),e.jsx("div",{className:"space-y-2",children:ue.items&&ue.items.length>0?ue.items.map((_,h)=>{var le;const C=_.completed&&!_.served,L=_.served;return e.jsxs("div",{className:`flex justify-between items-center text-sm p-3 rounded-lg border transition-all ${C?"bg-green-900/30 border-green-500 shadow-[0_0_15px_rgba(34,197,94,0.2)]":"bg-slate-800/50 border-slate-700"}`,children:[e.jsxs("div",{className:"flex gap-3 items-center flex-1",children:[e.jsxs("span",{className:"font-bold text-white bg-slate-700 px-2 py-1 rounded text-xs",children:["x",_.quantity]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`font-bold text-base ${L?"line-through text-slate-500":C?"text-white":"text-slate-300"}`,children:((le=_.menuItem)==null?void 0:le.name)||"Item"}),_.notes&&e.jsx("span",{className:"text-xs text-orange-400 italic",children:_.notes}),C&&e.jsxs("span",{className:"text-[10px] font-black text-green-400 uppercase tracking-wider animate-pulse flex items-center gap-1 mt-1",children:[e.jsx(Io,{size:10})," DA SERVIRE"]})]})]}),C?e.jsx("button",{onClick:()=>Ge(ue.id,h),className:"ml-2 bg-green-500 hover:bg-green-400 text-white p-2 rounded-lg shadow-lg active:scale-95 transition-all",children:e.jsx(en,{size:20,className:"fill-current text-green-700"})}):L?e.jsx(Xa,{size:20,className:"text-slate-600 ml-2"}):e.jsx("span",{className:"font-mono text-slate-500 ml-2 text-xs",children:"Cooking"})]},h)}):e.jsx("p",{className:"text-slate-500 italic",children:"Nessun elemento nell'ordine."})})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-500 opacity-50",children:[e.jsx(gt,{size:48,className:"mb-4"}),e.jsx("p",{children:"Nessun ordine attivo"})]})}),e.jsxs("div",{className:"p-5 border-t border-slate-800 bg-slate-800 flex gap-2 mb-10",children:[e.jsxs("button",{onClick:()=>u("menu"),className:"flex-[2] py-4 rounded-2xl font-black text-base tracking-wide text-white shadow-xl bg-gradient-to-br from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 transition-transform flex flex-col items-center justify-center gap-1 hover:scale-[1.02] shadow-blue-900/30",children:[e.jsx(gs,{size:24})," ",e.jsx("span",{children:ue?"AGGIUNGI":"NUOVO ORDINE"})]}),ue&&e.jsxs("button",{onClick:ae,className:"flex-1 bg-orange-500 border-2 border-orange-400 text-white rounded-2xl font-black text-xs uppercase tracking-widest shadow-[0_0_20px_rgba(249,115,22,0.4)] hover:bg-orange-600 transition-all flex flex-col items-center justify-center gap-2 hover:scale-[1.02]",children:[e.jsx(Co,{size:20,className:"mb-1"}),e.jsx("span",{className:"text-[10px] leading-tight",children:"S, Libera"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-6 gap-4",children:Array.from({length:i},(_,h)=>h+1).map(_=>{const h=_.toString(),C=he(h),L=l===h,le=se(h),G=t.find(Pe=>Pe.tableNumber===h&&Pe.status!==ve.DELIVERED),me=(G==null?void 0:G.waiterName)&&I&&G.waiterName!==I;let pe="bg-slate-800 border-slate-700 hover:border-slate-500",Te=null;return C==="occupied"&&(pe="bg-blue-900/40 border-blue-500/50 text-blue-100",Te=e.jsx(bs,{size:12})),C==="cooking"&&(pe="bg-orange-900/40 border-orange-500/50 text-orange-100",Te=e.jsx(tt,{size:12})),C==="ready"&&(pe="bg-green-600 border-green-400 text-white animate-pulse shadow-[0_0_15px_rgba(34,197,94,0.6)]",Te=e.jsx(Io,{size:14,className:"animate-wiggle"})),C==="completed"&&(pe="bg-orange-700/80 border-orange-500 text-white shadow-lg",Te=e.jsx(Xa,{size:12})),C==="delayed"&&(pe="bg-red-900/20 border-red-500 text-red-500 animate-pulse ring-2 ring-red-500/50",Te=e.jsx(ot,{size:12})),C==="reserved"&&(pe="bg-purple-900/20 border-purple-500/50 text-purple-200 border-dashed",Te=e.jsx(or,{size:12})),L&&(pe="bg-blue-600 border-blue-500 text-white shadow-lg shadow-blue-500/20 scale-105"),me&&C!=="free"&&(pe="bg-slate-800 border-slate-600 text-slate-500 opacity-60 cursor-not-allowed grayscale"),e.jsxs("button",{onClick:()=>{me&&C!=="free"||ie(h)},className:`aspect-square rounded-2xl border-2 flex flex-col items-center justify-center gap-1 shadow-lg transition-all active:scale-95 relative ${pe}`,children:[e.jsx("span",{className:"text-3xl font-black",children:_}),(C==="delayed"||C==="cooking")&&le&&e.jsxs("div",{className:`absolute top-[-8px] right-[-8px] px-1.5 py-0.5 rounded text-[10px] font-bold flex items-center gap-1 shadow-sm z-10 ${C==="delayed"?"bg-red-500 text-white animate-bounce":"bg-orange-500/20 text-orange-400 border border-orange-500/30"}`,children:[e.jsx(Ze,{size:10})," ",le]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-bold uppercase min-h-[16px]",children:[C!=="free"&&(me?e.jsx(or,{size:12}):Te),C==="ready"?"SERVIRE":C==="reserved"?"PRENOTATO":C==="free"?"LIBERO":C]}),e.jsx("div",{className:"text-[9px] font-mono opacity-80 mt-0.5 truncate max-w-[90%] min-h-[14px]",children:(G==null?void 0:G.waiterName)||""}),C==="ready"&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full shadow-[0_0_8px_rgba(34,197,94,0.8)]"})]},_)})})]}),d==="menu"&&e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 bg-slate-900 z-20 shadow-md",children:[e.jsxs("div",{className:"bg-slate-800 p-2 border-b border-slate-700 flex items-center gap-2",children:[e.jsx("button",{onClick:we,className:"p-3 bg-slate-700 text-slate-300 rounded-xl font-bold border border-slate-600 hover:bg-slate-600 hover:text-white shrink-0",children:e.jsx(lr,{size:18})}),e.jsx("div",{className:"flex-1 overflow-x-auto whitespace-nowrap flex gap-2 no-scrollbar",children:am.map(_=>e.jsxs("button",{onClick:()=>j(_),className:`flex items-center gap-2 px-4 py-3 rounded-xl text-xs font-bold transition-colors ${v===_?"bg-blue-600 text-white shadow-lg":"bg-slate-700 text-slate-400"}`,children:[rm(_)," ",_]},_))})]}),e.jsx("div",{className:"p-3 bg-slate-800 border-b border-slate-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(nr,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",value:D,onChange:_=>E(_.target.value),placeholder:"Cerca piatto...",className:"w-full bg-slate-900 text-white rounded-xl pl-10 pr-4 py-3 border border-slate-700 focus:border-blue-500 outline-none font-bold"})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:P.map(_=>e.jsxs("button",{onClick:()=>ne(_),className:"flex flex-col h-32 bg-slate-800 p-4 rounded-2xl border border-slate-700 hover:bg-slate-750 active:scale-[0.98] transition-all relative group shadow-sm overflow-hidden justify-between",children:[e.jsx("div",{className:"absolute top-2 right-2 p-1.5 bg-blue-600 rounded-full text-white shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(gs,{size:16})}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-700/50 flex items-center justify-center font-bold text-slate-400 shrink-0",children:_.category===J.BEVANDE?e.jsx(wn,{size:20}):e.jsx(gt,{size:20})}),e.jsx("div",{className:"w-full",children:e.jsx("h3",{className:"font-black text-xl leading-none bg-gradient-to-br from-white to-slate-500 bg-clip-text text-transparent break-words hyphens-auto text-left",children:_.name})})]},_.id))}),P.length===0&&e.jsx("div",{className:"text-center py-10 text-slate-500",children:e.jsx("p",{children:"Nessun piatto trovato."})})]}),w.length>0&&e.jsxs("div",{className:"fixed bottom-6 left-4 right-4 z-30 flex gap-3 shadow-2xl animate-slide-up",children:[e.jsxs("button",{onClick:()=>u("cart"),className:"flex-1 bg-green-600 hover:bg-green-500 text-white py-4 rounded-2xl font-black text-lg shadow-lg shadow-green-600/30 flex items-center justify-between px-6 transition-transform active:scale-95",children:[e.jsx("span",{className:"tracking-wide",children:"RIEPILOGO"}),e.jsx("span",{className:"bg-white text-green-600 font-black w-8 h-8 flex items-center justify-center rounded-full text-sm shadow-sm",children:w.reduce((_,h)=>_+h.quantity,0)})]}),e.jsx("button",{onClick:fe,className:"w-20 bg-orange-500 hover:bg-orange-600 text-white rounded-2xl shadow-lg shadow-orange-500/30 flex items-center justify-center transition-transform active:scale-95 border-2 border-orange-400",children:e.jsx(ts,{size:28,className:"ml-1"})})]})]}),d==="cart"&&e.jsxs("div",{className:"flex-1 flex flex-col bg-slate-900",children:[e.jsxs("div",{className:"p-4 bg-slate-800 border-b border-slate-700 flex items-center gap-3 shrink-0",children:[e.jsx("button",{onClick:()=>u("menu"),className:"p-2 bg-slate-700 rounded-lg text-slate-300",children:e.jsx(ar,{size:24})}),e.jsx("h2",{className:"text-xl font-black text-white",children:"Riepilogo Ordine"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 pb-32",children:[w.map((_,h)=>{var le;const C=_.notes?_.notes.split("|||"):[],L=te===h;return e.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{children:e.jsx("h3",{className:"font-bold text-lg",children:(le=_.menuItem)==null?void 0:le.name})}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900 rounded-lg p-1 border border-slate-700",children:[e.jsx("button",{onClick:()=>V(h,-1),className:"w-8 h-8 flex items-center justify-center bg-slate-800 hover:bg-red-500/20 hover:text-red-400 rounded-md transition-colors font-bold",children:"-"}),e.jsx("span",{className:"font-bold w-6 text-center",children:_.quantity}),e.jsx("button",{onClick:()=>V(h,1),className:"w-8 h-8 flex items-center justify-center bg-slate-800 hover:bg-green-500/20 hover:text-green-400 rounded-md transition-colors font-bold",children:"+"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase",children:"Aggiungi Nota"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Scrivi o detta una nota...",value:L?ge:"",onChange:G=>{p(h),ye(G.target.value)},onFocus:()=>p(h),className:"flex-1 bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:border-blue-500 outline-none"}),e.jsx("button",{onClick:()=>$e(h),className:`p-2 rounded-lg transition-all ${ce&&L?"bg-red-500 text-white animate-pulse":"bg-slate-700 text-slate-300 hover:bg-blue-600 hover:text-white"}`,title:ce&&L?"Stop Recording":"Start Voice Input",children:ce&&L?e.jsx(Ti,{size:20}):e.jsx(Ii,{size:20})}),e.jsx("button",{onClick:()=>k(h),disabled:!L||!ge.trim(),className:"p-2 bg-green-600 hover:bg-green-500 disabled:opacity-30 disabled:cursor-not-allowed text-white rounded-lg transition-all",title:"Aggiungi Nota",children:e.jsx(gs,{size:20})})]})]}),C.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-orange-400 uppercase flex items-center gap-1",children:e.jsxs("span",{children:["Note (",C.length,")"]})}),C.map((G,me)=>e.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 border border-orange-500/30 rounded-lg p-2",children:[e.jsxs("span",{className:"flex-1 text-sm text-orange-300 italic",children:[" ",G]}),e.jsx("button",{onClick:()=>T({itemIndex:h,noteIndex:me,currentText:G}),className:"p-1 text-blue-400 hover:text-blue-300 transition-colors",title:"Modifica",children:e.jsx(ud,{size:14})}),e.jsx("button",{onClick:()=>Q(h,me),className:"p-1 text-red-400 hover:text-red-300 transition-colors",title:"Elimina",children:e.jsx(Xe,{size:14})})]},me))]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>re(h),className:"text-xs text-red-400 flex items-center gap-1 hover:underline",children:[e.jsx(Lt,{size:12})," Rimuovi"]})})]},h)}),w.length===0&&e.jsx("div",{className:"text-center text-slate-500 mt-10",children:"Carrello vuoto"})]}),e.jsxs("div",{className:"fixed bottom-6 left-4 right-4 bg-slate-800 border border-slate-700 p-4 rounded-3xl shadow-2xl z-40",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 px-2",children:[e.jsx("span",{className:"text-slate-400 font-bold uppercase text-xs",children:"Totale Piatti"}),e.jsx("span",{className:"text-3xl font-black text-white",children:w.reduce((_,h)=>_+h.quantity,0)})]}),e.jsxs("button",{onClick:fe,disabled:w.length===0,className:"w-full bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white py-4 rounded-xl font-black text-xl shadow-lg shadow-blue-600/20 transition-transform active:scale-95 flex items-center justify-center gap-3",children:[e.jsx(Le,{size:24})," CONFERMA ORDINE"]})]})]})]})]})},im=()=>{const[s,t]=m.useState(!0),[a,r]=m.useState(!1),[n,i]=m.useState(""),[o,l]=m.useState(""),[c,d]=m.useState(!1),[u,v]=m.useState(""),[j,w]=m.useState(!q),[N,D]=m.useState(""),[E,O]=m.useState(""),[A,B]=m.useState(!1),[Z,F]=m.useState(null),[H,Y]=m.useState(null),[x,b]=m.useState(!1),S=ee=>{ee.preventDefault(),I0(N,E)},K=async ee=>{var ge,ye;if(ee.preventDefault(),B(!0),F(null),Y(null),b(!1),!q){F("Connessione al database non configurata."),w(!0),B(!1);return}try{if(a){const{error:ce}=await q.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(ce)throw ce;Y("Email di recupero inviata! Controlla la tua casella di posta (e lo spam).")}else if(s){const ce=["ristosync_supabase_url","ristosync_supabase_key"];Object.keys(localStorage).filter(p=>p.startsWith("ristosync_")&&!ce.includes(p)).forEach(p=>localStorage.removeItem(p));const{error:te}=await q.auth.signInWithPassword({email:n,password:o});if(te)throw te}else{let ce="49.90";try{const{data:p}=await q.from("profiles").select("settings").eq("email",an).single();(ye=(ge=p==null?void 0:p.settings)==null?void 0:ge.globalConfig)!=null&&ye.defaultCost&&(ce=p.settings.globalConfig.defaultCost)}catch{console.log("Using fallback cost")}const{data:U,error:te}=await q.auth.signUp({email:n,password:o,options:{data:{restaurant_name:u}}});if(te)throw te;if(U.user)try{const p=new Date;p.setDate(p.getDate()+15),await q.from("profiles").upsert({id:U.user.id,email:n,restaurant_name:u,subscription_status:"active",settings:{restaurantProfile:{planType:"Trial",subscriptionEndDate:p.toISOString(),subscriptionCost:ce,name:u}}},{onConflict:"id"})}catch(p){console.log("Profile setup error: ",p)}if(U.user&&!U.session){b(!0),B(!1);return}await new Promise(p=>setTimeout(p,1e3))}}catch(ce){let U=ce.message||"Si  verificato un errore.";console.error("Auth Error:",ce),U.includes("security purposes")?U="Troppi tentativi. Attendi 60 secondi.":U.includes("Invalid login credentials")?U="Email o password non corretti.":U.includes("User already registered")&&(U="Utente gi registrato. Accedi."),F(U)}finally{!x&&!H&&B(!1),a&&!Z&&B(!1)}},M=()=>{r(!a),F(null),Y(null)};return j?e.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-slate-900 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 to-slate-950"}),e.jsxs("div",{className:"relative z-10 w-full max-w-md bg-slate-900 border border-slate-700 p-8 rounded-3xl shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-600/30",children:e.jsx(li,{size:32,className:"text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Configurazione Database"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Inserisci le credenziali del tuo progetto Supabase per connettere l'app."})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:"Project URL"}),e.jsx("input",{type:"text",value:N,onChange:ee=>D(ee.target.value),placeholder:"https://xyz.supabase.co",className:"w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white focus:border-blue-500 outline-none font-mono text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:"Anon Public Key"}),e.jsx("input",{type:"text",value:E,onChange:ee=>O(ee.target.value),placeholder:"eyJhbGciOiJIUzI1NiIsInR5cCI...",className:"w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white focus:border-blue-500 outline-none font-mono text-sm",required:!0})]}),e.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 mt-4",children:[e.jsx(is,{size:20})," Salva e Connetti"]})]}),q&&e.jsx("button",{onClick:()=>w(!1),className:"w-full mt-4 text-slate-500 hover:text-white text-sm font-bold",children:"Annulla"})]})]}):e.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[url('https://images.unsplash.com/photo-1559339352-11d035aa65de?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80')] bg-cover bg-center opacity-10 blur-sm"}),e.jsx("div",{className:"absolute top-6 left-6 z-20",children:e.jsxs("button",{onClick:()=>window.location.href="/?landing=true",className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors font-bold bg-slate-900/80 px-4 py-2 rounded-full border border-slate-700 hover:border-orange-500 backdrop-blur-md group shadow-xl",children:[e.jsx(lr,{size:18,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"hidden md:inline",children:"Home Page"}),e.jsx("span",{className:"md:hidden",children:"HOME"})]})}),e.jsxs("div",{className:"relative z-10 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("div",{className:"w-20 h-20 bg-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-2xl shadow-orange-500/30 transform -rotate-3 cursor-pointer hover:scale-110 transition-transform",onClick:()=>window.location.href="/?landing=true",title:"Torna alla Home",children:e.jsx(tt,{size:40,className:"text-white",style:{animation:"logoBounce 2s ease-in-out infinite"}})}),e.jsxs("h1",{className:"text-4xl font-extrabold text-white tracking-tight",children:["Risto",e.jsx("span",{className:"text-orange-500",children:"Sync"}),e.jsx("span",{className:"text-blue-500 font-black ml-1",children:"AI"})]}),e.jsx("p",{className:"text-slate-400 mt-2 text-sm font-medium uppercase tracking-widest",children:"SaaS Restaurant Management"}),e.jsxs("div",{className:"mt-6 bg-gradient-to-r from-blue-600/20 to-orange-600/20 border border-blue-500/30 rounded-2xl p-4 backdrop-blur-sm animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-blue-400 font-black text-xs uppercase tracking-wider",children:"Registrazione Gratuita"})]}),e.jsxs("p",{className:"text-white text-sm font-bold text-center leading-relaxed",children:[" ",e.jsx("span",{className:"text-orange-400",children:"Prova RistoSync AI"})," per il tuo ristorante"]}),e.jsx("p",{className:"text-slate-300 text-xs text-center mt-1",children:"Registrati e ricevi il tuo trial gratuito"})]})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-8 shadow-2xl backdrop-blur-xl transition-all duration-300",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6 text-center",children:a?"Recupero Password":s?"Accedi al Ristorante":"Registra Nuovo Locale"}),x&&e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 text-blue-300 p-6 rounded-xl text-center mb-6 animate-fade-in",children:[e.jsx(_t,{size:32,className:"mx-auto mb-3 text-blue-400"}),e.jsx("h3",{className:"font-bold text-lg text-white mb-2",children:"Controlla la tua Email"}),e.jsxs("p",{className:"text-sm",children:["Link di conferma inviato a ",e.jsx("strong",{children:n}),"."]}),e.jsx("button",{onClick:()=>b(!1),className:"mt-4 text-blue-400 font-bold hover:underline text-sm",children:"Torna al login"})]}),H&&e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 text-green-400 p-6 rounded-xl text-center mb-6 animate-fade-in",children:[e.jsx(ts,{size:32,className:"mx-auto mb-3 text-green-500"}),e.jsx("h3",{className:"font-bold text-lg text-white mb-2",children:"Email Inviata"}),e.jsx("p",{className:"text-sm",children:H}),e.jsx("button",{onClick:()=>{r(!1),Y(null)},className:"mt-4 text-green-400 font-bold hover:underline text-sm",children:"Torna al login"})]}),!x&&Z&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 p-4 rounded-xl text-sm mb-6 font-bold flex flex-col gap-3 justify-center animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(ot,{size:24,className:"shrink-0"}),e.jsx("span",{children:Z})]}),e.jsxs("button",{onClick:T0,className:"text-xs bg-red-500/20 hover:bg-red-500/30 text-white py-2 rounded-lg border border-red-500/30 flex items-center justify-center gap-2",children:[e.jsx(ci,{size:12})," Resetta Configurazione Database"]})]}),!x&&!H&&e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[!s&&!a&&e.jsxs("div",{className:"relative animate-fade-in",children:[e.jsx(tt,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500",size:20}),e.jsx("input",{type:"text",placeholder:"Nome Ristorante",value:u,onChange:ee=>v(ee.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl py-4 pl-12 pr-4 text-white outline-none focus:border-orange-500 transition-colors",required:!s})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500",size:20}),e.jsx("input",{type:"email",placeholder:"Email",value:n,onChange:ee=>i(ee.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl py-4 pl-12 pr-4 text-white outline-none focus:border-orange-500 transition-colors",required:!0})]}),!a&&e.jsxs("div",{className:"relative animate-fade-in",children:[e.jsx(or,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500",size:20}),e.jsx("input",{type:c?"text":"password",placeholder:"Password",value:o,onChange:ee=>l(ee.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl py-4 pl-12 pr-12 text-white outline-none focus:border-orange-500 transition-colors",required:!a}),e.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white transition-colors p-2 z-10",tabIndex:-1,children:c?e.jsx(hd,{size:20}):e.jsx(Ai,{size:20})})]}),s&&!a&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:M,className:"text-xs text-orange-500 font-bold hover:text-orange-400 hover:underline transition-colors",children:"Password dimenticata?"})}),e.jsxs("button",{type:"submit",disabled:A,className:`w-full text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-[0.98] flex items-center justify-center gap-2 ${a?"bg-indigo-600 hover:bg-indigo-500 shadow-indigo-600/20":"bg-orange-500 hover:bg-orange-600 shadow-orange-500/20"}`,children:[A?e.jsx($t,{className:"animate-spin"}):a?"Invia Link di Reset":s?"Entra":"Prova Gratis 15 Giorni",!A&&!a&&e.jsx(xs,{size:20}),!A&&a&&e.jsx(ts,{size:20})]}),a&&e.jsxs("button",{type:"button",onClick:M,className:"w-full py-3 text-slate-400 font-bold text-sm hover:text-white transition-colors flex items-center justify-center gap-2",children:[e.jsx(lr,{size:16})," Torna al Login"]})]}),!x&&!a&&!H&&e.jsx("div",{className:"mt-8 text-center animate-fade-in",children:e.jsxs("p",{className:"text-slate-500 text-sm",children:[s?"Non hai un account?":"Hai gi un ristorante?",e.jsx("button",{onClick:()=>{t(!s),F(null)},className:"ml-2 text-white font-bold hover:underline",children:s?"Registrati ora":"Accedi"})]})})]})]}),e.jsx("style",{children:`
                @keyframes logoBounce {
                    0%, 100% {
                        transform: translateY(0) rotate(-3deg);
                    }
                    50% {
                        transform: translateY(-8px) rotate(-3deg);
                    }
                }
            `})]})};var On={},Ec={exports:{}},om="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",lm=om,cm=lm;function Cc(){}function Ic(){}Ic.resetWarningCache=Cc;var dm=function(){function s(r,n,i,o,l,c){if(c!==cm){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}s.isRequired=s;function t(){return s}var a={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:t,element:s,elementType:s,instanceOf:t,node:s,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Ic,resetWarningCache:Cc};return a.PropTypes=a,a};Ec.exports=dm();var Tc=Ec.exports,Ac={L:1,M:0,Q:3,H:2},Oc={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},um=Oc;function Rc(s){this.mode=um.MODE_8BIT_BYTE,this.data=s}Rc.prototype={getLength:function(s){return this.data.length},write:function(s){for(var t=0;t<this.data.length;t++)s.put(this.data.charCodeAt(t),8)}};var hm=Rc,Qr=Ac;function as(s,t){this.totalCount=s,this.dataCount=t}as.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];as.getRSBlocks=function(s,t){var a=as.getRsBlockTable(s,t);if(a==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+t);for(var r=a.length/3,n=new Array,i=0;i<r;i++)for(var o=a[i*3+0],l=a[i*3+1],c=a[i*3+2],d=0;d<o;d++)n.push(new as(l,c));return n};as.getRsBlockTable=function(s,t){switch(t){case Qr.L:return as.RS_BLOCK_TABLE[(s-1)*4+0];case Qr.M:return as.RS_BLOCK_TABLE[(s-1)*4+1];case Qr.Q:return as.RS_BLOCK_TABLE[(s-1)*4+2];case Qr.H:return as.RS_BLOCK_TABLE[(s-1)*4+3];default:return}};var mm=as;function Pc(){this.buffer=new Array,this.length=0}Pc.prototype={get:function(s){var t=Math.floor(s/8);return(this.buffer[t]>>>7-s%8&1)==1},put:function(s,t){for(var a=0;a<t;a++)this.putBit((s>>>t-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(s){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),s&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var xm=Pc,es={glog:function(s){if(s<1)throw new Error("glog("+s+")");return es.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return es.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var mt=0;mt<8;mt++)es.EXP_TABLE[mt]=1<<mt;for(var mt=8;mt<256;mt++)es.EXP_TABLE[mt]=es.EXP_TABLE[mt-4]^es.EXP_TABLE[mt-5]^es.EXP_TABLE[mt-6]^es.EXP_TABLE[mt-8];for(var mt=0;mt<255;mt++)es.LOG_TABLE[es.EXP_TABLE[mt]]=mt;var zc=es,Fs=zc;function on(s,t){if(s.length==null)throw new Error(s.length+"/"+t);for(var a=0;a<s.length&&s[a]==0;)a++;this.num=new Array(s.length-a+t);for(var r=0;r<s.length-a;r++)this.num[r]=s[r+a]}on.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var t=new Array(this.getLength()+s.getLength()-1),a=0;a<this.getLength();a++)for(var r=0;r<s.getLength();r++)t[a+r]^=Fs.gexp(Fs.glog(this.get(a))+Fs.glog(s.get(r)));return new on(t,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var t=Fs.glog(this.get(0))-Fs.glog(s.get(0)),a=new Array(this.getLength()),r=0;r<this.getLength();r++)a[r]=this.get(r);for(var r=0;r<s.getLength();r++)a[r]^=Fs.gexp(Fs.glog(s.get(r))+t);return new on(a,0).mod(s)}};var Dc=on,qt=Oc,gl=Dc,pm=zc,Ss={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},ut={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(s){for(var t=s<<10;ut.getBCHDigit(t)-ut.getBCHDigit(ut.G15)>=0;)t^=ut.G15<<ut.getBCHDigit(t)-ut.getBCHDigit(ut.G15);return(s<<10|t)^ut.G15_MASK},getBCHTypeNumber:function(s){for(var t=s<<12;ut.getBCHDigit(t)-ut.getBCHDigit(ut.G18)>=0;)t^=ut.G18<<ut.getBCHDigit(t)-ut.getBCHDigit(ut.G18);return s<<12|t},getBCHDigit:function(s){for(var t=0;s!=0;)t++,s>>>=1;return t},getPatternPosition:function(s){return ut.PATTERN_POSITION_TABLE[s-1]},getMask:function(s,t,a){switch(s){case Ss.PATTERN000:return(t+a)%2==0;case Ss.PATTERN001:return t%2==0;case Ss.PATTERN010:return a%3==0;case Ss.PATTERN011:return(t+a)%3==0;case Ss.PATTERN100:return(Math.floor(t/2)+Math.floor(a/3))%2==0;case Ss.PATTERN101:return t*a%2+t*a%3==0;case Ss.PATTERN110:return(t*a%2+t*a%3)%2==0;case Ss.PATTERN111:return(t*a%3+(t+a)%2)%2==0;default:throw new Error("bad maskPattern:"+s)}},getErrorCorrectPolynomial:function(s){for(var t=new gl([1],0),a=0;a<s;a++)t=t.multiply(new gl([1,pm.gexp(a)],0));return t},getLengthInBits:function(s,t){if(1<=t&&t<10)switch(s){case qt.MODE_NUMBER:return 10;case qt.MODE_ALPHA_NUM:return 9;case qt.MODE_8BIT_BYTE:return 8;case qt.MODE_KANJI:return 8;default:throw new Error("mode:"+s)}else if(t<27)switch(s){case qt.MODE_NUMBER:return 12;case qt.MODE_ALPHA_NUM:return 11;case qt.MODE_8BIT_BYTE:return 16;case qt.MODE_KANJI:return 10;default:throw new Error("mode:"+s)}else if(t<41)switch(s){case qt.MODE_NUMBER:return 14;case qt.MODE_ALPHA_NUM:return 13;case qt.MODE_8BIT_BYTE:return 16;case qt.MODE_KANJI:return 12;default:throw new Error("mode:"+s)}else throw new Error("type:"+t)},getLostPoint:function(s){for(var t=s.getModuleCount(),a=0,r=0;r<t;r++)for(var n=0;n<t;n++){for(var i=0,o=s.isDark(r,n),l=-1;l<=1;l++)if(!(r+l<0||t<=r+l))for(var c=-1;c<=1;c++)n+c<0||t<=n+c||l==0&&c==0||o==s.isDark(r+l,n+c)&&i++;i>5&&(a+=3+i-5)}for(var r=0;r<t-1;r++)for(var n=0;n<t-1;n++){var d=0;s.isDark(r,n)&&d++,s.isDark(r+1,n)&&d++,s.isDark(r,n+1)&&d++,s.isDark(r+1,n+1)&&d++,(d==0||d==4)&&(a+=3)}for(var r=0;r<t;r++)for(var n=0;n<t-6;n++)s.isDark(r,n)&&!s.isDark(r,n+1)&&s.isDark(r,n+2)&&s.isDark(r,n+3)&&s.isDark(r,n+4)&&!s.isDark(r,n+5)&&s.isDark(r,n+6)&&(a+=40);for(var n=0;n<t;n++)for(var r=0;r<t-6;r++)s.isDark(r,n)&&!s.isDark(r+1,n)&&s.isDark(r+2,n)&&s.isDark(r+3,n)&&s.isDark(r+4,n)&&!s.isDark(r+5,n)&&s.isDark(r+6,n)&&(a+=40);for(var u=0,n=0;n<t;n++)for(var r=0;r<t;r++)s.isDark(r,n)&&u++;var v=Math.abs(100*u/t/t-50)/5;return a+=v*10,a}},fm=ut,gm=hm,$c=mm,Lc=xm,zs=fm,bm=Dc;function ns(s,t){this.typeNumber=s,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var Ut=ns.prototype;Ut.addData=function(s){var t=new gm(s);this.dataList.push(t),this.dataCache=null};Ut.isDark=function(s,t){if(s<0||this.moduleCount<=s||t<0||this.moduleCount<=t)throw new Error(s+","+t);return this.modules[s][t]};Ut.getModuleCount=function(){return this.moduleCount};Ut.make=function(){if(this.typeNumber<1){var s=1;for(s=1;s<40;s++){for(var t=$c.getRSBlocks(s,this.errorCorrectLevel),a=new Lc,r=0,n=0;n<t.length;n++)r+=t[n].dataCount;for(var n=0;n<this.dataList.length;n++){var i=this.dataList[n];a.put(i.mode,4),a.put(i.getLength(),zs.getLengthInBits(i.mode,s)),i.write(a)}if(a.getLengthInBits()<=r*8)break}this.typeNumber=s}this.makeImpl(!1,this.getBestMaskPattern())};Ut.makeImpl=function(s,t){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var a=0;a<this.moduleCount;a++){this.modules[a]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[a][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(s,t),this.typeNumber>=7&&this.setupTypeNumber(s),this.dataCache==null&&(this.dataCache=ns.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)};Ut.setupPositionProbePattern=function(s,t){for(var a=-1;a<=7;a++)if(!(s+a<=-1||this.moduleCount<=s+a))for(var r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(0<=a&&a<=6&&(r==0||r==6)||0<=r&&r<=6&&(a==0||a==6)||2<=a&&a<=4&&2<=r&&r<=4?this.modules[s+a][t+r]=!0:this.modules[s+a][t+r]=!1)};Ut.getBestMaskPattern=function(){for(var s=0,t=0,a=0;a<8;a++){this.makeImpl(!0,a);var r=zs.getLostPoint(this);(a==0||s>r)&&(s=r,t=a)}return t};Ut.createMovieClip=function(s,t,a){var r=s.createEmptyMovieClip(t,a),n=1;this.make();for(var i=0;i<this.modules.length;i++)for(var o=i*n,l=0;l<this.modules[i].length;l++){var c=l*n,d=this.modules[i][l];d&&(r.beginFill(0,100),r.moveTo(c,o),r.lineTo(c+n,o),r.lineTo(c+n,o+n),r.lineTo(c,o+n),r.endFill())}return r};Ut.setupTimingPattern=function(){for(var s=8;s<this.moduleCount-8;s++)this.modules[s][6]==null&&(this.modules[s][6]=s%2==0);for(var t=8;t<this.moduleCount-8;t++)this.modules[6][t]==null&&(this.modules[6][t]=t%2==0)};Ut.setupPositionAdjustPattern=function(){for(var s=zs.getPatternPosition(this.typeNumber),t=0;t<s.length;t++)for(var a=0;a<s.length;a++){var r=s[t],n=s[a];if(this.modules[r][n]==null)for(var i=-2;i<=2;i++)for(var o=-2;o<=2;o++)i==-2||i==2||o==-2||o==2||i==0&&o==0?this.modules[r+i][n+o]=!0:this.modules[r+i][n+o]=!1}};Ut.setupTypeNumber=function(s){for(var t=zs.getBCHTypeNumber(this.typeNumber),a=0;a<18;a++){var r=!s&&(t>>a&1)==1;this.modules[Math.floor(a/3)][a%3+this.moduleCount-8-3]=r}for(var a=0;a<18;a++){var r=!s&&(t>>a&1)==1;this.modules[a%3+this.moduleCount-8-3][Math.floor(a/3)]=r}};Ut.setupTypeInfo=function(s,t){for(var a=this.errorCorrectLevel<<3|t,r=zs.getBCHTypeInfo(a),n=0;n<15;n++){var i=!s&&(r>>n&1)==1;n<6?this.modules[n][8]=i:n<8?this.modules[n+1][8]=i:this.modules[this.moduleCount-15+n][8]=i}for(var n=0;n<15;n++){var i=!s&&(r>>n&1)==1;n<8?this.modules[8][this.moduleCount-n-1]=i:n<9?this.modules[8][15-n-1+1]=i:this.modules[8][15-n-1]=i}this.modules[this.moduleCount-8][8]=!s};Ut.mapData=function(s,t){for(var a=-1,r=this.moduleCount-1,n=7,i=0,o=this.moduleCount-1;o>0;o-=2)for(o==6&&o--;;){for(var l=0;l<2;l++)if(this.modules[r][o-l]==null){var c=!1;i<s.length&&(c=(s[i]>>>n&1)==1);var d=zs.getMask(t,r,o-l);d&&(c=!c),this.modules[r][o-l]=c,n--,n==-1&&(i++,n=7)}if(r+=a,r<0||this.moduleCount<=r){r-=a,a=-a;break}}};ns.PAD0=236;ns.PAD1=17;ns.createData=function(s,t,a){for(var r=$c.getRSBlocks(s,t),n=new Lc,i=0;i<a.length;i++){var o=a[i];n.put(o.mode,4),n.put(o.getLength(),zs.getLengthInBits(o.mode,s)),o.write(n)}for(var l=0,i=0;i<r.length;i++)l+=r[i].dataCount;if(n.getLengthInBits()>l*8)throw new Error("code length overflow. ("+n.getLengthInBits()+">"+l*8+")");for(n.getLengthInBits()+4<=l*8&&n.put(0,4);n.getLengthInBits()%8!=0;)n.putBit(!1);for(;!(n.getLengthInBits()>=l*8||(n.put(ns.PAD0,8),n.getLengthInBits()>=l*8));)n.put(ns.PAD1,8);return ns.createBytes(n,r)};ns.createBytes=function(s,t){for(var a=0,r=0,n=0,i=new Array(t.length),o=new Array(t.length),l=0;l<t.length;l++){var c=t[l].dataCount,d=t[l].totalCount-c;r=Math.max(r,c),n=Math.max(n,d),i[l]=new Array(c);for(var u=0;u<i[l].length;u++)i[l][u]=255&s.buffer[u+a];a+=c;var v=zs.getErrorCorrectPolynomial(d),j=new bm(i[l],v.getLength()-1),w=j.mod(v);o[l]=new Array(v.getLength()-1);for(var u=0;u<o[l].length;u++){var N=u+w.getLength()-o[l].length;o[l][u]=N>=0?w.get(N):0}}for(var D=0,u=0;u<t.length;u++)D+=t[u].totalCount;for(var E=new Array(D),O=0,u=0;u<r;u++)for(var l=0;l<t.length;l++)u<i[l].length&&(E[O++]=i[l][u]);for(var u=0;u<n;u++)for(var l=0;l<t.length;l++)u<o[l].length&&(E[O++]=o[l][u]);return E};var vm=ns,to={};Object.defineProperty(to,"__esModule",{value:!0});var wm=Object.assign||function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},jm=Tc,Vt=Uc(jm),Mc=m,Xr=Uc(Mc);function Uc(s){return s&&s.__esModule?s:{default:s}}function ym(s,t){var a={};for(var r in s)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r]);return a}var Nm={bgColor:Vt.default.oneOfType([Vt.default.object,Vt.default.string]).isRequired,bgD:Vt.default.string.isRequired,fgColor:Vt.default.oneOfType([Vt.default.object,Vt.default.string]).isRequired,fgD:Vt.default.string.isRequired,size:Vt.default.number.isRequired,title:Vt.default.string,viewBoxSize:Vt.default.number.isRequired,xmlns:Vt.default.string},so=(0,Mc.forwardRef)(function(s,t){var a=s.bgColor,r=s.bgD,n=s.fgD,i=s.fgColor,o=s.size,l=s.title,c=s.viewBoxSize,d=s.xmlns,u=d===void 0?"http://www.w3.org/2000/svg":d,v=ym(s,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return Xr.default.createElement("svg",wm({},v,{height:o,ref:t,viewBox:"0 0 "+c+" "+c,width:o,xmlns:u}),l?Xr.default.createElement("title",null,l):null,Xr.default.createElement("path",{d:r,fill:a}),Xr.default.createElement("path",{d:n,fill:i}))});so.displayName="QRCodeSvg";so.propTypes=Nm;to.default=so;Object.defineProperty(On,"__esModule",{value:!0});On.QRCode=void 0;var _m=Object.assign||function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},km=Tc,ms=kr(km),Sm=Ac,Em=kr(Sm),Cm=vm,Im=kr(Cm),Bc=m,Tm=kr(Bc),Am=to,Om=kr(Am);function kr(s){return s&&s.__esModule?s:{default:s}}function Rm(s,t){var a={};for(var r in s)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r]);return a}var Pm={bgColor:ms.default.oneOfType([ms.default.object,ms.default.string]),fgColor:ms.default.oneOfType([ms.default.object,ms.default.string]),level:ms.default.string,size:ms.default.number,value:ms.default.string.isRequired},Rn=(0,Bc.forwardRef)(function(s,t){var a=s.bgColor,r=a===void 0?"#FFFFFF":a,n=s.fgColor,i=n===void 0?"#000000":n,o=s.level,l=o===void 0?"L":o,c=s.size,d=c===void 0?256:c,u=s.value,v=Rm(s,["bgColor","fgColor","level","size","value"]),j=new Im.default(-1,Em.default[l]);j.addData(u),j.make();var w=j.modules;return Tm.default.createElement(Om.default,_m({},v,{bgColor:r,bgD:w.map(function(N,D){return N.map(function(E,O){return E?"":"M "+O+" "+D+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:i,fgD:w.map(function(N,D){return N.map(function(E,O){return E?"M "+O+" "+D+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:t,size:d,viewBoxSize:w.length}))});On.QRCode=Rn;Rn.displayName="QRCode";Rn.propTypes=Pm;var wr=On.default=Rn;function zm({profiles:s,showToast:t}){const[a,r]=m.useState("inbox"),[n,i]=m.useState([]),[o,l]=m.useState(null),[c,d]=m.useState(!1),[u,v]=m.useState(null),[j,w]=m.useState("broadcast"),[N,D]=m.useState(""),[E,O]=m.useState(""),[A,B]=m.useState(null),[Z,F]=m.useState(!1),[H,Y]=m.useState(!1),[x,b]=m.useState(""),S=m.useRef(null),K=m.useRef(null);m.useEffect(()=>{const p=g=>{S.current&&!S.current.contains(g.target)&&Y(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]),m.useEffect(()=>{if(!q)return;M();const p=q.channel("admin_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},g=>{M()}).subscribe();return()=>{q.removeChannel(p)}},[]);const M=async()=>{d(!0);const{data:{user:p}}=await q.auth.getUser();if(!p)return;const{data:g,error:y}=await q.from("messages").select("*").eq("recipient_id",p.id).order("created_at",{ascending:!1});if(y)console.error("Error fetching messages:",y);else{const T=g==null?void 0:g.map(I=>{const X=s.find(he=>he.id===I.sender_id);return{...I,sender_email:(X==null?void 0:X.email)||"Sconosciuto",restaurant_name:(X==null?void 0:X.restaurant_name)||"Ristorante Sconosciuto"}});i(T||[])}d(!1)},ee=async()=>{if(!N.trim()||!E.trim()){t("Oggetto e messaggio sono obbligatori.","error");return}F(!0);let p=null;try{const{data:{user:g}}=await q.auth.getUser();if(!g)throw new Error("Utente non autenticato");if(A){const I=A.name.split(".").pop(),X=`${Date.now()}.${I}`,{error:he}=await q.storage.from("attachments").upload(X,A);if(he)throw he;const{data:{publicUrl:se}}=q.storage.from("attachments").getPublicUrl(X);p=se}let y=[];j==="broadcast"?y=s.map(I=>({sender_id:g.id,recipient_id:I.id,subject:N,content:E,attachment_url:p,is_read:!1})):y=[{sender_id:g.id,recipient_id:j,subject:N,content:E,attachment_url:p,is_read:!1}];const{error:T}=await q.from("messages").insert(y);if(T)throw T;t(j==="broadcast"?`Messaggio inviato a ${y.length} utenti!`:"Messaggio inviato con successo!","success"),D(""),O(""),B(null),r("inbox")}catch(g){console.error(g),t("Errore invio: "+g.message,"error")}finally{F(!1)}},ge=async()=>{if(!u)return;const p=u,{error:g}=await q.from("messages").delete().eq("id",p);g?t("Errore eliminazione","error"):(i(y=>y.filter(T=>T.id!==p)),t("Messaggio eliminato con successo","success"),(o==null?void 0:o.id)===p&&l(null)),v(null)},ye=async p=>{const{error:g}=await q.from("messages").update({is_read:!0}).eq("id",p);g||i(y=>y.map(T=>T.id===p?{...T,is_read:!0}:T))},ce=p=>{p.is_read||ye(p.id),D(`Re: ${p.subject}`),w(p.sender_id),r("compose"),l(null)},U=s.filter(p=>{var y,T;const g=x.toLowerCase();return(((y=p.restaurant_name)==null?void 0:y.toLowerCase())||"").includes(g)||(((T=p.email)==null?void 0:T.toLowerCase())||"").includes(g)}),te=()=>{if(j==="broadcast")return" TUTTI I RISTORANTI (Broadcast)";const p=s.find(g=>g.id===j);return p?` ${p.restaurant_name} (${p.email})`:"Seleziona Destinatario"};return e.jsxs("div",{className:"bg-slate-800 rounded-3xl border border-slate-700 p-0 shadow-xl h-[700px] flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"bg-slate-800 p-6 flex justify-between items-center border-b border-slate-700",children:[e.jsxs("h2",{className:"text-2xl font-black text-white flex items-center gap-3",children:[e.jsx(_t,{className:"text-indigo-500"})," Centro Messaggi"]}),e.jsxs("div",{className:"flex bg-slate-900 p-1 rounded-xl border border-slate-700",children:[e.jsxs("button",{onClick:()=>{r("inbox"),l(null)},className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-all ${a==="inbox"?"bg-indigo-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:[e.jsx(di,{size:16})," Posta in Arrivo",n.some(p=>!p.is_read)&&e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"})]}),e.jsxs("button",{onClick:()=>{r("compose"),l(null)},className:`px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-all ${a==="compose"?"bg-indigo-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`,children:[e.jsx(ts,{size:16})," Componi / Broadcast"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex relative bg-slate-900",children:[a==="inbox"&&e.jsxs("div",{className:`w-full md:w-1/3 border-r border-slate-800 flex flex-col ${o?"hidden md:flex":"flex"}`,children:[e.jsx("div",{className:"p-4 border-b border-slate-800",children:e.jsxs("div",{className:"relative",children:[e.jsx(nr,{className:"absolute left-3 top-2.5 text-slate-500",size:16}),e.jsx("input",{type:"text",placeholder:"Cerca msg...",className:"w-full bg-slate-950 border border-slate-700 rounded-xl pl-10 pr-4 py-2 text-sm text-white focus:border-indigo-500 outline-none"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scroll",children:c?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx($t,{className:"animate-spin text-slate-500"})}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-slate-500 gap-2",children:[e.jsx(cn,{size:32,className:"opacity-30"}),e.jsx("span",{className:"text-xs",children:"Nessun messaggio"})]}):n.map(p=>e.jsxs("div",{onClick:()=>{l(p),p.is_read||ye(p.id)},className:`p-4 border-b border-slate-800 cursor-pointer transition-colors relative 
                                            ${(o==null?void 0:o.id)===p.id?"bg-indigo-900/20":"hover:bg-slate-800/50"} 
                                            ${p.is_read?"opacity-60 border-l-4 border-l-transparent hover:opacity-100":"bg-slate-800/40 border-l-4 border-l-orange-500"}
                                        `,children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsxs("span",{className:`text-xs font-bold truncate max-w-[150px] flex items-center gap-1 ${p.is_read?"text-slate-400":"text-white"}`,children:[p.restaurant_name,!p.is_read&&e.jsx("span",{className:"bg-orange-500 text-white text-[10px] px-1.5 py-0.5 rounded font-bold uppercase ml-1",children:"NUOVO"})]}),e.jsx("span",{className:"text-[10px] text-slate-500",children:new Date(p.created_at).toLocaleDateString()})]}),e.jsx("div",{className:`text-sm mb-1 truncate ${p.is_read?"text-slate-300":"font-bold text-white"}`,children:p.subject}),e.jsx("div",{className:"text-xs text-slate-500 truncate",children:p.content})]},p.id))})]}),e.jsxs("div",{className:`flex-1 flex flex-col bg-slate-900/50 ${a==="inbox"&&!o?"hidden md:flex":"flex"}`,children:[a==="inbox"&&(o?e.jsxs("div",{className:"flex-1 flex flex-col h-full animate-fade-in text-white",children:[e.jsxs("div",{className:"md:hidden p-4 border-b border-slate-800 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(null),className:"text-slate-400 hover:text-white",children:e.jsx(lr,{size:20})}),e.jsx("span",{className:"font-bold text-white",children:"Dettaglio Messaggio"})]}),e.jsxs("div",{className:"p-8 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-white mb-2",children:o.subject}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-800 px-3 py-1 rounded-lg",children:[e.jsx(Rs,{size:14,className:"text-indigo-400"}),e.jsx("span",{className:"text-white font-bold",children:o.restaurant_name})]}),e.jsx("span",{className:"bg-slate-800 px-2 py-1 rounded text-xs",children:o.sender_email})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>v(o.id),className:"p-2 hover:bg-red-500/20 rounded-lg text-slate-500 hover:text-red-500 transition-colors",title:"Elimina",children:e.jsx(Lt,{size:20})})})]}),e.jsx("div",{className:"prose prose-invert max-w-none text-slate-300 leading-relaxed whitespace-pre-line mb-8 p-6 bg-slate-950 rounded-2xl border border-slate-800 shadow-inner",children:o.content}),o.attachment_url&&e.jsx("div",{className:"mb-8",children:e.jsxs("a",{href:o.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-3 px-4 py-3 bg-indigo-900/20 border border-indigo-500/30 rounded-xl hover:bg-indigo-900/40 transition-colors group",children:[e.jsx("div",{className:"bg-indigo-500/20 p-2 rounded-lg text-indigo-400 group-hover:scale-110 transition-transform",children:e.jsx(dn,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-white",children:"Allegato disponibile"}),e.jsx("p",{className:"text-xs text-indigo-300",children:"Clicca per scaricare"})]}),e.jsx(Oi,{size:16,className:"text-indigo-400 ml-2"})]})}),e.jsx("div",{className:"border-t border-slate-800 pt-6",children:e.jsxs("button",{onClick:()=>ce(o),className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold flex items-center gap-2 shadow-lg shadow-indigo-600/20 transition-all active:scale-95",children:[e.jsx(ui,{size:18})," Rispondi a ",o.restaurant_name]})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 opacity-40",children:[e.jsx(_t,{size:64,className:"mb-4",strokeWidth:1}),e.jsx("p",{className:"text-lg font-medium",children:"Seleziona un messaggio per leggerlo"})]})),a==="compose"&&e.jsx("div",{className:"p-8 overflow-y-auto h-full flex justify-center",children:e.jsxs("div",{className:"w-full max-w-2xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Destinatario"}),e.jsxs("div",{className:"relative",ref:S,children:[e.jsxs("button",{onClick:()=>Y(!H),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white flex justify-between items-center hover:border-indigo-500 transition-colors",children:[e.jsx("span",{className:"font-bold flex items-center gap-2 truncate",children:te()}),e.jsx(Ha,{size:16,className:`text-slate-400 transition-transform ${H?"rotate-180":""}`})]}),H&&e.jsxs("div",{className:"absolute top-full left-0 w-full bg-slate-900 border border-slate-700 rounded-xl mt-2 z-50 max-h-80 shadow-2xl overflow-hidden flex flex-col animate-slide-up",children:[e.jsx("div",{className:"p-3 border-b border-slate-800 bg-slate-900 sticky top-0 z-10",children:e.jsxs("div",{className:"relative",children:[e.jsx(nr,{size:14,className:"absolute left-3 top-3 text-slate-500"}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Cerca ristorante o email...",value:x,onChange:p=>b(p.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-white focus:border-indigo-500 outline-none"})]})}),e.jsxs("div",{className:"overflow-y-auto flex-1 custom-scroll p-2 space-y-1",children:[e.jsxs("button",{onClick:()=>{w("broadcast"),Y(!1)},className:`w-full text-left px-3 py-3 rounded-lg flex items-center gap-3 transition-colors ${j==="broadcast"?"bg-indigo-600 text-white":"hover:bg-slate-800 text-slate-300"}`,children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-full",children:e.jsx(di,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm",children:" TUTTI I RISTORANTI (Broadcast)"}),e.jsx("div",{className:"text-xs opacity-70",children:"Invia a tutti gli utenti attivi"})]})]}),U.length===0&&e.jsx("div",{className:"p-4 text-center text-xs text-slate-500",children:"Nessun risultato trovato"}),U.map(p=>{var g;return e.jsxs("button",{onClick:()=>{w(p.id),Y(!1)},className:`w-full text-left px-3 py-2 rounded-lg flex items-center gap-3 transition-colors ${j===p.id?"bg-indigo-600 text-white":"hover:bg-slate-800 text-slate-300"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center font-bold text-xs",children:(g=p.restaurant_name)==null?void 0:g.substring(0,2).toUpperCase()}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"font-bold text-sm truncate",children:p.restaurant_name}),e.jsx("div",{className:"text-xs opacity-70 truncate",children:p.email})]})]},p.id)})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Oggetto"}),e.jsx("input",{type:"text",value:N,onChange:p=>D(p.target.value),placeholder:"Es. Richiesta informazioni",className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white outline-none focus:border-indigo-500 transition-colors placeholder-slate-600 font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Messaggio"}),e.jsx("textarea",{value:E,onChange:p=>O(p.target.value),placeholder:"Scrivi qui il messaggio...",className:"w-full h-48 bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white outline-none focus:border-indigo-500 transition-colors placeholder-slate-600 resize-none leading-relaxed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Allegato (Opzionale)"}),e.jsx("input",{type:"file",ref:K,onChange:p=>{var g;return B(((g=p.target.files)==null?void 0:g[0])||null)},className:"hidden"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{var p;return(p=K.current)==null?void 0:p.click()},className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-xl text-sm font-bold text-white transition-colors flex items-center gap-2",children:[e.jsx(dn,{size:16})," ",A?"Cambia File":"Seleziona File"]}),A&&e.jsxs("div",{className:"text-xs text-slate-300 flex items-center gap-2 bg-slate-800 px-3 py-1 rounded-lg border border-slate-700",children:[A.name,e.jsx("button",{onClick:()=>B(null),className:"text-red-400 hover:text-red-300",children:e.jsx(Xe,{size:12})})]})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{r("inbox"),l(null)},className:"px-6 py-3 rounded-xl font-bold text-slate-500 hover:text-white hover:bg-slate-800 transition-colors",children:"Annulla"}),e.jsx("button",{onClick:ee,disabled:Z,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-indigo-600/20 active:scale-95 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:Z?e.jsx($t,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{size:20})," Invia "]})})]})]})})]})]}),u&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fade-in",children:e.jsx("div",{className:"bg-slate-900 border border-slate-700 p-8 rounded-2xl shadow-2xl max-w-sm w-full mx-4 transform scale-100 animate-slide-up",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(ot,{size:32,className:"text-red-500"})}),e.jsx("h3",{className:"text-xl font-black text-white mb-2",children:"Elimina Messaggio"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Sei sicuro di voler eliminare questo messaggio? L'azione non pu essere annullata."}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:()=>v(null),className:"flex-1 px-4 py-3 rounded-xl font-bold text-slate-400 hover:bg-slate-800 hover:text-white transition-colors",children:"Annulla"}),e.jsx("button",{onClick:ge,className:"flex-1 px-4 py-3 rounded-xl font-bold bg-red-600 text-white hover:bg-red-500 shadow-lg shadow-red-600/20 transition-colors",children:"Elimina"})]})]})})})]})}const Es="castro.massimo@yahoo.com",Dm=({onEnterApp:s})=>{var ls,Da,He,$a,ra,ys,na,Ns,Rr,ia,La,$s,Ma,Ua,cs,oa,Ba,_s,Pr,la,ds,zr,Dr,$r,Lr,Mr,Ls,Ms,ks,Ur;const[t,a]=m.useState([]),[r,n]=m.useState(!1),[i,o]=m.useState("users"),[l,c]=m.useState(0),[d,u]=m.useState(!1),[v,j]=m.useState(!1),[w,N]=m.useState(!1),[D,E]=m.useState(!1),[O,A]=m.useState(""),[B,Z]=m.useState(!1),[F,H]=m.useState(!1),[Y,x]=m.useState("info@ristosyncai.it"),[b,S]=m.useState("49.90"),[K,M]=m.useState("IT73W0623074792000057589384"),[ee,ge]=m.useState("Massimo Castro"),[ye,ce]=m.useState("3478127440"),[U,te]=m.useState("Promo Launch"),[p,g]=m.useState("29.90"),[y,T]=m.useState("3 Mesi"),[I,X]=m.useState("72"),[he,se]=m.useState(!1),[ue,ie]=m.useState(!1),[ne,re]=m.useState(null),[V,$e]=m.useState(!1),[k,Q]=m.useState({}),[xe,fe]=m.useState(""),[Ce,ae]=m.useState(""),[_e,Ge]=m.useState(""),[we,ze]=m.useState(""),[z,P]=m.useState(""),[_,h]=m.useState("Percentage"),[C,L]=m.useState(""),[le,G]=m.useState(""),[me,pe]=m.useState(""),[Te,Pe]=m.useState(null),[lt,kt]=m.useState(""),[qe,bt]=m.useState(!1),[ct,vt]=m.useState(null),[wt,Oa]=m.useState(null),Er=(R,Ie,ke)=>{vt({title:R,message:Ie,onConfirm:ke,confirmText:"Conferma",cancelText:"Annulla"}),bt(!0)},nt=(R,Ie="info")=>{Oa({message:R,type:Ie}),setTimeout(()=>Oa(null),3e3)},Oe=()=>{ct!=null&&ct.onConfirm&&ct.onConfirm(),bt(!1),vt(null)},at=()=>{bt(!1),vt(null)};m.useEffect(()=>{q==null||q.auth.getUser().then(({data:Ie})=>{var ke,Be;if((ke=Ie.user)!=null&&ke.email&&A(Ie.user.email),(Be=Ie.user)!=null&&Be.id){const Me=async()=>{const{count:Ve}=await q.from("messages").select("*",{count:"exact",head:!0}).eq("recipient_id",Ie.user.id).eq("is_read",!1);c(Ve||0)};Me(),q.channel("admin_unread").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`recipient_id=eq.${Ie.user.id}`},()=>Me()).subscribe()}}),Wt();const R=setInterval(Wt,3e4);return()=>clearInterval(R)},[]);const Wt=async()=>{var ke;if(!q)return;n(!0);const{data:R,error:Ie}=await q.from("profiles").select("*").order("created_at",{ascending:!1});if(R){a(R);const Be=R.find(Me=>Me.email===Es);if(Be&&((ke=Be.settings)!=null&&ke.globalConfig)){const Me=Be.settings.globalConfig;x(Me.contactEmail||"info@ristosyncai.it"),S(Me.defaultCost||"49.90"),Me.bankDetails&&(M(Me.bankDetails.iban||""),ge(Me.bankDetails.holder||"")),Me.supportContact&&ce(Me.supportContact.phone||""),Me.promo&&(te(Me.promo.name||"Promo Launch"),g(Me.promo.cost||"29.90"),T(Me.promo.duration||"3 Mesi"),X(Me.promo.deadlineHours||"72"),se(Me.promo.active||!1))}}Ie&&console.error("Errore recupero profili:",Ie),n(!1)},Ra=async()=>{if(!q)return;ie(!0);const R=t.find(Me=>Me.email===Es);if(!R){alert("Profilo Super Admin non trovato nel DB."),ie(!1);return}const ke={...R.settings||{},globalConfig:{contactEmail:Y,defaultCost:b,bankDetails:{iban:K,holder:ee},supportContact:{phone:ye},promo:{name:U,cost:p,duration:y,deadlineHours:I,active:he}}},{error:Be}=await q.from("profiles").update({settings:ke}).eq("id",R.id);if(Be)nt(" Errore salvataggio DB: "+Be.message,"error");else{try{const Me={monthlyCost:b,promo:{name:U,cost:p,duration:y,deadlineHours:I,active:he},lastUpdated:new Date().toISOString()},Ve=new Blob([JSON.stringify(Me)],{type:"application/json"}),{error:jt}=await q.storage.from("attachments").upload("global_pricing.json",Ve,{upsert:!0});jt&&console.warn("Upload JSON fallito (potrebbe non essere critico):",jt)}catch(Me){console.error("JSON sync error",Me)}nt(" Configurazione Globale salvata & Sincronizzata!","success"),Wt()}ie(!1)},Pn=async R=>{var jt;let Ie={...R};if(q)try{const{data:Gt,error:Fa}=await q.rpc("get_user_auth_data",{user_id:R.id});!Fa&&Gt&&Gt.length>0&&(Ie.last_sign_in_at=Gt[0].last_sign_in_at)}catch(Gt){console.error("Error fetching auth data:",Gt)}re(Ie);const ke=((jt=Ie.settings)==null?void 0:jt.restaurantProfile)||{};Q({businessName:ke.businessName||"",responsiblePerson:ke.responsiblePerson||"",vatNumber:ke.vatNumber||"",sdiCode:ke.sdiCode||"",pecEmail:ke.pecEmail||"",phoneNumber:ke.phoneNumber||"",landlineNumber:ke.landlineNumber||"",whatsappNumber:ke.whatsappNumber||"",email:ke.email||"",address:ke.address||"",billingAddress:ke.billingAddress||"",website:ke.website||"",socials:ke.socials||{instagram:"",facebook:"",google:"",tripadvisor:""},adminNotes:ke.adminNotes||""}),fe(ke.subscriptionEndDate||"");let Be=ke.planType||"Trial";Be==="Pro"&&(Be="Mensile"),Ge(Be);const Me=Be==="Trial"||Be==="Free"||Be==="Demo"?"0":ke.subscriptionCost||"49.00";ae(Me);const Ve=ke.agent||{};ze(Ve.name||""),P(Ve.iban||""),h(Ve.commissionType||"Percentage"),L(Ve.commissionValue||""),G(Ve.lastPaymentDate||""),pe(Ve.nextPaymentDate||""),$e(!0)},Tt=(R,Ie)=>{Q(ke=>({...ke,[R]:Ie}))},ws=(R,Ie)=>{Q(ke=>({...ke,socials:{...ke.socials,[R]:Ie}}))},zn=async()=>{if(!q||!ne)return;const R=ne.settings||{},Ie={...R,restaurantProfile:{...R.restaurantProfile||{},...k,subscriptionEndDate:xe,subscriptionCost:Ce,planType:_e,name:ne.restaurant_name,agent:{name:we,iban:z,commissionType:_,commissionValue:C,lastPaymentDate:le,nextPaymentDate:me}}},ke={...ne,settings:Ie};re(ke),a(Me=>Me.map(Ve=>Ve.id===ne.id?ke:Ve));const{error:Be}=await q.from("profiles").update({settings:Ie}).eq("id",ne.id);Be?(alert("ERRORE SALVATAGGIO: "+Be.message),Wt()):$e(!1)},Cr=async(R,Ie,ke)=>{if(R.startsWith("demo-")){nt("Questa  una riga simulata.","info");return}if(ke===Es){nt("Non puoi modificare lo stato del Super Admin.","error");return}if(!q)return;const Me=Ie==="active"||!Ie?"suspended":"active",Ve=Me==="suspended"?"SOSPENDERE":"RIATTIVARE";Er(Ve+" Account",`Vuoi ${Ve.toLowerCase()} questo account?

${Me==="suspended"?"L'utente vedr la schermata di pagamento e non potr accedere.":"L'utente potr accedere nuovamente all'app."}`,async()=>{const{error:jt}=await q.from("profiles").update({subscription_status:Me}).eq("id",R);jt?nt("Errore: "+jt.message,"error"):(Wt(),nt(`Account ${Me==="active"?"RIATTIVATO":"SOSPESO"}`,"success"))})},Dn=async(R,Ie,ke)=>{if(ke===Es){nt("Non puoi eliminare il Super Admin.","error");return}if(R.startsWith("demo-")){nt("Utente demo simulato, non eliminabile dal DB.","info");return}q&&Er("ELIMINAZIONE DEFINITIVA",` SEI SICURO DI VOLER ELIMINARE "${Ie}"?

L'azione  irreversibile. Verranno cancellati:
- Profilo Ristorante
- Tutti i dati associati (se collegati)

L'utente Auth rimarr ma senza profilo.`,async()=>{const{error:Be}=await q.from("profiles").delete().eq("id",R);Be?nt("Errore durante l'eliminazione: "+Be.message,"error"):(Wt(),nt(`Account "${Ie}" ELIMINATO con successo.`,"success"))})},Ir=R=>{R.id.startsWith("demo-")||(Pe(R.id),kt(R.restaurant_name||""))},Tr=()=>{Pe(null),kt("")},Bt=async()=>{if(!q||!Te)return;const{error:R}=await q.from("profiles").update({restaurant_name:lt}).eq("id",Te);R?nt("Errore salvataggio: "+R.message,"error"):(Pe(null),Wt(),nt("Nome aggiornato","success"))},$n=R=>{var ke,Be;if(R.subscription_status==="banned")return"bg-red-500/20 text-red-400 border-red-500/30";if(R.subscription_status==="suspended")return"bg-orange-500/20 text-orange-400 border-orange-500/30";const Ie=(Be=(ke=R.settings)==null?void 0:ke.restaurantProfile)==null?void 0:Be.subscriptionEndDate;return Ie&&new Date(Ie)<new Date?"bg-red-500/20 text-red-400 border-red-500/30 animate-pulse":"bg-green-500/20 text-green-400 border-green-500/30"},js=R=>{var ke,Be;if(R.subscription_status==="banned")return" BANNATO";if(R.subscription_status==="suspended")return" SOSPESO";const Ie=(Be=(ke=R.settings)==null?void 0:ke.restaurantProfile)==null?void 0:Be.subscriptionEndDate;return Ie&&new Date(Ie)<new Date?" SCADUTO":" ATTIVO"},Ar=(R,Ie)=>{navigator.clipboard.writeText(R),Ie==="demo"?(j(!0),setTimeout(()=>j(!1),2e3)):Ie==="fix"?(E(!0),setTimeout(()=>E(!1),2e3)):(N(!0),setTimeout(()=>N(!1),2e3))},Ds=()=>`create extension if not exists pgcrypto; insert into auth.users (id, instance_id, email, encrypted_password, email_confirmed_at, aud, role, raw_app_meta_data, raw_user_meta_data, created_at, updated_at, confirmation_token, recovery_token) values ('d0d0d0d0-d0d0-d0d0-d0d0-d0d0d0d0d0d0', '00000000-0000-0000-0000-000000000000', 'demo@ristosync.com', crypt('password123', gen_salt('bf')), now(), 'authenticated', 'authenticated', '{"provider":"email","providers":["email"]}', '{"restaurant_name":"Ristorante Demo"}', now(), now(), '', '') on conflict (id) do nothing; insert into public.profiles (id, email, restaurant_name, subscription_status) values ('d0d0d0d0-d0d0-d0d0-d0d0-d0d0d0d0d0d0', 'demo@ristosync.com', 'Ristorante Demo', 'active') on conflict (id) do update set restaurant_name = 'Ristorante Demo';`,Or=()=>`-- FIX DATABASE (Senza Errori Storage)

-- 1. Aggiorna colonne Menu
alter table public.menu_items add column if not exists combo_items jsonb;
alter table public.menu_items add column if not exists specific_department text;
alter table public.menu_items add column if not exists image text;
alter table public.menu_items add column if not exists ingredients text;

-- 2. Grant
grant all on table public.orders to authenticated;
grant all on table public.orders to service_role;
grant all on table public.menu_items to authenticated;
grant all on table public.menu_items to service_role;

-- 3. Policy Ordini
drop policy if exists "Enable All for Users" on public.orders;
drop policy if exists "Manage own orders" on public.orders;
create policy "Enable All for Users" on public.orders for all using (auth.uid() = user_id);

-- 4. Policy Menu
drop policy if exists "Manage own menu" on public.menu_items;
drop policy if exists "Public Read Menu" on public.menu_items;
create policy "Public Read Menu" on public.menu_items for select using (true);
drop policy if exists "Owner Manage Menu" on public.menu_items;
create policy "Owner Manage Menu" on public.menu_items for all using (auth.uid() = user_id);

-- 5. Realtime
do $$ begin alter publication supabase_realtime add table public.orders; exception when duplicate_object then null; end; $$;
do $$ begin alter publication supabase_realtime add table public.menu_items; exception when duplicate_object then null; end; $$;

-- 6. Super Admin
drop policy if exists "Super Admin Update All" on public.profiles;
create policy "Super Admin Update All" on public.profiles for update to authenticated using ( (auth.jwt() ->> 'email') = 'castro.massimo@yahoo.com' );
drop policy if exists "Super Admin Delete All" on public.profiles;
create policy "Super Admin Delete All" on public.profiles for delete to authenticated using ( (auth.jwt() ->> 'email') = 'castro.massimo@yahoo.com' );

-- 7. STORAGE (Solo creazione bucket, gestione policy MANUALE)
insert into storage.buckets (id, name, public) values ('attachments', 'attachments', true) on conflict (id) do nothing;

-- 8. Messaggi di Sistema
create table if not exists public.messages (
  id uuid default gen_random_uuid() primary key,
  sender_id uuid references auth.users(id),
  recipient_id uuid references auth.users(id),
  subject text,
  content text,
  attachment_url text,
  is_read boolean default false,
  created_at timestamptz default now()
);
alter table public.messages enable row level security;

drop policy if exists "Read Messages" on public.messages;
create policy "Read Messages" on public.messages for select using ( auth.uid() = recipient_id OR auth.uid() = sender_id OR recipient_id is null );

drop policy if exists "Insert Messages" on public.messages;
create policy "Insert Messages" on public.messages for insert with check ( auth.uid() = sender_id );

drop policy if exists "Delete Messages" on public.messages;
create policy "Delete Messages" on public.messages for delete using ( auth.uid() = recipient_id OR auth.uid() = sender_id );

do $$ begin alter publication supabase_realtime add table public.messages; exception when duplicate_object then null; end; $$;

NOTIFY pgrst, 'reload schema';`,sa=O.toLowerCase()===Es,Pa=(ne==null?void 0:ne.subscription_status)==="suspended",aa=(ne==null?void 0:ne.subscription_status)==="banned",At=_e==="Trial",Ft=_e==="Free"||_e==="Demo",Ht=xe&&new Date(xe)<new Date&&!Ft&&!Pa&&!aa,Ln=aa?"BANNATO":Pa?"SOSPESO":Ft?"GRATIS / DEMO":Ht?"SCADUTO":At?"IN PROVA":"ATTIVO",za=aa?"bg-red-600":Pa?"bg-orange-500":Ft?"bg-indigo-600":Ht?"bg-red-600":At?"bg-blue-500":"bg-green-600";return e.jsxs("div",{className:"min-h-screen bg-slate-950 text-slate-200 font-sans selection:bg-indigo-500/30",children:[e.jsx("div",{className:"fixed top-0 left-0 w-full h-[500px] bg-gradient-to-b from-indigo-900/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"max-w-[1600px] mx-auto p-4 md:p-8 relative z-10",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center gap-6 mb-10",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl shadow-2xl shadow-indigo-500/20 ring-1 ring-white/10",children:e.jsx(Yl,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black text-white tracking-tight",children:"Super Admin"}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm font-medium",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${sa?"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]":"bg-red-500 animate-pulse"}`}),O||"Verifica utente..."]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 w-full xl:w-auto",children:[e.jsxs("div",{className:"flex gap-2 mr-auto xl:mr-0",children:[e.jsx("button",{onClick:()=>H(!0),className:"p-3 bg-slate-900/50 hover:bg-red-500/10 text-slate-400 hover:text-red-400 rounded-xl border border-slate-800 hover:border-red-500/50 transition-all active:scale-95",title:"Strumenti Riparazione DB",children:e.jsx(To,{size:20})}),e.jsx("button",{onClick:()=>Z(!0),className:"p-3 bg-slate-900/50 hover:bg-slate-800 text-slate-400 hover:text-white rounded-xl border border-slate-800 hover:border-slate-600 transition-all active:scale-95",title:"Genera Demo User",children:e.jsx(li,{size:20})})]}),e.jsx("div",{className:"h-12 w-[1px] bg-slate-800 hidden xl:block mx-2"}),e.jsxs("button",{onClick:s,className:"flex-1 xl:flex-none flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl font-bold border border-slate-700 hover:border-slate-500 transition-all group",children:[e.jsx(un,{size:18,className:"text-slate-400 group-hover:text-white transition-colors"}),"App Utente"]}),e.jsxs("button",{onClick:Qa,className:"flex-1 xl:flex-none flex items-center justify-center gap-2 bg-red-500/10 hover:bg-red-500 text-red-400 hover:text-white px-6 py-3 rounded-xl font-bold border border-red-500/20 hover:border-red-500 transition-all",children:[e.jsx(fs,{size:18}),"Esci"]})]})]}),e.jsxs("div",{className:"flex p-1.5 bg-slate-900/80 backdrop-blur-md rounded-2xl border border-slate-800 w-full md:w-fit mb-8 shadow-lg",children:[e.jsxs("button",{onClick:()=>o("users"),className:`flex-1 md:flex-none px-8 py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2.5 ${i==="users"?"bg-indigo-600 text-white shadow-lg shadow-indigo-900/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[e.jsx(rs,{size:18})," Tenants"]}),e.jsxs("button",{onClick:()=>o("messages"),className:`flex-1 md:flex-none px-8 py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2.5 relative ${i==="messages"?"bg-indigo-600 text-white shadow-lg shadow-indigo-900/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[e.jsx(_t,{size:18})," Messaggi",l>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-black px-2 py-0.5 rounded-full ring-4 ring-slate-900 shadow-sm",children:l})]})]}),i==="messages"&&e.jsx(zm,{profiles:t,showToast:nt}),i==="users"&&e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"bg-slate-900 rounded-[2rem] border border-slate-800 overflow-hidden shadow-2xl relative",children:[e.jsxs("div",{className:"p-6 md:p-8 bg-gradient-to-r from-slate-900 via-slate-800/50 to-slate-900 border-b border-slate-800 flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-500/10 rounded-2xl flex items-center justify-center border border-indigo-500/20",children:e.jsx(Ca,{size:24,className:"text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Configurazione Globale"}),e.jsx("p",{className:"text-sm text-slate-400 font-medium",children:"Impostazioni visibili a tutti i clienti attivi"})]})]}),e.jsxs("button",{onClick:Ra,disabled:ue,className:"w-full md:w-auto bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg shadow-emerald-900/20 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:[ue?e.jsx(ci,{size:18,className:"animate-spin"}):e.jsx(is,{size:18}),"Salva Modifiche"]})]}),e.jsxs("div",{className:"p-6 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-4 space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[e.jsx(hn,{size:14})," Parametri Base"]}),e.jsxs("div",{className:"bg-slate-950/50 rounded-2xl p-5 border border-slate-800 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-slate-400 font-bold uppercase mb-2 block",children:"Email Ricezione Ordini"}),e.jsxs("div",{className:"relative group",children:[e.jsx(cn,{size:16,className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-indigo-400 transition-colors"}),e.jsx("input",{type:"email",value:Y,onChange:R=>x(R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl pl-11 pr-4 py-3.5 text-white text-sm font-medium focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 outline-none transition-all placeholder:text-slate-600",placeholder:"admin@ristosync.it"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-slate-400 font-bold uppercase mb-2 block",children:"Costo Mensile Default"}),e.jsxs("div",{className:"relative group",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 font-serif italic text-lg group-focus-within:text-emerald-400 transition-colors",children:""}),e.jsx("input",{type:"text",value:b,onChange:R=>S(R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl pl-11 pr-4 py-3.5 text-white text-lg font-bold focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500/50 outline-none transition-all",placeholder:"0.00"})]})]})]}),e.jsxs("div",{className:"bg-slate-950/50 rounded-2xl p-5 border border-slate-800",children:[e.jsx("label",{className:"text-[11px] text-slate-400 font-bold uppercase mb-2 block",children:"Supporto WhatsApp"}),e.jsxs("div",{className:"relative group",children:[e.jsx(un,{size:16,className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-green-400 transition-colors"}),e.jsx("input",{type:"text",value:ye,onChange:R=>ce(R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl pl-11 pr-4 py-3.5 text-white text-sm font-medium focus:border-green-500 focus:ring-1 focus:ring-green-500/50 outline-none transition-all",placeholder:"+39 000 000000"})]})]})]}),e.jsxs("div",{className:"lg:col-span-4 space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2",children:[e.jsx(hi,{size:14})," Dati Bancari"]}),e.jsxs("div",{className:"bg-slate-950/50 rounded-2xl p-5 border border-slate-800 h-full flex flex-col justify-between overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-[0.03] pointer-events-none",children:e.jsx(hi,{size:200})}),e.jsxs("div",{className:"space-y-5 relative z-10",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-slate-400 font-bold uppercase mb-2 block",children:"Intestatario Conto"}),e.jsx("input",{type:"text",value:ee,onChange:R=>ge(R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3.5 text-white text-sm font-medium focus:border-indigo-500 outline-none transition-all",placeholder:"Nome Azienda / Persona"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-slate-400 font-bold uppercase mb-2 block",children:"Codice IBAN"}),e.jsx("textarea",{value:K,onChange:R=>M(R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3.5 text-white font-mono text-sm uppercase focus:border-indigo-500 outline-none transition-all resize-none h-24 sm:h-auto",rows:3,placeholder:"IT00 X000 0000 0000 0000 0000 000"})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xs font-black text-purple-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(ft,{size:14})," Promo Speciale"]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-800 p-1 rounded-lg border border-slate-700",children:[e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded ${he?"text-slate-500":"text-slate-400"}`,children:"OFF"}),e.jsx("button",{onClick:()=>se(!he),className:`w-10 h-5 rounded-full relative transition-colors duration-300 ${he?"bg-purple-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-1 left-1 bg-white w-3 h-3 rounded-full transition-transform duration-300 ${he?"translate-x-5":"translate-x-0"}`})}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded ${he?"text-white":"text-slate-500"}`,children:"ON"})]})]}),e.jsx("div",{className:`rounded-3xl p-1 bg-gradient-to-br transition-all duration-500 ${he?"from-purple-600 via-pink-600 to-orange-500 shadow-xl shadow-purple-900/30":"from-slate-800 to-slate-800 grayscale opacity-50"}`,children:e.jsxs("div",{className:"bg-slate-900 rounded-[1.3rem] p-5 h-full relative overflow-hidden",children:[he&&e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-purple-500/20 blur-[50px] pointer-events-none"}),e.jsxs("div",{className:"space-y-4 relative z-10",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-purple-300 font-bold uppercase mb-1.5 block",children:"Nome Promo"}),e.jsx("input",{type:"text",value:U,onChange:R=>te(R.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white font-bold text-sm focus:border-purple-500 outline-none",placeholder:"es. Summer Sale"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-purple-300 font-bold uppercase mb-1.5 block",children:"Prezzo Offerta"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-purple-500 font-bold text-xs",children:""}),e.jsx("input",{type:"text",value:p,onChange:R=>g(R.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl pl-8 pr-3 py-3 text-white font-bold text-sm focus:border-purple-500 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-purple-300 font-bold uppercase mb-1.5 block",children:"Durata Testo"}),e.jsx("input",{type:"text",value:y,onChange:R=>T(R.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-3 text-white font-medium text-sm focus:border-purple-500 outline-none",placeholder:"3 Mesi"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-purple-300 font-bold uppercase mb-1.5 block flex justify-between",children:[e.jsx("span",{children:"Scadenza Timer (Ore)"}),e.jsxs("span",{className:"text-white/50",children:[I,"h"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{size:16,className:"text-purple-500"}),e.jsx("input",{type:"number",value:I,onChange:R=>X(R.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white font-mono text-sm focus:border-purple-500 outline-none"})]})]})]})]})}),e.jsx("p",{className:"text-center text-[10px] text-slate-500 font-medium",children:"Questa promo apparir sulla Landing Page sostituendo il piano Standard."})]})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[2rem] border border-slate-800 overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-6 md:p-8 border-b border-slate-800 flex justify-between items-center bg-slate-900/50 backdrop-blur-sm",children:[e.jsxs("h2",{className:"font-bold text-xl text-white flex items-center gap-3",children:[e.jsx(rs,{size:24,className:"text-indigo-500"}),"Gestione Tenants"]}),e.jsxs("button",{onClick:Wt,className:"flex items-center gap-2 text-sm font-bold bg-slate-800 hover:bg-slate-700 hover:text-white px-4 py-2.5 rounded-xl text-slate-400 transition-all border border-slate-700 hover:border-slate-500 active:scale-95 shadow-lg",children:[e.jsx(ci,{size:16,className:r?"animate-spin text-indigo-500":""}),"Aggiorna"]})]}),e.jsx("div",{className:"overflow-x-auto custom-scroll",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-slate-950 text-slate-400 text-[10px] uppercase font-black tracking-wider sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-5 font-black border-b border-slate-800",children:"Ristorante"}),e.jsx("th",{className:"p-5 font-black border-b border-slate-800 hidden md:table-cell",children:"Contatto Admin"}),e.jsx("th",{className:"p-5 font-black border-b border-slate-800",children:"Status"}),e.jsx("th",{className:"p-5 font-black border-b border-slate-800",children:"Piano"}),e.jsx("th",{className:"p-5 font-black border-b border-slate-800 text-right",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800/50",children:t.map(R=>{var je,Br,Fr,Gr,qr,Vr,Jt,Ga;const Ie=R.id.toString().startsWith("demo-"),ke=R.email===Es,Be=((Br=(je=R.settings)==null?void 0:je.restaurantProfile)==null?void 0:Br.vatNumber)||((Gr=(Fr=R.settings)==null?void 0:Fr.restaurantProfile)==null?void 0:Gr.phoneNumber),Me=$n(R),Ve=((Vr=(qr=R.settings)==null?void 0:qr.restaurantProfile)==null?void 0:Vr.planType)||"Trial",jt=(Ga=(Jt=R.settings)==null?void 0:Jt.restaurantProfile)==null?void 0:Ga.subscriptionEndDate,Gt=jt&&new Date(jt)<new Date,Fa=()=>Gt?"bg-red-500/10 text-red-500 border-red-500/20 shadow-[0_0_10px_rgba(239,68,68,0.1)]":Ve==="Trial"?"bg-blue-500/10 text-blue-400 border-blue-500/20 shadow-[0_0_10px_rgba(59,130,246,0.1)]":Ve==="Mensile"?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20 shadow-[0_0_10px_rgba(16,185,129,0.1)]":Ve==="Annuale"?"bg-amber-500/10 text-amber-400 border-amber-500/20 shadow-[0_0_10px_rgba(245,158,11,0.1)]":Ve==="VIP"||Ve==="Premium"?"bg-purple-500/10 text-purple-400 border-purple-500/20 shadow-[0_0_10px_rgba(168,85,247,0.1)]":Ve==="Promo"?"bg-pink-500/10 text-pink-400 border-pink-500/20 shadow-[0_0_10px_rgba(236,72,153,0.1)]":"bg-slate-500/10 text-slate-400 border-slate-500/20";return e.jsxs("tr",{className:`group transition-all hover:bg-slate-800/40 border-l-2 border-l-transparent hover:border-l-indigo-500 ${Ie?"opacity-60 hover:opacity-100 grayscale-[0.5] hover:grayscale-0":""} ${ke?"bg-indigo-900/5":""}`,children:[e.jsx("td",{className:"p-5 align-middle",children:Te===R.id?e.jsxs("div",{className:"flex items-center gap-2 animate-fade-in w-full max-w-[250px]",children:[e.jsx("input",{type:"text",value:lt,onChange:Kr=>kt(Kr.target.value),className:"bg-slate-950 border border-indigo-500 rounded-xl px-3 py-2.5 text-white text-sm font-bold w-full outline-none focus:ring-2 focus:ring-indigo-500/30 transition-all",autoFocus:!0}),e.jsx("button",{onClick:Bt,className:"p-2.5 bg-emerald-500 rounded-xl text-white hover:bg-emerald-600 shadow-lg shadow-emerald-500/20 active:scale-95 transition-transform",children:e.jsx(is,{size:18})}),e.jsx("button",{onClick:Tr,className:"p-2.5 bg-slate-700 rounded-xl text-white hover:bg-slate-600 border border-slate-600 active:scale-95 transition-transform",children:e.jsx(Xe,{size:18})})]}):e.jsxs("div",{className:"flex items-center gap-4 group",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center font-black text-xl shadow-lg transition-transform group-hover:scale-105 ${ke?"bg-gradient-to-br from-indigo-600 to-purple-600 text-white shadow-indigo-500/30":"bg-slate-800 text-slate-400 border border-slate-700"}`,children:R.restaurant_name?R.restaurant_name.charAt(0).toUpperCase():e.jsx(Rs,{size:22})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-white text-base tracking-tight",children:R.restaurant_name||"N/A"}),Ie&&e.jsx("span",{className:"bg-orange-500/10 text-orange-400 border border-orange-500/30 text-[9px] px-1.5 py-0.5 rounded-md font-black uppercase tracking-wider",children:"Demo"}),ke&&e.jsx("span",{className:"bg-indigo-600 text-white text-[9px] px-2 py-0.5 rounded-md font-black uppercase tracking-wider shadow-lg shadow-indigo-600/30",children:"HQ"}),!Ie&&e.jsx("button",{onClick:()=>Ir(R),className:"opacity-0 group-hover:opacity-100 p-1.5 text-slate-500 hover:text-white hover:bg-slate-700 rounded-lg transition-all",title:"Rinomina",children:e.jsx(Js,{size:12})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-[10px] font-mono text-slate-500 bg-slate-950 px-1.5 py-0.5 rounded border border-slate-800",children:[R.id.split("-")[0],"..."]}),!Be&&!Ie&&e.jsxs("span",{className:"text-[9px] text-orange-400 font-bold flex items-center gap-1",children:[e.jsx(ot,{size:10})," Dati mancanti"]})]})]})]})}),e.jsx("td",{className:"p-5 hidden md:table-cell align-middle",children:e.jsxs("div",{className:"flex items-center gap-3 text-slate-400 font-medium text-sm",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-900 flex items-center justify-center border border-slate-800",children:e.jsx(_t,{size:14,className:"text-slate-500"})}),R.email]})}),e.jsx("td",{className:"p-5 align-middle",children:e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider border bg-slate-950/30 ${Me}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${R.subscription_status==="active"?"bg-green-500 animate-pulse":"bg-current"}`}),js(R)]})}),e.jsx("td",{className:"p-5 align-middle",children:e.jsxs("div",{className:"flex flex-col items-start gap-1.5",children:[e.jsxs("span",{className:`px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider border ${Fa()} flex items-center gap-2`,children:[Gt?e.jsx(oi,{size:12}):e.jsx(Za,{size:12}),Gt?"SCADUTO":Ve]}),e.jsx("span",{className:"text-[10px] text-slate-500 font-mono ml-1",children:jt?new Date(jt).toLocaleDateString():"Illimitato"})]})}),e.jsx("td",{className:"p-5 text-right align-middle",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsxs("button",{onClick:()=>Pn(R),className:`flex items-center gap-2 pl-3 pr-4 py-2.5 rounded-xl text-xs font-bold transition-all shadow-lg active:scale-95 border group/btn relative ${Be?"bg-indigo-600 hover:bg-indigo-500 text-white border-indigo-500 hover:shadow-indigo-500/25":"bg-slate-800 hover:bg-slate-700 text-slate-300 border-slate-700 hover:border-slate-500"}`,children:[e.jsx(hn,{size:18,className:"transition-transform group-hover/btn:rotate-90"}),e.jsx("span",{className:"hidden xl:inline",children:"Gestisci"}),!Be&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-orange-500 rounded-full border-2 border-slate-900 shadow-sm animate-pulse"})]}),e.jsx("div",{className:"w-[1px] h-8 bg-slate-800 hidden md:block"}),ke?e.jsx("div",{className:"p-3 text-slate-700 opacity-50 cursor-not-allowed border border-transparent",children:e.jsx(or,{size:20})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Cr(R.id,R.subscription_status,R.email),className:`p-2.5 rounded-xl border transition-all active:scale-95 shadow-md flex items-center justify-center ${R.subscription_status==="suspended"?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/20 hover:shadow-[0_0_15px_rgba(16,185,129,0.2)]":"bg-amber-500/10 border-amber-500/30 text-amber-400 hover:bg-amber-500/20 hover:shadow-[0_0_15px_rgba(245,158,11,0.2)]"} ${Ie?"opacity-30 cursor-not-allowed pointer-events-none":""}`,title:R.subscription_status==="suspended"?"RIATTIVA Account":"SOSPENDI Account",children:R.subscription_status==="suspended"?e.jsx(md,{size:20}):e.jsx(xd,{size:20})}),e.jsx("button",{onClick:()=>Dn(R.id,R.restaurant_name,R.email),className:"p-2.5 rounded-xl border border-slate-800 bg-slate-900 text-slate-500 hover:text-red-400 hover:border-red-500/50 hover:bg-red-500/10 hover:shadow-[0_0_15px_rgba(239,68,68,0.2)] transition-all active:scale-95 flex items-center justify-center",title:"ELIMINA DEFINITIVAMENTE",children:e.jsx(Lt,{size:20})})]})]})})]},R.id)})})]})})]})]})]}),ne&&e.jsx("div",{className:"fixed inset-0 z-[60] bg-slate-950/80 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-[2.5rem] w-full max-w-[90rem] shadow-2xl animate-slide-up flex flex-col max-h-[92vh] overflow-hidden relative",children:[e.jsxs("div",{className:"p-6 md:p-8 border-b border-slate-800 flex justify-between items-start bg-slate-950/50 backdrop-blur-md z-20",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center shadow-2xl ${za} text-white ring-4 ring-slate-900`,children:e.jsx(Rs,{size:32})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h2",{className:"text-3xl font-black text-white tracking-tight",children:ne.restaurant_name}),e.jsx("div",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider text-white shadow-lg ${za}`,children:Ln})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-slate-400 font-medium",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_t,{size:14,className:"text-slate-500"})," ",ne.email]}),e.jsxs("div",{className:"flex items-center gap-2 font-mono text-xs opacity-50 px-2 py-1 bg-slate-800 rounded-md border border-slate-700",children:[e.jsx(li,{size:10})," ",ne.id]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[V?e.jsxs("button",{onClick:zn,className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl flex items-center gap-2 transition-all shadow-lg shadow-emerald-600/20 hover:shadow-emerald-600/40 active:scale-95 text-xs uppercase tracking-wider animate-pulse",children:[e.jsx(is,{size:16})," Salva Tutto"]}):e.jsxs("button",{onClick:()=>$e(!0),className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl flex items-center gap-2 transition-all shadow-lg shadow-indigo-600/20 hover:shadow-indigo-600/40 active:scale-95 text-xs uppercase tracking-wider transform hover:-translate-y-1",children:[e.jsx(Js,{size:16})," Modifica"]}),e.jsx("button",{onClick:()=>re(null),className:"p-3 bg-slate-800 rounded-xl text-slate-400 hover:text-white hover:bg-slate-700 transition-colors border border-slate-700 hover:border-slate-500",children:e.jsx(Xe,{size:20})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 md:p-8 bg-slate-900 custom-scroll",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[ne.email!==Es&&e.jsxs("div",{className:"lg:col-span-4 space-y-8",children:[e.jsxs("div",{className:"bg-slate-950 rounded-3xl border border-slate-800 overflow-hidden relative group",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-900/20 to-indigo-900/20 p-5 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-purple-400 flex items-center gap-2",children:[e.jsx(mi,{size:14})," Agente & Provvigioni"]}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500 shadow-[0_0_10px_purple]"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-2",children:"Nome Agente Assegnato"}),V?e.jsx("input",{type:"text",value:we,onChange:R=>ze(R.target.value),className:"w-full bg-slate-900 border border-slate-700 text-white px-4 py-3 rounded-xl font-bold outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/50 transition-all",placeholder:"Nessun agente"}):e.jsxs("div",{className:"w-full bg-slate-900 border border-slate-800 text-white px-4 py-3 rounded-xl font-bold flex items-center justify-between group-hover:border-purple-500/30 transition-colors",children:[we||"Nessuno assegnato",we&&e.jsx(pd,{size:16,className:"text-purple-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-2",children:"Commissione"}),V?e.jsxs("select",{value:_,onChange:R=>h(R.target.value),className:"w-full bg-slate-900 border border-slate-700 text-white px-3 py-3 rounded-xl text-xs font-bold outline-none focus:border-purple-500",children:[e.jsx("option",{value:"Percentage",children:"% Percentuale"}),e.jsx("option",{value:"Monthly",children:"Fisso Mese"}),e.jsx("option",{value:"Annual",children:"Fisso Anno"}),e.jsx("option",{value:"OneOff",children:"Una Tantum"})]}):e.jsx("div",{className:"w-full bg-slate-900 border border-slate-800 text-slate-300 px-3 py-3 rounded-xl font-bold text-xs truncate",children:_==="Percentage"?"% Percentuale":_==="Monthly"?"Fisso Mensile":_==="Annual"?"Fisso Annuale":"Una Tantum"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-2",children:"Valore"}),V?e.jsx("input",{type:"text",value:C,onChange:R=>L(R.target.value),className:"w-full bg-slate-900 border border-slate-700 text-white px-3 py-3 rounded-xl font-bold text-right outline-none focus:border-purple-500",placeholder:"0"}):e.jsx("div",{className:"w-full bg-slate-900 border border-slate-800 text-purple-400 px-3 py-3 rounded-xl font-bold text-right",children:C?_==="Percentage"?`${C}%`:` ${C}`:"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-2",children:"IBAN Agente"}),e.jsxs("div",{className:"flex gap-3",children:[V?e.jsx("input",{type:"text",value:z,onChange:R=>P(R.target.value),className:"w-full bg-slate-900 border border-slate-700 text-white px-4 py-3 rounded-xl font-mono text-xs outline-none focus:border-purple-500 uppercase",placeholder:"IT00..."}):e.jsx("div",{className:"w-full bg-slate-900 border border-slate-800 text-slate-400 px-4 py-3 rounded-xl font-mono text-xs flex items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:z||"Nessun IBAN"})}),(z||V)&&e.jsx("div",{className:"bg-white p-1 rounded-xl shrink-0 h-[46px] w-[46px] flex items-center justify-center",children:z?e.jsx(wr,{value:z,size:38}):e.jsxs("div",{className:"text-[8px] text-slate-300 font-bold text-center",children:["NO",e.jsx("br",{}),"QR"]})})]})]})]})]}),e.jsxs("div",{className:`rounded-3xl border overflow-hidden relative ${Ht?"bg-red-950/20 border-red-500/30":Ft?"bg-indigo-950/20 border-indigo-500/30":"bg-emerald-950/20 border-emerald-500/30"}`,children:[e.jsxs("div",{className:`p-5 border-b flex items-center justify-between ${Ht?"bg-red-900/20 border-red-500/20":Ft?"bg-indigo-900/20 border-indigo-500/20":"bg-emerald-900/20 border-emerald-500/20"}`,children:[e.jsxs("h3",{className:`text-xs font-black uppercase tracking-widest flex items-center gap-2 ${Ht?"text-red-400":Ft?"text-indigo-400":"text-emerald-400"}`,children:[e.jsx(Za,{size:14})," Abbonamento"]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${Ht?"bg-red-500 text-white":Ft?"bg-indigo-500 text-white":"bg-emerald-500 text-white"}`,children:Ht?"SCADUTO":_e})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Data Scadenza"}),V?e.jsx("input",{type:"date",value:xe?xe.split("T")[0]:"",onChange:R=>fe(R.target.value),className:"bg-slate-900 border border-slate-600 text-white p-3 rounded-xl w-full font-bold focus:border-white outline-none text-center"}):e.jsx("p",{className:`text-3xl font-black font-mono tracking-tight ${Ht?"text-red-500 animate-pulse":"text-white"}`,children:xe?new Date(xe).toLocaleDateString():"ILLIMITATO"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-2",children:"Piano Selezionato"}),V?e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto custom-scroll pr-1",children:[{value:"Trial",label:"Trial (15gg)",color:"blue"},{value:"Mensile",label:"Mensile Standard",color:"emerald"},{value:"Annuale",label:"Annuale Pro",color:"amber"},{value:"Promo",label:`${U||"Promo Special"}`,color:"pink"},{value:"VIP",label:"VIP Support",color:"purple"},{value:"Free",label:"Free / Demo",color:"indigo"}].map(R=>e.jsxs("button",{onClick:()=>{Ge(R.value),R.value==="Promo"?ae(p||"29.90"):R.value==="Trial"||R.value==="Free"?ae("0"):R.value==="Mensile"&&ae(b||"49.90")},className:`w-full px-4 py-3 rounded-xl text-left flex justify-between items-center transition-all border ${_e===R.value?`bg-${R.color}-500/20 border-${R.color}-500 text-${R.color}-400`:"bg-slate-900 border-slate-700 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx("span",{className:"font-bold text-xs uppercase",children:R.label}),_e===R.value&&e.jsx("div",{className:`w-2 h-2 rounded-full bg-${R.color}-500 shadow-[0_0_8px_currentColor]`})]},R.value))}):e.jsx("div",{className:"w-full bg-slate-900 border border-slate-700 p-4 rounded-xl text-center font-bold text-slate-300",children:_e||"Nessun Piano"})]}),V&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-2",children:"Costo Personalizzato ()"}),e.jsx("input",{type:"text",value:Ce,onChange:R=>ae(R.target.value),className:"w-full bg-slate-900 border border-slate-700 text-white px-4 py-3 rounded-xl font-bold focus:border-white outline-none",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-white/10",children:[e.jsx("div",{className:"flex items-center justify-between text-[10px] text-slate-500 font-bold uppercase mb-2",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ze,{size:12})," Ultimo Accesso"]})}),e.jsx("div",{className:"bg-slate-950/50 px-4 py-2 rounded-lg border border-slate-800 font-mono text-xs text-slate-400",children:ne.last_sign_in_at?new Date(ne.last_sign_in_at).toLocaleString():"Nessun accesso registrato"})]})]})]})]}),e.jsxs("div",{className:`${ne.email===Es?"lg:col-span-12":"lg:col-span-8"} space-y-6`,children:[e.jsxs("div",{className:"bg-slate-950 p-6 md:p-8 rounded-[2rem] border border-slate-800 relative",children:[e.jsxs("h4",{className:"text-sm font-black text-white uppercase mb-6 flex items-center gap-3",children:[e.jsx(mi,{className:"text-orange-500",size:18})," Dati Fiscali & Legali"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Ragione Sociale Completa"}),V?e.jsx("input",{type:"text",value:k.businessName,onChange:R=>Tt("businessName",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white font-bold focus:border-orange-500 outline-none"}):e.jsx("p",{className:"text-lg text-white font-bold bg-slate-900/50 p-3 rounded-xl border border-slate-800/50",children:((Da=(ls=ne.settings)==null?void 0:ls.restaurantProfile)==null?void 0:Da.businessName)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"P.IVA / C.F."}),V?e.jsx("input",{type:"text",value:k.vatNumber,onChange:R=>Tt("vatNumber",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white font-mono focus:border-orange-500 outline-none"}):e.jsx("p",{className:"text-white font-mono bg-slate-900 p-3 rounded-xl border border-slate-800",children:(($a=(He=ne.settings)==null?void 0:He.restaurantProfile)==null?void 0:$a.vatNumber)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Responsabile Legale"}),V?e.jsx("input",{type:"text",value:k.responsiblePerson,onChange:R=>Tt("responsiblePerson",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-orange-500 outline-none"}):e.jsx("p",{className:"text-white bg-slate-900 p-3 rounded-xl border border-slate-800",children:((ys=(ra=ne.settings)==null?void 0:ra.restaurantProfile)==null?void 0:ys.responsiblePerson)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Codice SDI"}),V?e.jsx("input",{type:"text",value:k.sdiCode,onChange:R=>Tt("sdiCode",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white font-mono uppercase focus:border-orange-500 outline-none",placeholder:"XXXXXXX"}):e.jsx("p",{className:"text-white font-mono bg-slate-900 p-3 rounded-xl border border-slate-800",children:((Ns=(na=ne.settings)==null?void 0:na.restaurantProfile)==null?void 0:Ns.sdiCode)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Email PEC"}),V?e.jsx("input",{type:"text",value:k.pecEmail,onChange:R=>Tt("pecEmail",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white font-mono focus:border-orange-500 outline-none"}):e.jsx("p",{className:"text-white font-mono bg-slate-900 p-3 rounded-xl border border-slate-800",children:((ia=(Rr=ne.settings)==null?void 0:Rr.restaurantProfile)==null?void 0:ia.pecEmail)||"-"})]})]})]}),e.jsxs("div",{className:"bg-slate-950 p-6 md:p-8 rounded-[2rem] border border-slate-800",children:[e.jsxs("h4",{className:"text-sm font-black text-white uppercase mb-6 flex items-center gap-3",children:[e.jsx(rr,{className:"text-blue-500",size:18})," Sede & Contatti"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Indirizzo Sede Operativa"}),V?e.jsx("input",{type:"text",value:k.address,onChange:R=>Tt("address",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none"}):e.jsx("p",{className:"text-white bg-slate-900 p-3 rounded-xl border border-slate-800",children:(($s=(La=ne.settings)==null?void 0:La.restaurantProfile)==null?void 0:$s.address)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Cellulare"}),V?e.jsx("input",{type:"text",value:k.phoneNumber,onChange:R=>Tt("phoneNumber",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none"}):e.jsx("p",{className:"text-white bg-slate-900 p-3 rounded-xl border border-slate-800",children:((Ua=(Ma=ne.settings)==null?void 0:Ma.restaurantProfile)==null?void 0:Ua.phoneNumber)||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Email Pubblica"}),V?e.jsx("input",{type:"text",value:k.publicEmail,onChange:R=>Tt("publicEmail",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none"}):e.jsx("p",{className:"text-white bg-slate-900 p-3 rounded-xl border border-slate-800",children:((oa=(cs=ne.settings)==null?void 0:cs.restaurantProfile)==null?void 0:oa.publicEmail)||"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Sito Web"}),V?e.jsx("input",{type:"text",value:k.website,onChange:R=>Tt("website",R.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none",placeholder:"https://"}):e.jsx("p",{className:"text-blue-400 bg-slate-900 p-3 rounded-xl border border-slate-800 break-all",children:((_s=(Ba=ne.settings)==null?void 0:Ba.restaurantProfile)==null?void 0:_s.website)||"-"})]})]})]}),e.jsxs("div",{className:"bg-slate-950 p-6 md:p-8 rounded-[2rem] border border-slate-800",children:[e.jsxs("h4",{className:"text-sm font-black text-white uppercase mb-6 flex items-center gap-3",children:[e.jsx(Ia,{className:"text-pink-500",size:18})," Social Media"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900 p-3 rounded-xl border border-slate-800",children:[e.jsx(ya,{className:"text-pink-500"}),V?e.jsx("input",{type:"text",value:((Pr=k.socials)==null?void 0:Pr.instagram)||"",onChange:R=>ws("instagram",R.target.value),className:"bg-transparent text-sm w-full outline-none text-white",placeholder:"Link Instagram..."}):e.jsx("a",{href:(la=k.socials)==null?void 0:la.instagram,target:"_blank",rel:"noreferrer",className:"text-sm text-slate-300 truncate hover:text-white transition-colors",children:((ds=k.socials)==null?void 0:ds.instagram)||"-"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900 p-3 rounded-xl border border-slate-800",children:[e.jsx(Na,{className:"text-blue-600"}),V?e.jsx("input",{type:"text",value:((zr=k.socials)==null?void 0:zr.facebook)||"",onChange:R=>ws("facebook",R.target.value),className:"bg-transparent text-sm w-full outline-none text-white",placeholder:"Link Facebook..."}):e.jsx("a",{href:(Dr=k.socials)==null?void 0:Dr.facebook,target:"_blank",rel:"noreferrer",className:"text-sm text-slate-300 truncate hover:text-white transition-colors",children:(($r=k.socials)==null?void 0:$r.facebook)||"-"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900 p-3 rounded-xl border border-slate-800",children:[e.jsx(Rs,{className:"text-green-500"}),V?e.jsx("input",{type:"text",value:((Lr=k.socials)==null?void 0:Lr.google)||"",onChange:R=>ws("google",R.target.value),className:"bg-transparent text-sm w-full outline-none text-white",placeholder:"Link Google Business..."}):e.jsx("a",{href:(Mr=k.socials)==null?void 0:Mr.google,target:"_blank",rel:"noreferrer",className:"text-sm text-slate-300 truncate hover:text-white transition-colors",children:((Ls=k.socials)==null?void 0:Ls.google)||"-"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900 p-3 rounded-xl border border-slate-800",children:[e.jsx(Ri,{className:"text-emerald-500"}),V?e.jsx("input",{type:"text",value:((Ms=k.socials)==null?void 0:Ms.tripadvisor)||"",onChange:R=>ws("tripadvisor",R.target.value),className:"bg-transparent text-sm w-full outline-none text-white",placeholder:"Link TripAdvisor..."}):e.jsx("a",{href:(ks=k.socials)==null?void 0:ks.tripadvisor,target:"_blank",rel:"noreferrer",className:"text-sm text-slate-300 truncate hover:text-white transition-colors",children:((Ur=k.socials)==null?void 0:Ur.tripadvisor)||"-"})]})]})]}),e.jsxs("div",{className:"bg-yellow-900/10 p-6 md:p-8 rounded-[2rem] border border-yellow-700/30",children:[e.jsxs("h4",{className:"text-sm font-black text-yellow-500 uppercase mb-6 flex items-center gap-3",children:[e.jsx(fd,{size:18})," Note Interne (Admin Only)"]}),V?e.jsx("textarea",{value:k.adminNotes,onChange:R=>Tt("adminNotes",R.target.value),className:"w-full bg-slate-900 border border-yellow-700/30 rounded-xl px-4 py-3 text-white h-32 outline-none focus:border-yellow-500 resize-none",placeholder:"Scrivi una nota interna..."}):e.jsx("div",{className:"min-h-[6rem] text-slate-300 whitespace-pre-wrap",children:k.adminNotes||"Nessuna nota presente."})]})]})]})}),e.jsxs("div",{className:"p-4 bg-slate-950 border-t border-slate-800 flex justify-center text-[10px] text-slate-500 font-mono",children:["PROFILO ID: ",ne.id]})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-red-500/30 rounded-3xl p-6 w-full max-w-2xl shadow-2xl animate-slide-up relative",children:[e.jsx("button",{onClick:()=>H(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-white",children:e.jsx(Xe,{})}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 text-red-400",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:e.jsx(To,{size:24})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Riparazione Database & Permessi"})]}),e.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"Esegui questo script per aggiornare la struttura e i permessi."}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 relative group text-left mb-6",children:[e.jsx("pre",{className:"text-left text-xs text-green-400 font-mono whitespace-pre-wrap overflow-x-auto h-48 custom-scroll p-2",children:Or()}),e.jsxs("button",{onClick:()=>Ar(Or(),"fix"),className:"absolute top-4 right-4 bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 shadow-lg transition-all",children:[D?e.jsx(yt,{size:16,className:"text-green-500"}):e.jsx(_a,{size:16})," ",D?"COPIATO!":"COPIA SQL"]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>H(!1),className:"px-6 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg font-bold",children:"Chiudi"})})]})}),B&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-orange-500/30 rounded-3xl p-6 w-full max-w-2xl shadow-2xl animate-slide-up relative",children:[e.jsx("button",{onClick:()=>Z(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-white",children:e.jsx(Xe,{})}),e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Genera Utente Demo"}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 relative group text-left mb-6",children:[e.jsx("pre",{className:"text-left text-xs text-green-400 font-mono whitespace-pre-wrap overflow-x-auto h-64 custom-scroll p-2",children:Ds()}),e.jsx("button",{onClick:()=>Ar(Ds(),"demo"),className:"absolute top-4 right-4 bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2",children:v?e.jsx(yt,{size:16,className:"text-green-500"}):e.jsx(_a,{size:16})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>Z(!1),className:"px-6 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg font-bold",children:"Chiudi"})})]})}),qe&&ct&&e.jsx("div",{className:"fixed inset-0 z-[70] bg-black/90 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-orange-500/30 rounded-3xl p-8 w-full max-w-md shadow-2xl animate-slide-up",children:[e.jsx("h2",{className:"text-2xl font-black text-white mb-4",children:ct.title}),e.jsx("p",{className:"text-slate-300 mb-8 whitespace-pre-line",children:ct.message}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:at,className:"px-6 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold transition-all",children:ct.cancelText||"Annulla"}),e.jsx("button",{onClick:Oe,className:"px-6 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold transition-all",children:ct.confirmText||"Conferma"})]})]})}),wt&&e.jsx("div",{className:"fixed bottom-8 right-8 z-[80] animate-slide-up",children:e.jsxs("div",{className:`px-6 py-4 rounded-2xl shadow-2xl border-2 font-bold flex items-center gap-3 ${wt.type==="success"?"bg-green-600 border-green-400 text-white":wt.type==="error"?"bg-red-600 border-red-400 text-white":"bg-blue-600 border-blue-400 text-white"}`,children:[wt.type==="success"&&e.jsx(yt,{size:20}),wt.type==="error"&&e.jsx(ot,{size:20}),wt.type==="info"&&e.jsx(oi,{size:20}),e.jsx("span",{children:wt.message})]})})]})},$m=[J.MENU_COMPLETO,J.ANTIPASTI,J.PANINI,J.PIZZE,J.PRIMI,J.SECONDI,J.DOLCI,J.BEVANDE],Lm={Glutine:Bi,Latticini:Ui,Uova:Mi,"Frutta a guscio":Li,Pesce:$i,Soia:Di,Piccante:zi,Vegano:Pi},bl=({restaurantId:s,isPreview:t=!1,activeMenuData:a,activeRestaurantName:r})=>{var U,te,p;const[n,i]=m.useState(a||[]),[o,l]=m.useState(r||"Menu Digitale"),[c,d]=m.useState(null),[u,v]=m.useState({}),[j,w]=m.useState(!a),[N,D]=m.useState(null),[E,O]=m.useState(J.ANTIPASTI),[A,B]=m.useState(!1),[Z,F]=m.useState(!1),[H,Y]=m.useState(null),[x,b]=m.useState(null),[S,K]=m.useState(!1);m.useEffect(()=>{a&&(i(a),w(!1)),r&&l(r)},[a,r]),m.useEffect(()=>{(async()=>{var T,I,X,he;if(!q){a||D("Database non connesso."),w(!1);return}try{const{data:se,error:ue}=await q.from("profiles").select("restaurant_name, settings").eq("id",s).single();if(se?(l(se.restaurant_name),(I=(T=se.settings)==null?void 0:T.restaurantProfile)!=null&&I.socials&&v(se.settings.restaurantProfile.socials),(he=(X=se.settings)==null?void 0:X.restaurantProfile)!=null&&he.logo&&d(se.settings.restaurantProfile.logo)):ue&&(console.error("Profile Fetch Error:",ue),(ue.code==="PGRST116"||ue.message.includes("security"))&&F(!0)),!a){const{data:ie,error:ne}=await q.from("menu_items").select("*").eq("user_id",s);if(ne&&console.error("Menu fetch error:",ne),ie&&ie.length>0){const re=ie.map(V=>({id:V.id,name:V.name,price:V.price,category:V.category,description:V.description,ingredients:V.ingredients,allergens:V.allergens,image:V.image,isCombo:V.category===J.MENU_COMPLETO,comboItems:V.combo_items||[],specificDepartment:V.specific_department}));i(re),F(!1)}}}catch(se){console.error("Critical Error fetching public menu:",se),a||D("Errore di caricamento.")}finally{w(!1)}})();const y=()=>B(window.scrollY>300);return t||window.addEventListener("scroll",y),()=>{t||window.removeEventListener("scroll",y)}},[s,t,a]),m.useEffect(()=>{const g=()=>{var he,se;const T=br(),I=T.find(ue=>ue.type==="happy_hour"&&ue.isActive);if(I&&((he=I.config)!=null&&he.startTime)&&((se=I.config)!=null&&se.endTime)){const ue=new Date,ie=ue.getHours()*60+ue.getMinutes(),[ne,re]=I.config.startTime.split(":").map(Number),[V,$e]=I.config.endTime.split(":").map(Number),k=ne*60+re,Q=V*60+$e;ie>=k&&ie<=Q?Y(I):Y(null)}else Y(null);const X=T.find(ue=>ue.type==="birthday_promo"&&ue.isActive);b(X||null)};g();const y=setInterval(g,6e4);return()=>clearInterval(y)},[]);const M=m.useMemo(()=>$m.filter(g=>n.some(y=>y.category===g)),[n]);m.useEffect(()=>{M.length>0&&!M.includes(E)&&O(M[0])},[M]);const ee=g=>{O(g);const y=document.getElementById(`cat-${g}`);if(y){const T=t?document.getElementById("digital-menu-container"):window;if(t&&T instanceof HTMLElement)y.scrollIntoView({behavior:"smooth",block:"start"});else{const X=document.body.getBoundingClientRect().top,ue=y.getBoundingClientRect().top-X-140;window.scrollTo({top:ue,behavior:"smooth"})}}},ge=(g,y=18)=>{switch(g){case J.MENU_COMPLETO:return e.jsx(Fi,{size:y});case J.ANTIPASTI:return e.jsx(Ea,{size:y});case J.PANINI:return e.jsx(yn,{size:y});case J.PIZZE:return e.jsx(jn,{size:y});case J.PRIMI:return e.jsx(tt,{size:y});case J.SECONDI:return e.jsx(gt,{size:y});case J.DOLCI:return e.jsx(Jl,{size:y});case J.BEVANDE:return e.jsx(wn,{size:y});default:return e.jsx(gt,{size:y})}},ye=()=>{const g=new URL(window.location.href);g.searchParams.delete("menu"),window.location.href=g.toString()},ce=({link:g,icon:y,colorClass:T,label:I})=>{if(!g)return null;const X=g.startsWith("http")?g:`https://${g}`;return e.jsx("a",{href:X,target:"_blank",rel:"noopener noreferrer",className:`w-10 h-10 rounded-xl flex items-center justify-center shadow-md border border-gray-300 bg-white hover:bg-gray-50 hover:scale-110 transition-all ${T}`,title:I,children:e.jsx(y,{size:20})})};return j?e.jsxs("div",{className:`${t?"h-full bg-slate-900 rounded-[2.5rem]":"min-h-screen bg-slate-900"} flex flex-col items-center justify-center text-white p-4`,children:[e.jsx($t,{className:"animate-spin text-orange-500 mb-4",size:48}),e.jsx("p",{className:"animate-pulse font-medium text-lg",children:"Caricamento..."})]}):(Z||n.length===0&&!j)&&!a?e.jsxs("div",{className:`${t?"h-full bg-slate-950 rounded-[2.5rem]":"min-h-screen bg-slate-950"} flex flex-col items-center justify-center text-white p-8 text-center`,children:[e.jsx("div",{className:"w-20 h-20 bg-orange-500/10 rounded-full flex items-center justify-center mb-6 animate-pulse",children:e.jsx(ot,{size:40,className:"text-orange-500"})}),e.jsx("h2",{className:"text-2xl font-black mb-3",children:"Menu Non Disponibile"}),Z?e.jsxs("div",{className:"bg-slate-900 p-4 rounded-2xl border border-red-500/30 max-w-xs text-sm",children:[e.jsx("p",{className:"text-slate-300 mb-2 font-medium",children:t?"Permessi pubblici non attivi.":"Il ristorante non  accessibile."}),t&&e.jsx("p",{className:"text-xs text-orange-400",children:"Esegui lo script SQL nella dashboard Super Admin."})]}):e.jsx("div",{className:"max-w-md",children:e.jsx("p",{className:"text-slate-400 mb-6 text-sm",children:'Nessun piatto inserito. Vai su "Menu" per aggiungerne uno.'})}),!t&&e.jsxs("button",{onClick:ye,className:"mt-8 bg-slate-800 hover:bg-slate-700 text-white px-8 py-4 rounded-xl font-bold border border-slate-700 transition-all flex items-center gap-2",children:[e.jsx(fs,{size:20})," Torna alla Home"]})]}):N&&!a?e.jsxs("div",{className:`${t?"h-full":"min-h-screen"} bg-slate-950 flex flex-col items-center justify-center text-white p-6 text-center`,children:[e.jsx(ot,{size:48,className:"text-red-500 mb-4"}),e.jsx("p",{className:"text-slate-400 mb-6",children:N})]}):e.jsxs("div",{id:"digital-menu-container",className:`${t?"h-full overflow-y-auto relative rounded-[2.5rem] bg-slate-900 scrollbar-hide":"min-h-screen bg-slate-900 pb-24"}`,children:[e.jsx("div",{className:`bg-slate-900 text-white relative shadow-lg z-20 border-b border-slate-800 ${t?"rounded-b-2xl pt-8 pb-3":"pt-4 pb-4 sticky top-0"}`,children:e.jsxs("div",{className:"px-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c?e.jsx("div",{className:`${t?"w-10 h-10":"w-12 h-12"} rounded-xl overflow-hidden shadow-lg border-2 border-orange-500/30`,children:e.jsx("img",{src:c,alt:"Logo",className:"w-full h-full object-cover"})}):e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-orange-500 to-red-600 shadow-lg shadow-orange-600/20",children:e.jsx(tt,{size:t?18:22,className:"text-white"})}),e.jsx("h1",{className:`${t?"text-lg":"text-xl"} font-bold tracking-tight leading-none truncate max-w-[200px] text-white`,children:o})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 bg-slate-800 px-2 py-1 rounded-full border border-slate-700",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-300 uppercase",children:"Open"})]}),x&&e.jsx("button",{onClick:()=>K(!0),className:"bg-gradient-to-r from-orange-500 to-pink-500 p-1.5 rounded-full shadow-lg shadow-pink-500/20 hover:scale-110 transition-transform animate-pulse",children:e.jsx(tn,{size:16,className:"text-white"})})]})]})}),H&&e.jsxs("div",{className:"bg-gradient-to-r from-pink-600 to-purple-600 text-white p-3 shadow-lg animate-fade-in relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(Ze,{size:64})}),e.jsxs("div",{className:"flex items-center justify-between max-w-2xl mx-auto px-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-full backdrop-blur-sm animate-pulse",children:e.jsx(Ze,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-sm uppercase tracking-wide",children:"Happy Hour Attivo!"}),e.jsxs("p",{className:"text-xs text-white/90 font-medium",children:["Fino alle ",(U=H.config)==null?void 0:U.endTime]})]})]}),e.jsx("div",{className:"bg-white text-pink-600 px-3 py-1 rounded-full font-black text-xs shadow-md",children:"PROMO"})]})]}),S&&x&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 w-full max-w-sm rounded-3xl p-8 shadow-2xl animate-slide-up text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-500 via-pink-500 to-purple-500"}),e.jsx("div",{className:"absolute -top-10 -right-10 w-32 h-32 bg-pink-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6 relative",children:e.jsx(gd,{size:40,className:"text-pink-500 animate-bounce"})}),e.jsx("h3",{className:"text-3xl font-black text-white mb-2",children:"Buon Compleanno!"}),e.jsx("p",{className:"text-slate-400 mb-6 text-sm",children:((te=x.config)==null?void 0:te.message)||"Tanti auguri! Ecco un regalo per te."}),e.jsxs("div",{className:"bg-slate-800 p-4 rounded-2xl border-2 border-dashed border-slate-700 mb-6",children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold mb-1",children:"Il tuo regalo"}),e.jsx("p",{className:"text-3xl font-black text-white",children:((p=x.config)==null?void 0:p.discountType)==="percentage"?`-${x.config.discountValue}%`:`${x.config.discountValue}`}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Mostra questa schermata in cassa"})]}),e.jsx("button",{onClick:()=>K(!1),className:"w-full py-4 bg-gradient-to-r from-pink-600 to-purple-600 text-white font-black text-lg rounded-2xl shadow-lg shadow-pink-600/20 active:scale-95 transition-all",children:"GRAZIE!"})]})}),e.jsx("div",{className:`sticky z-10 bg-slate-900/95 backdrop-blur-md border-b border-slate-800 ${t?"top-0 py-2":"top-[60px] py-3"}`,children:e.jsx("div",{className:"flex overflow-x-auto gap-2 px-4 no-scrollbar snap-x",children:M.map(g=>e.jsxs("button",{onClick:()=>ee(g),className:`flex items-center gap-1.5 rounded-full whitespace-nowrap font-bold transition-all snap-center ${t?"px-3 py-1.5 text-[10px]":"px-4 py-2 text-xs"} ${E===g?"bg-gradient-to-r from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-500/30":"bg-slate-800 text-slate-400 border border-slate-700 hover:bg-slate-700 hover:text-white"}`,children:[ge(g,t?12:14)," ",g]},g))})}),e.jsxs("div",{className:`px-4 max-w-2xl mx-auto ${t?"py-4 space-y-6":"py-6 space-y-10"}`,children:[M.map(g=>{const y=n.filter(T=>T.category===g);return e.jsxs("div",{id:`cat-${g}`,className:"scroll-mt-32",children:[e.jsxs("div",{className:`flex items-center gap-3 ${t?"mb-3 mt-4":"mb-4 mt-6"}`,children:[e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-orange-400 to-transparent flex-1"}),e.jsxs("div",{className:`flex items-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-full shadow-lg shadow-orange-500/30 ${t?"text-xs":"text-sm"}`,children:[ge(g,t?14:16),e.jsx("span",{className:"font-black uppercase tracking-wider",children:g})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-orange-400 to-transparent flex-1"})]}),e.jsx("div",{className:`grid ${t?"gap-3":"gap-4"}`,children:y.map(T=>{const I=T.category===J.MENU_COMPLETO;let X=[];I&&T.comboItems&&(X=(a||n).filter(ue=>{var ie;return(ie=T.comboItems)==null?void 0:ie.includes(ue.id)}));let he=T.allergens||[];if(I&&X.length>0){const se=X.flatMap(ue=>ue.allergens||[]);he=[...new Set([...he,...se])]}return e.jsx("div",{className:`bg-white rounded-2xl shadow-md border border-gray-200 flex flex-col relative overflow-hidden group hover:shadow-lg transition-shadow ${t?"p-3 gap-1.5":"p-5 gap-3"}`,children:e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`${t?"text-sm":"text-base"} font-bold text-slate-900 leading-tight`,children:T.name}),T.ingredients&&e.jsx("p",{className:`text-slate-600 font-medium italic mt-1 leading-snug ${t?"text-[10px]":"text-xs"}`,children:T.ingredients}),I&&X.length>0&&e.jsxs("div",{className:"mt-2 mb-1",children:[e.jsx("p",{className:"text-[9px] font-bold text-slate-500 uppercase mb-1",children:"Include:"}),e.jsx("ul",{className:`list-disc list-inside text-slate-700 ${t?"text-[10px]":"text-xs"}`,children:X.map(se=>e.jsx("li",{children:se.name},se.id))})]}),e.jsx("p",{className:`text-slate-500 leading-relaxed mt-2 border-t border-dashed border-gray-300 pt-2 ${t?"text-[10px]":"text-xs"}`,children:T.description||e.jsx("span",{className:"italic opacity-50",children:"."})}),he.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pt-2 mt-1",children:he.map(se=>{const ue=Lm[se]||cr;return e.jsxs("span",{className:`inline-flex items-center gap-1 font-bold uppercase text-slate-600 bg-gray-100 border border-gray-300 rounded-md ${t?"text-[8px] px-1.5 py-0.5":"text-[9px] px-2 py-1"}`,children:[e.jsx(ue,{size:t?8:10,className:"text-orange-500"})," ",se]},se)})})]}),T.image&&e.jsxs("div",{className:"shrink-0 flex flex-col items-center gap-2",children:[e.jsx("div",{className:`rounded-xl overflow-hidden aspect-square bg-gray-100 border border-gray-200 ${t?"w-16":"w-24"}`,children:e.jsx("img",{src:T.image,alt:T.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:`font-black text-orange-600 ${t?"text-sm":"text-lg"} whitespace-nowrap`,children:[" ",T.price.toFixed(2)]})]}),!T.image&&e.jsxs("div",{className:`font-black text-orange-600 ${t?"text-sm":"text-lg"} whitespace-nowrap self-start`,children:[" ",T.price.toFixed(2)]})]})},T.id)})})]},g)}),M.length===0&&e.jsxs("div",{className:"text-center py-10 text-slate-500",children:[e.jsx(nr,{size:40,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-sm",children:"Menu vuoto"})]})]}),e.jsxs("div",{className:`text-center bg-slate-900 rounded-t-[2.5rem] shadow-[0_-10px_40px_rgba(0,0,0,0.2)] border-t border-slate-800 ${t?"py-6 mt-4":"py-8 mt-8"}`,children:[e.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest mb-4",children:"Seguici & Contattaci"}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3 mb-6 px-6",children:[e.jsx(ce,{link:u.instagram,icon:ya,colorClass:"text-pink-500",label:"Instagram"}),e.jsx(ce,{link:u.facebook,icon:Na,colorClass:"text-blue-500",label:"Facebook"}),e.jsx(ce,{link:u.tiktok,icon:Ql,colorClass:"text-white",label:"TikTok"}),e.jsx(ce,{link:u.google,icon:Rs,colorClass:"text-blue-400",label:"Google Business"}),e.jsx(ce,{link:u.tripadvisor,icon:Ri,colorClass:"text-green-500",label:"TripAdvisor"}),e.jsx(ce,{link:u.thefork,icon:Ea,colorClass:"text-emerald-500",label:"TheFork"}),e.jsx(ce,{link:u.youtube,icon:bd,colorClass:"text-red-500",label:"YouTube"}),e.jsx(ce,{link:u.linkedin,icon:vd,colorClass:"text-blue-600",label:"LinkedIn"})]}),!Object.values(u).some(g=>!!g)&&e.jsx("p",{className:"text-xs text-slate-500 italic mb-4",children:"Nessun social collegato"}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-slate-500 font-bold text-[10px]",children:[e.jsx(tt,{size:12})," Powered by RistoSync",e.jsx("span",{className:"text-blue-500 font-black ml-1",children:"AI"})]})]}),!t&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ye,className:"fixed bottom-6 left-6 p-3 bg-slate-800 border border-slate-700 text-white rounded-full z-50 shadow-2xl hover:scale-110 transition-all opacity-50 hover:opacity-100",title:"Esci dal Menu Digitale",children:e.jsx(fs,{size:20})}),A&&e.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"fixed bottom-6 right-6 p-3 bg-orange-600 text-white rounded-full shadow-2xl shadow-orange-500/30 z-50 animate-bounce hover:bg-orange-500 transition-colors",children:e.jsx(wd,{size:20})})]})]})};function Mm({session:s,onClose:t,showToast:a,showConfirm:r}){const[n,i]=m.useState("inbox"),[o,l]=m.useState([]),[c,d]=m.useState(null),[u,v]=m.useState(!1),[j,w]=m.useState(""),[N,D]=m.useState(""),[E,O]=m.useState(null),[A,B]=m.useState(!1);m.useEffect(()=>{Z();const x=q.channel("public:messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},b=>{const S=b.new;(S.recipient_id===s.user.id||S.recipient_id===null)&&Z()}).subscribe();return()=>{q.removeChannel(x)}},[s.user.id]);const Z=async()=>{v(!0);try{const x=JSON.parse(localStorage.getItem("hidden_messages")||"[]"),b=JSON.parse(localStorage.getItem("read_broadcasts")||"[]"),{data:S,error:K}=await q.from("messages").select("*").or(`recipient_id.eq.${s.user.id},recipient_id.is.null`).order("created_at",{ascending:!1});if(S){const M=S.filter(ee=>!x.includes(ee.id)).map(ee=>ee.recipient_id===null&&b.includes(ee.id)?{...ee,is_read:!0}:ee);l(M)}}catch(x){console.error("Error fetching messages:",x)}v(!1)},F=async()=>{if(!j||!N){a("Compila tutti i campi obbligatori.","error");return}B(!0);let x=null;try{if(E){const M=E.name.split(".").pop(),ee=`${Date.now()}_${Math.random()}.${M}`,ge=`${s.user.id}/${ee}`,{error:ye}=await q.storage.from("attachments").upload(ge,E);if(ye)throw ye;const{data:{publicUrl:ce}}=q.storage.from("attachments").getPublicUrl(ge);x=ce}const{data:b}=await q.from("profiles").select("id").eq("email","castro.massimo@yahoo.com").single(),S=b==null?void 0:b.id;if(!S){a("Impossibile trovare l'amministratore. Riprova pi tardi.","error"),B(!1);return}const{error:K}=await q.from("messages").insert({sender_id:s.user.id,recipient_id:S,subject:j,content:N,attachment_url:x,is_read:!1});if(K)throw K;w(""),D(""),O(null),i("inbox"),a("Messaggio inviato con successo!","success"),Z()}catch(b){a("Errore nell'invio: "+b.message,"error")}B(!1)},H=async x=>{if(!await r("Elimina Messaggio","Vuoi cancellare definitivamente questo messaggio?"))return;const S=o.find(M=>M.id===x);if(S&&S.recipient_id===null){const M=JSON.parse(localStorage.getItem("hidden_messages")||"[]");localStorage.setItem("hidden_messages",JSON.stringify([...M,x])),l(ee=>ee.filter(ge=>ge.id!==x)),(c==null?void 0:c.id)===x&&d(null),a("Messaggio eliminato","success");return}const{error:K}=await q.from("messages").delete().eq("id",x);K?a("Errore eliminazione: "+K.message,"error"):(l(M=>M.filter(ee=>ee.id!==x)),(c==null?void 0:c.id)===x&&d(null),a("Messaggio eliminato","success"))},Y=async x=>{if(!x.is_read){if(x.recipient_id===null){const b=JSON.parse(localStorage.getItem("read_broadcasts")||"[]");b.includes(x.id)||localStorage.setItem("read_broadcasts",JSON.stringify([...b,x.id])),l(S=>S.map(K=>K.id===x.id?{...K,is_read:!0}:K)),window.dispatchEvent(new Event("messages:updated"));return}setTimeout(async()=>{const{error:b}=await q.from("messages").update({is_read:!0}).eq("id",x.id);b||(l(S=>S.map(K=>K.id===x.id?{...K,is_read:!0}:K)),window.dispatchEvent(new Event("messages:updated")))},2e3)}};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 text-white animate-fade-in relative",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 flex justify-between items-center bg-slate-900/50 backdrop-blur-sm sticky top-0 z-10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black flex items-center gap-3",children:[e.jsx(_t,{className:"text-orange-500"})," Centro Messaggi"]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Comunicazioni di servizio e supporto dedicato"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{i("inbox"),d(null)},className:`px-4 py-2 rounded-xl font-bold transition-all flex items-center gap-2 ${n==="inbox"?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[e.jsx(cn,{size:18})," In Arrivo"]}),e.jsxs("button",{onClick:()=>{i("compose"),d(null)},className:`px-4 py-2 rounded-xl font-bold transition-all flex items-center gap-2 ${n==="compose"?"bg-orange-600 text-white shadow-lg shadow-orange-500/30":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[e.jsx(ts,{size:18})," Scrivi"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex relative",children:[n==="inbox"&&e.jsxs("div",{className:`flex-1 flex flex-col md:flex-row h-full transition-all duration-300 ${c?"md:flex":"flex"}`,children:[e.jsx("div",{className:`w-full md:w-1/3 border-r border-slate-800 overflow-y-auto ${c?"hidden md:block":"block"}`,children:u?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx($t,{className:"animate-spin text-indigo-500"})}):o.length===0?e.jsxs("div",{className:"p-10 text-center text-slate-500 flex flex-col items-center",children:[e.jsx(cn,{size:48,strokeWidth:1,className:"mb-4 opacity-50"}),e.jsx("p",{children:"Nessun messaggio ricevuto."})]}):e.jsx("div",{className:"divide-y divide-slate-800",children:o.map(x=>e.jsxs("div",{onClick:()=>{d(x),Y(x)},className:`p-4 cursor-pointer transition-all border-b border-slate-800/50 relative overflow-hidden group
                                                ${(c==null?void 0:c.id)===x.id?"bg-indigo-900/20":"hover:bg-slate-900/50"} 
                                                ${!x.is_read&&x.recipient_id!==null?"border-l-4 border-l-orange-500 bg-slate-900":"border-l-4 border-l-transparent opacity-70 hover:opacity-100"}
                                            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:`text-sm font-bold flex items-center gap-2 ${!x.is_read&&x.recipient_id!==null?"text-white":"text-slate-400"}`,children:[x.recipient_id===null?" RistoSync Team":" Supporto",!x.is_read&&x.recipient_id!==null&&e.jsx("span",{className:"bg-orange-500 text-white text-[10px] px-1.5 py-0.5 rounded font-bold uppercase",children:"NUOVO"})]}),e.jsx("span",{className:"text-[10px] text-slate-500",children:new Date(x.created_at).toLocaleDateString()})]}),e.jsx("h4",{className:`text-base mb-1 truncate ${!x.is_read&&x.recipient_id!==null?"font-black text-white":"font-medium text-slate-300"}`,children:x.subject}),e.jsx("p",{className:"text-xs text-slate-500 line-clamp-2",children:x.content}),x.attachment_url&&e.jsx(dn,{size:12,className:"text-slate-500 mt-2"})]},x.id))})}),e.jsx("div",{className:`flex-1 bg-slate-900/30 flex-col ${c?"flex":"hidden md:flex"}`,children:c?e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"md:hidden p-4 border-b border-slate-800 flex gap-2",children:e.jsxs("button",{onClick:()=>d(null),className:"flex items-center gap-1 text-slate-400 text-sm",children:[e.jsx(ui,{size:16,className:"rotate-90"})," Indietro"]})}),e.jsxs("div",{className:"p-8 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-white mb-2",children:c.subject}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsxs("span",{children:["Da: ",e.jsx("strong",{children:c.recipient_id===null?"RistoSync Team (Broadcast)":"Supporto Clienti"})]}),e.jsx("span",{children:""}),e.jsx("span",{children:new Date(c.created_at).toLocaleString()})]})]}),c.recipient_id!==null&&e.jsx("button",{onClick:()=>H(c.id),className:"p-2 hover:bg-red-500/20 rounded-lg text-slate-500 hover:text-red-500 transition-colors",title:"Elimina",children:e.jsx(Lt,{size:20})})]}),e.jsx("div",{className:"prose prose-invert max-w-none text-slate-300 leading-relaxed whitespace-pre-line mb-8 p-6 bg-slate-950 rounded-2xl border border-slate-800",children:c.content}),c.attachment_url&&e.jsxs("div",{className:"bg-indigo-900/20 border border-indigo-500/30 rounded-xl p-4 flex items-center gap-4 max-w-sm mb-8",children:[e.jsx("div",{className:"bg-indigo-500/20 p-3 rounded-lg",children:e.jsx(Ys,{className:"text-indigo-400"})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"text-sm font-bold text-white truncate",children:"Allegato"}),e.jsx("p",{className:"text-xs text-indigo-300",children:"File allegato al messaggio"})]}),e.jsx("a",{href:c.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition-colors",children:e.jsx(Oi,{size:18})})]}),e.jsxs("div",{className:"mt-8 border-t border-slate-800 pt-8",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Risposta Rapida"}),e.jsxs("button",{onClick:()=>{w(`RE: ${c.subject}`),i("compose")},className:"bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-colors",children:[e.jsx(ui,{size:18})," Rispondi al Supporto"]})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500 opacity-50",children:[e.jsx(_t,{size:64,className:"mb-4",strokeWidth:1}),e.jsx("p",{className:"text-lg",children:"Seleziona un messaggio per leggerlo"})]})})]}),n==="compose"&&e.jsx("div",{className:"flex-1 flex justify-center p-6 md:p-10 pb-32 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsxs("h2",{className:"text-2xl font-black text-white mb-6 flex items-center gap-2",children:[e.jsx(ts,{className:"text-orange-500"})," Scrivi allo Staff"]}),e.jsxs("div",{className:"space-y-6 bg-slate-900 p-8 rounded-3xl border border-slate-800 shadow-xl mb-10",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-400 text-sm font-bold mb-2 uppercase",children:"Oggetto"}),e.jsx("input",{type:"text",value:j,onChange:x=>w(x.target.value),placeholder:"Es: Conferma Pagamento, Problema Tecnico...",className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-orange-500 outline-none transition-colors font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-400 text-sm font-bold mb-2 uppercase",children:"Messaggio"}),e.jsx("textarea",{value:N,onChange:x=>D(x.target.value),placeholder:"Scrivi qui il tuo messaggio...",className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-orange-500 outline-none transition-colors h-40 resize-none leading-relaxed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-400 text-sm font-bold mb-2 uppercase",children:"Allegato (Opzionale)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",onChange:x=>O(x.target.files?x.target.files[0]:null),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsxs("div",{className:"w-full bg-slate-950 border border-dashed border-slate-700 rounded-xl px-4 py-4 text-slate-400 flex items-center justify-center gap-3 hover:border-orange-500/50 transition-colors",children:[e.jsx(dn,{size:20}),e.jsx("span",{className:"truncate",children:E?E.name:"Clicca per caricare un file (PDF, JPG, PNG)"})]})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>i("inbox"),className:"px-6 py-3 rounded-xl font-bold text-slate-400 hover:text-white hover:bg-slate-800 transition-colors",children:"Annulla"}),e.jsxs("button",{onClick:F,disabled:A,className:"bg-orange-600 hover:bg-orange-500 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-orange-600/20 transform active:scale-95 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[A?e.jsx($t,{className:"animate-spin"}):e.jsx(ts,{size:20}),A?"Invio in corso...":"Invia Messaggio"]})]})]})]})})]})]})}function vl({isOpen:s,title:t,message:a,type:r,onConfirm:n,onCancel:i,confirmText:o="Conferma",cancelText:l="Annulla"}){if(!s)return null;const c=()=>{n&&n()},d=()=>{i&&i()};return e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-3xl shadow-2xl w-full max-w-md animate-slide-up",children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsxs("div",{className:`w-12 h-12 rounded-full flex items-center justify-center shrink-0 ${r==="confirm"?"bg-orange-600/20":r==="success"?"bg-blue-600/20":r==="delete"?"bg-red-600/20":"bg-blue-600/20"}`,children:[r==="confirm"&&e.jsx(ot,{className:"text-orange-500",size:24}),r==="success"&&e.jsx(Le,{className:"text-blue-500",size:24}),r==="delete"&&e.jsx(Lt,{className:"text-red-500",size:24}),r==="alert"&&e.jsx(ot,{className:"text-blue-500",size:24})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:t}),e.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:a})]})]})}),e.jsxs("div",{className:`p-4 bg-slate-950/50 border-t border-slate-800 rounded-b-3xl flex gap-3 ${r==="confirm"||r==="delete"?"justify-between":"justify-end"}`,children:[(r==="confirm"||r==="delete")&&e.jsx("button",{onClick:d,className:"flex-1 px-6 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold rounded-xl transition-colors",children:l}),e.jsx("button",{onClick:c,className:`flex-1 px-6 py-3 font-bold rounded-xl transition-all shadow-lg ${r==="confirm"?"bg-orange-600 hover:bg-orange-500 text-white shadow-orange-900/20":r==="success"?"bg-blue-600 hover:bg-blue-500 text-white shadow-blue-900/20":r==="delete"?"bg-red-600 hover:bg-red-500 text-white shadow-red-900/20":"bg-blue-600 hover:bg-blue-500 text-white shadow-blue-900/20"}`,children:r==="confirm"||r==="delete"?o:"OK"})]})]})})}function wl({isOpen:s,message:t,type:a="info",onClose:r,duration:n=3e3}){if(m.useEffect(()=>{if(s&&n>0){const l=setTimeout(()=>{r()},n);return()=>clearTimeout(l)}},[s,n,r]),!s)return null;const i={success:e.jsx(Le,{className:"text-green-500",size:24}),error:e.jsx(jd,{className:"text-red-500",size:24}),info:e.jsx(cr,{className:"text-blue-500",size:24})},o={success:"bg-green-600/20 border-green-500/50",error:"bg-red-600/20 border-red-500/50",info:"bg-blue-600/20 border-blue-500/50"};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                .animate-slide-in-right {
                    animation: slideInRight 0.3s ease-out;
                }
            `}),e.jsx("div",{className:"fixed top-4 right-4 z-[10000] animate-slide-in-right",children:e.jsxs("div",{className:`${o[a]} border-2 rounded-2xl shadow-2xl backdrop-blur-sm p-4 pr-12 max-w-md relative`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i[a],e.jsx("p",{className:"text-white font-bold text-sm leading-relaxed",children:t})]}),e.jsx("button",{onClick:r,className:"absolute top-3 right-3 text-slate-400 hover:text-white transition-colors",children:e.jsx(Xe,{size:18})})]})})]})}const ai=({onClose:s,onAccept:t,restaurantName:a})=>{const[r,n]=m.useState(!1),[i,o]=m.useState(!1),[l,c]=m.useState(!1),[d,u]=m.useState(!1),v=r&&i&&l,j=()=>{v&&t({termsAccepted:r,cookiesAccepted:i,privacyAccepted:l,dontShowAgain:d})};return e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border-2 border-orange-500/30 rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up",children:[e.jsxs("div",{className:"relative bg-gradient-to-br from-orange-600 to-red-600 p-8 rounded-t-3xl text-center",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{onClick:s,className:"p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors",title:"Chiudi",children:e.jsx(Xe,{size:20,className:"text-white"})})}),e.jsx("div",{className:"w-20 h-20 bg-white/10 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-4 animate-bounce",children:e.jsx(ft,{size:40,className:"text-white"})}),e.jsx("h1",{className:"text-3xl font-black text-white mb-2",children:" Benvenuto in RistoSync AI!"}),e.jsx("p",{className:"text-orange-100 text-lg font-bold",children:a})]}),e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsx("div",{className:"bg-blue-600/10 border border-blue-500/30 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center shrink-0",children:e.jsx(Le,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-black text-lg mb-2",children:"Trial Gratuito Attivato: 15 Giorni "}),e.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Il tuo periodo di prova gratuito  attivo. Hai pieno accesso a tutte le funzionalit. Alla scadenza potrai scegliere il piano pi adatto a te."})]})]})}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-white font-bold text-base mb-4 flex items-center gap-2",children:[e.jsx(Ai,{size:18,className:"text-orange-500"}),"Cosa puoi fare con RistoSync AI"]}),e.jsxs("ul",{className:"space-y-3 text-sm text-slate-300",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Le,{size:16,className:"text-green-500 shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Gestione Ordini in Tempo Reale"})," - Sincronizzazione tra sala e cucina"]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Le,{size:16,className:"text-green-500 shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Menu Digitale Personalizzato"})," - QR code per i tuoi clienti"]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Le,{size:16,className:"text-green-500 shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Intelligenza Artificiale"})," - Analisi e suggerimenti automatici"]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(Le,{size:16,className:"text-green-500 shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:"Statistiche Avanzate"})," - Monitora le performance del tuo locale"]})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-orange-600/10 to-red-600/10 border border-orange-500/30 rounded-2xl p-6",children:e.jsxs("p",{className:"text-slate-300 text-sm text-center leading-relaxed",children:["Nessuna carta di credito richiesta per iniziare. Goditi l'esperienza ",e.jsx("span",{className:"text-orange-400 font-bold",children:"RistoSync AI"}),"!"]})}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-6",children:[e.jsx("h3",{className:"text-white font-bold text-sm mb-4",children:"Accettazione Termini e Condizioni"}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:w=>n(w.target.checked),className:"w-5 h-5 rounded border-2 border-slate-600 bg-slate-800 checked:bg-orange-500 checked:border-orange-500 cursor-pointer transition-all"}),r&&e.jsx(Le,{size:14,className:"absolute left-0.5 top-0.5 text-white pointer-events-none"})]}),e.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:[e.jsx(Ys,{size:14,className:"inline mr-1 text-orange-500"}),"Accetto i ",e.jsx("a",{href:"https://www.iubenda.com/termini-e-condizioni/",target:"_blank",rel:"noopener noreferrer",className:"text-orange-400 hover:underline font-bold",children:"Termini e Condizioni"})," del servizio"]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:w=>o(w.target.checked),className:"w-5 h-5 rounded border-2 border-slate-600 bg-slate-800 checked:bg-orange-500 checked:border-orange-500 cursor-pointer transition-all"}),i&&e.jsx(Le,{size:14,className:"absolute left-0.5 top-0.5 text-white pointer-events-none"})]}),e.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:[e.jsx(Xl,{size:14,className:"inline mr-1 text-orange-500"}),"Accetto l'utilizzo dei ",e.jsx("a",{href:"https://www.iubenda.com/privacy-policy/cookie-policy/",target:"_blank",rel:"noopener noreferrer",className:"text-orange-400 hover:underline font-bold",children:"Cookie"})," per migliorare l'esperienza"]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:w=>c(w.target.checked),className:"w-5 h-5 rounded border-2 border-slate-600 bg-slate-800 checked:bg-orange-500 checked:border-orange-500 cursor-pointer transition-all"}),l&&e.jsx(Le,{size:14,className:"absolute left-0.5 top-0.5 text-white pointer-events-none"})]}),e.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:[e.jsx(mn,{size:14,className:"inline mr-1 text-orange-500"}),"Accetto la ",e.jsx("a",{href:"https://www.iubenda.com/privacy-policy/",target:"_blank",rel:"noopener noreferrer",className:"text-orange-400 hover:underline font-bold",children:"Privacy Policy"})," e il trattamento dei dati"]})]}),e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group mt-6 pt-4 border-t border-slate-700",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:w=>u(w.target.checked),className:"w-5 h-5 rounded border-2 border-slate-600 bg-slate-800 checked:bg-blue-500 checked:border-blue-500 cursor-pointer transition-all"}),d&&e.jsx(Le,{size:14,className:"absolute left-0.5 top-0.5 text-white pointer-events-none"})]}),e.jsx("span",{className:"text-sm text-slate-400 group-hover:text-slate-300 transition-colors",children:"Non mostrare pi questo messaggio"})]})]}),e.jsx("div",{className:"flex gap-3 pt-4",children:e.jsx("button",{onClick:j,disabled:!v,className:`flex-1 py-4 rounded-xl font-black text-lg transition-all shadow-lg ${v?"bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white shadow-orange-500/30 active:scale-95":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:v?" Inizia Ora":" Accetta i Termini"})}),e.jsx("p",{className:"text-xs text-slate-500 text-center mt-4",children:"Puoi modificare queste preferenze in qualsiasi momento dalle impostazioni"})]})]})})};var jl;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(jl||(jl={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yl;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(yl||(yl={}));var Nl;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Nl||(Nl={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _l=["user","model","function","system"];var kl;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(kl||(kl={}));var Sl;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Sl||(Sl={}));var El;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(El||(El={}));var Cl;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(Cl||(Cl={}));var sr;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.OTHER="OTHER"})(sr||(sr={}));var Il;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})(Il||(Il={}));var Tl;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Tl||(Tl={}));var Al;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Al||(Al={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class fa extends Ct{constructor(t,a){super(t),this.response=a}}class Fc extends Ct{constructor(t,a,r,n){super(t),this.status=a,this.statusText=r,this.errorDetails=n}}class Ps extends Ct{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Um="https://generativelanguage.googleapis.com",Bm="v1beta",Fm="0.21.0",Gm="genai-js";var Qs;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Qs||(Qs={}));class qm{constructor(t,a,r,n,i){this.model=t,this.task=a,this.apiKey=r,this.stream=n,this.requestOptions=i}toString(){var t,a;const r=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||Bm;let i=`${((a=this.requestOptions)===null||a===void 0?void 0:a.baseUrl)||Um}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function Vm(s){const t=[];return s!=null&&s.apiClient&&t.push(s.apiClient),t.push(`${Gm}/${Fm}`),t.join(" ")}async function Km(s){var t;const a=new Headers;a.append("Content-Type","application/json"),a.append("x-goog-api-client",Vm(s.requestOptions)),a.append("x-goog-api-key",s.apiKey);let r=(t=s.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(n){throw new Ps(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${n.message}`)}for(const[n,i]of r.entries()){if(n==="x-goog-api-key")throw new Ps(`Cannot set reserved header name ${n}`);if(n==="x-goog-api-client")throw new Ps(`Header name ${n} can only be set using the apiClient field`);a.append(n,i)}}return a}async function Wm(s,t,a,r,n,i){const o=new qm(s,t,a,r,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},Qm(i)),{method:"POST",headers:await Km(o),body:n})}}async function Sr(s,t,a,r,n,i={},o=fetch){const{url:l,fetchOptions:c}=await Wm(s,t,a,r,n,i);return Hm(l,c,o)}async function Hm(s,t,a=fetch){let r;try{r=await a(s,t)}catch(n){Jm(n,s)}return r.ok||await Ym(r,s),r}function Jm(s,t){let a=s;throw s instanceof Fc||s instanceof Ps||(a=new Ct(`Error fetching from ${t.toString()}: ${s.message}`),a.stack=s.stack),a}async function Ym(s,t){let a="",r;try{const n=await s.json();a=n.error.message,n.error.details&&(a+=` ${JSON.stringify(n.error.details)}`,r=n.error.details)}catch{}throw new Fc(`Error fetching from ${t.toString()}: [${s.status} ${s.statusText}] ${a}`,s.status,s.statusText,r)}function Qm(s){const t={};if((s==null?void 0:s.signal)!==void 0||(s==null?void 0:s.timeout)>=0){const a=new AbortController;(s==null?void 0:s.timeout)>=0&&setTimeout(()=>a.abort(),s.timeout),s!=null&&s.signal&&s.signal.addEventListener("abort",()=>{a.abort()}),t.signal=a.signal}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ao(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ln(s.candidates[0]))throw new fa(`${Ts(s)}`,s);return Xm(s)}else if(s.promptFeedback)throw new fa(`Text not available. ${Ts(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ln(s.candidates[0]))throw new fa(`${Ts(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Ol(s)[0]}else if(s.promptFeedback)throw new fa(`Function call not available. ${Ts(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ln(s.candidates[0]))throw new fa(`${Ts(s)}`,s);return Ol(s)}else if(s.promptFeedback)throw new fa(`Function call not available. ${Ts(s)}`,s)},s}function Xm(s){var t,a,r,n;const i=[];if(!((a=(t=s.candidates)===null||t===void 0?void 0:t[0].content)===null||a===void 0)&&a.parts)for(const o of(n=(r=s.candidates)===null||r===void 0?void 0:r[0].content)===null||n===void 0?void 0:n.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function Ol(s){var t,a,r,n;const i=[];if(!((a=(t=s.candidates)===null||t===void 0?void 0:t[0].content)===null||a===void 0)&&a.parts)for(const o of(n=(r=s.candidates)===null||r===void 0?void 0:r[0].content)===null||n===void 0?void 0:n.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}const Zm=[sr.RECITATION,sr.SAFETY,sr.LANGUAGE];function ln(s){return!!s.finishReason&&Zm.includes(s.finishReason)}function Ts(s){var t,a,r;let n="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)n+="Response was blocked",!((t=s.promptFeedback)===null||t===void 0)&&t.blockReason&&(n+=` due to ${s.promptFeedback.blockReason}`),!((a=s.promptFeedback)===null||a===void 0)&&a.blockReasonMessage&&(n+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((r=s.candidates)===null||r===void 0)&&r[0]){const i=s.candidates[0];ln(i)&&(n+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(n+=`: ${i.finishMessage}`))}return n}function jr(s){return this instanceof jr?(this.v=s,this):new jr(s)}function ex(s,t,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=a.apply(s,t||[]),n,i=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(j){r[j]&&(n[j]=function(w){return new Promise(function(N,D){i.push([j,w,N,D])>1||l(j,w)})})}function l(j,w){try{c(r[j](w))}catch(N){v(i[0][3],N)}}function c(j){j.value instanceof jr?Promise.resolve(j.value.v).then(d,u):v(i[0][2],j)}function d(j){l("next",j)}function u(j){l("throw",j)}function v(j,w){j(w),i.shift(),i.length&&l(i[0][0],i[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function tx(s){const t=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),a=rx(t),[r,n]=a.tee();return{stream:ax(r),response:sx(n)}}async function sx(s){const t=[],a=s.getReader();for(;;){const{done:r,value:n}=await a.read();if(r)return ao(nx(t));t.push(n)}}function ax(s){return ex(this,arguments,function*(){const a=s.getReader();for(;;){const{value:r,done:n}=yield jr(a.read());if(n)break;yield yield jr(ao(r))}})}function rx(s){const t=s.getReader();return new ReadableStream({start(r){let n="";return i();function i(){return t.read().then(({value:o,done:l})=>{if(l){if(n.trim()){r.error(new Ct("Failed to parse stream"));return}r.close();return}n+=o;let c=n.match(Rl),d;for(;c;){try{d=JSON.parse(c[1])}catch{r.error(new Ct(`Error parsing JSON response: "${c[1]}"`));return}r.enqueue(d),n=n.substring(c[0].length),c=n.match(Rl)}return i()})}}})}function nx(s){const t=s[s.length-1],a={promptFeedback:t==null?void 0:t.promptFeedback};for(const r of s){if(r.candidates)for(const n of r.candidates){const i=n.index;if(a.candidates||(a.candidates=[]),a.candidates[i]||(a.candidates[i]={index:n.index}),a.candidates[i].citationMetadata=n.citationMetadata,a.candidates[i].groundingMetadata=n.groundingMetadata,a.candidates[i].finishReason=n.finishReason,a.candidates[i].finishMessage=n.finishMessage,a.candidates[i].safetyRatings=n.safetyRatings,n.content&&n.content.parts){a.candidates[i].content||(a.candidates[i].content={role:n.content.role||"user",parts:[]});const o={};for(const l of n.content.parts)l.text&&(o.text=l.text),l.functionCall&&(o.functionCall=l.functionCall),l.executableCode&&(o.executableCode=l.executableCode),l.codeExecutionResult&&(o.codeExecutionResult=l.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),a.candidates[i].content.parts.push(o)}}r.usageMetadata&&(a.usageMetadata=r.usageMetadata)}return a}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gc(s,t,a,r){const n=await Sr(t,Qs.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(a),r);return tx(n)}async function qc(s,t,a,r){const i=await(await Sr(t,Qs.GENERATE_CONTENT,s,!1,JSON.stringify(a),r)).json();return{response:ao(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vc(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function yr(s){let t=[];if(typeof s=="string")t=[{text:s}];else for(const a of s)typeof a=="string"?t.push({text:a}):t.push(a);return ix(t)}function ix(s){const t={role:"user",parts:[]},a={role:"function",parts:[]};let r=!1,n=!1;for(const i of s)"functionResponse"in i?(a.parts.push(i),n=!0):(t.parts.push(i),r=!0);if(r&&n)throw new Ct("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!n)throw new Ct("No content is provided for sending chat message.");return r?t:a}function ox(s,t){var a;let r={model:t==null?void 0:t.model,generationConfig:t==null?void 0:t.generationConfig,safetySettings:t==null?void 0:t.safetySettings,tools:t==null?void 0:t.tools,toolConfig:t==null?void 0:t.toolConfig,systemInstruction:t==null?void 0:t.systemInstruction,cachedContent:(a=t==null?void 0:t.cachedContent)===null||a===void 0?void 0:a.name,contents:[]};const n=s.generateContentRequest!=null;if(s.contents){if(n)throw new Ps("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=s.contents}else if(n)r=Object.assign(Object.assign({},r),s.generateContentRequest);else{const i=yr(s);r.contents=[i]}return{generateContentRequest:r}}function Pl(s){let t;return s.contents?t=s:t={contents:[yr(s)]},s.systemInstruction&&(t.systemInstruction=Vc(s.systemInstruction)),t}function lx(s){return typeof s=="string"||Array.isArray(s)?{content:yr(s)}:s}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],cx={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function dx(s){let t=!1;for(const a of s){const{role:r,parts:n}=a;if(!t&&r!=="user")throw new Ct(`First content should be with role 'user', got ${r}`);if(!_l.includes(r))throw new Ct(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(_l)}`);if(!Array.isArray(n))throw new Ct("Content should have 'parts' property with an array of Parts");if(n.length===0)throw new Ct("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of n)for(const c of zl)c in l&&(i[c]+=1);const o=cx[r];for(const l of zl)if(!o.includes(l)&&i[l]>0)throw new Ct(`Content with role '${r}' can't contain '${l}' part`);t=!0}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dl="SILENT_ERROR";class ux{constructor(t,a,r,n={}){this.model=a,this.params=r,this._requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,r!=null&&r.history&&(dx(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,a={}){var r,n,i,o,l,c;await this._sendPromise;const d=yr(t),u={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},v=Object.assign(Object.assign({},this._requestOptions),a);let j;return this._sendPromise=this._sendPromise.then(()=>qc(this._apiKey,this.model,u,v)).then(w=>{var N;if(w.response.candidates&&w.response.candidates.length>0){this._history.push(d);const D=Object.assign({parts:[],role:"model"},(N=w.response.candidates)===null||N===void 0?void 0:N[0].content);this._history.push(D)}else{const D=Ts(w.response);D&&console.warn(`sendMessage() was unsuccessful. ${D}. Inspect response object for details.`)}j=w}),await this._sendPromise,j}async sendMessageStream(t,a={}){var r,n,i,o,l,c;await this._sendPromise;const d=yr(t),u={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,d]},v=Object.assign(Object.assign({},this._requestOptions),a),j=Gc(this._apiKey,this.model,u,v);return this._sendPromise=this._sendPromise.then(()=>j).catch(w=>{throw new Error(Dl)}).then(w=>w.response).then(w=>{if(w.candidates&&w.candidates.length>0){this._history.push(d);const N=Object.assign({},w.candidates[0].content);N.role||(N.role="model"),this._history.push(N)}else{const N=Ts(w);N&&console.warn(`sendMessageStream() was unsuccessful. ${N}. Inspect response object for details.`)}}).catch(w=>{w.message!==Dl&&console.error(w)}),j}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hx(s,t,a,r){return(await Sr(t,Qs.COUNT_TOKENS,s,!1,JSON.stringify(a),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mx(s,t,a,r){return(await Sr(t,Qs.EMBED_CONTENT,s,!1,JSON.stringify(a),r)).json()}async function xx(s,t,a,r){const n=a.requests.map(o=>Object.assign(Object.assign({},o),{model:t}));return(await Sr(t,Qs.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:n}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(t,a,r={}){this.apiKey=t,this._requestOptions=r,a.model.includes("/")?this.model=a.model:this.model=`models/${a.model}`,this.generationConfig=a.generationConfig||{},this.safetySettings=a.safetySettings||[],this.tools=a.tools,this.toolConfig=a.toolConfig,this.systemInstruction=Vc(a.systemInstruction),this.cachedContent=a.cachedContent}async generateContent(t,a={}){var r;const n=Pl(t),i=Object.assign(Object.assign({},this._requestOptions),a);return qc(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},n),i)}async generateContentStream(t,a={}){var r;const n=Pl(t),i=Object.assign(Object.assign({},this._requestOptions),a);return Gc(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},n),i)}startChat(t){var a;return new ux(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},t),this._requestOptions)}async countTokens(t,a={}){const r=ox(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),n=Object.assign(Object.assign({},this._requestOptions),a);return hx(this.apiKey,this.model,r,n)}async embedContent(t,a={}){const r=lx(t),n=Object.assign(Object.assign({},this._requestOptions),a);return mx(this.apiKey,this.model,r,n)}async batchEmbedContents(t,a={}){const r=Object.assign(Object.assign({},this._requestOptions),a);return xx(this.apiKey,this.model,t,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(t){this.apiKey=t}getGenerativeModel(t,a){if(!t.model)throw new Ct("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new $l(this.apiKey,t,a)}getGenerativeModelFromCachedContent(t,a,r){if(!t.name)throw new Ps("Cached content must contain a `name` field.");if(!t.model)throw new Ps("Cached content must contain a `model` field.");const n=["model","systemInstruction"];for(const o of n)if(a!=null&&a[o]&&t[o]&&(a==null?void 0:a[o])!==t[o]){if(o==="model"){const l=a.model.startsWith("models/")?a.model.replace("models/",""):a.model,c=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(l===c)continue}throw new Ps(`Different value for "${o}" specified in modelParams (${a[o]}) and cachedContent (${t[o]})`)}const i=Object.assign(Object.assign({},a),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new $l(this.apiKey,i,r)}}var ta={};const px=async(s,t)=>{var a;try{const r=os()||ta.API_KEY;if(!r)return" Configurazione AI mancante. Vai nelle Impostazioni > AI Intelligence e inserisci la tua Google API Key.";const i=new ea(r).getGenerativeModel({model:"gemini-2.0-flash-exp"}),l=`
      Sei un assistente chef esperto e cortese in un ristorante italiano.
      Contesto: ${t?`Il cliente sta chiedendo informazioni sul piatto: "${t.name}". Ingredienti: ${t.ingredients||"Non specificati"}. Descrizione: ${t.description||"Nessuna"}. Allergeni: ${((a=t.allergens)==null?void 0:a.join(", "))||"Nessuno"}.`:"Il cliente sta facendo una domanda generale sul menu."}
      Domanda del cliente: "${s}"
      
      Rispondi in modo conciso (max 2 frasi), professionale e invitante. 
      Se chiedono allergeni e non sei sicuro, consiglia di chiedere allo chef.
    `;return(await i.generateContent(l)).response.text()||"Non riesco a rispondere al momento."}catch(r){return console.error("Gemini Error:",r),"Errore AI. Verifica la chiave API."}},fx=async(s,t)=>{var a,r;try{const n=os()||ta.API_KEY;if(!n)return" Chiave API mancante.";const o=new ea(n).getGenerativeModel({model:"gemini-2.0-flash-exp"}),l=`
            Sei un Consulente Ristorazione esperto. Analizza i dati del ${t}:
            
             PERFORMANCE:
            - Incasso Totale:  ${(s.totalRevenue||0).toFixed(2)}
            - Numero Tavoli/Ordini: ${s.totalOrders||0}
            - Valore Medio Ordine:  ${(s.avgOrderValue||0).toFixed(2)}
            - Piatti Serviti: ${s.totalItems||0}
            - Food Cost Stimato:  ${(s.foodCost||0).toFixed(2)} (32%)
            - Tempo Medio Attesa: ${s.avgWait||0} minuti
            
             TOP PIATTI (pi venduti): ${((a=s.topDishes)==null?void 0:a.length)>0?s.topDishes.join(", "):"Nessun dato"}
            
             PIATTI MENO RICHIESTI: ${((r=s.bottomDishes)==null?void 0:r.length)>0?s.bottomDishes.join(", "):"Nessun dato"}

            Fornisci un report DETTAGLIATO (max 150 parole) con:
            1.  Valutazione performance complessiva
            2.  Analisi dei piatti top e come sfruttarli meglio
            3.  Suggerimenti per i piatti meno venduti (promozioni, modifica ricetta, rimozione dal menu?)
            4.  Valutazione tempo di attesa (ottimo <15min, buono <20min, da migliorare >20min)
            5.  Un consiglio strategico per domani
            
            Usa emoji per rendere il report leggibile e coinvolgente.
        `;return(await o.generateContent(l)).response.text()||"Analisi non disponibile."}catch(n){return console.error("Gemini Analysis Error:",n),"Errore analisi AI."}},gx=async s=>{try{const t=os()||ta.API_KEY;if(!t)return"";const r=new ea(t).getGenerativeModel({model:"gemini-2.0-flash-exp"}),n=`
            Sei uno Chef. 
            Elenca SOLO gli ingredienti principali per il piatto "${s}", separati da virgola.
            Non scrivere nient'altro. Solo elenco ingredienti.
            Esempio: Pasta, Uova, Guanciale, Pecorino, Pepe.
        `,o=(await r.generateContent(n)).response;return o.text()?o.text().replace(/\n/g," ").trim():""}catch(t){return console.error("Ingredients Gen Error:",t),""}},bx=async(s,t)=>{try{const a=os()||ta.API_KEY;if(!a)return"";const n=new ea(a).getGenerativeModel({model:"gemini-2.0-flash-exp"}),i=`
            Sei uno Chef stellato che scrive il menu.
            Scrivi una descrizione breve (max 20 parole), invitante e poetica per il piatto: "${s}".
            Considera questi ingredienti: ${t}.
            Non elencare di nuovo gli ingredienti, descrivi l'esperienza di gusto.
            Tono elegante. Niente virgolette.
        `;return(await n.generateContent(i)).response.text()||""}catch(a){return console.error("Description Gen Error:",a),""}},vx=async s=>{try{const t=os()||ta.API_KEY;if(!t)return"";const r=new ea(t).getGenerativeModel({model:"gemini-2.0-flash-exp"}),n=`
            Sei un esperto copywriter per la ristorazione.
            Scrivi una "Bio" (descrizione breve) accattivante ed elegante per il ristorante chiamato "${s}".
            Massimo 30 parole.
            Usa un tono invitante che faccia venire fame.
            Usa 1 o 2 emoji appropriate.
            Non usare virgolette.
        `;return(await r.generateContent(n)).response.text()||""}catch(t){return console.error("Restaurant Bio Gen Error:",t),""}},wx=async(s,t)=>{try{const a=os()||ta.API_KEY;if(!a)return"";const n=new ea(a).getGenerativeModel({model:"gemini-2.0-flash-exp"}),i=`
            Sei un Social Media Manager esperto per ristoranti.
            Scrivi un post per Facebook/Instagram basato su questo argomento: "${s}".
            ${t?`Considera che il post avr un'immagine che mostra: ${t}`:""}

            Il post DEVE avere questa struttura esatta:
            1. Un TITOLO ACCATTIVANTE (in maiuscolo, max 5 parole, con emoji)
            2. Un corpo del testo di ALMENO 5 righe, usando un linguaggio persuasivo, emozionale e che faccia venire fame.
            3. Una CALL TO ACTION finale chiara (es. "Prenota ora", "Vieni a trovarci").
            4. Esattamente 10 HASHTAG pertinenti alla fine.

            Usa molte emoji nel testo.
            Tono: Entusiasta, Caldo, Invitante.
        `;return(await n.generateContent(i)).response.text()||""}catch(a){return console.error("Social Post Gen Error:",a),"Errore nella generazione del post."}},jx=async s=>{try{if(!s||s.trim().length===0)return[];const t=os()||ta.API_KEY;if(!t)return console.warn("API Key mancante per rilevamento allergeni"),[];const r=new ea(t).getGenerativeModel({model:"gemini-2.0-flash-exp"}),n=`
            Sei un esperto nutrizionista e allergologo.
            Analizza questa lista di ingredienti e identifica TUTTI gli allergeni presenti.
            
            Ingredienti: "${s}"
            
            Allergeni da considerare (lista completa EU):
            - Glutine (cereali contenenti glutine: grano, segale, orzo, avena, farro, kamut)
            - Lattosio (latte e derivati: formaggi, burro, panna, yogurt, mozzarella, parmigiano, pecorino)
            - Uova (e prodotti a base di uova)
            - Frutta a guscio (mandorle, nocciole, noci, anacardi, pistacchi, noci pecan, noci del Brasile, noci macadamia)
            - Pesce (e prodotti della pesca)
            - Crostacei (gamberi, scampi, aragoste, granchi)
            - Soia (e prodotti a base di soia)
            - Sedano (e prodotti a base di sedano)
            - Senape (e prodotti a base di senape)
            - Sesamo (semi di sesamo e prodotti derivati)
            - Lupini (e prodotti a base di lupini)
            - Molluschi (cozze, vongole, ostriche, calamari, polpo, seppie)
            - Solfiti (anidride solforosa e solfiti in concentrazione superiore a 10 mg/kg)
            - Arachidi (e prodotti a base di arachidi)
            
            IMPORTANTE: Rispondi SOLO con un array JSON di stringhe contenente i nomi degli allergeni rilevati.
            Usa ESATTAMENTE questi nomi: "Glutine", "Lattosio", "Uova", "Frutta a guscio", "Pesce", "Crostacei", "Soia", "Sedano", "Senape", "Sesamo", "Lupini", "Molluschi", "Solfiti", "Arachidi"
            
            Se non ci sono allergeni, rispondi con: []
            
            Esempi:
            - Ingredienti: "Pasta, Pomodoro, Basilico"  ["Glutine"]
            - Ingredienti: "Mozzarella, Pomodoro, Basilico"  ["Lattosio"]
            - Ingredienti: "Uova, Farina, Latte, Burro"  ["Glutine", "Lattosio", "Uova"]
            - Ingredienti: "Gamberi, Aglio, Prezzemolo"  ["Crostacei"]
            - Ingredienti: "Insalata, Pomodoro, Cetrioli"  []
        `;let c=((await r.generateContent(n)).response.text()||"[]").trim();c.startsWith("```json")?c=c.replace(/^```json\s*/,"").replace(/\s*```$/,""):c.startsWith("```")&&(c=c.replace(/^```\s*/,"").replace(/\s*```$/,""));const d=JSON.parse(c);if(!Array.isArray(d))return console.error("Risposta allergeni non  un array"),[];const u=["Glutine","Lattosio","Uova","Frutta a guscio","Pesce","Crostacei","Soia","Sedano","Senape","Sesamo","Lupini","Molluschi","Solfiti","Arachidi"];return d.filter(v=>u.includes(v))}catch(t){return console.error("Allergen Detection Error:",t),[]}},Kc=m.createContext(void 0),yx=({children:s})=>{const[t,a]=m.useState([]),r=(i,o="info")=>{const l=Date.now();a(c=>[...c,{id:l,message:i,type:o}]),setTimeout(()=>{a(c=>c.filter(d=>d.id!==l))},3e3)},n=i=>{a(o=>o.filter(l=>l.id!==i))};return e.jsxs(Kc.Provider,{value:{showToast:r},children:[s,e.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 pointer-events-none",children:t.map(i=>e.jsxs("div",{className:`
              pointer-events-auto flex items-center gap-3 px-4 py-3 rounded-xl shadow-2xl border-l-4 animate-slide-up bg-slate-900 border-slate-700
              ${i.type==="success"?"border-l-green-500":i.type==="error"?"border-l-red-500":"border-l-blue-500"}
            `,children:[i.type==="success"&&e.jsx(Le,{className:"text-green-500",size:20}),i.type==="error"&&e.jsx(yd,{className:"text-red-500",size:20}),i.type==="info"&&e.jsx(cr,{className:"text-blue-500",size:20}),e.jsx("span",{className:"text-white font-semibold text-sm",children:i.message}),e.jsx("button",{onClick:()=>n(i.id),className:"ml-2 text-slate-500 hover:text-white",children:e.jsx(Xe,{size:14})})]},i.id))})]})},Nx=()=>{const s=m.useContext(Kc);if(!s)throw new Error("useToast must be used within a ToastProvider");return s};function Wc(){const[s,t]=m.useState({isOpen:!1,title:"",message:"",type:"alert"});return{dialogState:s,showConfirm:(l,c)=>new Promise(d=>{t({isOpen:!0,title:l,message:c,type:"confirm",onConfirm:()=>{t(u=>({...u,isOpen:!1})),d(!0)},onCancel:()=>{t(u=>({...u,isOpen:!1})),d(!1)}})}),showDelete:(l,c)=>new Promise(d=>{t({isOpen:!0,title:l,message:c,type:"delete",onConfirm:()=>{t(u=>({...u,isOpen:!1})),d(!0)},onCancel:()=>{t(u=>({...u,isOpen:!1})),d(!1)}})}),showAlert:(l,c)=>new Promise(d=>{t({isOpen:!0,title:l,message:c,type:"alert",onConfirm:()=>{t(u=>({...u,isOpen:!1})),d()}})}),showSuccess:(l,c)=>new Promise(d=>{t({isOpen:!0,title:l,message:c,type:"success",onConfirm:()=>{t(u=>({...u,isOpen:!1})),d()}})}),closeDialog:()=>{t(l=>({...l,isOpen:!1}))}}}const _x=({post:s,logoUrl:t,onPublish:a,onEdit:r,onDelete:n})=>{var i,o;return e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl hover:border-indigo-500/30 transition-all group flex flex-col lg:flex-row h-auto lg:h-[500px] w-full",children:[e.jsxs("div",{className:"lg:w-2/5 relative bg-slate-950 overflow-hidden",children:[s.image?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.image,alt:"Post",className:"w-full h-64 lg:h-full object-cover transition-transform duration-700 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/80 via-transparent to-transparent lg:bg-gradient-to-r lg:from-transparent lg:to-slate-900/50"}),s.overlayText&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsx("span",{className:"text-white font-black uppercase text-center text-xl lg:text-2xl drop-shadow-md border-2 border-white/80 p-2 transform -rotate-2",children:s.overlayText})})]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-600 bg-slate-950/50",children:[e.jsx(xn,{size:48,className:"mb-2 opacity-50"}),e.jsx("span",{className:"text-xs font-bold tracking-widest uppercase",children:"No Image"})]}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"bg-black/60 backdrop-blur-md text-white text-[10px] font-bold px-3 py-1 rounded-full border border-white/10 uppercase tracking-wider shadow-lg",children:s.topic||"Post Social"})})]}),e.jsxs("div",{className:"lg:w-3/5 p-6 lg:p-8 flex flex-col relative bg-gradient-to-br from-slate-900 to-slate-900/50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-xs shadow-md",children:"RS"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-bold leading-none",children:"Anteprima Post"}),e.jsx("p",{className:"text-slate-500 text-[11px] font-mono mt-1",children:new Date(s.date).toLocaleDateString()})]})]}),e.jsx(Ca,{size:14,className:"text-slate-600"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden relative mb-4",children:[e.jsx("p",{className:"text-slate-300 text-sm leading-relaxed whitespace-pre-wrap line-clamp-4 lg:line-clamp-5",children:s.content}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:(o=(i=s.content)==null?void 0:i.match(/#[a-zA-Z0-9_]+/g))==null?void 0:o.slice(0,5).map((l,c)=>e.jsx("span",{className:"text-indigo-400 text-xs font-medium",children:l},c))})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-800/50 flex gap-3 mt-auto",children:[e.jsxs("button",{onClick:()=>a(s),className:"flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-2.5 rounded-xl font-bold text-sm shadow-lg hover:shadow-indigo-500/20 transition-all flex items-center justify-center gap-2",children:[e.jsx(ts,{size:16})," ",e.jsx("span",{className:"hidden sm:inline",children:"Pubblica"})]}),e.jsx("button",{onClick:()=>r(s),className:"px-4 py-2.5 bg-slate-800 text-slate-300 hover:text-white hover:bg-slate-700 rounded-xl font-medium text-sm transition-all border border-slate-700 flex items-center justify-center",title:"Modifica",children:e.jsx(Js,{size:16})}),e.jsx("button",{onClick:()=>n(s.id),className:"px-4 py-2.5 bg-red-900/30 text-red-400 hover:bg-red-600 hover:text-white rounded-xl font-bold text-sm transition-all border border-red-900/50 hover:border-red-600 flex items-center justify-center shadow-md",title:"Elimina",children:e.jsx(Lt,{size:16})})]})]})]})};function kx(){var Ge,we,ze,z,P,_;const[s,t]=m.useState("campaigns"),[a,r]=m.useState([]),[n,i]=m.useState([]),[o,l]=m.useState(!1),[c,d]=m.useState({}),[u,v]=m.useState({}),[j,w]=m.useState(""),[N,D]=m.useState(""),[E,O]=m.useState(!1),[A,B]=m.useState(null),[Z,F]=m.useState(""),[H,Y]=m.useState(null),[x,b]=m.useState([]),[S,K]=m.useState(null),[M,ee]=m.useState(null),[ge,ye]=m.useState("login"),[ce,U]=m.useState([]),[te,p]=m.useState(null),[g,y]=m.useState(!1),[T,I]=m.useState(!1),[X,he]=m.useState(null),{showToast:se}=Nx(),{showConfirm:ue}=Wc();m.useEffect(()=>{var G;r(gr()),i(br()),b(vr());const h=It();(G=h.restaurantProfile)!=null&&G.logo&&Y(h.restaurantProfile.logo);const C=()=>{r(gr())},L=()=>{i(br())},le=()=>{b(vr())};return window.addEventListener("local-marketing-update",C),window.addEventListener("local-automation-update",L),window.addEventListener("local-social-update",le),()=>{window.removeEventListener("local-marketing-update",C),window.removeEventListener("local-automation-update",L),window.removeEventListener("local-social-update",le)}},[]);const ie=h=>{pl({...h,isActive:!h.isActive}),se(h.isActive?"Automazione disattivata":"Automazione attivata","info")},ne=()=>{u.id&&(pl(u),l(!1),v({}))},re=h=>{var L;const C=(L=h.target.files)==null?void 0:L[0];if(C){const le=new FileReader;le.onloadend=()=>{B(le.result)},le.readAsDataURL(C)}},V=async()=>{if(!j)return;O(!0);const h=await wx(j,Z?`Grafica con scritta: "${Z}"`:void 0);D(h),O(!1)},$e=()=>{if(!N&&!A)return;const h={id:S||Date.now().toString(),topic:j,content:N,image:A,overlayText:Z,date:Date.now(),platform:"all"};S?(Q0(h),K(null)):Y0(h),w(""),D(""),B(null),F(""),se("Post salvato nella bacheca!","success")},k=h=>{w(h.topic||""),D(h.content),B(h.image||null),F(h.overlayText||""),K(h.id),window.scrollTo({top:0,behavior:"smooth"})},Q=async h=>{await ue("Elimina Post","Vuoi davvero eliminare questo post salvato?")&&(X0(h),se("Post eliminato","info"))},xe=async h=>{(h==="facebook"?g:T)?await ue("Disconnetti",`Vuoi disconnettere ${h}?`)&&(h==="facebook"?(y(!1),he(null)):I(!1),se(`${h} disconnesso`,"info")):(ee(h),ye("login"),U([]),p(null))},fe=()=>{ye("select_page"),setTimeout(()=>{U(["Pizzeria Da Mario - Official","Mario's Lounge Bar","Ristorante Il Gusto"])},800)},Ce=()=>{if(!te){se("Seleziona una pagina per continuare","error");return}ye("success"),setTimeout(()=>{M==="facebook"?(y(!0),he(te)):I(!0),ee(null),se(`${M} collegato a "${te}"!`,"success")},1e3)},ae=async h=>{if(!g&&!T){se("Nessun account social collegato! Collega Facebook o Instagram prima di pubblicare.","error");return}const C=[];g&&C.push("Facebook"),T&&C.push("Instagram"),await ue("Pubblica Post",`Pubblicare questo post su ${C.join(" e ")}?`)&&(se("Pubblicazione in corso...","info"),setTimeout(()=>{se(` Post pubblicato con successo su ${C.join(" e ")}!`,"success")},2e3))},_e=()=>{if(!c.title||!c.discountValue)return;const h={id:c.id||Date.now().toString(),title:c.title,description:c.description||"",discountType:c.discountType||"percentage",discountValue:parseFloat(c.discountValue.toString()),active:c.active??!0,target:c.target||"all",targetValue:c.targetValue,startDate:c.startDate,endDate:c.endDate};c.id?xl(h):W0(h),l(!1),d({})};return e.jsxs("div",{className:"max-w-7xl mx-auto animate-fade-in pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-black text-white mb-2 flex items-center gap-3",children:[e.jsx("div",{className:"bg-pink-600/20 p-2 rounded-xl text-pink-500",children:e.jsx(Zl,{size:32})}),"Marketing Suite"]}),e.jsx("p",{className:"text-slate-400",children:"Coinvolgi i clienti ai tavoli con promozioni mirate e social engagement."})]}),e.jsxs("div",{className:"flex gap-2 bg-slate-900 p-1.5 rounded-xl border border-slate-800",children:[e.jsxs("button",{onClick:()=>t("campaigns"),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2 ${s==="campaigns"?"bg-pink-600 text-white shadow-lg shadow-pink-900/20":"text-slate-400 hover:text-white"}`,children:[e.jsx(tn,{size:16})," Campagne"]}),e.jsxs("button",{onClick:()=>t("automations"),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2 ${s==="automations"?"bg-indigo-600 text-white shadow-lg shadow-indigo-900/20":"text-slate-400 hover:text-white"}`,children:[e.jsx(sn,{size:16})," Automazioni"]}),e.jsxs("button",{onClick:()=>t("social"),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2 ${s==="social"?"bg-blue-600 text-white shadow-lg shadow-blue-900/20":"text-slate-400 hover:text-white"}`,children:[e.jsx(Ia,{size:16})," Social Media"]})]})]}),s==="campaigns"&&e.jsxs("div",{className:"animate-slide-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(Nd,{className:"text-pink-400"})," Campagne Attive"]}),e.jsxs("button",{onClick:()=>{d({}),l(!0)},className:"bg-pink-600 hover:bg-pink-500 text-white px-4 py-2 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg shadow-pink-900/20 transition-all hover:scale-105 active:scale-95",children:[e.jsx(gs,{size:18})," Nuova Promo"]})]}),o&&e.jsxs("div",{className:"mb-8 bg-slate-900 border border-slate-800 p-6 rounded-2xl shadow-xl animate-fade-in relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-pink-500"}),e.jsx("h4",{className:"font-bold text-white mb-6 text-lg border-b border-slate-800 pb-2",children:c.id?"Modifica Promozione":"Crea Nuova Promozione"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Titolo Promo"}),e.jsx("input",{type:"text",value:c.title||"",onChange:h=>d({...c,title:h.target.value}),placeholder:"Es. Sconto Pranzo, Happy Hour...",className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-pink-500 outline-none font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Tipo Sconto"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:c.discountType||"percentage",onChange:h=>d({...c,discountType:h.target.value}),className:"bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-pink-500 outline-none font-bold flex-1",children:[e.jsx("option",{value:"percentage",children:"Percentuale (%)"}),e.jsx("option",{value:"fixed_amount",children:"Importo Fisso ()"})]}),e.jsx("input",{type:"number",value:c.discountValue||"",onChange:h=>d({...c,discountValue:parseFloat(h.target.value)}),placeholder:"0",className:"w-24 bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-pink-500 outline-none font-black text-center"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Messaggio per il cliente"}),e.jsx("textarea",{value:c.description||"",onChange:h=>d({...c,description:h.target.value}),placeholder:"Testo che apparir nel banner...",className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-pink-500 outline-none h-20 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Target (A chi mostrarlo?)"}),e.jsxs("select",{value:c.target||"all",onChange:h=>d({...c,target:h.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-pink-500 outline-none font-bold",children:[e.jsx("option",{value:"all",children:"Tutti i Tavoli"}),e.jsx("option",{value:"table_spend_above",children:"Chi spende pi di..."}),e.jsx("option",{value:"specific_items",children:"Se ordinano..."})]})]}),c.target==="table_spend_above"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Soglia Spesa ()"}),e.jsx("input",{type:"number",value:c.targetValue||"",onChange:h=>d({...c,targetValue:parseFloat(h.target.value)}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-pink-500 outline-none font-bold"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>l(!1),className:"px-6 py-2 rounded-xl bg-slate-800 text-slate-300 font-bold hover:bg-slate-700",children:"Annulla"}),e.jsxs("button",{onClick:_e,className:"px-6 py-2 rounded-xl bg-pink-600 text-white font-bold hover:bg-pink-500 shadow-lg shadow-pink-900/20 flex items-center gap-2",children:[e.jsx(is,{size:18})," Salva"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.length===0&&!o&&e.jsxs("div",{className:"col-span-full text-center py-20 bg-slate-900/50 rounded-3xl border border-dashed border-slate-800",children:[e.jsx(tn,{size:48,className:"mx-auto text-slate-600 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-400",children:"Nessuna Promozione Attiva"}),e.jsx("p",{className:"text-slate-500 text-sm mb-6",children:"Crea la tua prima campagna per aumentare le vendite."}),e.jsx("button",{onClick:()=>{d({}),l(!0)},className:"bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl font-bold",children:"Inizia Ora"})]}),a.map(h=>e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 hover:border-pink-500/50 transition-all group relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 right-0 px-3 py-1 text-[10px] font-bold uppercase rounded-bl-xl ${h.active?"bg-green-500/20 text-green-400":"bg-slate-800 text-slate-500"}`,children:h.active?"Attiva":"Pausa"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-white text-lg",children:h.title}),e.jsx("p",{className:"text-slate-400 text-sm line-clamp-2",children:h.description})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-950 p-3 rounded-xl border border-slate-800",children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Sconto"}),e.jsx("p",{className:"text-2xl font-black text-pink-500",children:h.discountType==="percentage"?`${h.discountValue}%`:`${h.discountValue}`})]}),e.jsxs("div",{className:"bg-slate-950 p-3 rounded-xl border border-slate-800 flex-1",children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Target"}),e.jsx("p",{className:"text-sm font-medium text-white",children:h.target==="all"?"Tutti i Tavoli":h.target==="table_spend_above"?`Spesa > ${h.targetValue}`:"Prodotti Specifici"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{d(h),l(!0)},className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white py-2 rounded-lg font-bold text-xs flex items-center justify-center gap-2",children:[e.jsx(Js,{size:14})," Modifica"]}),e.jsx("button",{onClick:()=>xl({...h,active:!h.active}),className:`flex-1 py-2 rounded-lg font-bold text-xs flex items-center justify-center gap-2 ${h.active?"bg-yellow-600/20 text-yellow-400 hover:bg-yellow-600/30":"bg-green-600/20 text-green-400 hover:bg-green-600/30"}`,children:h.active?"Pausa":"Attiva"}),e.jsx("button",{onClick:()=>H0(h.id),className:"w-10 bg-red-900/20 hover:bg-red-600 text-red-500 hover:text-white rounded-lg flex items-center justify-center transition-colors",children:e.jsx(Lt,{size:14})})]})]},h.id))]})]}),s==="automations"&&e.jsxs("div",{className:"animate-slide-up",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-900/50 to-slate-900 p-8 rounded-3xl border border-indigo-500/30 mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black text-white mb-2",children:"Automazioni Smart"}),e.jsx("p",{className:"text-indigo-200",children:"Definisci regole per aumentare ticket medio e fidelizzazione."})]}),e.jsx("div",{className:"bg-indigo-600 p-4 rounded-2xl shadow-lg shadow-indigo-600/20",children:e.jsx(sn,{size:32,className:"text-white"})})]}),o&&u.id&&e.jsxs("div",{className:"mb-8 bg-slate-900 border border-slate-800 p-6 rounded-2xl shadow-xl animate-fade-in relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-indigo-500"}),e.jsxs("h4",{className:"font-bold text-white mb-4 text-lg",children:["Configura ",u.title]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[u.type==="birthday_promo"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Sconto Regalo"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:((Ge=u.config)==null?void 0:Ge.discountType)||"percentage",onChange:h=>v({...u,config:{...u.config,discountType:h.target.value}}),className:"bg-slate-950 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none font-bold",children:[e.jsx("option",{value:"percentage",children:"%"}),e.jsx("option",{value:"fixed_amount",children:""})]}),e.jsx("input",{type:"number",value:((we=u.config)==null?void 0:we.discountValue)||"",onChange:h=>v({...u,config:{...u.config,discountValue:parseFloat(h.target.value)}}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none font-bold"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Messaggio di Auguri"}),e.jsx("textarea",{value:((ze=u.config)==null?void 0:ze.message)||"",onChange:h=>v({...u,config:{...u.config,message:h.target.value}}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none h-20 resize-none"})]})]}),u.type==="review_request"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Piattaforme Target"}),e.jsxs("select",{value:((z=u.config)==null?void 0:z.reviewPlatform)||"all",onChange:h=>v({...u,config:{...u.config,reviewPlatform:h.target.value}}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white outline-none font-bold mb-4",children:[e.jsx("option",{value:"all",children:"Google & TripAdvisor"}),e.jsx("option",{value:"google",children:"Solo Google"}),e.jsx("option",{value:"tripadvisor",children:"Solo TripAdvisor"})]})]}),u.type==="happy_hour"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Inizio"}),e.jsx("input",{type:"time",value:((P=u.config)==null?void 0:P.startTime)||"18:00",onChange:h=>v({...u,config:{...u.config,startTime:h.target.value}}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Fine"}),e.jsx("input",{type:"time",value:((_=u.config)==null?void 0:_.endTime)||"20:00",onChange:h=>v({...u,config:{...u.config,endTime:h.target.value}}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none font-bold"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{l(!1),v({})},className:"px-4 py-2 rounded-xl bg-slate-800 text-slate-300 font-bold hover:bg-slate-700",children:"Chiudi"}),e.jsx("button",{onClick:ne,className:"px-4 py-2 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 shadow-lg shadow-indigo-900/20",children:"Salva Configurazione"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:n.map(h=>{var C,L,le,G,me,pe;return e.jsxs("div",{className:`bg-slate-900 border border-slate-800 p-6 rounded-2xl transition-all ${h.isActive?"border-indigo-500/50 shadow-lg shadow-indigo-900/20":"opacity-75"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${h.type==="birthday_promo"?"bg-orange-600/20 text-orange-400":h.type==="review_request"?"bg-purple-600/20 text-purple-400":h.type==="happy_hour"?"bg-pink-600/20 text-pink-400":"bg-green-600/20 text-green-400"}`,children:h.type==="birthday_promo"?e.jsx(tn,{size:20}):h.type==="review_request"?e.jsx(di,{size:20}):h.type==="happy_hour"?e.jsx(Ze,{size:20}):e.jsx(dr,{size:20})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{v(h),l(!0)},className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(Js,{size:16})}),e.jsx("div",{onClick:()=>ie(h),className:`cursor-pointer px-2 py-1 text-[10px] font-bold uppercase rounded flex items-center gap-1 transition-colors ${h.isActive?"bg-green-900/30 text-green-400 hover:bg-green-900/50":"bg-slate-800 text-slate-500 hover:bg-slate-700"}`,children:h.isActive?"ATTIVO":"PAUSA"})]})]}),e.jsx("h4",{className:"font-bold text-white text-lg mb-2",children:h.title}),e.jsxs("p",{className:"text-sm text-slate-400 mb-4 h-10",children:[h.type==="birthday_promo"&&`Regala ${((C=h.config)==null?void 0:C.discountType)==="percentage"?h.config.discountValue+"%":""+((L=h.config)==null?void 0:L.discountValue)} di sconto ai festeggiati.`,h.type==="review_request"&&`Richiedi recensioni su ${((le=h.config)==null?void 0:le.reviewPlatform)==="all"?"Google & TripAdvisor":(G=h.config)==null?void 0:G.reviewPlatform} dopo il pagamento.`,h.type==="happy_hour"&&`Attiva promozioni speciali dalle ${(me=h.config)==null?void 0:me.startTime} alle ${(pe=h.config)==null?void 0:pe.endTime}.`,h.type==="smart_upsell"&&"Suggerisci prodotti aggiuntivi in base all'ordine."]})]},h.id)})})]}),s==="social"&&e.jsxs("div",{className:"animate-slide-up",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-700 shadow-xl",children:[e.jsxs("h3",{className:"font-bold text-white text-lg mb-6 flex items-center gap-2",children:[e.jsx(Ia,{className:"text-blue-500"})," Generatore Post AI"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Argomento del Post"}),e.jsx("textarea",{value:j,onChange:h=>w(h.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-xl p-4 text-white text-sm outline-none focus:border-blue-500 resize-none h-24",placeholder:"Es. Nuova pizza speciale con tartufo..."})]}),e.jsxs("div",{className:"p-4 border-2 border-dashed border-slate-700 rounded-xl relative hover:border-blue-500 transition-colors group",children:[e.jsx("input",{type:"file",onChange:re,accept:"image/*",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsxs("div",{className:"text-center text-slate-500 group-hover:text-blue-400",children:[e.jsx(xn,{className:"mx-auto mb-2"}),e.jsx("p",{className:"text-xs font-bold",children:"Carica una foto del piatto"})]})]}),A&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase font-bold text-slate-500 mb-1",children:"Scritta in sovraimpressione (Grafica)"}),e.jsx("input",{type:"text",value:Z,onChange:h=>F(h.target.value),placeholder:"Es. SCONTO 50% OGGI",className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-pink-500 outline-none font-black"})]}),e.jsxs("button",{onClick:V,disabled:E||!j,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[E?e.jsx($t,{className:"animate-spin"}):e.jsx(sn,{size:18}),E?"L'AI sta scrivendo...":"Genera Post e Caption"]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"aspect-square bg-slate-950 rounded-xl border border-slate-800 relative overflow-hidden flex items-center justify-center group/preview",children:A?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:A,alt:"Post Preview",className:"w-full h-full object-cover"}),H&&e.jsx("div",{className:"absolute top-4 left-4 w-12 h-12 bg-white rounded-full p-1 shadow-lg z-20",children:e.jsx("img",{src:H,alt:"Logo",className:"w-full h-full object-cover rounded-full"})}),e.jsx("button",{onClick:()=>B(null),className:"absolute top-4 right-4 bg-red-600 text-white p-2 rounded-full shadow-lg opacity-0 group-hover/preview:opacity-100 transition-opacity z-30 hover:bg-red-500",title:"Rimuovi immagine",children:e.jsx(Xe,{size:16})}),Z&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 pointer-events-none",children:e.jsx("h2",{className:"text-3xl md:text-4xl font-black text-white uppercase text-center drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)] px-4 leading-tight transform -rotate-2 border-4 border-white p-4",children:Z})})]}):e.jsxs("div",{className:"text-slate-600 text-center p-4",children:[e.jsx(ir,{size:40,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:"Anteprima visuale"})]})})})]}),N&&e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 animate-fade-in relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("p",{className:"text-[10px] uppercase font-bold text-blue-400 flex items-center gap-1",children:[e.jsx(Ja,{size:12})," Suggerimento AI"]}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(N),className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white",title:"Copia",children:e.jsx(_a,{size:14})})]}),e.jsx("textarea",{readOnly:!0,value:N,className:"w-full bg-transparent text-slate-300 text-sm outline-none resize-none h-48 scrollbar-thin scrollbar-thumb-slate-700"})]}),(N||A)&&e.jsxs("button",{onClick:$e,className:"w-full mt-4 bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 rounded-xl border border-slate-600 flex items-center justify-center gap-2 transition-all",children:[e.jsx(is,{size:18})," ",S?"Salva Modifiche":"Salva in Bacheca"]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:"Account Collegati"}),e.jsxs("button",{onClick:()=>xe("facebook"),className:`w-full p-4 bg-slate-900 border ${g?"border-blue-500 bg-blue-900/10":"border-slate-800"} rounded-2xl flex items-center justify-between hover:border-blue-600 group transition-all`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg text-white",children:e.jsx(Na,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-white",children:"Facebook Page"}),e.jsx("p",{className:"text-xs text-slate-500",children:g?`Collegato a: ${X||"Pagina Ristorante"}`:"Non collegato"})]})]}),e.jsx("div",{className:`px-3 py-1 text-[10px] font-bold rounded transition-colors ${g?"bg-green-500/20 text-green-400":"bg-slate-800 text-slate-400 group-hover:bg-blue-600 group-hover:text-white"}`,children:g?"CONNESSO":"CONNETTI"})]}),e.jsxs("button",{onClick:()=>xe("instagram"),className:`w-full p-4 bg-slate-900 border ${T?"border-pink-500 bg-pink-900/10":"border-slate-800"} rounded-2xl flex items-center justify-between hover:border-pink-600 group transition-all`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-pink-600 rounded-lg text-white",children:e.jsx(ya,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-white",children:"Instagram Business"}),e.jsx("p",{className:"text-xs text-slate-500",children:T?"Collegato":"Non collegato"})]})]}),e.jsx("div",{className:`px-3 py-1 text-[10px] font-bold rounded transition-colors ${T?"bg-green-500/20 text-green-400":"bg-slate-800 text-slate-400 group-hover:bg-pink-600 group-hover:text-white"}`,children:T?"CONNESSO":"CONNETTI"})]})]})]}),e.jsxs("div",{className:"mt-12",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(ir,{className:"text-purple-400"})," Bacheca Post Salvati"]}),x.length===0?e.jsx("div",{className:"text-center py-10 border border-dashed border-slate-700 rounded-2xl bg-slate-900/50",children:e.jsx("p",{className:"text-slate-500",children:"Nessun post salvato. Generane uno nuovo sopra!"})}):e.jsx("div",{className:"flex flex-col gap-6 w-full",children:x.map(h=>e.jsx(_x,{post:h,logoUrl:H,onPublish:ae,onEdit:k,onDelete:Q},h.id))})]})]}),M&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 rounded-2xl border border-slate-700 w-full max-w-md overflow-hidden shadow-2xl scale-100 animate-scale-in",children:[e.jsxs("div",{className:"bg-slate-950 p-4 border-b border-slate-800 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[M==="facebook"?e.jsx(Na,{className:"text-blue-600"}):e.jsx(ya,{className:"text-pink-600"}),"Connetti ",M==="facebook"?"Facebook":"Instagram"]}),e.jsx("button",{onClick:()=>ee(null),className:"text-slate-500 hover:text-white",children:e.jsx(Xe,{size:20})})]}),e.jsxs("div",{className:"p-6",children:[ge==="login"&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-800 rounded-full mx-auto flex items-center justify-center mb-4",children:M==="facebook"?e.jsx(Na,{size:32,className:"text-blue-500"}):e.jsx(ya,{size:32,className:"text-pink-500"})}),e.jsx("p",{className:"text-slate-300",children:"Per pubblicare automaticamente i post, devi autorizzare RistoSync a gestire la tua Pagina."}),e.jsxs("button",{onClick:fe,className:`w-full py-3 rounded-xl font-bold text-white shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2
                                        ${M==="facebook"?"bg-[#1877F2] hover:bg-[#166fe5]":"bg-gradient-to-r from-purple-500 to-pink-500 hover:opacity-90"}`,children:["Continua con ",M==="facebook"?"Facebook":"Instagram"]}),e.jsx("div",{className:"pt-4 border-t border-slate-800",children:e.jsx("button",{onClick:()=>ye("api_config"),className:"text-xs text-slate-500 hover:text-white underline",children:"Ho gi un Token API (Configurazione Avanzata)"})})]}),ge==="select_page"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsx("h4",{className:"font-bold text-white",children:"Seleziona la Pagina da gestire:"}),ce.length===0?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx($t,{className:"animate-spin text-slate-500"})}):e.jsx("div",{className:"space-y-2",children:ce.map(h=>e.jsxs("div",{onClick:()=>p(h),className:`p-3 rounded-xl border cursor-pointer flex items-center justify-between transition-all ${te===h?"bg-blue-600/20 border-blue-500":"bg-slate-950 border-slate-800 hover:border-slate-600"}`,children:[e.jsx("span",{className:"text-white font-medium",children:h}),te===h&&e.jsx(Le,{size:18,className:"text-blue-400"})]},h))}),e.jsx("button",{onClick:Ce,disabled:!te,className:"w-full mt-4 py-3 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Conferma e Collega"})]}),ge==="api_config"&&e.jsxs("div",{className:"space-y-4 animate-fade-in text-left",children:[e.jsx("h4",{className:"font-bold text-white",children:"Configurazione Manuale API"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Inserisci il Page ID e l'Access Token a lunga durata."}),e.jsxs("div",{className:"bg-blue-900/20 border border-blue-800 p-3 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-blue-300 mb-2",children:"Non sai dove trovare questi dati? Usa il Graph API Explorer di Facebook."}),e.jsxs("a",{href:"https://developers.facebook.com/tools/explorer/",target:"_blank",rel:"noopener noreferrer",className:"text-[10px] font-bold text-blue-400 hover:text-white flex items-center gap-1 underline",children:["Apri Graph API Explorer ",e.jsx(_d,{size:10})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 block mb-1",children:"Page ID / User ID"}),e.jsx("input",{type:"text",placeholder:"e.g. 10492819283",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none",id:"manualPageId"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 block mb-1",children:"Access Token (Long-Lived)"}),e.jsx("input",{type:"password",placeholder:"EAAG...",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none",id:"manualToken"})]}),e.jsx("button",{onClick:async()=>{var L;const h=document.getElementById("manualPageId").value,C=document.getElementById("manualToken").value;if(!h||!C){se("Inserisci sia il Page ID che il Token","error");return}try{const le=It();le.restaurantProfile||(le.restaurantProfile={}),le.restaurantProfile.socialApiConfig={facebookPageId:h,facebookAccessToken:C,instagramUserId:(L=le.restaurantProfile.socialApiConfig)==null?void 0:L.instagramUserId},await Cs(le),M==="facebook"?(y(!0),he(`Pagina ID: ${h}`)):I(!0),ye("success"),se("API Token salvato con successo!","success"),setTimeout(()=>{ee(null)},1500)}catch(le){console.error("Save failed",le),se("Errore nel salvataggio impostazioni","error")}},className:"w-full mt-2 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold transition-all",children:"Salva e Connetti"}),e.jsx("button",{onClick:()=>ye("login"),className:"w-full py-2 text-slate-500 text-sm hover:text-white",children:"Indietro"})]}),ge==="success"&&e.jsxs("div",{className:"text-center py-8 animate-fade-in",children:[e.jsx(Le,{size:48,className:"text-green-500 mx-auto mb-4"}),e.jsx("h4",{className:"font-bold text-white text-xl",children:"Collegamento Riuscito!"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Ora puoi pubblicare direttamente sulla pagina."})]})]})]})})]})}const Sx={Glutine:Bi,Latticini:Ui,Uova:Mi,"Frutta a guscio":Li,Pesce:$i,Soia:Di,Piccante:zi,Vegano:Pi},Ex=[J.ANTIPASTI,J.PRIMI,J.SECONDI,J.PIZZE,J.PANINI,J.DOLCI,J.BEVANDE,J.MENU_COMPLETO];function ri({menuItems:s,restaurantProfile:t,publicUrl:a,onClose:r}){const n=()=>{window.print()},i=Ex.reduce((o,l)=>{const c=s.filter(d=>d.category===l);return c.length>0&&(o[l]=c),o},{});return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-slate-900 overflow-auto flex flex-col items-center",children:[e.jsxs("div",{className:"print:hidden fixed top-0 left-0 right-0 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 p-4 flex items-center justify-between z-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tt,{className:"text-orange-500",size:24}),e.jsx("h1",{className:"text-white font-bold text-lg",children:"Anteprima Menu Stampabile (A5)"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:n,className:"px-6 py-2 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-bold rounded-xl transition-all shadow-lg flex items-center gap-2",children:" Stampa"}),e.jsx("button",{onClick:r,className:"px-6 py-2 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors",children:" Chiudi"})]})]}),e.jsxs("div",{className:"pt-24 pb-20 print:pt-0 print:pb-0 w-full max-w-[14.8cm] print:max-w-none mx-auto",children:[e.jsxs("div",{className:"bg-white text-slate-900 w-full aspect-[148/210] shadow-2xl mb-8 print:mb-0 print:shadow-none print:w-full print:h-screen print:break-after-page flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"w-full h-32 bg-slate-950 relative shrink-0",children:[e.jsx("div",{className:"absolute inset-0 opacity-20 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-transparent"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-3 bg-orange-500 shadow-lg z-10"})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-12 text-center -mt-8 relative z-20",children:[e.jsx("div",{className:"mb-8 drop-shadow-xl",children:t.logo?e.jsx("img",{src:t.logo,alt:"Logo",className:"max-w-[200px] max-h-[200px] object-contain"}):e.jsx("div",{className:"text-orange-500",children:e.jsx(tt,{size:120,strokeWidth:1.5})})}),e.jsx("h1",{className:"text-5xl font-black text-slate-900 uppercase tracking-tighter mb-4 leading-[0.9]",children:t.name||"Ristorante Demo"}),e.jsx("div",{className:"w-12 h-1.5 bg-slate-200 rounded-full mb-6"}),t.description&&e.jsx("div",{className:"max-w-[80%]",children:e.jsxs("p",{className:"text-xl text-slate-500 font-serif italic leading-relaxed",children:['"',t.description.substring(0,80),t.description.length>80?"...":"",'"']})})]}),e.jsxs("div",{className:"shrink-0 bg-slate-50 border-t border-slate-100 p-8 flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-sm font-black text-slate-900 uppercase tracking-wide mb-1",children:"Menu Digitale"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Scansiona per ordinare"}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-[10px] font-bold text-orange-600 uppercase",children:[e.jsx(Ca,{size:12})," ",a.replace(/^https?:\/\//,"")]})]}),e.jsx("div",{className:"bg-white p-2 rounded-lg border border-slate-200 shadow-sm",children:e.jsx(wr,{value:a,size:90})})]})]}),e.jsxs("div",{className:"bg-white text-slate-900 w-full min-h-[21cm] shadow-2xl print:shadow-none print:w-full p-8 print:p-8",children:[t.description&&e.jsxs("div",{className:"mb-12 pb-8 border-b border-slate-100 text-center print:break-inside-avoid",children:[e.jsx("h3",{className:"text-xl font-black text-slate-800 mb-4 font-serif italic",children:"La Nostra Storia"}),e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed font-serif italic px-4",children:t.description}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center text-orange-400 mx-auto mt-6",children:e.jsx("span",{className:"font-serif text-lg",children:""})})]}),e.jsx("div",{className:"space-y-12",children:Object.entries(i).map(([o,l])=>e.jsxs("section",{className:"print:break-inside-avoid-page",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6 sticky top-0 bg-white z-10 py-2",children:[e.jsx("div",{className:"h-8 w-1.5 bg-orange-500 rounded-r"}),e.jsx("h2",{className:"text-2xl font-black text-orange-600 uppercase tracking-tight flex-1",children:o}),e.jsx("div",{className:"text-xs text-orange-300 font-bold uppercase tracking-widest hidden print:block",children:""}),e.jsx("div",{className:"h-[2px] w-12 bg-orange-200"})]}),e.jsx("div",{className:"space-y-6",children:l.map(c=>e.jsxs("div",{className:"print:break-inside-avoid relative flex gap-5",children:[c.image&&e.jsx("div",{className:"w-[85px] h-[85px] shrink-0 print:w-[25mm] print:h-[25mm]",children:e.jsx("img",{src:c.image,alt:c.name,className:"w-full h-full object-cover rounded-md bg-slate-50"})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1 border-b border-dashed border-slate-200 pb-1",children:[e.jsx("h3",{className:"text-base font-bold text-slate-900 leading-tight w-[80%] uppercase tracking-tight",children:c.name}),e.jsxs("span",{className:"text-base font-bold text-orange-600 font-mono whitespace-nowrap",children:[" ",c.price.toFixed(2)]})]}),e.jsx("div",{className:"text-xs text-slate-600 leading-snug",children:(c.description||c.ingredients)&&e.jsxs("p",{className:"mb-1 text-slate-500 font-medium",children:[c.description,c.description&&c.ingredients&&" - ",c.ingredients&&e.jsx("span",{className:"italic text-slate-400",children:c.ingredients})]})}),c.allergens&&c.allergens.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:c.allergens.map(d=>{const u=Sx[d];return u?e.jsxs("div",{className:"flex items-center gap-0.5 text-[9px] text-slate-400 uppercase tracking-wider font-bold",title:d,children:[e.jsx(u,{size:10,className:"text-orange-400"}),e.jsx("span",{className:"print:hidden",children:d})]},d):null})})]})]},c.id))}),e.jsx("div",{className:"h-4"})]},o))}),e.jsx("div",{className:"mt-12 pt-6 border-t border-slate-100 text-center opacity-60",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-[10px] text-slate-500 font-medium uppercase tracking-wider",children:[t.website&&e.jsx("span",{children:t.website}),t.phoneNumber&&e.jsxs("span",{children:["Tel: ",t.phoneNumber]})]})})]})]}),e.jsx("style",{children:`
                @media print {
                    @page {
                        size: A5;
                        margin: 0;
                    }
                    body {
                        -webkit-print-color-adjust: exact !important;
                        print-color-adjust: exact !important;
                        background: white;
                    }
                    /* Nascondi scrollbar e UI browser */
                    ::-webkit-scrollbar { display: none; }
                    
                    /* Forza interruzioni */
                    .print\\:break-after-page {
                        break-after: page;
                        page-break-after: always;
                    }
                    .print\\:break-inside-avoid {
                        break-inside: avoid;
                        page-break-inside: avoid;
                    }
                    .print\\:break-inside-avoid-page {
                        break-inside: avoid-page;
                        page-break-inside: avoid;
                    }
                    
                    /* Resetta padding/margini contenitori */
                    .print\\:pt-0 { padding-top: 0 !important; }
                    .print\\:pb-0 { padding-bottom: 0 !important; }
                    .print\\:shadow-none { box-shadow: none !important; }
                    .print\\:w-full { width: 100% !important; max-width: none !important; }
                    .print\\:h-screen { height: 100vh !important; }
                    .print\\:block { display: block !important; }
                    .print\\:p-8 { padding: 20mm !important; } /* Margini sicuri A5 */
                    
                    /* Nascondi tutto il resto dell'app */
                    #root > *:not([class*="fixed"]) {
                        display: none;
                    }
                }
            `})]})}function Cx({restaurantProfile:s,publicUrl:t,onClose:a}){const r=()=>{window.print()};return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-slate-900 overflow-auto flex flex-col items-center",children:[e.jsxs("div",{className:"print:hidden fixed top-0 left-0 right-0 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 p-4 flex items-center justify-between z-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Kt,{className:"text-orange-500",size:24}),e.jsx("h1",{className:"text-white font-bold text-lg",children:"Locandina Delivery (A5)"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:r,className:"px-6 py-2 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-bold rounded-xl transition-all shadow-lg flex items-center gap-2",children:" Stampa / PDF"}),e.jsx("button",{onClick:a,className:"px-6 py-2 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors",children:" Chiudi"})]})]}),e.jsx("div",{className:"pt-24 pb-20 print:pt-0 print:pb-0 w-full max-w-[14.8cm] print:max-w-none mx-auto",children:e.jsxs("div",{className:"bg-white text-slate-900 w-full aspect-[148/210] shadow-2xl print:shadow-none print:w-full print:h-screen flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"w-full h-24 bg-slate-950 relative shrink-0 flex items-center justify-center overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-20 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 to-transparent"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 bg-orange-500 z-10"}),e.jsxs("div",{className:"relative z-20 flex items-center gap-2 text-white/90",children:[e.jsx(Kt,{size:20,className:"text-orange-500"}),e.jsx("span",{className:"font-black tracking-[0.3em] text-sm uppercase",children:"Official Delivery"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center p-8 text-center bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] from-slate-50 to-white",children:[e.jsx("div",{className:"mb-6 mt-4 h-32 flex items-center justify-center",children:s.logo?e.jsx("img",{src:s.logo,alt:"Logo",className:"max-h-full max-w-[200px] object-contain drop-shadow-xl"}):e.jsx(tt,{size:80,className:"text-slate-800",strokeWidth:1.5})}),e.jsx("h1",{className:"text-4xl font-black text-slate-900 uppercase tracking-tighter mb-2 leading-none",children:s.name||"Ristorante Demo"}),e.jsx("div",{className:"w-16 h-1 bg-orange-500 rounded-full mb-8"}),e.jsxs("div",{className:"w-full bg-white rounded-2xl border-2 border-slate-100 shadow-xl p-8 flex flex-col items-center relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-orange-500 via-red-500 to-orange-500"}),e.jsx("h2",{className:"text-3xl font-black italic text-slate-900 mb-2 tracking-tight",children:"ORDINA ORA!"}),e.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase tracking-wide mb-6",children:"Scansiona il QR Code per il Menu"}),e.jsxs("div",{className:"p-2 bg-white rounded-xl border border-slate-100 shadow-sm relative",children:[e.jsx("div",{className:"absolute -top-3 -right-3 bg-red-600 text-white text-[9px] font-black px-2 py-0.5 rounded shadow-sm uppercase animate-pulse",children:"Scan Me"}),e.jsx(wr,{value:t,size:150})]})]})]}),e.jsx("div",{className:"bg-slate-50 border-t border-slate-100 p-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[s.phoneNumber&&e.jsxs("div",{className:"flex items-center gap-2 text-xl font-bold text-slate-800",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-900",children:e.jsx(pn,{size:14,fill:"currentColor"})}),s.phoneNumber]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 font-bold uppercase tracking-wider bg-white px-3 py-1 rounded-full border border-slate-100 shadow-sm",children:[e.jsx(Ca,{size:12,className:"text-orange-500"})," ",t.replace(/^https?:\/\//,"")]})]})})]})}),e.jsx("style",{children:`
                @media print {
                    @page {
                        size: A5;
                        margin: 0;
                    }
                    body {
                        -webkit-print-color-adjust: exact !important;
                        print-color-adjust: exact !important;
                        background: white;
                    }
                    /* Nascondi scrollbar e UI browser */
                    ::-webkit-scrollbar { display: none; }
                    
                    /* Resetta padding/margini */
                    .print\\:pt-0 { padding-top: 0 !important; }
                    .print\\:pb-0 { padding-bottom: 0 !important; }
                    .print\\:shadow-none { box-shadow: none !important; }
                    .print\\:w-full { width: 100% !important; max-width: none !important; }
                    .print\\:h-screen { height: 100vh !important; }
                    
                    /* Nascondi app */
                    #root > *:not([class*="fixed"]) {
                        display: none;
                    }
                }
            `})]})}function Ix({platform:s,isNew:t=!1,onSave:a,onClose:r}){const[n,i]=m.useState(s);m.useEffect(()=>{i(s)},[s]);const o=l=>{l.preventDefault(),a(n)};return e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-3xl w-full max-w-2xl shadow-2xl overflow-hidden animate-slide-up flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 bg-slate-950 border-b border-slate-800 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-black text-white ${n.bgClass||"bg-slate-700"} transition-colors`,children:n.shortCode||"?"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-white",children:t?"Nuova Piattaforma":"Modifica Piattaforma"}),e.jsx("p",{className:"text-slate-400 text-sm",children:t?"Configura i dettagli della nuova integrazione":s.name})]})]}),e.jsx("button",{type:"button",onClick:r,className:"p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition-colors",children:e.jsx(Xe,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:e.jsxs("form",{id:"platform-form",onSubmit:o,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-slate-400 text-xs font-bold uppercase",children:"Nome Piattaforma"}),e.jsx("input",{type:"text",value:n.name,onChange:l=>i({...n,name:l.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none transition-colors",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-slate-400 text-xs font-bold uppercase",children:"Codice Breve (Sigla)"}),e.jsx("input",{type:"text",value:n.shortCode,onChange:l=>i({...n,shortCode:l.target.value.toUpperCase()}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none font-mono transition-colors",required:!0,maxLength:3,placeholder:"Es. JE"})]})]}),e.jsxs("div",{className:"bg-slate-950/50 p-6 rounded-2xl border border-slate-800 space-y-4",children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2 mb-4",children:[e.jsx(Ys,{className:"text-blue-500",size:18})," Dettagli Contratto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Merchant ID"}),e.jsxs("div",{className:"relative",children:[e.jsx(kd,{size:14,className:"absolute left-3 top-3.5 text-slate-600"}),e.jsx("input",{type:"text",value:n.merchantId||"",onChange:l=>i({...n,merchantId:l.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded-xl pl-9 pr-4 py-2.5 text-white text-sm focus:border-blue-500 outline-none transition-colors",placeholder:"Es. 123456"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Numero Contratto"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ys,{size:14,className:"absolute left-3 top-3.5 text-slate-600"}),e.jsx("input",{type:"text",value:n.contractNumber||"",onChange:l=>i({...n,contractNumber:l.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded-xl pl-9 pr-4 py-2.5 text-white text-sm focus:border-blue-500 outline-none transition-colors",placeholder:"Es. CTR-2024-X"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Commissione (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Sd,{size:14,className:"absolute left-3 top-3.5 text-slate-600"}),e.jsx("input",{type:"number",value:n.commissionPercent||"",onChange:l=>i({...n,commissionPercent:parseFloat(l.target.value)}),className:"w-full bg-slate-900 border border-slate-700 rounded-xl pl-9 pr-4 py-2.5 text-white text-sm focus:border-blue-500 outline-none transition-colors",placeholder:"Es. 15.5",step:"0.1"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"API Key (Integrazioni)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ec,{size:14,className:"absolute left-3 top-3.5 text-slate-600"}),e.jsx("input",{type:"password",value:n.apiKey||"",onChange:l=>i({...n,apiKey:l.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded-xl pl-9 pr-4 py-2.5 text-white text-sm focus:border-blue-500 outline-none transition-colors",placeholder:""})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-slate-400 text-xs font-bold uppercase",children:"Note Interne"}),e.jsx("textarea",{value:n.notes||"",onChange:l=>i({...n,notes:l.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-blue-500 outline-none min-h-[100px] transition-colors",placeholder:"Note su contatti, account manager, scadenze..."})]})]})}),e.jsxs("div",{className:"p-6 bg-slate-950 border-t border-slate-800 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:r,className:"px-6 py-3 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-colors",children:"Annulla"}),e.jsxs("button",{type:"submit",form:"platform-form",className:"px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg shadow-blue-900/20 flex items-center gap-2 transition-all hover:scale-[1.02] active:scale-[0.98]",children:[e.jsx(is,{size:20})," ",t?"Crea Piattaforma":"Salva Modifiche"]})]})]})})}const Tx=({onExit:s})=>{const[t,a]=m.useState([]),[r,n]=m.useState(12),[i,o]=m.useState(new Date),[l,c]=m.useState(null),d=()=>{a(Mt()||[]),n(jc())};m.useEffect(()=>{d();const E=()=>d();window.addEventListener("local-storage-update",E),window.addEventListener("local-settings-update",E);const O=setInterval(()=>o(new Date),1e3),A=setInterval(d,2e3);return()=>{window.removeEventListener("local-storage-update",E),window.removeEventListener("local-settings-update",E),clearInterval(O),clearInterval(A)}},[]);const u=E=>{const O=t.filter(F=>F.tableNumber===E&&F.status!==ve.DELIVERED);return O.length===0?(It().tableReservations||[]).includes(E)?"reserved":"free":O.every(F=>(F.items||[]).every(H=>H.served))?"completed":O.some(F=>(F.items||[]).some(H=>H.completed&&!H.served))?"ready":O.some(F=>(F.items||[]).some(H=>!H.completed))?"cooking":"occupied"},v=E=>{const O=t.find(A=>A.tableNumber===E&&A.status!==ve.DELIVERED);return(O==null?void 0:O.waiterName)||null},j=E=>{const O=t.filter(b=>b.tableNumber===E&&b.status!==ve.DELIVERED);if(O.length===0)return null;const A=O.reduce((b,S)=>{const K=new Date(b.createdAt||b.timestamp).getTime();return new Date(S.createdAt||S.timestamp).getTime()<K?S:b}),B=new Date(A.createdAt||A.timestamp),F=new Date().getTime()-B.getTime(),H=Math.floor(F/6e4);if(H<60)return`${H}m`;const Y=Math.floor(H/60),x=H%60;return`${Y}h ${x}m`},w=E=>{var A;return((A=It().sharedTables)==null?void 0:A[E])||[]},D=(()=>{const E={free:0,occupied:0,cooking:0,ready:0,completed:0,reserved:0};for(let O=1;O<=r;O++){const A=u(O.toString());E[A]++}return E})();return e.jsxs("div",{className:"h-screen w-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-md border-b border-slate-700 px-6 py-4 flex items-center justify-between shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(rs,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-white tracking-tight",children:"Monitor Tavoli"}),e.jsx("p",{className:"text-slate-400 text-sm font-medium",children:"Coordinamento Sala in Tempo Reale"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/50 px-4 py-2 rounded-xl border border-slate-700",children:[e.jsx(Ze,{size:20,className:"text-blue-400"}),e.jsx("span",{className:"text-white font-mono text-xl font-bold",children:i.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),e.jsxs("button",{onClick:s,className:"bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl font-bold transition-all border border-slate-600 flex items-center gap-2",children:[e.jsx(Hl,{size:20}),"Esci"]})]})]}),e.jsx("div",{className:"bg-slate-900/50 border-b border-slate-800 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-700"}),e.jsxs("span",{className:"text-slate-300 font-bold text-sm",children:["Liberi: ",D.free]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-500"}),e.jsxs("span",{className:"text-blue-300 font-bold text-sm",children:["Occupati: ",D.occupied]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-purple-500"}),e.jsxs("span",{className:"text-purple-300 font-bold text-sm",children:["Prenotati: ",D.reserved]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),e.jsxs("span",{className:"text-orange-300 font-bold text-sm",children:["In Cucina: ",D.cooking]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 animate-pulse"}),e.jsxs("span",{className:"text-green-300 font-bold text-sm",children:["Pronti: ",D.ready]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-700"}),e.jsxs("span",{className:"text-orange-300 font-bold text-sm",children:["Serviti: ",D.completed]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-8",children:e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-4 max-w-[1920px] mx-auto",children:Array.from({length:r},(E,O)=>O+1).map(E=>{const O=E.toString(),A=u(O),B=v(O),Z=j(O),F=w(O),H=F.length>0;let Y="bg-slate-800 border-slate-700",x=null,b="Libero",S="text-slate-400";return A==="occupied"&&(Y="bg-blue-900/40 border-blue-500/50",x=e.jsx(bs,{size:16,className:"text-blue-300"}),b="Occupato",S="text-blue-100"),A==="reserved"&&(Y="bg-purple-900/40 border-purple-500/50 dashed-border",x=e.jsx(wa,{size:16,className:"text-purple-300"}),b="Prenotato",S="text-purple-100"),A==="cooking"&&(Y="bg-orange-900/40 border-orange-500/50",x=e.jsx(tt,{size:16,className:"text-orange-300"}),b="In Cucina",S="text-orange-100"),A==="ready"&&(Y="bg-green-600 border-green-400 animate-pulse shadow-[0_0_20px_rgba(34,197,94,0.6)]",x=e.jsx(ot,{size:16,className:"text-white animate-bounce"}),b="PRONTO!",S="text-white"),A==="completed"&&(Y="bg-orange-700/80 border-orange-500",x=e.jsx(Le,{size:16,className:"text-orange-100"}),b="Servito",S="text-white"),e.jsxs("div",{onClick:()=>c(O),className:`aspect-square rounded-2xl border-2 flex flex-col p-2 shadow-xl transition-all relative cursor-pointer hover:scale-105 active:scale-95 ${Y} ${H?"ring-4 ring-purple-500/50":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start w-full h-6",children:[H?e.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center border-2 border-purple-400 shadow-lg",children:e.jsx(rs,{size:12,className:"text-white"})}):e.jsx("div",{}),Z&&A!=="free"&&e.jsxs("div",{className:`px-2 py-1 rounded-lg text-[10px] font-bold flex items-center gap-1 ${A==="ready"?"bg-red-500 text-white animate-pulse":"bg-black/40 backdrop-blur-sm text-white"}`,children:[e.jsx(Ze,{size:10}),Z]})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-1",children:[e.jsx("span",{className:`text-4xl font-black ${S} leading-none`,children:E}),e.jsxs("div",{className:"flex flex-col items-center",children:[x,e.jsx("span",{className:`text-[10px] font-bold ${S} uppercase tracking-wider text-center leading-tight`,children:b})]})]}),e.jsx("div",{className:"h-6 w-full flex items-end justify-center",children:B&&e.jsx("div",{className:"bg-black/40 backdrop-blur-sm rounded-lg px-2 py-0.5 text-center w-full max-w-full",children:e.jsx("p",{className:"text-white text-[10px] font-bold truncate",children:H?` ${F.join(", ")}`:` ${B}`})})})]},E)})})}),e.jsx("div",{className:"bg-slate-900/80 backdrop-blur-md border-t border-slate-700 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-8 text-xs text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{size:14,className:"text-purple-400"}),e.jsx("span",{children:"Tavolo Condiviso"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{size:14,className:"text-blue-400"}),e.jsx("span",{children:"Tempo Trascorso"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{size:14,className:"text-green-400"}),e.jsx("span",{children:"Attenzione Richiesta"})]})]})}),l&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in",onClick:()=>c(null),children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 w-full max-w-lg rounded-3xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden animate-slide-up",onClick:E=>E.stopPropagation(),children:[e.jsxs("div",{className:"bg-slate-800 p-5 border-b border-slate-700 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black text-white flex items-center gap-2",children:["Tavolo ",l,u(l)==="reserved"&&e.jsx("span",{className:"bg-purple-600 text-white text-xs px-2 py-1 rounded-full uppercase tracking-wide",children:"Prenotato"})]}),e.jsxs("p",{className:"text-slate-400 text-sm font-bold flex items-center gap-2 mt-1",children:[e.jsx(bs,{size:14})," ",v(l)||"Nessun cameriere",w(l).length>0&&e.jsxs("span",{className:"text-purple-400",children:[" (+",w(l).join(", "),")"]})]})]}),e.jsx("button",{onClick:()=>c(null),className:"w-10 h-10 bg-slate-700 hover:bg-slate-600 rounded-full flex items-center justify-center text-white transition-colors",children:e.jsx(Xe,{size:20})})]}),e.jsx("div",{className:"p-6 overflow-y-auto custom-scroll flex-1",children:t.filter(E=>E.tableNumber===l&&E.status!=="Servito").length>0?e.jsx("div",{className:"space-y-4",children:t.filter(E=>E.tableNumber===l&&E.status!=="Servito").map(E=>e.jsxs("div",{className:"bg-slate-950 border border-slate-800 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{size:14,className:"text-slate-500"}),e.jsx("span",{className:"text-xs text-slate-500 font-mono",children:new Date(E.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded-lg uppercase ${E.status==="Pronto"?"bg-green-600 text-white animate-pulse":E.status==="In Preparazione"?"bg-orange-600 text-white":"bg-slate-700 text-slate-300"}`,children:E.status})]}),e.jsx("div",{className:"space-y-2",children:E.items.map((O,A)=>e.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-slate-800/50 pb-2 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-bold text-slate-400",children:[O.quantity,"x"]}),e.jsx("span",{className:O.served?"text-slate-500 line-through decoration-slate-600":"text-white",children:O.menuItem.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O.notes&&e.jsx("span",{className:"text-[10px] bg-yellow-500/10 text-yellow-500 px-1.5 py-0.5 rounded border border-yellow-500/20 max-w-[100px] truncate",children:O.notes}),O.completed?e.jsx(Le,{size:14,className:"text-green-500"}):e.jsx("div",{className:"w-3.5 h-3.5 rounded-full border border-slate-600"})]})]},A))})]},E.id))}):e.jsxs("div",{className:"text-center py-10 text-slate-500 flex flex-col items-center",children:[e.jsx(As,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"Nessun ordine attivo"}),e.jsx("p",{className:"text-xs mt-2",children:"Il tavolo  libero o l'ordine  stato completato."})]})})]})})]})},Ll=({deadlineHours:s,lastUpdated:t})=>{const[a,r]=m.useState(null),[n,i]=m.useState(!1);return m.useEffect(()=>{if(!s||!t)return;const o=new Date(t).getTime(),l=parseInt(s)*60*60*1e3,c=o+l,d=setInterval(()=>{const u=new Date().getTime(),v=c-u;v<0?(i(!0),clearInterval(d)):r({h:Math.floor(v/(1e3*60*60)),m:Math.floor(v%(1e3*60*60)/(1e3*60)),s:Math.floor(v%(1e3*60)/1e3)})},1e3);return()=>clearInterval(d)},[s,t]),n||!a?e.jsx("div",{className:"text-xs text-red-400 font-bold uppercase mt-2",children:"Offerta Scaduta"}):e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2 bg-purple-900/50 rounded-lg py-1 px-3 border border-purple-500/30",children:[e.jsx(Ze,{size:12,className:"text-purple-400"}),e.jsxs("span",{className:"font-mono text-sm font-bold text-white tracking-widest",children:[String(a.h).padStart(2,"0"),":",String(a.m).padStart(2,"0"),":",String(a.s).padStart(2,"0")]})]})},Ax=({onNavigateToApp:s})=>{const[t,a]=m.useState(!1),[r,n]=m.useState(800),[i,o]=m.useState(4),[l,c]=m.useState(null),[d,u]=m.useState(!1),[v,j]=m.useState("59.90"),[w,N]=m.useState(null);m.useEffect(()=>{(async()=>{try{const{data:H}=q!=null&&q.storage?q.storage.from("attachments").getPublicUrl("global_pricing.json"):{data:null};if(H!=null&&H.publicUrl){const Y=await fetch(`${H.publicUrl}?t=${Date.now()}`);if(Y.ok){const x=await Y.json();x.monthlyCost&&j(x.monthlyCost),x.promo&&x.promo.active?N({...x.promo,lastUpdated:x.lastUpdated}):N(null)}}}catch(H){console.error("Failed to load dynamic pricing",H)}})()},[]);const D={privacy:{title:"Privacy Policy",content:e.jsxs("div",{className:"space-y-4 text-slate-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ultimo aggiornamento:"})," 17 Dicembre 2024"]}),e.jsx("p",{children:"Benvenuto su RistoSync AI. La tua privacy  importante per noi."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"1. Titolare del Trattamento"}),e.jsx("p",{children:'RistoSync AI ("noi", "ci"). Email: info@ristosyncai.it.'}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"2. Dati che Raccogliamo"}),e.jsx("p",{children:"Raccogliamo informazioni per fornire e migliorare il nostro Servizio: dati di registrazione (email, nome ristorante), dati di utilizzo, e dati dei menu caricati."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"3. Utilizzo dei Dati"}),e.jsx("p",{children:"Utilizziamo i tuoi dati per: fornire il servizio, migliorare l'AI, comunicazione di servizio, e obblighi legali."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"4. Contatti"}),e.jsx("p",{children:"Per qualsiasi domanda sulla privacy, contattaci a: info@ristosyncai.it"})]})},cookie:{title:"Cookie Policy",content:e.jsxs("div",{className:"space-y-4 text-slate-300",children:[e.jsx("p",{children:"RistoSync AI utilizza cookie e tecnologie simili per migliorare l'esperienza utente."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"Cosa sono i cookie?"}),e.jsx("p",{children:"File di testo salvati sul tuo dispositivo quando visiti un sito web."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"Tipologie utilizzate"}),e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Essenziali:"})," Necessari per il funzionamento del sito (es. login)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Analitici:"})," Per capire come gli utenti usano il sito e migliorarlo."]})]}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"Gestione preferenze"}),e.jsx("p",{children:"Puoi gestire le preferenze dei cookie direttamente dalle impostazioni del tuo browser."})]})},terms:{title:"Termini e Condizioni",content:e.jsxs("div",{className:"space-y-4 text-slate-300",children:[e.jsx("p",{children:"L'utilizzo di RistoSync AI  soggetto ai seguenti termini."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"1. Accettazione"}),e.jsx("p",{children:"Registrandoti al servizio, accetti questi Termini e Condizioni."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"2. Il Servizio"}),e.jsx("p",{children:`RistoSync AI  una piattaforma SaaS per la gestione della ristorazione. Il servizio  fornito "cos com'".`}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"3. Abbonamenti e Pagamenti"}),e.jsx("p",{children:"Alcune funzionalit richiedono un abbonamento a pagamento. I prezzi sono indicati nella pagina Prezzi."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"4. Responsabilit"}),e.jsx("p",{children:"Non siamo responsabili per danni indiretti derivanti dall'uso del servizio."}),e.jsx("h3",{className:"text-white font-bold text-lg mt-4",children:"5. Legge Applicabile"}),e.jsx("p",{children:"Questi termini sono regolati dalla legge italiana."})]})}};m.useEffect(()=>{const F=()=>{u(window.scrollY>50)};return window.addEventListener("scroll",F),()=>window.removeEventListener("scroll",F)},[]);const O=(()=>{const H=r*i/60,Y=H*18,x=Y*12;return{monthly:Math.round(Y),annual:Math.round(x),hours:Math.round(H)}})(),A=[{icon:e.jsx(sn,{className:"w-8 h-8"}),title:"Sync Totale 2.0",description:"Modifica un piatto e aggiorna istantaneamente Glovo, Uber Eats, Just Eat e Deliveroo. Sincronizzazione scorte in tempo reale per eliminare gli ordini rifiutati.",color:"from-orange-500 to-red-500"},{icon:e.jsx(Ao,{className:"w-8 h-8"}),title:"AI Chef Marketing",description:`L'AI scrive descrizioni "appetitose" ottimizzate per la vendita e crea automaticamente post social accattivanti dai tuoi nuovi piatti.`,color:"from-purple-500 to-pink-500"},{icon:e.jsx(mn,{className:"w-8 h-8"}),title:"Reputation Guard",description:"Centralizza Google e TripAdvisor. Il sistema risponde automaticamente alle recensioni positive e ti allerta su quelle critiche con bozze di risposta empatiche.",color:"from-blue-500 to-cyan-500"},{icon:e.jsx(fn,{className:"w-8 h-8"}),title:"Business Intelligence",description:"Report unificati su vendite, piatti top performer e orari di punta. Prevedi la domanda del weekend grazie all'analisi predittiva.",color:"from-green-500 to-emerald-500"},{icon:e.jsx(gt,{className:"w-8 h-8"}),title:"Menu Digitale QR",description:"Menu digitale interattivo con QR code personalizzato. I clienti visualizzano piatti, allergeni e descrizioni AI direttamente dal loro smartphone.",color:"from-yellow-500 to-orange-500"},{icon:e.jsx(Ze,{className:"w-8 h-8"}),title:"Gestione Ordini",description:"Display cucina intelligente con priorit automatica, timer di preparazione e notifiche real-time. Zero errori, massima efficienza.",color:"from-indigo-500 to-purple-500"}],B=[{icon:e.jsx(Ze,{className:"w-6 h-6"}),title:"Risparmia Tempo",description:"Fino a 640 ore all'anno recuperate eliminando aggiornamenti manuali su ogni piattaforma"},{icon:e.jsx(Cd,{className:"w-6 h-6"}),title:"Riduci i Costi",description:"Nessuna commissione sugli ordini. Nessun costo nascosto. Solo potenza pura."},{icon:e.jsx(rs,{className:"w-6 h-6"}),title:"Migliora il Servizio",description:"Ordini sincronizzati in cucina, tempi di preparazione ottimizzati, clienti pi soddisfatti"},{icon:e.jsx(dr,{className:"w-6 h-6"}),title:"Aumenta le Vendite",description:"Descrizioni AI ottimizzate aumentano il tasso di conversione e il valore medio dell'ordine"},{icon:e.jsx(Fi,{className:"w-6 h-6"}),title:"Proteggi la Reputazione",description:"Risposte rapide e professionali alle recensioni mantengono alto il tuo rating"},{icon:e.jsx(ft,{className:"w-6 h-6"}),title:"Tecnologia AI",description:"Intelligenza artificiale all'avanguardia per automatizzare marketing e customer care"}],Z=["Sync illimitato Delivery","AI Marketing Suite","Reputation Manager","Supporto Prioritario WhatsApp","Business Intelligence","Kitchen Display System","Aggiornamenti automatici","Backup giornaliero dati"];return e.jsxs("div",{className:"landing-page",children:[e.jsx("header",{className:`landing-header ${d?"scrolled":""}`,children:e.jsx("div",{className:"landing-container",children:e.jsxs("div",{className:"landing-header-content",children:[e.jsxs("div",{className:"landing-logo",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),style:{cursor:"pointer"},children:[e.jsx(gt,{className:"w-8 h-8 text-orange-500 logo-float"}),e.jsxs("span",{className:"landing-logo-text",children:["RISTO",e.jsx("span",{className:"text-orange-500",children:"SYNC"}),e.jsx("span",{className:"landing-logo-subtitle",children:"INTELLIGENCE"})]})]}),e.jsxs("nav",{className:`landing-nav ${t?"open":""}`,children:[e.jsx("a",{href:"#features",onClick:()=>a(!1),children:"Piattaforma"}),e.jsx("a",{href:"#roi",onClick:()=>a(!1),children:"Risparmio"}),e.jsx("a",{href:"#pricing",onClick:()=>a(!1),children:"Prezzi"}),e.jsx("a",{href:"#contact",onClick:()=>a(!1),children:"Contatti"})]}),e.jsx("button",{className:"landing-cta-button",onClick:s,children:"Accedi alla Piattaforma"}),e.jsx("button",{className:"landing-mobile-menu-toggle hidden",onClick:()=>a(!t),children:t?e.jsx(Xe,{}):e.jsx(Ed,{})}),e.jsx("button",{className:"md:hidden ml-2 p-2.5 bg-orange-500 rounded-xl shadow-lg logo-float flex items-center justify-center transition-transform active:scale-95",onClick:s,"aria-label":"Accedi all'App",children:e.jsx(tt,{className:"w-6 h-6 text-white"})})]})})}),e.jsx("section",{className:"landing-hero",children:e.jsx("div",{className:"landing-container",children:e.jsxs("div",{className:"landing-hero-content",children:[e.jsxs("div",{className:"landing-hero-text",children:[e.jsxs("div",{className:"landing-badge",children:[e.jsx("span",{className:"landing-badge-dot"}),"VERSIONE 3.0 LIVE"]}),e.jsxs("h1",{className:"landing-hero-title",children:["Il Tuo Ristorante,",e.jsx("br",{}),e.jsx("span",{className:"text-gradient",children:"Perfettamente Sincronizzato."})]}),e.jsx("p",{className:"landing-hero-subtitle",children:"Dimentica i tablet multipli. Unifica Glovo, Uber Eats, Just Eat e Deliveroo. Gestisci tutto da un'unica piattaforma intelligente."}),e.jsxs("div",{className:"landing-hero-cta",children:[e.jsxs("button",{className:"landing-button-primary",onClick:s,children:[e.jsx("span",{className:"hidden md:inline",children:"Prova Gratis 15 Giorni"}),e.jsx("span",{className:"md:hidden",children:"Prova Gratis"}),e.jsx(xs,{className:"w-5 h-5 ml-2"})]}),e.jsx("button",{className:"landing-button-secondary hidden md:flex",onClick:()=>{var F;(F=document.getElementById("roi"))==null||F.scrollIntoView({behavior:"smooth"})},children:"Calcola il Tuo Risparmio"})]}),e.jsxs("div",{className:"landing-hero-stats",children:[e.jsxs("div",{className:"landing-stat",children:[e.jsx("div",{className:"landing-stat-value",children:"640h"}),e.jsx("div",{className:"landing-stat-label",children:"Ore risparmiate/anno"})]}),e.jsxs("div",{className:"landing-stat",children:[e.jsx("div",{className:"landing-stat-value",children:"11.520"}),e.jsx("div",{className:"landing-stat-label",children:"Risparmio medio annuo"})]}),e.jsxs("div",{className:"landing-stat",children:[e.jsx("div",{className:"landing-stat-value",children:"0.5s"}),e.jsx("div",{className:"landing-stat-label",children:"Sync multicanale"})]})]})]}),e.jsx("div",{className:"landing-hero-image hidden md:block",children:e.jsxs("div",{className:"landing-mockup",children:[e.jsxs("div",{className:"landing-mockup-header",children:[e.jsx("div",{className:"landing-mockup-dot red"}),e.jsx("div",{className:"landing-mockup-dot yellow"}),e.jsx("div",{className:"landing-mockup-dot green"})]}),e.jsxs("div",{className:"landing-mockup-content",children:[e.jsxs("div",{className:"landing-mockup-sidebar",children:[e.jsxs("div",{className:"landing-mockup-menu-item active",children:[e.jsx(fn,{className:"w-4 h-4"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs("div",{className:"landing-mockup-menu-item",children:[e.jsx(gt,{className:"w-4 h-4"}),e.jsx("span",{children:"Menu"})]}),e.jsxs("div",{className:"landing-mockup-menu-item",children:[e.jsx(dr,{className:"w-4 h-4"}),e.jsx("span",{children:"Analytics"})]})]}),e.jsx("div",{className:"landing-mockup-main",children:e.jsx("div",{className:"landing-mockup-chart",children:e.jsxs("div",{className:"landing-mockup-chart-bars",children:[e.jsx("div",{className:"landing-mockup-bar bar-animate",style:{height:"60%",animationDelay:"0s"}}),e.jsx("div",{className:"landing-mockup-bar bar-animate",style:{height:"80%",animationDelay:"0.1s"}}),e.jsx("div",{className:"landing-mockup-bar bar-animate",style:{height:"45%",animationDelay:"0.2s"}}),e.jsx("div",{className:"landing-mockup-bar bar-animate",style:{height:"90%",animationDelay:"0.3s"}}),e.jsx("div",{className:"landing-mockup-bar bar-animate",style:{height:"70%",animationDelay:"0.4s"}})]})})})]})]})})]})})}),e.jsxs("div",{className:"w-full bg-gradient-to-r from-orange-600 via-red-500 to-orange-600 py-6 md:py-8 my-12 relative overflow-hidden shadow-2xl skew-y-[-2deg] transform origin-left",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"landing-container relative z-10 flex items-center justify-center",children:e.jsx("h2",{className:"text-2xl md:text-5xl font-black text-white uppercase tracking-wider text-center drop-shadow-lg skew-y-[2deg]",children:"Sincronizza il Gusto, Automatizza il Successo"})})]}),e.jsx("section",{className:"landing-section relative",children:e.jsxs("div",{className:"landing-container",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-500/10 border border-purple-500/30 text-purple-400 font-bold text-sm mb-4",children:[e.jsx(ft,{size:16})," POTENZIATO DALL'INTELLIGENZA ARTIFICIALE"]}),e.jsxs("h2",{className:"text-4xl md:text-5xl font-black text-white mb-6",children:["Il Tuo Ristorante in ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600",children:"Autopilot"})]}),e.jsx("p",{className:"text-slate-400 max-w-2xl mx-auto text-lg",children:"Un ecosistema completo che gestisce ogni aspetto del tuo business, dalla cucina al marketing, con la precisione dell'AI."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-purple-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(Ao,{className:"text-purple-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"AI Integrata"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Il sistema apprende dalle tue abitudini e ottimizza i processi automaticamente."})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-orange-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(Wl,{className:"text-orange-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Menu Automatico"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Inserimento automatizzato dei menu da foto o file CSV/PDF in pochi secondi."})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-red-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(Sa,{className:"text-red-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Avvisi Smart"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Allarmi in tempo reale per sala e cucina. Coordinamento perfetto, zero attese."})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-blue-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(Ia,{className:"text-blue-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Social Marketing"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Creazione e pubblicazione automatica di post sui tuoi canali social."})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-green-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(ir,{className:"text-green-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Sync Coordinato"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Gestione unificata tra cucina, sala e delivery. Tutti sanno cosa fare."})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-yellow-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(Ys,{className:"text-yellow-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"QR & Menu Digitali"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Genera il tuo menu digitale con QR Code aggiornato in tempo reale."})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-cyan-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-cyan-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(qs,{className:"text-cyan-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Stampa Menu A4/A5"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Esporta e stampa il tuo menu in formati professionali A4 e A5."})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl hover:border-pink-500/50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 bg-pink-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform",children:e.jsx(ft,{className:"text-pink-400 w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Locandine Delivery"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Crea automaticamente flyer accattivanti per promuovere il tuo delivery."})]})]})]})}),e.jsxs("section",{id:"features",className:"landing-section",style:{position:"relative",overflow:"hidden"},children:[e.jsx("div",{className:"floating-element",style:{position:"absolute",top:"10%",left:"5%",width:"100px",height:"100px",background:"radial-gradient(circle, rgba(255,107,53,0.15) 0%, transparent 70%)",borderRadius:"50%",animation:"float 6s ease-in-out infinite",zIndex:0}}),e.jsx("div",{className:"floating-element",style:{position:"absolute",top:"60%",right:"10%",width:"150px",height:"150px",background:"radial-gradient(circle, rgba(139,92,246,0.15) 0%, transparent 70%)",borderRadius:"50%",animation:"float 8s ease-in-out infinite reverse",zIndex:0}}),e.jsx("div",{className:"floating-element",style:{position:"absolute",bottom:"20%",left:"15%",width:"80px",height:"80px",background:"radial-gradient(circle, rgba(34,197,94,0.15) 0%, transparent 70%)",borderRadius:"50%",animation:"float 7s ease-in-out infinite",animationDelay:"2s",zIndex:0}}),e.jsxs("div",{className:"landing-container",style:{position:"relative",zIndex:1},children:[e.jsxs("div",{className:"landing-section-header",children:[e.jsx("h2",{className:"landing-section-title",children:"Tutto in Unico Hub"}),e.jsx("p",{className:"landing-section-subtitle",children:"La tecnologia enterprise resa semplice per il tuo locale."})]}),e.jsx("div",{className:"landing-features-grid",children:A.map((F,H)=>e.jsxs("div",{className:"landing-feature-card",children:[e.jsx("div",{className:`landing-feature-icon bg-gradient-to-br ${F.color}`,children:F.icon}),e.jsx("h3",{className:"landing-feature-title",children:F.title}),e.jsx("p",{className:"landing-feature-description",children:F.description})]},H))})]})]}),e.jsx("section",{className:"landing-sync-showcase",children:e.jsx("div",{className:"landing-container",children:e.jsxs("div",{className:"sync-showcase-content",children:[e.jsxs("div",{className:"sync-showcase-text",children:[e.jsxs("h2",{className:"sync-showcase-title",children:[e.jsx("span",{className:"text-gradient",children:"Menu Intelligence."}),e.jsx("br",{}),"Controllo Totale."]}),e.jsx("p",{className:"sync-showcase-description",children:"Analizza le performance di ogni piatto in tempo reale. Scopri quali ingredienti ti costano di pi, ottimizza i prezzi e massimizza i profitti con la nostra dashboard AI avanzata."}),e.jsxs("div",{className:"sync-showcase-stats",children:[e.jsxs("div",{className:"sync-stat",children:[e.jsx("div",{className:"sync-stat-value",children:"+24%"}),e.jsx("div",{className:"sync-stat-label",children:"Margine Medio"})]}),e.jsxs("div",{className:"sync-stat",children:[e.jsx("div",{className:"sync-stat-value",children:"AI"}),e.jsx("div",{className:"sync-stat-label",children:"Previsioni Vendite"})]}),e.jsxs("div",{className:"sync-stat",children:[e.jsx("div",{className:"sync-stat-value",children:"360"}),e.jsx("div",{className:"sync-stat-label",children:"Visione Business"})]})]})]}),e.jsx("div",{className:"sync-showcase-image",children:e.jsx("img",{src:"/menu-analytics.png",alt:"RistoSync Menu Analytics Dashboard",className:"sync-image"})})]})})}),e.jsx("section",{className:"landing-section landing-section-dark",children:e.jsxs("div",{className:"landing-container",children:[e.jsxs("div",{className:"landing-section-header",children:[e.jsx("h2",{className:"landing-section-title",children:"Perch RistoSync AI?"}),e.jsx("p",{className:"landing-section-subtitle",children:"Vantaggi concreti per il tuo ristorante"})]}),e.jsx("div",{className:"landing-benefits-grid",children:B.map((F,H)=>e.jsxs("div",{className:"landing-benefit-card",children:[e.jsx("div",{className:"landing-benefit-icon",children:F.icon}),e.jsx("h3",{className:"landing-benefit-title",children:F.title}),e.jsx("p",{className:"landing-benefit-description",children:F.description})]},H))})]})}),e.jsx("section",{id:"roi",className:"landing-section hidden md:block",children:e.jsx("div",{className:"landing-container",children:e.jsxs("div",{className:"landing-roi-container",children:[e.jsxs("div",{className:"landing-roi-calculator",children:[e.jsx("h2",{className:"landing-roi-title",children:"Calcolatore ROI"}),e.jsx("p",{className:"landing-roi-subtitle",children:"Inserisci i tuoi dati attuali e scopri l'impatto economico dell'automazione."}),e.jsxs("div",{className:"landing-roi-input-group",children:[e.jsxs("label",{className:"landing-roi-label",children:["Ordini Mensili",e.jsx("span",{className:"landing-roi-value",children:r})]}),e.jsx("input",{type:"range",min:"100",max:"2000",step:"50",value:r,onChange:F=>n(Number(F.target.value)),className:"landing-roi-slider"})]}),e.jsxs("div",{className:"landing-roi-input-group",children:[e.jsxs("label",{className:"landing-roi-label",children:["Minuti Persi / Ordine",e.jsxs("span",{className:"landing-roi-value",children:[i," min"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:i,onChange:F=>o(Number(F.target.value)),className:"landing-roi-slider"})]}),e.jsx("p",{className:"landing-roi-note",children:"*Basato su costo orario medio di 18,00"})]}),e.jsxs("div",{className:"landing-roi-results",children:[e.jsx("div",{className:"landing-roi-results-header",children:"RISPARMIO ANNUALE STIMATO"}),e.jsxs("div",{className:"landing-roi-results-amount",children:["",O.annual.toLocaleString()]}),e.jsxs("div",{className:"landing-roi-results-detail",children:[O.hours," ore di lavoro recuperate"]}),e.jsxs("button",{className:"landing-roi-cta",onClick:s,children:["Inizia a Risparmiare",e.jsx(xs,{className:"w-5 h-5 ml-2"})]})]})]})})}),e.jsx("section",{id:"pricing",className:"landing-section landing-section-dark",children:e.jsxs("div",{className:"landing-container",children:[e.jsxs("div",{className:"landing-section-header",children:[e.jsx("h2",{className:"landing-section-title",children:"Un Prezzo, Tutto Incluso."}),e.jsx("p",{className:"landing-section-subtitle",children:"Nessuna commissione sugli ordini. Nessun costo nascosto. Solo potenza pura."})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 justify-center items-stretch",children:[e.jsxs("div",{className:`landing-pricing-card bg-slate-900/50 border ${w?"border-purple-500/50":"border-slate-700"} relative flex-1 max-w-md overflow-hidden group`,children:[w&&e.jsx("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 z-40 w-full max-w-[260px] cursor-pointer group-hover:scale-105 transition-transform duration-300",onClick:()=>{var F;return(F=document.getElementById("pricing"))==null?void 0:F.scrollIntoView()},children:e.jsxs("div",{className:"bg-fuchsia-600 border-4 border-yellow-300 rounded-[2rem] p-5 shadow-[0_10px_40px_rgba(192,38,211,0.5)] text-center transform -rotate-3 hover:rotate-0 transition-all",children:[e.jsx("h3",{className:"text-yellow-300 font-black uppercase text-sm tracking-widest mb-1 drop-shadow-md",children:w.name}),e.jsxs("div",{className:"text-white font-black text-5xl mb-3 drop-shadow-lg tracking-tighter",children:["",w.cost]}),e.jsxs("div",{className:"bg-white rounded-xl p-2 mx-auto shadow-inner",children:[e.jsx("div",{className:"text-blue-500 text-[10px] font-black uppercase tracking-tight leading-tight",children:"OFFERTA LAMPO SCADE IN:"}),e.jsx("div",{className:"text-blue-700 font-mono font-black text-xl leading-none mt-1",children:e.jsx(Ll,{deadlineHours:w.deadlineHours||"72",lastUpdated:w.lastUpdated||new Date().toISOString()})})]})]})}),e.jsxs("div",{className:`transition-all duration-300 ${w?"opacity-40 grayscale-[0.8] blur-[1px]":""}`,children:[e.jsx("div",{className:"landing-pricing-badge",children:"STANDARD"}),e.jsxs("div",{className:"landing-pricing-amount text-white",children:[e.jsx("span",{className:"landing-pricing-currency",children:""}),e.jsx("span",{className:`landing-pricing-value ${w?"line-through decoration-red-500 decoration-4 text-slate-500":""}`,children:v}),e.jsx("span",{className:"landing-pricing-period",children:"/mese"})]}),e.jsx("div",{className:"landing-pricing-location",children:"PER LOCATION"}),e.jsx("div",{className:"landing-pricing-features space-y-3 my-8",children:Z.map((F,H)=>e.jsxs("div",{className:"landing-pricing-feature flex items-center gap-3 text-slate-300",children:[e.jsx(qa,{className:"w-5 h-5 text-orange-500 shrink-0"}),e.jsx("span",{children:F})]},H))}),e.jsxs("button",{className:"landing-pricing-cta w-full py-4 rounded-xl bg-orange-600 hover:bg-orange-500 text-white font-bold transition-all",onClick:s,children:["Attiva Prova di 15 Giorni",e.jsx(xs,{className:"w-5 h-5 ml-2 inline"})]}),e.jsx("p",{className:"landing-pricing-note text-center text-xs text-slate-500 mt-4",children:"Nessuna carta di credito richiesta"})]})]}),w&&e.jsxs("div",{className:"landing-pricing-card bg-gradient-to-b from-purple-900/50 to-slate-900 border border-purple-500/50 relative flex-1 max-w-md shadow-[0_0_30px_rgba(168,85,247,0.15)] transform md:scale-105 z-10",children:[e.jsxs("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-purple-600 text-white px-4 py-1 rounded-full text-xs font-black uppercase tracking-wider shadow-lg flex items-center gap-2 animate-pulse",children:[e.jsx(ft,{size:14})," ",w.name]}),e.jsxs("div",{className:"landing-pricing-amount text-white mt-4 flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-baseline justify-center",children:[e.jsx("span",{className:"landing-pricing-currency text-purple-400",children:""}),e.jsx("span",{className:"landing-pricing-value text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400",children:w.cost}),e.jsxs("span",{className:"landing-pricing-period text-purple-300",children:["/ ",w.duration]})]}),w.deadlineHours&&w.lastUpdated&&e.jsx("div",{className:"mt-2 scale-110",children:e.jsx(Ll,{deadlineHours:w.deadlineHours,lastUpdated:w.lastUpdated})})]}),e.jsx("div",{className:"landing-pricing-location text-purple-400 mt-2",children:"OFFERTA LIMITATA"}),e.jsxs("div",{className:"landing-pricing-features space-y-3 my-8",children:[e.jsxs("div",{className:"landing-pricing-feature flex items-center gap-3 text-slate-300",children:[e.jsx(qa,{className:"w-5 h-5 text-purple-500 shrink-0"}),e.jsx("span",{className:"font-bold text-white",children:"Tutte le funzioni Standard"})]}),e.jsxs("div",{className:"landing-pricing-feature flex items-center gap-3 text-slate-300",children:[e.jsx(qa,{className:"w-5 h-5 text-purple-500 shrink-0"}),e.jsx("span",{children:"Priorit Supporto VIP"})]}),e.jsxs("div",{className:"landing-pricing-feature flex items-center gap-3 text-slate-300",children:[e.jsx(qa,{className:"w-5 h-5 text-purple-500 shrink-0"}),e.jsx("span",{children:"Setup Guidato Gratuito"})]}),e.jsxs("div",{className:"landing-pricing-feature flex items-center gap-3 text-slate-300",children:[e.jsx(qa,{className:"w-5 h-5 text-purple-500 shrink-0"}),e.jsx("span",{children:"Accesso Anticipato AI Beta"})]})]}),e.jsxs("button",{className:"landing-pricing-cta w-full py-4 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold transition-all shadow-lg shadow-purple-600/20",onClick:s,children:["Richiedi ",w.name,e.jsx(xs,{className:"w-5 h-5 ml-2 inline"})]}),e.jsx("p",{className:"landing-pricing-note text-center text-xs text-purple-400/60 mt-4",children:"Posti limitati disponibili"})]})]})]})}),e.jsx("section",{id:"contact",className:"landing-section",children:e.jsxs("div",{className:"landing-container",children:[e.jsxs("div",{className:"landing-section-header",children:[e.jsx("h2",{className:"landing-section-title",children:"Hai Domande?"}),e.jsx("p",{className:"landing-section-subtitle",children:"Il nostro team  qui per aiutarti"})]}),e.jsxs("div",{className:"landing-contact-grid",children:[e.jsxs("div",{className:"landing-contact-card",children:[e.jsx(_t,{className:"w-8 h-8 text-orange-500"}),e.jsx("h3",{className:"landing-contact-title",children:"Email"}),e.jsx("p",{className:"landing-contact-detail",children:"info@ristosyncai.it"}),e.jsxs("a",{href:"mailto:info@ristosyncai.it",className:"landing-contact-link",children:["Invia Email ",e.jsx(xs,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"landing-contact-card",children:[e.jsx(pn,{className:"w-8 h-8 text-orange-500"}),e.jsx("h3",{className:"landing-contact-title",children:"WhatsApp"}),e.jsx("p",{className:"landing-contact-detail",children:"Supporto Prioritario"}),e.jsxs("a",{href:"#",className:"landing-contact-link",children:["Contattaci ",e.jsx(xs,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"landing-contact-card",children:[e.jsx(rr,{className:"w-8 h-8 text-orange-500"}),e.jsx("h3",{className:"landing-contact-title",children:"Demo"}),e.jsx("p",{className:"landing-contact-detail",children:"Prenota una dimostrazione"}),e.jsxs("button",{className:"landing-contact-link",onClick:s,children:["Richiedi Demo ",e.jsx(xs,{className:"w-4 h-4"})]})]})]})]})}),e.jsx("footer",{className:"landing-footer",children:e.jsx("div",{className:"landing-container",children:e.jsxs("div",{className:"landing-footer-content flex flex-col md:flex-row items-center justify-between gap-6",children:[e.jsxs("div",{className:"landing-footer-brand",children:[e.jsx(gt,{className:"w-6 h-6 text-orange-500 logo-float"}),e.jsxs("span",{className:"landing-footer-logo",children:["RISTO",e.jsx("span",{className:"text-orange-500",children:"SYNC"})," AI"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:gap-8 items-center",children:[e.jsxs("div",{className:"flex gap-6 text-sm text-slate-400",children:[e.jsx("button",{onClick:()=>c("privacy"),className:"hover:text-white transition-colors bg-transparent border-none cursor-pointer p-0 text-slate-400 text-sm",children:"Privacy Policy"}),e.jsx("button",{onClick:()=>c("cookie"),className:"hover:text-white transition-colors bg-transparent border-none cursor-pointer p-0 text-slate-400 text-sm",children:"Cookie Policy"}),e.jsx("button",{onClick:()=>c("terms"),className:"hover:text-white transition-colors bg-transparent border-none cursor-pointer p-0 text-slate-400 text-sm",children:"Termini e Condizioni"})]}),e.jsx("p",{className:"landing-footer-text",children:" 2024 RistoSync Intelligence. Tutti i diritti riservati."})]})]})})}),e.jsxs("div",{className:"md:hidden fixed bottom-4 left-4 right-4 bg-slate-900/95 border border-slate-700 p-4 rounded-2xl shadow-2xl backdrop-blur-lg flex items-center justify-between z-50 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-xl flex items-center justify-center shadow-lg shadow-orange-500/20",children:e.jsx(gt,{className:"text-white w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-sm",children:"Installa App"}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase tracking-wider",children:"Accesso Rapido"})]})]}),e.jsx("button",{onClick:()=>alert(`Per installare: 
1. Premi Condividi (iOS) o Menu (Android)
2. Premi 'Aggiungi a Schermata Home'`),className:"bg-white text-slate-900 text-xs font-bold px-4 py-2 rounded-lg hover:bg-slate-100 transition-colors",children:"Installa"})]}),l&&e.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",onClick:()=>c(null),children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 w-full max-w-2xl max-h-[80vh] overflow-y-auto rounded-3xl shadow-2xl relative flex flex-col",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-slate-900/95 backdrop-blur-md p-6 border-b border-slate-800 flex justify-between items-center z-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:D[l].title}),e.jsx("button",{onClick:()=>c(null),className:"w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700 transition-colors",children:e.jsx(Xe,{size:20})})]}),e.jsx("div",{className:"p-6 md:p-8",children:D[l].content}),e.jsx("div",{className:"p-6 border-t border-slate-800 bg-slate-900/50",children:e.jsx("button",{onClick:()=>c(null),className:"w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-xl transition-colors",children:"Ho Capito"})})]})}),e.jsx("style",{children:`
        .landing-page {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
          color: #fff;
          background: #0a0a0a;
        }

        /* Header */
        .landing-header {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
          background: rgba(10, 10, 10, 0.8);
          backdrop-filter: blur(10px);
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          transition: all 0.3s ease;
        }

        .landing-header.scrolled {
          background: rgba(10, 10, 10, 0.95);
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .landing-container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 20px;
        }

        .landing-header-content {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 1rem 0;
        }

        .landing-logo {
          display: flex;
          align-items: center;
          gap: 0.75rem;
        }

        .landing-logo-text {
          font-size: 1.25rem;
          font-weight: 800;
          letter-spacing: -0.5px;
          display: flex;
          flex-direction: column;
          line-height: 1.2;
        }

        .landing-logo-subtitle {
          font-size: 0.6rem;
          font-weight: 500;
          color: #888;
          letter-spacing: 2px;
        }

        .landing-nav {
          display: flex;
          gap: 2rem;
        }

        .landing-nav a {
          color: #ccc;
          text-decoration: none;
          font-weight: 500;
          transition: color 0.3s ease;
        }

        .landing-nav a:hover {
          color: #ff6b35;
        }

        .landing-cta-button {
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          color: white;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          font-weight: 600;
          cursor: pointer;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .landing-cta-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        .landing-mobile-menu-toggle {
          display: none;
          background: none;
          border: none;
          color: white;
          cursor: pointer;
        }

        /* Hero Section */
        .landing-hero {
          padding: 120px 0 80px;
          background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
          position: relative;
          overflow: hidden;
        }

        .landing-hero::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
        }

        .landing-hero-content {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 4rem;
          align-items: center;
          position: relative;
          z-index: 1;
        }

        .landing-badge {
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          background: rgba(255, 107, 53, 0.1);
          border: 1px solid rgba(255, 107, 53, 0.3);
          padding: 0.5rem 1rem;
          border-radius: 50px;
          font-size: 0.75rem;
          font-weight: 600;
          color: #ff6b35;
          margin-bottom: 1.5rem;
        }

        .landing-badge-dot {
          width: 8px;
          height: 8px;
          background: #ff6b35;
          border-radius: 50%;
          animation: pulse 2s infinite;
        }

        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }

        .landing-hero-title {
          font-size: 3.5rem;
          font-weight: 900;
          line-height: 1.1;
          margin-bottom: 1.5rem;
          letter-spacing: -1px;
        }

        .text-gradient {
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }

        .landing-hero-subtitle {
          font-size: 1.25rem;
          color: #aaa;
          line-height: 1.6;
          margin-bottom: 2rem;
        }

        .landing-hero-cta {
          display: flex;
          gap: 1rem;
          margin-bottom: 3rem;
        }

        .landing-button-primary {
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          color: white;
          border: none;
          padding: 1rem 2rem;
          border-radius: 12px;
          font-weight: 600;
          font-size: 1rem;
          cursor: pointer;
          display: flex;
          align-items: center;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .landing-button-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 12px 24px rgba(255, 107, 53, 0.4);
        }

        .landing-button-secondary {
          background: rgba(255, 255, 255, 0.05);
          color: white;
          border: 1px solid rgba(255, 255, 255, 0.1);
          padding: 1rem 2rem;
          border-radius: 12px;
          font-weight: 600;
          font-size: 1rem;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .landing-button-secondary:hover {
          background: rgba(255, 255, 255, 0.1);
          border-color: rgba(255, 255, 255, 0.2);
        }

        .landing-hero-stats {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 2rem;
        }

        .landing-stat {
          text-align: left;
        }

        .landing-stat-value {
          font-size: 2rem;
          font-weight: 800;
          color: #ff6b35;
          margin-bottom: 0.25rem;
        }

        .landing-stat-label {
          font-size: 0.875rem;
          color: #888;
        }

        /* Mockup */
        .landing-mockup {
          background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
          border-radius: 16px;
          overflow: hidden;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
          border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .landing-mockup-header {
          background: #0f0f1e;
          padding: 0.75rem 1rem;
          display: flex;
          gap: 0.5rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .landing-mockup-dot {
          width: 12px;
          height: 12px;
          border-radius: 50%;
        }

        .landing-mockup-dot.red { background: #ff5f56; }
        .landing-mockup-dot.yellow { background: #ffbd2e; }
        .landing-mockup-dot.green { background: #27c93f; }

        .landing-mockup-content {
          display: flex;
          height: 400px;
        }

        .landing-mockup-sidebar {
          width: 200px;
          background: rgba(0, 0, 0, 0.2);
          padding: 1.5rem 1rem;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .landing-mockup-menu-item {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.75rem 1rem;
          border-radius: 8px;
          color: #888;
          transition: all 0.2s ease;
        }

        .landing-mockup-menu-item.active {
          background: rgba(255, 107, 53, 0.1);
          color: #ff6b35;
        }

        .landing-mockup-main {
          flex: 1;
          padding: 2rem;
        }

        .landing-mockup-chart {
          background: rgba(255, 255, 255, 0.02);
          border: 1px solid rgba(255, 255, 255, 0.05);
          border-radius: 12px;
          padding: 2rem;
          height: 100%;
          display: flex;
          align-items: flex-end;
        }

        .landing-mockup-chart-bars {
          display: flex;
          gap: 1rem;
          align-items: flex-end;
          width: 100%;
          height: 100%;
        }

        .landing-mockup-bar {
          flex: 1;
          background: linear-gradient(to top, #ff6b35, #f7931e);
          border-radius: 8px 8px 0 0;
        }

        .bar-animate {
          animation: growBar 1s ease-out, barBounce 2s ease-in-out 1s infinite;
        }

        @keyframes growBar {
          from { height: 0; }
        }

        @keyframes barBounce {
          0%, 100% { 
            transform: scaleY(1);
            transform-origin: bottom;
          }
          50% { 
            transform: scaleY(0.85);
            transform-origin: bottom;
          }
        }

        /* Logo Float Animation */
        .logo-float {
          animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-8px);
          }
        }

        /* Floating Elements Animation */
        @keyframes float {
          0%, 100% {
            transform: translateY(0) translateX(0);
          }
          25% {
            transform: translateY(-20px) translateX(10px);
          }
          50% {
            transform: translateY(-10px) translateX(-10px);
          }
          75% {
            transform: translateY(-30px) translateX(5px);
          }
        }

        /* Sections */
        .landing-section {
          padding: 80px 0;
        }

        .landing-section-dark {
          background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
        }

        .landing-section-header {
          text-align: center;
          margin-bottom: 4rem;
        }

        .landing-section-title {
          font-size: 2.5rem;
          font-weight: 800;
          margin-bottom: 1rem;
        }

        .landing-section-subtitle {
          font-size: 1.25rem;
          color: #aaa;
        }

        /* Features Grid - 3x3 on desktop */
        .landing-features-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 2rem;
        }

        @media (max-width: 1024px) {
          .landing-features-grid {
            grid-template-columns: repeat(2, 1fr);
          }
        }

        @media (max-width: 640px) {
          .landing-features-grid {
            grid-template-columns: 1fr;
          }
        }

        .landing-feature-card {
          background: rgba(255, 255, 255, 0.02);
          border: 1px solid rgba(255, 255, 255, 0.05);
          border-radius: 16px;
          padding: 2rem;
          transition: all 0.3s ease;
        }

        .landing-feature-card:hover {
          transform: translateY(-8px);
          border-color: rgba(255, 107, 53, 0.3);
          box-shadow: 0 12px 40px rgba(255, 107, 53, 0.2);
        }

        .landing-feature-icon {
          width: 64px;
          height: 64px;
          border-radius: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin-bottom: 1.5rem;
          color: white;
        }

        .landing-feature-title {
          font-size: 1.5rem;
          font-weight: 700;
          margin-bottom: 1rem;
        }

        .landing-feature-description {
          color: #aaa;
          line-height: 1.6;
        }

        /* Dashboard Showcase */
        .landing-dashboard-showcase {
          position: relative;
          border-radius: 24px;
          overflow: hidden;
          box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        }

        .dashboard-image {
          width: 100%;
          height: auto;
          display: block;
          border-radius: 24px;
          transition: transform 0.3s ease;
        }

        .landing-dashboard-showcase:hover .dashboard-image {
          transform: scale(1.02);
        }

        .dashboard-glow {
          position: absolute;
          inset: -50%;
          background: radial-gradient(circle, rgba(255, 107, 53, 0.3) 0%, transparent 70%);
          opacity: 0;
          transition: opacity 0.3s ease;
          pointer-events: none;
        }

        .landing-dashboard-showcase:hover .dashboard-glow {
          opacity: 1;
        }

        /* Floating Elements */
        .floating-elements {
          position: absolute;
          inset: 0;
          pointer-events: none;
        }

        .floating-icon {
          position: absolute;
          animation: float 6s ease-in-out infinite;
        }

        /* Sync Showcase Section */
        .landing-sync-showcase {
          padding: 100px 0;
          background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
          position: relative;
          overflow: hidden;
        }

        .landing-sync-showcase::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 800px;
          height: 800px;
          background: radial-gradient(circle, rgba(255, 107, 53, 0.1) 0%, transparent 70%);
          animation: pulse 4s ease-in-out infinite;
        }

        .sync-showcase-content {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 4rem;
          align-items: center;
          position: relative;
          z-index: 1;
        }

        .sync-showcase-title {
          font-size: 3rem;
          font-weight: 900;
          line-height: 1.2;
          margin-bottom: 1.5rem;
        }

        .sync-showcase-description {
          font-size: 1.125rem;
          color: #aaa;
          line-height: 1.8;
          margin-bottom: 2.5rem;
        }

        .sync-showcase-stats {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 2rem;
        }

        .sync-stat {
          text-align: left;
        }

        .sync-stat-value {
          font-size: 2.5rem;
          font-weight: 900;
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          margin-bottom: 0.5rem;
        }

        .sync-stat-label {
          font-size: 0.875rem;
          color: #888;
          line-height: 1.4;
        }

        .sync-showcase-image {
          position: relative;
        }

        .sync-image {
          width: 100%;
          height: auto;
          border-radius: 24px;
          box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
          animation: float 8s ease-in-out infinite;
        }

        @media (max-width: 1024px) {
          .sync-showcase-content {
            grid-template-columns: 1fr;
            gap: 3rem;
          }

          .sync-showcase-title {
            font-size: 2.5rem;
          }

          .sync-showcase-stats {
            grid-template-columns: repeat(3, 1fr);
          }
        }

        @media (max-width: 640px) {
          .sync-showcase-stats {
            grid-template-columns: 1fr;
            gap: 1.5rem;
          }

          .sync-showcase-title {
            font-size: 2rem;
          }
        }

        /* Benefits Grid */
        .landing-benefits-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 2rem;
        }

        .landing-benefit-card {
          display: flex;
          gap: 1rem;
        }

        .landing-benefit-icon {
          width: 48px;
          height: 48px;
          background: rgba(255, 107, 53, 0.1);
          border-radius: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #ff6b35;
          flex-shrink: 0;
        }

        .landing-benefit-title {
          font-size: 1.125rem;
          font-weight: 700;
          margin-bottom: 0.5rem;
        }

        .landing-benefit-description {
          color: #aaa;
          line-height: 1.6;
        }

        /* ROI Calculator */
        .landing-roi-container {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 3rem;
          background: rgba(255, 255, 255, 0.02);
          border: 1px solid rgba(255, 255, 255, 0.05);
          border-radius: 24px;
          padding: 3rem;
        }

        .landing-roi-title {
          font-size: 2rem;
          font-weight: 800;
          margin-bottom: 1rem;
        }

        .landing-roi-subtitle {
          color: #aaa;
          margin-bottom: 2rem;
        }

        .landing-roi-input-group {
          margin-bottom: 2rem;
        }

        .landing-roi-label {
          display: flex;
          justify-content: space-between;
          margin-bottom: 1rem;
          font-weight: 600;
        }

        .landing-roi-value {
          color: #ff6b35;
        }

        .landing-roi-slider {
          width: 100%;
          height: 8px;
          border-radius: 4px;
          background: rgba(255, 255, 255, 0.1);
          outline: none;
          -webkit-appearance: none;
        }

        .landing-roi-slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          cursor: pointer;
        }

        .landing-roi-slider::-moz-range-thumb {
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          cursor: pointer;
          border: none;
        }

        .landing-roi-note {
          font-size: 0.875rem;
          color: #888;
          font-style: italic;
        }

        .landing-roi-results {
          background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
          border-radius: 16px;
          padding: 3rem;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          text-align: center;
        }

        .landing-roi-results-header {
          font-size: 0.875rem;
          font-weight: 600;
          color: #888;
          letter-spacing: 2px;
          margin-bottom: 1rem;
        }

        .landing-roi-results-amount {
          font-size: 4rem;
          font-weight: 900;
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          margin-bottom: 1rem;
        }

        .landing-roi-results-detail {
          color: #4ade80;
          font-size: 1.125rem;
          margin-bottom: 2rem;
        }

        .landing-roi-cta {
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          color: white;
          border: none;
          padding: 1rem 2rem;
          border-radius: 12px;
          font-weight: 600;
          font-size: 1rem;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          transition: transform 0.2s ease;
        }

        .landing-roi-cta:hover {
          transform: translateY(-2px);
        }

        /* Pricing */
        .landing-pricing-card {
          max-width: 600px;
          margin: 0 auto;
          background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 24px;
          padding: 3rem;
          text-align: center;
        }

        .landing-pricing-badge {
          display: inline-block;
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          color: white;
          padding: 0.5rem 1.5rem;
          border-radius: 50px;
          font-size: 0.875rem;
          font-weight: 700;
          margin-bottom: 2rem;
        }

        .landing-pricing-amount {
          display: flex;
          align-items: flex-start;
          justify-content: center;
          margin-bottom: 0.5rem;
        }

        .landing-pricing-currency {
          font-size: 2rem;
          font-weight: 700;
          margin-top: 1rem;
        }

        .landing-pricing-value {
          font-size: 5rem;
          font-weight: 900;
          line-height: 1;
        }

        .landing-pricing-period {
          font-size: 1.5rem;
          color: #888;
          margin-top: 2rem;
        }

        .landing-pricing-location {
          color: #888;
          font-size: 0.875rem;
          margin-bottom: 2rem;
        }

        .landing-pricing-features {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
          margin-bottom: 2rem;
          text-align: left;
        }

        .landing-pricing-feature {
          display: flex;
          align-items: center;
          gap: 0.75rem;
        }

        .landing-pricing-cta {
          background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
          color: white;
          border: none;
          padding: 1.25rem 2.5rem;
          border-radius: 12px;
          font-weight: 700;
          font-size: 1.125rem;
          cursor: pointer;
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 1rem;
          transition: transform 0.2s ease;
        }

        .landing-pricing-cta:hover {
          transform: translateY(-2px);
        }

        .landing-pricing-note {
          font-size: 0.875rem;
          color: #888;
        }

        /* Contact */
        .landing-contact-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
          gap: 2rem;
        }

        .landing-contact-card {
          background: rgba(255, 255, 255, 0.02);
          border: 1px solid rgba(255, 255, 255, 0.05);
          border-radius: 16px;
          padding: 2rem;
          text-align: center;
          transition: all 0.3s ease;
        }

        .landing-contact-card:hover {
          transform: translateY(-8px);
          border-color: rgba(255, 107, 53, 0.3);
        }

        .landing-contact-title {
          font-size: 1.25rem;
          font-weight: 700;
          margin: 1rem 0 0.5rem;
        }

        .landing-contact-detail {
          color: #aaa;
          margin-bottom: 1rem;
        }

        .landing-contact-link {
          color: #ff6b35;
          text-decoration: none;
          font-weight: 600;
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          background: none;
          border: none;
          cursor: pointer;
          transition: gap 0.2s ease;
        }

        .landing-contact-link:hover {
          gap: 0.75rem;
        }

        /* Footer */
        .landing-footer {
          background: #000;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          padding: 2rem 0;
        }

        .landing-footer-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .landing-footer-brand {
          display: flex;
          align-items: center;
          gap: 0.75rem;
        }

        .landing-footer-logo {
          font-size: 1.125rem;
          font-weight: 800;
        }

        .landing-footer-text {
          color: #888;
          font-size: 0.875rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
          .landing-nav {
            display: none;
          }

          .landing-nav.open {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.98);
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          }

          .landing-mobile-menu-toggle {
            display: none;
          }

          .landing-cta-button {
            display: none;
          }

          .landing-hero-content {
            grid-template-columns: 1fr;
            gap: 2rem;
          }

          .landing-hero-title {
            font-size: 2.5rem;
          }

          .landing-hero-cta {
            flex-direction: column;
          }

          .landing-hero-stats {
            grid-template-columns: 1fr;
          }

          .landing-roi-container {
            grid-template-columns: 1fr;
          }

          .landing-pricing-features {
            grid-template-columns: 1fr;
          }

          .landing-footer-content {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
          }
        }

        /* Narrow Screen / iPhone Fixes */
        @media (max-width: 430px) {
          .landing-hero-title {
            font-size: 1.75rem;
            line-height: 1.2;
          }
          .landing-container {
            padding: 0 12px;
          }
          .landing-pricing-value {
             font-size: 3.5rem;
          }
          .landing-logo-text {
             font-size: 1rem;
          }
          .landing-hero-subtitle {
            font-size: 1rem;
          }
          .landing-section-title {
            font-size: 1.75rem;
          }
          .landing-section-subtitle {
            font-size: 0.95rem;
          }
          .landing-feature-card {
            padding: 1.25rem;
          }
          .landing-benefit-card {
            padding: 1.25rem;
          }
          .landing-roi-container {
            padding: 1.5rem;
            gap: 1.5rem;
          }
          .landing-pricing-card {
            padding: 2rem;
          }
          .landing-hero {
            padding: 100px 0 60px;
          }
        }

        /* Float Animation */
        @keyframes float {
          0% { transform: translateY(0px); }
          50% { transform: translateY(-6px); }
          100% { transform: translateY(0px); }
        }

        .logo-float {
          animation: float 3s ease-in-out infinite;
        }
      `})]})};var Ox={exports:{}};(function(s){var t=function(a){var r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(p,g,y){p[g]=y.value},o,l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",d=l.asyncIterator||"@@asyncIterator",u=l.toStringTag||"@@toStringTag";function v(p,g,y){return Object.defineProperty(p,g,{value:y,enumerable:!0,configurable:!0,writable:!0}),p[g]}try{v({},"")}catch{v=function(g,y,T){return g[y]=T}}function j(p,g,y,T){var I=g&&g.prototype instanceof B?g:B,X=Object.create(I.prototype),he=new ce(T||[]);return i(X,"_invoke",{value:M(p,y,he)}),X}a.wrap=j;function w(p,g,y){try{return{type:"normal",arg:p.call(g,y)}}catch(T){return{type:"throw",arg:T}}}var N="suspendedStart",D="suspendedYield",E="executing",O="completed",A={};function B(){}function Z(){}function F(){}var H={};v(H,c,function(){return this});var Y=Object.getPrototypeOf,x=Y&&Y(Y(U([])));x&&x!==r&&n.call(x,c)&&(H=x);var b=F.prototype=B.prototype=Object.create(H);Z.prototype=F,i(b,"constructor",{value:F,configurable:!0}),i(F,"constructor",{value:Z,configurable:!0}),Z.displayName=v(F,u,"GeneratorFunction");function S(p){["next","throw","return"].forEach(function(g){v(p,g,function(y){return this._invoke(g,y)})})}a.isGeneratorFunction=function(p){var g=typeof p=="function"&&p.constructor;return g?g===Z||(g.displayName||g.name)==="GeneratorFunction":!1},a.mark=function(p){return Object.setPrototypeOf?Object.setPrototypeOf(p,F):(p.__proto__=F,v(p,u,"GeneratorFunction")),p.prototype=Object.create(b),p},a.awrap=function(p){return{__await:p}};function K(p,g){function y(X,he,se,ue){var ie=w(p[X],p,he);if(ie.type==="throw")ue(ie.arg);else{var ne=ie.arg,re=ne.value;return re&&typeof re=="object"&&n.call(re,"__await")?g.resolve(re.__await).then(function(V){y("next",V,se,ue)},function(V){y("throw",V,se,ue)}):g.resolve(re).then(function(V){ne.value=V,se(ne)},function(V){return y("throw",V,se,ue)})}}var T;function I(X,he){function se(){return new g(function(ue,ie){y(X,he,ue,ie)})}return T=T?T.then(se,se):se()}i(this,"_invoke",{value:I})}S(K.prototype),v(K.prototype,d,function(){return this}),a.AsyncIterator=K,a.async=function(p,g,y,T,I){I===void 0&&(I=Promise);var X=new K(j(p,g,y,T),I);return a.isGeneratorFunction(g)?X:X.next().then(function(he){return he.done?he.value:X.next()})};function M(p,g,y){var T=N;return function(X,he){if(T===E)throw new Error("Generator is already running");if(T===O){if(X==="throw")throw he;return te()}for(y.method=X,y.arg=he;;){var se=y.delegate;if(se){var ue=ee(se,y);if(ue){if(ue===A)continue;return ue}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(T===N)throw T=O,y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);T=E;var ie=w(p,g,y);if(ie.type==="normal"){if(T=y.done?O:D,ie.arg===A)continue;return{value:ie.arg,done:y.done}}else ie.type==="throw"&&(T=O,y.method="throw",y.arg=ie.arg)}}}function ee(p,g){var y=g.method,T=p.iterator[y];if(T===o)return g.delegate=null,y==="throw"&&p.iterator.return&&(g.method="return",g.arg=o,ee(p,g),g.method==="throw")||y!=="return"&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+y+"' method")),A;var I=w(T,p.iterator,g.arg);if(I.type==="throw")return g.method="throw",g.arg=I.arg,g.delegate=null,A;var X=I.arg;if(!X)return g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,A;if(X.done)g[p.resultName]=X.value,g.next=p.nextLoc,g.method!=="return"&&(g.method="next",g.arg=o);else return X;return g.delegate=null,A}S(b),v(b,u,"Generator"),v(b,c,function(){return this}),v(b,"toString",function(){return"[object Generator]"});function ge(p){var g={tryLoc:p[0]};1 in p&&(g.catchLoc=p[1]),2 in p&&(g.finallyLoc=p[2],g.afterLoc=p[3]),this.tryEntries.push(g)}function ye(p){var g=p.completion||{};g.type="normal",delete g.arg,p.completion=g}function ce(p){this.tryEntries=[{tryLoc:"root"}],p.forEach(ge,this),this.reset(!0)}a.keys=function(p){var g=Object(p),y=[];for(var T in g)y.push(T);return y.reverse(),function I(){for(;y.length;){var X=y.pop();if(X in g)return I.value=X,I.done=!1,I}return I.done=!0,I}};function U(p){if(p){var g=p[c];if(g)return g.call(p);if(typeof p.next=="function")return p;if(!isNaN(p.length)){var y=-1,T=function I(){for(;++y<p.length;)if(n.call(p,y))return I.value=p[y],I.done=!1,I;return I.value=o,I.done=!0,I};return T.next=T}}return{next:te}}a.values=U;function te(){return{value:o,done:!0}}return ce.prototype={constructor:ce,reset:function(p){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(ye),!p)for(var g in this)g.charAt(0)==="t"&&n.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=o)},stop:function(){this.done=!0;var p=this.tryEntries[0],g=p.completion;if(g.type==="throw")throw g.arg;return this.rval},dispatchException:function(p){if(this.done)throw p;var g=this;function y(ue,ie){return X.type="throw",X.arg=p,g.next=ue,ie&&(g.method="next",g.arg=o),!!ie}for(var T=this.tryEntries.length-1;T>=0;--T){var I=this.tryEntries[T],X=I.completion;if(I.tryLoc==="root")return y("end");if(I.tryLoc<=this.prev){var he=n.call(I,"catchLoc"),se=n.call(I,"finallyLoc");if(he&&se){if(this.prev<I.catchLoc)return y(I.catchLoc,!0);if(this.prev<I.finallyLoc)return y(I.finallyLoc)}else if(he){if(this.prev<I.catchLoc)return y(I.catchLoc,!0)}else if(se){if(this.prev<I.finallyLoc)return y(I.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(p,g){for(var y=this.tryEntries.length-1;y>=0;--y){var T=this.tryEntries[y];if(T.tryLoc<=this.prev&&n.call(T,"finallyLoc")&&this.prev<T.finallyLoc){var I=T;break}}I&&(p==="break"||p==="continue")&&I.tryLoc<=g&&g<=I.finallyLoc&&(I=null);var X=I?I.completion:{};return X.type=p,X.arg=g,I?(this.method="next",this.next=I.finallyLoc,A):this.complete(X)},complete:function(p,g){if(p.type==="throw")throw p.arg;return p.type==="break"||p.type==="continue"?this.next=p.arg:p.type==="return"?(this.rval=this.arg=p.arg,this.method="return",this.next="end"):p.type==="normal"&&g&&(this.next=g),A},finish:function(p){for(var g=this.tryEntries.length-1;g>=0;--g){var y=this.tryEntries[g];if(y.finallyLoc===p)return this.complete(y.completion,y.afterLoc),ye(y),A}},catch:function(p){for(var g=this.tryEntries.length-1;g>=0;--g){var y=this.tryEntries[g];if(y.tryLoc===p){var T=y.completion;if(T.type==="throw"){var I=T.arg;ye(y)}return I}}throw new Error("illegal catch attempt")},delegateYield:function(p,g,y){return this.delegate={iterator:U(p),resultName:g,nextLoc:y},this.method==="next"&&(this.arg=o),A}},a}(s.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(Ox);var ro=(s,t)=>`${s}-${t}-${Math.random().toString(16).slice(3,8)}`;const Rx=ro;let Ml=0;var Hc=({id:s,action:t,payload:a={}})=>{let r=s;return typeof r>"u"&&(r=Rx("Job",Ml),Ml+=1),{id:r,action:t,payload:a}},Aa={};let no=!1;Aa.logging=no;Aa.setLogging=s=>{no=s};Aa.log=(...s)=>no?console.log.apply(void 0,s):null;const Px=Hc,{log:Zr}=Aa,zx=ro;let Ul=0;var Dx=()=>{const s=zx("Scheduler",Ul),t={},a={};let r=[];Ul+=1;const n=()=>r.length,i=()=>Object.keys(t).length,o=()=>{if(r.length!==0){const v=Object.keys(t);for(let j=0;j<v.length;j+=1)if(typeof a[v[j]]>"u"){r[0](t[v[j]]);break}}},l=(v,j)=>new Promise((w,N)=>{const D=Px({action:v,payload:j});r.push(async E=>{r.shift(),a[E.id]=D;try{w(await E[v].apply(void 0,[...j,D.id]))}catch(O){N(O)}finally{delete a[E.id],o()}}),Zr(`[${s}]: Add ${D.id} to JobQueue`),Zr(`[${s}]: JobQueue length=${r.length}`),o()});return{addWorker:v=>(t[v.id]=v,Zr(`[${s}]: Add ${v.id}`),Zr(`[${s}]: Number of workers=${i()}`),o(),v.id),addJob:async(v,...j)=>{if(i()===0)throw Error(`[${s}]: You need to have at least one worker before adding jobs`);return l(v,j)},terminate:async()=>{Object.keys(t).forEach(async v=>{await t[v].terminate()}),r=[]},getQueueLen:n,getNumWorkers:i}};function $x(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Lx=s=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof $x=="function"&&(t.type="node"),typeof s>"u"?t:t[s]};const Mx=Lx("type")==="browser",Ux=Mx?s=>new URL(s,window.location.href).href:s=>s;var Bx=s=>{const t={...s};return["corePath","workerPath","langPath"].forEach(a=>{s[a]&&(t[a]=Ux(t[a]))}),t},Jc={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const Fx="7.0.0",Gx={version:Fx};var qx={workerBlobURL:!0,logger:()=>{}};const Vx=Gx.version,Kx=qx;var Wx={...Kx,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Vx}/dist/worker.min.js`},Hx=({workerPath:s,workerBlobURL:t})=>{let a;if(Blob&&URL&&t){const r=new Blob([`importScripts("${s}");`],{type:"application/javascript"});a=new Worker(URL.createObjectURL(r))}else a=new Worker(s);return a},Jx=s=>{s.terminate()},Yx=(s,t)=>{s.onmessage=({data:a})=>{t(a)}},Qx=async(s,t)=>{s.postMessage(t)};const ni=s=>new Promise((t,a)=>{const r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=({target:{error:{code:n}}})=>{a(Error(`File could not be read! Code=${n}`))},r.readAsArrayBuffer(s)}),Ci=async s=>{let t=s;if(typeof s>"u")return"undefined";if(typeof s=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(s)?t=atob(s.split(",")[1]).split("").map(a=>a.charCodeAt(0)):t=await(await fetch(s)).arrayBuffer();else if(typeof HTMLElement<"u"&&s instanceof HTMLElement)s.tagName==="IMG"&&(t=await Ci(s.src)),s.tagName==="VIDEO"&&(t=await Ci(s.poster)),s.tagName==="CANVAS"&&await new Promise(a=>{s.toBlob(async r=>{t=await ni(r),a()})});else if(typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas){const a=await s.convertToBlob();t=await ni(a)}else(s instanceof File||s instanceof Blob)&&(t=await ni(s));return new Uint8Array(t)};var Xx=Ci;const Zx=Wx,ep=Hx,tp=Jx,sp=Yx,ap=Qx,rp=Xx;var np={defaultOptions:Zx,spawnWorker:ep,terminateWorker:tp,onMessage:sp,send:ap,loadImage:rp};const ip=Bx,ss=Hc,{log:Bl}=Aa,op=ro,Gs=Jc,{defaultOptions:lp,spawnWorker:cp,terminateWorker:dp,onMessage:up,loadImage:Fl,send:hp}=np;let Gl=0;var Yc=async(s="eng",t=Gs.LSTM_ONLY,a={},r={})=>{const n=op("Worker",Gl),{logger:i,errorHandler:o,...l}=ip({...lp,...a}),c={},d=typeof s=="string"?s.split("+"):s;let u=t,v=r;const j=[Gs.DEFAULT,Gs.LSTM_ONLY].includes(t)&&!l.legacyCore;let w,N;const D=new Promise((U,te)=>{N=U,w=te}),E=U=>{w(U.message)};let O=cp(l);O.onerror=E,Gl+=1;const A=({id:U,action:te,payload:p})=>new Promise((g,y)=>{Bl(`[${n}]: Start ${U}, action=${te}`);const T=`${te}-${U}`;c[T]={resolve:g,reject:y},hp(O,{workerId:n,jobId:U,action:te,payload:p})}),B=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),Z=U=>A(ss({id:U,action:"load",payload:{options:{lstmOnly:j,corePath:l.corePath,logging:l.logging}}})),F=(U,te,p)=>A(ss({id:p,action:"FS",payload:{method:"writeFile",args:[U,te]}})),H=(U,te)=>A(ss({id:te,action:"FS",payload:{method:"readFile",args:[U,{encoding:"utf8"}]}})),Y=(U,te)=>A(ss({id:te,action:"FS",payload:{method:"unlink",args:[U]}})),x=(U,te,p)=>A(ss({id:p,action:"FS",payload:{method:U,args:te}})),b=(U,te)=>A(ss({id:te,action:"loadLanguage",payload:{langs:U,options:{langPath:l.langPath,dataPath:l.dataPath,cachePath:l.cachePath,cacheMethod:l.cacheMethod,gzip:l.gzip,lstmOnly:[Gs.DEFAULT,Gs.LSTM_ONLY].includes(u)&&!l.legacyLang}}})),S=(U,te,p,g)=>A(ss({id:g,action:"initialize",payload:{langs:U,oem:te,config:p}})),K=(U="eng",te,p,g)=>{if(j&&[Gs.TESSERACT_ONLY,Gs.TESSERACT_LSTM_COMBINED].includes(te))throw Error("Legacy model requested but code missing.");const y=te||u;u=y;const T=p||v;v=T;const X=(typeof U=="string"?U.split("+"):U).filter(he=>!d.includes(he));return d.push(...X),X.length>0?b(X,g).then(()=>S(U,y,T,g)):S(U,y,T,g)},M=(U={},te)=>A(ss({id:te,action:"setParameters",payload:{params:U}})),ee=async(U,te={},p={text:!0},g)=>A(ss({id:g,action:"recognize",payload:{image:await Fl(U),options:te,output:p}})),ge=async(U,te)=>{if(j)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return A(ss({id:te,action:"detect",payload:{image:await Fl(U)}}))},ye=async()=>(O!==null&&(dp(O),O=null),Promise.resolve());up(O,({workerId:U,jobId:te,status:p,action:g,data:y})=>{const T=`${g}-${te}`;if(p==="resolve")Bl(`[${U}]: Complete ${te}`),c[T].resolve({jobId:te,data:y}),delete c[T];else if(p==="reject")if(c[T].reject(y),delete c[T],g==="load"&&w(y),o)o(y);else throw Error(y);else p==="progress"&&i({...y,userJobId:te})});const ce={id:n,worker:O,load:B,writeText:F,readText:H,removeFile:Y,FS:x,reinitialize:K,setParameters:M,recognize:ee,detect:ge,terminate:ye};return Z().then(()=>b(s)).then(()=>S(s,t,r)).then(()=>N(ce)).catch(()=>{}),D};const Qc=Yc,mp=async(s,t,a)=>{const r=await Qc(t,1,a);return r.recognize(s).finally(async()=>{await r.terminate()})},xp=async(s,t)=>{const a=await Qc("osd",0,t);return a.detect(s).finally(async()=>{await a.terminate()})};var pp={recognize:mp,detect:xp},fp={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},gp={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const bp=Dx,vp=Yc,wp=pp,jp=fp,yp=Jc,Np=gp,{setLogging:_p}=Aa;var kp={languages:jp,OEM:yp,PSM:Np,createScheduler:bp,createWorker:vp,setLogging:_p,...wp};const Sp=Vl(kp);var Xc={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(s,t){((a,r)=>{s.exports=r()})(id,function a(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},n,i=!r.document&&!!r.postMessage,o=r.IS_PAPA_WORKER||!1,l={},c=0,d={};function u(x){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(b){var S=F(b);S.chunkSize=parseInt(S.chunkSize),b.step||b.chunk||(S.chunkSize=null),this._handle=new D(S),(this._handle.streamer=this)._config=S}).call(this,x),this.parseChunk=function(b,S){var K=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<K){let ee=this._config.newline;ee||(M=this._config.quoteChar||'"',ee=this._handle.guessLineEndings(b,M)),b=[...b.split(ee).slice(K)].join(ee)}this.isFirstChunk&&Y(this._config.beforeFirstChunk)&&(M=this._config.beforeFirstChunk(b))!==void 0&&(b=M),this.isFirstChunk=!1,this._halted=!1;var K=this._partialLine+b,M=(this._partialLine="",this._handle.parse(K,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(b=M.meta.cursor,K=(this._finished||(this._partialLine=K.substring(b-this._baseIndex),this._baseIndex=b),M&&M.data&&(this._rowCount+=M.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)r.postMessage({results:M,workerId:d.WORKER_ID,finished:K});else if(Y(this._config.chunk)&&!S){if(this._config.chunk(M,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=M=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(M.data),this._completeResults.errors=this._completeResults.errors.concat(M.errors),this._completeResults.meta=M.meta),this._completed||!K||!Y(this._config.complete)||M&&M.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),K||M&&M.meta.paused||this._nextChunk(),M}this._halted=!0},this._sendError=function(b){Y(this._config.error)?this._config.error(b):o&&this._config.error&&r.postMessage({workerId:d.WORKER_ID,error:b,finished:!1})}}function v(x){var b;(x=x||{}).chunkSize||(x.chunkSize=d.RemoteChunkSize),u.call(this,x),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(S){this._input=S,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(b=new XMLHttpRequest,this._config.withCredentials&&(b.withCredentials=this._config.withCredentials),i||(b.onload=H(this._chunkLoaded,this),b.onerror=H(this._chunkError,this)),b.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var S,K=this._config.downloadRequestHeaders;for(S in K)b.setRequestHeader(S,K[S])}var M;this._config.chunkSize&&(M=this._start+this._config.chunkSize-1,b.setRequestHeader("Range","bytes="+this._start+"-"+M));try{b.send(this._config.downloadRequestBody)}catch(ee){this._chunkError(ee.message)}i&&b.status===0&&this._chunkError()}},this._chunkLoaded=function(){b.readyState===4&&(b.status<200||400<=b.status?this._chunkError():(this._start+=this._config.chunkSize||b.responseText.length,this._finished=!this._config.chunkSize||this._start>=(S=>(S=S.getResponseHeader("Content-Range"))!==null?parseInt(S.substring(S.lastIndexOf("/")+1)):-1)(b),this.parseChunk(b.responseText)))},this._chunkError=function(S){S=b.statusText||S,this._sendError(new Error(S))}}function j(x){(x=x||{}).chunkSize||(x.chunkSize=d.LocalChunkSize),u.call(this,x);var b,S,K=typeof FileReader<"u";this.stream=function(M){this._input=M,S=M.slice||M.webkitSlice||M.mozSlice,K?((b=new FileReader).onload=H(this._chunkLoaded,this),b.onerror=H(this._chunkError,this)):b=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var M=this._input,ee=(this._config.chunkSize&&(ee=Math.min(this._start+this._config.chunkSize,this._input.size),M=S.call(M,this._start,ee)),b.readAsText(M,this._config.encoding));K||this._chunkLoaded({target:{result:ee}})},this._chunkLoaded=function(M){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(M.target.result)},this._chunkError=function(){this._sendError(b.error)}}function w(x){var b;u.call(this,x=x||{}),this.stream=function(S){return b=S,this._nextChunk()},this._nextChunk=function(){var S,K;if(!this._finished)return S=this._config.chunkSize,b=S?(K=b.substring(0,S),b.substring(S)):(K=b,""),this._finished=!b,this.parseChunk(K)}}function N(x){u.call(this,x=x||{});var b=[],S=!0,K=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(M){this._input=M,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){K&&b.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),b.length?this.parseChunk(b.shift()):S=!0},this._streamData=H(function(M){try{b.push(typeof M=="string"?M:M.toString(this._config.encoding)),S&&(S=!1,this._checkIsFinished(),this.parseChunk(b.shift()))}catch(ee){this._streamError(ee)}},this),this._streamError=H(function(M){this._streamCleanUp(),this._sendError(M)},this),this._streamEnd=H(function(){this._streamCleanUp(),K=!0,this._streamData("")},this),this._streamCleanUp=H(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function D(x){var b,S,K,M,ee=Math.pow(2,53),ge=-ee,ye=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ce=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,U=this,te=0,p=0,g=!1,y=!1,T=[],I={data:[],errors:[],meta:{}};function X(ie){return x.skipEmptyLines==="greedy"?ie.join("").trim()==="":ie.length===1&&ie[0].length===0}function he(){if(I&&K&&(ue("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),K=!1),x.skipEmptyLines&&(I.data=I.data.filter(function(V){return!X(V)})),se()){let V=function($e,k){Y(x.transformHeader)&&($e=x.transformHeader($e,k)),T.push($e)};if(I)if(Array.isArray(I.data[0])){for(var ie=0;se()&&ie<I.data.length;ie++)I.data[ie].forEach(V);I.data.splice(0,1)}else I.data.forEach(V)}function ne(V,$e){for(var k=x.header?{}:[],Q=0;Q<V.length;Q++){var xe=Q,fe=V[Q],fe=((Ce,ae)=>(_e=>(x.dynamicTypingFunction&&x.dynamicTyping[_e]===void 0&&(x.dynamicTyping[_e]=x.dynamicTypingFunction(_e)),(x.dynamicTyping[_e]||x.dynamicTyping)===!0))(Ce)?ae==="true"||ae==="TRUE"||ae!=="false"&&ae!=="FALSE"&&((_e=>{if(ye.test(_e)&&(_e=parseFloat(_e),ge<_e&&_e<ee))return 1})(ae)?parseFloat(ae):ce.test(ae)?new Date(ae):ae===""?null:ae):ae)(xe=x.header?Q>=T.length?"__parsed_extra":T[Q]:xe,fe=x.transform?x.transform(fe,xe):fe);xe==="__parsed_extra"?(k[xe]=k[xe]||[],k[xe].push(fe)):k[xe]=fe}return x.header&&(Q>T.length?ue("FieldMismatch","TooManyFields","Too many fields: expected "+T.length+" fields but parsed "+Q,p+$e):Q<T.length&&ue("FieldMismatch","TooFewFields","Too few fields: expected "+T.length+" fields but parsed "+Q,p+$e)),k}var re;I&&(x.header||x.dynamicTyping||x.transform)&&(re=1,!I.data.length||Array.isArray(I.data[0])?(I.data=I.data.map(ne),re=I.data.length):I.data=ne(I.data,0),x.header&&I.meta&&(I.meta.fields=T),p+=re)}function se(){return x.header&&T.length===0}function ue(ie,ne,re,V){ie={type:ie,code:ne,message:re},V!==void 0&&(ie.row=V),I.errors.push(ie)}Y(x.step)&&(M=x.step,x.step=function(ie){I=ie,se()?he():(he(),I.data.length!==0&&(te+=ie.data.length,x.preview&&te>x.preview?S.abort():(I.data=I.data[0],M(I,U))))}),this.parse=function(ie,ne,re){var V=x.quoteChar||'"',V=(x.newline||(x.newline=this.guessLineEndings(ie,V)),K=!1,x.delimiter?Y(x.delimiter)&&(x.delimiter=x.delimiter(ie),I.meta.delimiter=x.delimiter):((V=(($e,k,Q,xe,fe)=>{var Ce,ae,_e,Ge;fe=fe||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var we=0;we<fe.length;we++){for(var ze,z=fe[we],P=0,_=0,h=0,C=(_e=void 0,new O({comments:xe,delimiter:z,newline:k,preview:10}).parse($e)),L=0;L<C.data.length;L++)Q&&X(C.data[L])?h++:(ze=C.data[L].length,_+=ze,_e===void 0?_e=ze:0<ze&&(P+=Math.abs(ze-_e),_e=ze));0<C.data.length&&(_/=C.data.length-h),(ae===void 0||P<=ae)&&(Ge===void 0||Ge<_)&&1.99<_&&(ae=P,Ce=z,Ge=_)}return{successful:!!(x.delimiter=Ce),bestDelimiter:Ce}})(ie,x.newline,x.skipEmptyLines,x.comments,x.delimitersToGuess)).successful?x.delimiter=V.bestDelimiter:(K=!0,x.delimiter=d.DefaultDelimiter),I.meta.delimiter=x.delimiter),F(x));return x.preview&&x.header&&V.preview++,b=ie,S=new O(V),I=S.parse(b,ne,re),he(),g?{meta:{paused:!0}}:I||{meta:{paused:!1}}},this.paused=function(){return g},this.pause=function(){g=!0,S.abort(),b=Y(x.chunk)?"":b.substring(S.getCharIndex())},this.resume=function(){U.streamer._halted?(g=!1,U.streamer.parseChunk(b,!0)):setTimeout(U.resume,3)},this.aborted=function(){return y},this.abort=function(){y=!0,S.abort(),I.meta.aborted=!0,Y(x.complete)&&x.complete(I),b=""},this.guessLineEndings=function($e,V){$e=$e.substring(0,1048576);var V=new RegExp(E(V)+"([^]*?)"+E(V),"gm"),re=($e=$e.replace(V,"")).split("\r"),V=$e.split(`
`),$e=1<V.length&&V[0].length<re[0].length;if(re.length===1||$e)return`
`;for(var k=0,Q=0;Q<re.length;Q++)re[Q][0]===`
`&&k++;return k>=re.length/2?`\r
`:"\r"}}function E(x){return x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function O(x){var b=(x=x||{}).delimiter,S=x.newline,K=x.comments,M=x.step,ee=x.preview,ge=x.fastMode,ye=null,ce=!1,U=x.quoteChar==null?'"':x.quoteChar,te=U;if(x.escapeChar!==void 0&&(te=x.escapeChar),(typeof b!="string"||-1<d.BAD_DELIMITERS.indexOf(b))&&(b=","),K===b)throw new Error("Comment character same as delimiter");K===!0?K="#":(typeof K!="string"||-1<d.BAD_DELIMITERS.indexOf(K))&&(K=!1),S!==`
`&&S!=="\r"&&S!==`\r
`&&(S=`
`);var p=0,g=!1;this.parse=function(y,T,I){if(typeof y!="string")throw new Error("Input must be a string");var X=y.length,he=b.length,se=S.length,ue=K.length,ie=Y(M),ne=[],re=[],V=[],$e=p=0;if(!y)return P();if(ge||ge!==!1&&y.indexOf(U)===-1){for(var k=y.split(S),Q=0;Q<k.length;Q++){if(V=k[Q],p+=V.length,Q!==k.length-1)p+=S.length;else if(I)return P();if(!K||V.substring(0,ue)!==K){if(ie){if(ne=[],Ge(V.split(b)),_(),g)return P()}else Ge(V.split(b));if(ee&&ee<=Q)return ne=ne.slice(0,ee),P(!0)}}return P()}for(var xe=y.indexOf(b,p),fe=y.indexOf(S,p),Ce=new RegExp(E(te)+E(U),"g"),ae=y.indexOf(U,p);;)if(y[p]===U)for(ae=p,p++;;){if((ae=y.indexOf(U,ae+1))===-1)return I||re.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ne.length,index:p}),ze();if(ae===X-1)return ze(y.substring(p,ae).replace(Ce,U));if(U===te&&y[ae+1]===te)ae++;else if(U===te||ae===0||y[ae-1]!==te){xe!==-1&&xe<ae+1&&(xe=y.indexOf(b,ae+1));var _e=we((fe=fe!==-1&&fe<ae+1?y.indexOf(S,ae+1):fe)===-1?xe:Math.min(xe,fe));if(y.substr(ae+1+_e,he)===b){V.push(y.substring(p,ae).replace(Ce,U)),y[p=ae+1+_e+he]!==U&&(ae=y.indexOf(U,p)),xe=y.indexOf(b,p),fe=y.indexOf(S,p);break}if(_e=we(fe),y.substring(ae+1+_e,ae+1+_e+se)===S){if(V.push(y.substring(p,ae).replace(Ce,U)),z(ae+1+_e+se),xe=y.indexOf(b,p),ae=y.indexOf(U,p),ie&&(_(),g))return P();if(ee&&ne.length>=ee)return P(!0);break}re.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ne.length,index:p}),ae++}}else if(K&&V.length===0&&y.substring(p,p+ue)===K){if(fe===-1)return P();p=fe+se,fe=y.indexOf(S,p),xe=y.indexOf(b,p)}else if(xe!==-1&&(xe<fe||fe===-1))V.push(y.substring(p,xe)),p=xe+he,xe=y.indexOf(b,p);else{if(fe===-1)break;if(V.push(y.substring(p,fe)),z(fe+se),ie&&(_(),g))return P();if(ee&&ne.length>=ee)return P(!0)}return ze();function Ge(h){ne.push(h),$e=p}function we(h){var C=0;return C=h!==-1&&(h=y.substring(ae+1,h))&&h.trim()===""?h.length:C}function ze(h){return I||(h===void 0&&(h=y.substring(p)),V.push(h),p=X,Ge(V),ie&&_()),P()}function z(h){p=h,Ge(V),V=[],fe=y.indexOf(S,p)}function P(h){if(x.header&&!T&&ne.length&&!ce){var C=ne[0],L=Object.create(null),le=new Set(C);let G=!1;for(let me=0;me<C.length;me++){let pe=C[me];if(L[pe=Y(x.transformHeader)?x.transformHeader(pe,me):pe]){let Te,Pe=L[pe];for(;Te=pe+"_"+Pe,Pe++,le.has(Te););le.add(Te),C[me]=Te,L[pe]++,G=!0,(ye=ye===null?{}:ye)[Te]=pe}else L[pe]=1,C[me]=pe;le.add(pe)}G&&console.warn("Duplicate headers found and renamed."),ce=!0}return{data:ne,errors:re,meta:{delimiter:b,linebreak:S,aborted:g,truncated:!!h,cursor:$e+(T||0),renamedHeaders:ye}}}function _(){M(P()),ne=[],re=[]}},this.abort=function(){g=!0},this.getCharIndex=function(){return p}}function A(x){var b=x.data,S=l[b.workerId],K=!1;if(b.error)S.userError(b.error,b.file);else if(b.results&&b.results.data){var M={abort:function(){K=!0,B(b.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Z,resume:Z};if(Y(S.userStep)){for(var ee=0;ee<b.results.data.length&&(S.userStep({data:b.results.data[ee],errors:b.results.errors,meta:b.results.meta},M),!K);ee++);delete b.results}else Y(S.userChunk)&&(S.userChunk(b.results,M,b.file),delete b.results)}b.finished&&!K&&B(b.workerId,b.results)}function B(x,b){var S=l[x];Y(S.userComplete)&&S.userComplete(b),S.terminate(),delete l[x]}function Z(){throw new Error("Not implemented.")}function F(x){if(typeof x!="object"||x===null)return x;var b,S=Array.isArray(x)?[]:{};for(b in x)S[b]=F(x[b]);return S}function H(x,b){return function(){x.apply(b,arguments)}}function Y(x){return typeof x=="function"}return d.parse=function(x,b){var S=(b=b||{}).dynamicTyping||!1;if(Y(S)&&(b.dynamicTypingFunction=S,S={}),b.dynamicTyping=S,b.transform=!!Y(b.transform)&&b.transform,!b.worker||!d.WORKERS_SUPPORTED)return S=null,d.NODE_STREAM_INPUT,typeof x=="string"?(x=(K=>K.charCodeAt(0)!==65279?K:K.slice(1))(x),S=new(b.download?v:w)(b)):x.readable===!0&&Y(x.read)&&Y(x.on)?S=new N(b):(r.File&&x instanceof File||x instanceof Object)&&(S=new j(b)),S.stream(x);(S=(()=>{var K;return!!d.WORKERS_SUPPORTED&&(K=(()=>{var M=r.URL||r.webkitURL||null,ee=a.toString();return d.BLOB_URL||(d.BLOB_URL=M.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",ee,")();"],{type:"text/javascript"})))})(),(K=new r.Worker(K)).onmessage=A,K.id=c++,l[K.id]=K)})()).userStep=b.step,S.userChunk=b.chunk,S.userComplete=b.complete,S.userError=b.error,b.step=Y(b.step),b.chunk=Y(b.chunk),b.complete=Y(b.complete),b.error=Y(b.error),delete b.worker,S.postMessage({input:x,config:b,workerId:S.id})},d.unparse=function(x,b){var S=!1,K=!0,M=",",ee=`\r
`,ge='"',ye=ge+ge,ce=!1,U=null,te=!1,p=((()=>{if(typeof b=="object"){if(typeof b.delimiter!="string"||d.BAD_DELIMITERS.filter(function(T){return b.delimiter.indexOf(T)!==-1}).length||(M=b.delimiter),typeof b.quotes!="boolean"&&typeof b.quotes!="function"&&!Array.isArray(b.quotes)||(S=b.quotes),typeof b.skipEmptyLines!="boolean"&&typeof b.skipEmptyLines!="string"||(ce=b.skipEmptyLines),typeof b.newline=="string"&&(ee=b.newline),typeof b.quoteChar=="string"&&(ge=b.quoteChar),typeof b.header=="boolean"&&(K=b.header),Array.isArray(b.columns)){if(b.columns.length===0)throw new Error("Option columns is empty");U=b.columns}b.escapeChar!==void 0&&(ye=b.escapeChar+ge),b.escapeFormulae instanceof RegExp?te=b.escapeFormulae:typeof b.escapeFormulae=="boolean"&&b.escapeFormulae&&(te=/^[=+\-@\t\r].*$/)}})(),new RegExp(E(ge),"g"));if(typeof x=="string"&&(x=JSON.parse(x)),Array.isArray(x)){if(!x.length||Array.isArray(x[0]))return g(null,x,ce);if(typeof x[0]=="object")return g(U||Object.keys(x[0]),x,ce)}else if(typeof x=="object")return typeof x.data=="string"&&(x.data=JSON.parse(x.data)),Array.isArray(x.data)&&(x.fields||(x.fields=x.meta&&x.meta.fields||U),x.fields||(x.fields=Array.isArray(x.data[0])?x.fields:typeof x.data[0]=="object"?Object.keys(x.data[0]):[]),Array.isArray(x.data[0])||typeof x.data[0]=="object"||(x.data=[x.data])),g(x.fields||[],x.data||[],ce);throw new Error("Unable to serialize unrecognized input");function g(T,I,X){var he="",se=(typeof T=="string"&&(T=JSON.parse(T)),typeof I=="string"&&(I=JSON.parse(I)),Array.isArray(T)&&0<T.length),ue=!Array.isArray(I[0]);if(se&&K){for(var ie=0;ie<T.length;ie++)0<ie&&(he+=M),he+=y(T[ie],ie);0<I.length&&(he+=ee)}for(var ne=0;ne<I.length;ne++){var re=(se?T:I[ne]).length,V=!1,$e=se?Object.keys(I[ne]).length===0:I[ne].length===0;if(X&&!se&&(V=X==="greedy"?I[ne].join("").trim()==="":I[ne].length===1&&I[ne][0].length===0),X==="greedy"&&se){for(var k=[],Q=0;Q<re;Q++){var xe=ue?T[Q]:Q;k.push(I[ne][xe])}V=k.join("").trim()===""}if(!V){for(var fe=0;fe<re;fe++){0<fe&&!$e&&(he+=M);var Ce=se&&ue?T[fe]:fe;he+=y(I[ne][Ce],fe)}ne<I.length-1&&(!X||0<re&&!$e)&&(he+=ee)}}return he}function y(T,I){var X,he;return T==null?"":T.constructor===Date?JSON.stringify(T).slice(1,25):(he=!1,te&&typeof T=="string"&&te.test(T)&&(T="'"+T,he=!0),X=T.toString().replace(p,ye),(he=he||S===!0||typeof S=="function"&&S(T,I)||Array.isArray(S)&&S[I]||((se,ue)=>{for(var ie=0;ie<ue.length;ie++)if(-1<se.indexOf(ue[ie]))return!0;return!1})(X,d.BAD_DELIMITERS)||-1<X.indexOf(M)||X.charAt(0)===" "||X.charAt(X.length-1)===" ")?ge+X+ge:X)}},d.RECORD_SEP="",d.UNIT_SEP="",d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!i&&!!r.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=O,d.ParserHandle=D,d.NetworkStreamer=v,d.FileStreamer=j,d.StringStreamer=w,d.ReadableStreamStreamer=N,r.jQuery&&((n=r.jQuery).fn.parse=function(x){var b=x.config||{},S=[];return this.each(function(ee){if(!(n(this).prop("tagName").toUpperCase()==="INPUT"&&n(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var ge=0;ge<this.files.length;ge++)S.push({file:this.files[ge],inputElem:this,instanceConfig:n.extend({},b)})}),K(),this;function K(){if(S.length===0)Y(x.complete)&&x.complete();else{var ee,ge,ye,ce,U=S[0];if(Y(x.before)){var te=x.before(U.file,U.inputElem);if(typeof te=="object"){if(te.action==="abort")return ee="AbortError",ge=U.file,ye=U.inputElem,ce=te.reason,void(Y(x.error)&&x.error({name:ee},ge,ye,ce));if(te.action==="skip")return void M();typeof te.config=="object"&&(U.instanceConfig=n.extend(U.instanceConfig,te.config))}else if(te==="skip")return void M()}var p=U.instanceConfig.complete;U.instanceConfig.complete=function(g){Y(p)&&p(g,U.file,U.inputElem),M()},d.parse(U.file,U.instanceConfig)}}function M(){S.splice(0,1),K()}}),o&&(r.onmessage=function(x){x=x.data,d.WORKER_ID===void 0&&x&&(d.WORKER_ID=x.workerId),typeof x.input=="string"?r.postMessage({workerId:d.WORKER_ID,results:d.parse(x.input,x.config),finished:!0}):(r.File&&x.input instanceof File||x.input instanceof Object)&&(x=d.parse(x.input,x.config))&&r.postMessage({workerId:d.WORKER_ID,results:x,finished:!0})}),(v.prototype=Object.create(u.prototype)).constructor=v,(j.prototype=Object.create(u.prototype)).constructor=j,(w.prototype=Object.create(w.prototype)).constructor=w,(N.prototype=Object.create(u.prototype)).constructor=N,d})})(Xc);var Ep=Xc.exports;const Cp=Vl(Ep),Ip=({deadlineHours:s,lastUpdated:t})=>{const[a,r]=m.useState(null),[n,i]=m.useState(!1);return m.useEffect(()=>{if(!s||!t)return;const o=new Date(t).getTime(),l=parseInt(s)*60*60*1e3,c=o+l,d=setInterval(()=>{const u=new Date().getTime(),v=c-u;v<0?(i(!0),clearInterval(d)):r({h:Math.floor(v/(1e3*60*60)),m:Math.floor(v%(1e3*60*60)/(1e3*60)),s:Math.floor(v%(1e3*60)/1e3)})},1e3);return()=>clearInterval(d)},[s,t]),n||!a?e.jsx("div",{className:"text-[10px] text-red-500 font-bold uppercase mt-1",children:"Offerta Scaduta"}):e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 bg-purple-900/50 rounded-md py-1 px-2 border border-purple-500/30 w-fit",children:[e.jsx(Ze,{size:10,className:"text-purple-400"}),e.jsxs("span",{className:"font-mono text-xs font-bold text-white tracking-widest",children:[String(a.h).padStart(2,"0"),":",String(a.m).padStart(2,"0"),":",String(a.s).padStart(2,"0")]})]})},ql=[J.MENU_COMPLETO,J.ANTIPASTI,J.PANINI,J.PIZZE,J.PRIMI,J.SECONDI,J.DOLCI,J.BEVANDE],Tp=[{id:"Glutine",icon:Bi,label:"Glutine"},{id:"Latticini",icon:Ui,label:"Latticini"},{id:"Uova",icon:Mi,label:"Uova"},{id:"Frutta a guscio",icon:Li,label:"Noci"},{id:"Pesce",icon:$i,label:"Pesce"},{id:"Soia",icon:Di,label:"Soia"},{id:"Piccante",icon:zi,label:"Piccante"},{id:"Vegano",icon:Pi,label:"Vegano"}];function Ap(){var oo,lo,co,uo,ho,mo,xo,po,fo,go,bo,vo,wo,jo,yo,No,_o,ko;const s=new URLSearchParams(window.location.search),t=s.get("menu"),a=s.get("landing"),r=s.get("monitor"),[n,i]=m.useState(!t&&!r&&a!=="false"),[o,l]=m.useState(null),[c,d]=m.useState(!0),[u,v]=m.useState(!1),[j,w]=m.useState(!1),[N,D]=m.useState(!1),[E,O]=m.useState(!1),[A,B]=m.useState(null),[Z,F]=m.useState(null),[H,Y]=m.useState(!1),[x,b]=m.useState(r==="true"),[S,K]=m.useState(""),[M,ee]=m.useState("Ristorante"),[ge,ye]=m.useState("49.00"),[ce,U]=m.useState(null),[te,p]=m.useState(!1),[g,y]=m.useState("menu"),[T,I]=m.useState("dashboard"),[X,he]=m.useState(0),[se,ue]=m.useState([]),[ie,ne]=m.useState(!1),[re,V]=m.useState({}),[$e,k]=m.useState(!1),[Q,xe]=m.useState(!1),fe=m.useRef(null),Ce=m.useRef(null),ae=m.useRef(null),_e=m.useRef(null),Ge=m.useRef(null),[we,ze]=m.useState(!1),[z,P]=m.useState(!1),[_,h]=m.useState([]),[C,L]=m.useState(new Date),[le,G]=m.useState(""),[me,pe]=m.useState(!1),[Te,Pe]=m.useState(null),[lt,kt]=m.useState({kitchenSound:!0,waiterSound:!0,pushEnabled:!1}),[qe,bt]=m.useState(It()),[ct,vt]=m.useState(It().categoryDestinations),[wt,Oa]=m.useState(It().printEnabled),[Er,nt]=m.useState(!1),[Oe,at]=m.useState({}),[Wt,Ra]=m.useState(""),[Pn,Tt]=m.useState(!!os()),[ws,zn]=m.useState(""),[Cr,Dn]=m.useState(""),[Ir,Tr]=m.useState(!1),[Bt,$n]=m.useState("info@ristosyncai.it"),[js,Ar]=m.useState("IT73W0623074792000057589384"),[Ds,Or]=m.useState("Massimo Castro"),[sa,Pa]=m.useState("3478127440"),aa=((oo=o==null?void 0:o.user)==null?void 0:oo.email)===an,{dialogState:At,showConfirm:Ft,showDelete:Ht,showSuccess:Ln,closeDialog:za}=Wc(),[ls,Da]=m.useState({isOpen:!1,message:"",type:"info"}),He=(f,$="info")=>{Da({isOpen:!0,message:f,type:$})},$a=()=>{Da(f=>({...f,isOpen:!1}))},[ra,ys]=m.useState(!1),[na,Ns]=m.useState(!1),[Rr,ia]=m.useState(!1),[La,$s]=m.useState(null),[Ma,Ua]=m.useState(!1),[cs,oa]=m.useState(null),Ba=(f,$)=>{var W;oa({isOpen:!0,plan:f,price:$}),(W=document.getElementById("bank-details"))==null||W.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{var f;if((f=o==null?void 0:o.user)!=null&&f.id){const $=async()=>{if(!q)return;const{count:de}=await q.from("messages").select("*",{count:"exact",head:!0}).eq("recipient_id",o.user.id).eq("is_read",!1),{data:oe}=await q.from("messages").select("id").is("recipient_id",null);let be=0;if(oe){const De=JSON.parse(localStorage.getItem("hidden_messages")||"[]"),Re=JSON.parse(localStorage.getItem("read_broadcasts")||"[]");be=oe.filter(Ke=>!De.includes(Ke.id)&&!Re.includes(Ke.id)).length}he((de||0)+be)};$();const W=q.channel("public:messages:count").on("postgres_changes",{event:"*",schema:"public",table:"messages"},()=>{$()}).subscribe();return window.addEventListener("messages:updated",$),()=>{q.removeChannel(W),window.removeEventListener("messages:updated",$)}}},[o]),m.useEffect(()=>{if(t){d(!1);return}if(!q){d(!1);return}const f=setTimeout(()=>{d(oe=>oe&&!1)},5e3),$=async oe=>{var be,De,Re,Ke,Je,Ot,us,pt,St,Et;try{const{data:it,error:hs}=await q.from("profiles").select("restaurant_name, subscription_status, settings").eq("id",oe.id).single();try{const{data:Ye}=await q.from("profiles").select("settings").eq("email","castro.massimo@yahoo.com").single();(De=(be=Ye==null?void 0:Ye.settings)==null?void 0:be.globalConfig)!=null&&De.defaultCost&&ye(Ye.settings.globalConfig.defaultCost),(Ke=(Re=Ye==null?void 0:Ye.settings)==null?void 0:Re.globalConfig)!=null&&Ke.promo&&Ye.settings.globalConfig.promo.active?U({...Ye.settings.globalConfig.promo,lastUpdated:Ye.settings.globalConfig.lastUpdated||new Date().toISOString()}):U(null)}catch{console.log("Could not load global config")}if(hs||!it)return v(!0),w(!1),!1;if(it.subscription_status==="banned")return w(!0),v(!1),!1;if(it.subscription_status==="suspended")return v(!0),w(!1),!1;const Fe=(Ot=(Je=it.settings)==null?void 0:Je.restaurantProfile)==null?void 0:Ot.planType,Ue=(pt=(us=it.settings)==null?void 0:us.restaurantProfile)==null?void 0:pt.subscriptionEndDate,Rt=(Et=(St=it.settings)==null?void 0:St.restaurantProfile)==null?void 0:Et.userPreferences;if(!(Rt!=null&&Rt.termsAccepted)&&!(Rt!=null&&Rt.dontShowWelcomeAgain)&&ys(!0),Fe==="Free"||Fe==="Demo")return B(null),O(!1),v(!1),it.restaurant_name&&ee(it.restaurant_name),!0;if(Ue){const Ye=new Date(Ue);Ye.setHours(23,59,59,999);const ad=new Date,So=Ye.getTime()-ad.getTime(),rd=Math.ceil(So/(1e3*60*60*24));if(B(rd),So<0&&oe.email!==an)return O(!0),v(!0),!1}return it.restaurant_name&&ee(it.restaurant_name),v(!1),w(!1),O(!1),!0}catch(it){return console.error("Error checking user status:",it),v(!0),!1}};q.auth.getSession().then(async({data:{session:oe}})=>{oe?await $(oe.user)?(l(oe),ll()):l(oe):l(null),d(!1)});const{data:{subscription:W}}=q.auth.onAuthStateChange(async(oe,be)=>{be?($(be.user),l(be),ll()):(l(null),v(!1),w(!1)),d(!1)}),de=()=>{alert(` MEMORIA DISPOSITIVO PIENA!
Le immagini occupano troppo spazio. Alcuni dati potrebbero non venire salvati in locale.
Consiglio: Elimina piatti vecchi o usa immagini pi leggere.`)};return window.addEventListener("storage-quota-exceeded",de),()=>{clearTimeout(f),W.unsubscribe(),window.removeEventListener("storage-quota-exceeded",de)}},[t]),m.useEffect(()=>{const f=async()=>{var $,W;if(q)try{const{data:de}=await q.from("profiles").select("settings").eq("email",an).single();if(($=de==null?void 0:de.settings)!=null&&$.globalConfig){const oe=de.settings.globalConfig;oe.contactEmail&&$n(oe.contactEmail),oe.bankDetails&&(oe.bankDetails.iban&&Ar(oe.bankDetails.iban),oe.bankDetails.holder&&Or(oe.bankDetails.holder)),(W=oe.supportContact)!=null&&W.phone&&Pa(oe.supportContact.phone)}}catch(de){console.error("Error fetching global settings",de)}};if(te){ue(Nt()),kt(K0()),f();const $=It();bt($),vt($.categoryDestinations||{[J.MENU_COMPLETO]:"Cucina",[J.ANTIPASTI]:"Cucina",[J.PANINI]:"Pub",[J.PIZZE]:"Pizzeria",[J.PRIMI]:"Cucina",[J.SECONDI]:"Cucina",[J.DOLCI]:"Cucina",[J.BEVANDE]:"Sala"}),Oa($.printEnabled||{Cucina:!1,Pizzeria:!1,Pub:!1,Sala:!1,Cassa:!1}),$.restaurantProfile&&at($.restaurantProfile),h(Mt());const W=os();W&&Ra(W)}},[te]);const _s=f=>{b(!1),new URL(window.location.href).searchParams.has("monitor")&&window.history.pushState({},"",window.location.pathname),f==="kitchen"?F("kitchen"):f==="pizzeria"?F("pizzeria"):f==="pub"?F("pub"):f==="delivery"?F("delivery"):f==="waiter"&&(yc()?F("waiter"):Y(!0))},Pr=()=>{o&&p(!0)},la=async f=>{var $;try{if(!q||!o)return;const{data:W}=await q.from("profiles").select("settings").eq("id",o.user.id).single(),de={...W==null?void 0:W.settings,restaurantProfile:{...($=W==null?void 0:W.settings)==null?void 0:$.restaurantProfile,userPreferences:{termsAccepted:f.termsAccepted,cookiesAccepted:f.cookiesAccepted,privacyAccepted:f.privacyAccepted,welcomeModalShown:!0,dontShowWelcomeAgain:f.dontShowAgain}}};await q.from("profiles").update({settings:de}).eq("id",o.user.id),ys(!1),He(" Benvenuto! Inizia a esplorare RistoSync AI","success")}catch(W){console.error("Error saving preferences:",W),He("Errore nel salvataggio delle preferenze","error")}},ds=(f,$)=>{at(W=>({...W,socials:{...W.socials,[f]:$}}))},zr=()=>{if(!re.name||!re.price)return;const f={id:re.id||Date.now().toString(),name:re.name,price:parseFloat(re.price.toString()),category:re.category||J.ANTIPASTI,description:re.description||"",ingredients:re.ingredients||"",allergens:re.allergens||[],image:re.image,isCombo:re.category===J.MENU_COMPLETO,comboItems:re.comboItems||[],specificDepartment:re.specificDepartment};ie&&re.id?ml(f):ti(f),ue(Nt()),V({}),ne(!1)},Dr=async f=>{await Ft("Elimina Piatto",`Sei sicuro di voler eliminare "${f.name}"? Questa azione non pu essere annullata.`)&&(G0(f.id),ue(Nt()))},$r=f=>{var W;const $=(W=f.target.files)==null?void 0:W[0];if($){const de=new FileReader;de.onloadend=()=>{const oe=new Image;oe.src=de.result,oe.onload=()=>{const be=document.createElement("canvas"),De=600;let Re=oe.width,Ke=oe.height;Re>De&&(Ke*=De/Re,Re=De),be.width=Re,be.height=Ke;const Je=be.getContext("2d");Je==null||Je.drawImage(oe,0,0,Re,Ke),V(Ot=>({...Ot,image:be.toDataURL("image/jpeg",.5)}))}},de.readAsDataURL($)}},Lr=f=>{var W;const $=(W=f.target.files)==null?void 0:W[0];if($){const de=new FileReader;de.onloadend=()=>{const oe=new Image;oe.src=de.result,oe.onload=()=>{const be=document.createElement("canvas"),De=400;be.width=De,be.height=De;const Re=be.getContext("2d"),Ke=Math.min(oe.width,oe.height),Je=(oe.width-Ke)/2,Ot=(oe.height-Ke)/2;Re==null||Re.drawImage(oe,Je,Ot,Ke,Ke,0,0,De,De),at(us=>({...us,logo:be.toDataURL("image/png",.9)}))}},de.readAsDataURL($)}},Mr=async f=>{if(!f.target.files||f.target.files.length===0)return;const $=Array.from(f.target.files);let W=0;const de=Nt();let oe=!1;const be=new Map;de.forEach((De,Re)=>{be.set(De.name.toLowerCase().trim().replace(/[-_]/g," "),Re)});for(const De of $){const Re=De.name.split(".")[0].toLowerCase().trim().replace(/[-_]/g," ");if(be.has(Re)){const Ke=be.get(Re),Je=new FileReader;await new Promise(Ot=>{Je.onload=us=>{var St;const pt=new Image;pt.src=(St=us.target)==null?void 0:St.result,pt.onload=()=>{const Et=document.createElement("canvas"),it=600;let hs=pt.width,Fe=pt.height;hs>it&&(Fe*=it/hs,hs=it),Et.width=hs,Et.height=Fe;const Ue=Et.getContext("2d");Ue==null||Ue.drawImage(pt,0,0,hs,Fe);const Rt=Et.toDataURL("image/jpeg",.5);de[Ke].image=Rt,ml(de[Ke]),W++,oe=!0,Ot(null)}},Je.readAsDataURL(De)})}}oe?(ue(Nt()),alert(` Completato! Associate ${W} immagini ai piatti.`)):alert(" Nessuna immagine corrispondeva ai nomi dei piatti nel menu.")},Ls=m.useRef(null),[Ms,ks]=m.useState(!1),Ur=async f=>{var W;const $=(W=f.target.files)==null?void 0:W[0];if($){ks(!0),He(" Analisi AI (Avanzata) in corso... attendere...","info");try{let de=[];if($.type.startsWith("image/")){const oe=await Sp.recognize($,"ita"),be=oe.data.blocks||[];if(be.length>0)be.forEach(De=>{const Re=De.text.trim();if(!Re)return;const Ke=/(\d{1,3}[.,]\d{2})\s*?/,Je=Re.match(Ke);if(Je){const Ot=parseFloat(Je[1].replace(",",".")),pt=Re.replace(Je[0],"").replace("","").trim().split(`
`).map(St=>St.trim()).filter(St=>St.length>0);if(pt.length>0){const St=pt[0],Et=pt.slice(1).join(" ");St.length>3&&Ot>0&&de.push({name:St,price:Ot,category:"Pizze Speciali",description:Et,ingredients:Et})}}});else{console.log("No blocks found, falling back to lines.");const De=oe.data.text.split(`
`)}}else if($.type.includes("csv")||$.type.includes("excel")||$.name.toLowerCase().endsWith(".csv")){Cp.parse($,{complete:oe=>{oe.data&&Array.isArray(oe.data)&&(oe.data.forEach(be=>{if(Array.isArray(be)&&be.length>=2){const De=be[0],Re=String(be[1]).replace(/[\s]/g,"").replace(",","."),Ke=parseFloat(Re),Je=be[2]||"Nuovi Arrivi";De&&!isNaN(Ke)&&de.push({name:De,price:Ke,category:Je,description:be[3]||"Importato da CSV"})}}),R(de))},header:!1});return}else{He("Formato file non supportato. Usa Immagini o CSV.","error"),ks(!1);return}de.length>0?R(de):(He(" Nessun piatto riconosciuto. Prova una foto pi chiara.","error"),ks(!1))}catch(de){console.error(de),He("Errore analisi.","error"),ks(!1)}finally{Ls.current&&(Ls.current.value="")}}},R=f=>{let $=0;f.forEach(W=>{const de={id:Date.now().toString()+Math.random().toString().slice(2,5),name:W.name,price:W.price,category:Object.values(J).includes(W.category)?W.category:J.ANTIPASTI,description:W.description||"",ingredients:W.ingredients||"",allergens:[]};ti(de),$++}),ue(Nt()),ks(!1),He(` Importati ${$} piatti con successo!`,"success")},Ie=f=>{var W;const $=(W=f.target.files)==null?void 0:W[0];if($){const de=new FileReader;de.onload=oe=>{var be;try{const De=JSON.parse((be=oe.target)==null?void 0:be.result);Array.isArray(De)&&(De.forEach(Re=>{Re.name&&Re.price&&Re.category&&ti({id:Date.now().toString()+Math.random(),name:Re.name,price:parseFloat(Re.price),category:Re.category,description:Re.description,ingredients:Re.ingredients,allergens:Re.allergens||[],image:Re.image,isCombo:Re.category===J.MENU_COMPLETO,comboItems:Re.comboItems||[],specificDepartment:Re.specificDepartment})}),ue(Nt()),alert(`Importati ${De.length} piatti!`))}catch{alert("Errore nel file JSON")}},de.readAsText($)}},ke=()=>{const f="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(se,null,2)),$=document.createElement("a");$.setAttribute("href",f),$.setAttribute("download","menu_ristosync.json"),document.body.appendChild($),$.click(),$.remove()},Be=async()=>{if(!re.name)return;k(!0);const f=await bx(re.name,re.ingredients||"");f&&V($=>({...$,description:f})),k(!1)},Me=async()=>{if(!re.name)return;xe(!0);const f=await gx(re.name);if(f){const $=await jx(f);V(W=>({...W,ingredients:f,allergens:$})),$.length>0&&He(` Rilevati ${$.length} allergeni: ${$.join(", ")}`,"success")}xe(!1)};m.useRef(null);const Ve=async()=>{if(!Oe.name){alert("Inserisci prima il nome del ristorante.");return}ze(!0);const f=await vx(Oe.name);f&&at($=>({...$,description:f})),ze(!1)},jt=()=>{if(!("webkitSpeechRecognition"in window)){alert("Il tuo browser non supporta il riconoscimento vocale. Usa Chrome.");return}const f=new window.webkitSpeechRecognition;f.lang="it-IT",f.continuous=!1,f.interimResults=!1,f.onstart=()=>P(!0),f.onend=()=>P(!1),f.onerror=()=>P(!1),f.onresult=$=>{const W=$.results[0][0].transcript;W&&at(de=>({...de,description:(de.description?de.description+" ":"")+W}))},f.start()},Gt=async f=>{var oe;const $=((oe=qe.restaurantProfile)==null?void 0:oe.tableCount)||12,W=Math.max(1,$+f),de={...qe,restaurantProfile:{...qe.restaurantProfile,tableCount:W}};bt(de),at(be=>({...be,tableCount:W})),await Cs(de)},Fa=async()=>{var oe,be;if(_.length===0){G("Nessun dato disponibile per questa data.");return}pe(!0);const f=((oe=je==null?void 0:je.topItems)==null?void 0:oe.map(De=>De[0]))||[],$=((be=je==null?void 0:je.bottomItems)==null?void 0:be.map(De=>De[0]))||[],W={totalRevenue:(je==null?void 0:je.revenue)||0,totalItems:(je==null?void 0:je.totalDishes)||0,avgWait:(je==null?void 0:je.avgWaitTime)||0,topDishes:f.slice(0,5),bottomDishes:$.slice(0,3),totalOrders:(je==null?void 0:je.totalOrders)||0,avgOrderValue:(je==null?void 0:je.avgOrder)||0,foodCost:(je==null?void 0:je.foodCost)||0},de=await fx(W,C.toLocaleDateString());G(de),pe(!1)},je=m.useMemo(()=>{const f=_.filter(Fe=>{const Ue=new Date(Fe.createdAt||Fe.timestamp);return Ue.getDate()===C.getDate()&&Ue.getMonth()===C.getMonth()&&Ue.getFullYear()===C.getFullYear()&&Fe.status===ve.DELIVERED}),$=f.reduce((Fe,Ue)=>Fe+Ue.items.reduce((Rt,Ye)=>Rt+Ye.menuItem.price*Ye.quantity,0),0),W=f.reduce((Fe,Ue)=>Fe+Ue.items.reduce((Rt,Ye)=>Rt+Ye.quantity,0),0),de=f.length?$/f.length:0,oe=$*.32;let be=0,De=0;f.forEach(Fe=>{if(Fe.status===ve.DELIVERED&&Fe.createdAt&&Fe.timestamp){const Ue=Fe.timestamp-Fe.createdAt;Ue>0&&Ue<24*60*60*1e3&&(be+=Ue/6e4,De++)}});const Re=De>0?Math.round(be/De):0,Ke={};f.forEach(Fe=>Fe.items.forEach(Ue=>{Ke[Ue.menuItem.name]=(Ke[Ue.menuItem.name]||0)+Ue.quantity}));const Je=Object.entries(Ke).sort((Fe,Ue)=>Ue[1]-Fe[1]),Ot=Je.slice(0,5),us=Je.length>5?Je.slice(-3).reverse():Je.length>0?Je.slice(-Math.min(3,Je.length)).reverse():[],pt={};f.forEach(Fe=>{Fe.items.forEach(Ue=>{(Ue.menuItem.ingredients?Ue.menuItem.ingredients.split(",").map(Ye=>Ye.trim()).filter(Boolean):[]).forEach(Ye=>{pt[Ye]=(pt[Ye]||0)+Ue.quantity})})});const St=Object.entries(pt).sort((Fe,Ue)=>Ue[1]-Fe[1]).slice(0,5).map(([Fe,Ue])=>({name:Fe,count:Ue})),Et={};f.forEach(Fe=>{const Ue=new Date(Fe.createdAt||Fe.timestamp).getHours();Et[Ue]=(Et[Ue]||0)+1});const it=Object.entries(Et).sort((Fe,Ue)=>Ue[1]-Fe[1])[0],hs=f.length;return{revenue:$,totalDishes:W,avgOrder:de,topItems:Ot,bottomItems:us,peakHour:it,totalOrders:hs,foodCost:oe,topIngredients:St,avgWaitTime:Re}},[_,C]),Br=async()=>{const f={...qe,categoryDestinations:ct,printEnabled:wt};await Cs(f),bt(f),nt(!1),alert("Impostazioni salvate con successo!")},Fr=async()=>{const f={categoryDestinations:ct,printEnabled:wt,restaurantProfile:{...qe.restaurantProfile,...Oe}};await Cs(f),bt(f),nt(!1),await Ln(" Profilo Salvato","La configurazione  stata salvata con successo!")},Gr=async()=>{await q0(Wt),Tt(!0),He("API Key salvata con successo!","success")},qr=async()=>{await Ft("Eliminare API Key?","Vuoi davvero rimuovere la chiave API? Le funzionalit AI smetteranno di funzionare.")&&(await V0(),Ra(""),Tt(!1),He("API Key rimossa correttamente.","info"))},Vr=()=>{var W;const f=`${window.location.origin}?menu=${(W=o==null?void 0:o.user)==null?void 0:W.id}`,$=window.open("","","width=600,height=600");$&&($.document.write(`<html><head><title>QR Menu</title><style>body{font-family:sans-serif;text-align:center;padding:50px;} h1{font-size:30px;} .url{margin-top:20px;font-size:20px;font-weight:bold;}</style></head><body><h1>Scansiona per il Menu</h1><img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(f)}" /><div class="url">${M}</div><p>Powered by RistoSync</p><script>window.print();<\/script></body></html>`),$.document.close())},Jt=(lo=o==null?void 0:o.user)!=null&&lo.id?`${window.location.origin}?menu=${o.user.id}`:"",Ga=Jt?`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(Jt)}`:"",Kr=()=>{navigator.clipboard.writeText(Jt),alert("Link copiato!")},ed=()=>{navigator.share?navigator.share({title:M,text:"Guarda il nostro menu!",url:Jt}).catch(console.error):Kr()},io=async()=>{if(!ws)return;Tr(!0);const f=await px(ws,null);Dn(f),Tr(!1)},td=()=>{S.trim()&&(B0(S.trim()),F("waiter"),Y(!1))},sd=async()=>{await Ht("Factory Reset Completo"," ATTENZIONE: Questa azione canceller TUTTI i dati (Ordini, Menu, Impostazioni). Questa operazione  IRREVERSIBILE. Sei assolutamente sicuro?")&&(L0(),He(" Reset completato. Ricaricamento...","info"),setTimeout(()=>window.location.reload(),2e3))};if(t)return e.jsx(bl,{restaurantId:t});if(n)return e.jsx(Ax,{onNavigateToApp:()=>{i(!1),window.history.pushState({},"","?landing=false")}});if(c)return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center text-white",children:e.jsx($t,{className:"animate-spin text-orange-500",size:48})});if(!o)return e.jsx(im,{});if(aa&&T==="dashboard")return e.jsx(Dm,{onEnterApp:()=>I("app")});if(j)return e.jsxs("div",{className:"min-h-screen bg-red-950 flex flex-col items-center justify-center text-white p-8 text-center",children:[e.jsx(mn,{size:64,className:"mb-6 text-red-500"}),e.jsx("h1",{className:"text-4xl font-black mb-4",children:"ACCOUNT BLOCCATO"}),e.jsx("p",{className:"text-xl mb-8",children:"Il tuo account  stato disabilitato permanentemente per violazione dei termini."}),e.jsx("button",{onClick:Qa,className:"bg-red-700 hover:bg-red-600 px-8 py-3 rounded-xl font-bold",children:"Esci"})]});if(N)return e.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center text-white p-8 text-center",children:[e.jsx(ot,{size:64,className:"mb-6 text-slate-500"}),e.jsx("h1",{className:"text-4xl font-black mb-4",children:"ACCOUNT DISATTIVATO"}),e.jsx("p",{className:"text-xl mb-8 max-w-md",children:"Il tuo account  stato disattivato. Contatta l'amministrazione per richiedere la riattivazione."}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-700 max-w-md w-full mb-8 text-left",children:[e.jsx("p",{className:"font-bold text-slate-300 mb-2",children:"Contatta l'amministrazione:"}),e.jsxs("div",{className:"flex items-center gap-2 text-white mb-1",children:[e.jsx(_t,{size:16})," ",Bt]}),e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[e.jsx(Un,{size:16})," ",sa]})]}),e.jsx("button",{onClick:Qa,className:"bg-slate-700 hover:bg-slate-600 px-8 py-3 rounded-xl font-bold",children:"Esci"})]});if(u)return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-950 via-slate-900 to-slate-950 flex flex-col items-center justify-start text-white p-6 overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-8 pt-8",children:[e.jsx(Ze,{size:64,className:"mx-auto mb-4 text-orange-500"}),e.jsx("h1",{className:"text-4xl font-black mb-2",children:"SERVIZIO IN ATTESA"}),e.jsx("p",{className:"text-lg text-slate-300 max-w-md mx-auto",children:"Il tuo abbonamento  in attesa di attivazione. Scegli un piano per iniziare!"})]}),e.jsxs("div",{className:"w-full max-w-4xl mb-8",children:[e.jsx("h2",{className:"text-xl font-black text-center mb-6 text-orange-400",children:" Piani Disponibili"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm border border-slate-700 rounded-2xl p-6 text-center hover:border-blue-500/50 transition-all hover:scale-105",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center mx-auto mb-4",children:e.jsx(wa,{size:28,className:"text-white"})}),e.jsx("h3",{className:"text-xl font-black text-white mb-2",children:"MENSILE"}),e.jsxs("div",{className:"text-4xl font-black text-blue-400 mb-1",children:["49",e.jsx("span",{className:"text-lg text-slate-400",children:"/mese"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Fatturazione mensile  Disdici quando vuoi"}),e.jsxs("ul",{className:"text-xs text-slate-300 text-left space-y-2 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Gestione ordini illimitata"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Menu digitale QR"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," AI Assistant"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Supporto email"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-b from-orange-600/20 to-slate-800/80 backdrop-blur-sm border-2 border-orange-500 rounded-2xl p-6 text-center relative hover:scale-105 transition-all shadow-lg shadow-orange-500/20",children:[e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-orange-500 text-white text-xs font-black px-4 py-1 rounded-full",children:" PI POPOLARE"}),e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center mx-auto mb-4 mt-2",children:e.jsx(wa,{size:28,className:"text-white"})}),e.jsx("h3",{className:"text-xl font-black text-white mb-2",children:"ANNUALE"}),e.jsxs("div",{className:"text-4xl font-black text-orange-400 mb-1",children:["399",e.jsx("span",{className:"text-lg text-slate-400",children:"/anno"})]}),e.jsx("p",{className:"text-sm text-green-400 font-bold mb-4",children:"Risparmi 189! (33/mese)"}),e.jsxs("ul",{className:"text-xs text-slate-300 text-left space-y-2 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Tutto il piano Mensile"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," 2 mesi GRATIS"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Supporto prioritario"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Statistiche avanzate"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-b from-purple-900/30 to-slate-800/80 backdrop-blur-sm border border-purple-500/50 rounded-2xl p-6 text-center hover:border-purple-400 transition-all hover:scale-105",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center mx-auto mb-4",children:e.jsx(ft,{size:28,className:"text-white"})}),e.jsx("h3",{className:"text-xl font-black text-white mb-2",children:"VIP / PREMIUM"}),e.jsxs("div",{className:"text-4xl font-black text-purple-400 mb-1",children:["799",e.jsx("span",{className:"text-lg text-slate-400",children:"/anno"})]}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Per catene e ristoranti premium"}),e.jsxs("ul",{className:"text-xs text-slate-300 text-left space-y-2 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Tutto il piano Annuale"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Multi-sede incluso"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Account manager dedicato"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-green-500 shrink-0"})," Personalizzazioni su misura"]})]})]})]})]}),e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm p-6 rounded-2xl border border-slate-700 w-full max-w-xl mb-6",children:[e.jsxs("h3",{className:"font-bold text-lg text-white mb-4 flex items-center gap-2",children:[e.jsx(Za,{size:20,className:"text-green-500"})," Modalit di Pagamento"]}),e.jsxs("p",{className:"text-sm text-slate-300 mb-4",children:['Effettua il bonifico bancario con la causale "Abbonamento RistoSync - ',M,'"']}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-center",children:[e.jsxs("div",{className:"flex-1 w-full bg-slate-950 p-4 rounded-xl border border-slate-800",children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase mb-1",children:"IBAN"}),e.jsx("p",{className:"font-mono text-white text-lg select-all break-all",children:js}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(js),He("IBAN copiato!","success")},className:"text-xs flex items-center gap-1 text-blue-400 hover:text-blue-300 mt-1 font-bold",children:[e.jsx(_a,{size:12})," Copia IBAN"]}),e.jsx("p",{className:"text-xs text-slate-500 uppercase mt-3 mb-1",children:"Intestatario"}),e.jsx("p",{className:"font-bold text-white",children:Ds})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-lg border-2 border-slate-200 shrink-0 flex flex-col items-center",children:[e.jsx(wr,{value:`BCD
002
2
SCT

${Ds}
${js}
EUR


Abbonamento ${new Date().toLocaleString("it-IT",{month:"long"})} ${M}`,size:120,style:{height:"auto",maxWidth:"100%",width:"100%"},level:"M"}),e.jsxs("p",{className:"text-center text-[10px] font-bold text-slate-900 mt-2 uppercase flex items-center gap-1",children:[e.jsx(Va,{size:10})," Paga con App"]})]})]})]}),e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm p-6 rounded-2xl border border-slate-700 w-full max-w-xl mb-8",children:[e.jsxs("h3",{className:"font-bold text-lg text-white mb-4 flex items-center gap-2",children:[e.jsx(Un,{size:20,className:"text-orange-500"})," Contatta l'Amministrazione"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-3 rounded-xl border border-slate-800",children:[e.jsx(_t,{size:20,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("p",{className:"text-sm text-white font-medium",children:Bt})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-3 rounded-xl border border-slate-800",children:[e.jsx(Un,{size:20,className:"text-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Telefono"}),e.jsx("p",{className:"text-sm text-white font-medium",children:sa})]})]})]})]}),e.jsx("button",{onClick:Qa,className:"bg-orange-600 hover:bg-orange-500 px-8 py-3 rounded-xl font-bold mb-8 transition-all active:scale-95",children:"Esci"})]});if(x)return e.jsx(Tx,{onExit:()=>{b(!1),window.history.pushState({},"",window.location.pathname)}});if(!Z&&!te){const f=((co=qe.restaurantProfile)==null?void 0:co.planType)||"Trial",$=f==="Free"||f==="Demo";let W="Licenza Attiva",de="text-emerald-400";return E?(W="Abbonamento Scaduto",de="text-red-500 animate-pulse"):A!==null?(W=`${A} Giorni Rimasti`,A<=5&&(de="text-orange-400")):$&&(W="Versione Gratuita",de="text-blue-400"),e.jsxs(e.Fragment,{children:[ra&&o&&e.jsx(ai,{onClose:()=>ys(!1),onAccept:la,restaurantName:M}),e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white p-6 flex flex-col font-sans relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 to-slate-950 pointer-events-none"}),e.jsx("div",{className:"absolute top-[-10%] right-[-5%] w-96 h-96 bg-orange-600/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-[-10%] left-[-5%] w-96 h-96 bg-blue-600/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative z-10 flex justify-between items-center mb-12",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl flex items-center justify-center shadow-lg shadow-orange-600/20 transform rotate-3",children:e.jsx(tt,{size:36,className:"text-white drop-shadow-md"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-black tracking-tight flex items-center gap-2",children:["Risto",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500",children:"Sync"}),e.jsx("span",{className:"text-blue-500 font-black ml-1",children:"AI"}),e.jsx("span",{className:"text-xs bg-slate-800 text-slate-400 px-2 py-1 rounded-md border border-slate-700 font-mono tracking-widest uppercase",children:f})]}),e.jsxs("p",{className:"text-slate-400 font-medium text-sm mt-1 flex items-center gap-2",children:[M," ",e.jsx("span",{className:"w-1 h-1 bg-slate-500 rounded-full"})," ",new Date().toLocaleDateString()]}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-widest font-mono mt-0.5",children:(uo=o==null?void 0:o.user)==null?void 0:uo.email}),e.jsxs("p",{className:`text-xs font-bold uppercase tracking-wider mt-1 ${de} flex items-center gap-1`,children:[E?e.jsx(ot,{size:10}):e.jsx(Ze,{size:10})," ",W]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[aa&&e.jsxs("button",{onClick:()=>I("dashboard"),className:"group bg-indigo-900/30 hover:bg-indigo-600 p-4 rounded-2xl transition-all duration-300 border border-indigo-500/30 hover:border-indigo-400 flex flex-col items-center gap-1 shadow-lg active:scale-95",title:"Super Admin Dashboard",children:[e.jsx(Yl,{className:"text-indigo-400 group-hover:text-white",size:24}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-indigo-400 group-hover:text-white",children:"Super Admin"})]}),e.jsxs("button",{onClick:Pr,className:"group bg-slate-800 hover:bg-slate-700 p-4 rounded-2xl transition-all duration-300 border border-slate-700 hover:border-slate-500 flex flex-col items-center gap-1 shadow-lg active:scale-95",title:"Impostazioni Admin",children:[e.jsx(hn,{className:"text-slate-400 group-hover:text-white group-hover:rotate-45 transition-transform",size:24}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 group-hover:text-slate-300",children:"Admin"})]}),e.jsxs("button",{onClick:Qa,className:"group bg-slate-800 hover:bg-red-900/20 p-4 rounded-2xl transition-all duration-300 border border-slate-700 hover:border-red-500/50 flex flex-col items-center gap-1 shadow-lg active:scale-95",title:"Esci",children:[e.jsx(fs,{className:"text-slate-400 group-hover:text-red-400",size:24}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 group-hover:text-red-400",children:"Esci"})]})]})]}),E&&e.jsxs("div",{className:"relative z-10 mb-8 bg-red-600/10 border border-red-500/30 p-4 rounded-2xl flex items-center justify-between animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-400 font-bold",children:[e.jsx(ot,{size:24}),e.jsx("span",{children:"Abbonamento Scaduto! Rinnova per continuare a usare tutte le funzioni."})]}),e.jsx("button",{onClick:()=>{p(!0),y("subscription")},className:"bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-500",children:"Rinnova"})]}),A!==null&&A<=5&&!E&&e.jsxs("div",{className:"relative z-10 mb-8 bg-orange-600/10 border border-orange-500/30 p-4 rounded-2xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 text-orange-400 font-bold",children:[e.jsx(Ze,{size:24}),e.jsxs("span",{children:["Abbonamento in scadenza tra ",A," giorni."]})]}),e.jsx("button",{onClick:()=>{p(!0),y("subscription")},className:"bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-orange-500",children:"Gestisci"})]}),e.jsxs("div",{className:"relative z-10 grid grid-cols-1 md:grid-cols-3 gap-5 w-full max-w-7xl mx-auto px-4",children:[e.jsxs("div",{className:"flex flex-col gap-5 md:row-span-2",children:[e.jsxs("button",{onClick:()=>_s("waiter"),className:"group relative flex-1 bg-slate-800 rounded-2xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-2 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-blue-500/10 hover:border-blue-500/50 overflow-hidden min-h-[160px]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-blue-600/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border-4 border-slate-700 group-hover:border-blue-500 group-hover:scale-105 transition-all shadow-inner",children:e.jsx(un,{size:28,className:"text-slate-400 group-hover:text-blue-500 transition-colors"})}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx("h2",{className:"text-xl font-black text-white mb-0.5 group-hover:text-blue-400 transition-colors",children:"SALA"}),e.jsx("p",{className:"text-slate-500 text-xs font-medium",children:"Gestione Comande"})]})]}),e.jsxs("button",{onClick:()=>{b(!0),F(null),window.history.pushState({},"","?monitor=true")},className:"group relative flex-1 bg-slate-800 rounded-2xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-2 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-purple-500/10 hover:border-purple-500/50 overflow-hidden min-h-[160px]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-purple-600/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border-4 border-slate-700 group-hover:border-purple-500 group-hover:scale-105 transition-all shadow-inner",children:e.jsx(rs,{size:28,className:"text-slate-400 group-hover:text-purple-500 transition-colors"})}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx("h2",{className:"text-xl font-black text-white mb-0.5 group-hover:text-purple-400 transition-colors",children:"MONITOR"}),e.jsx("p",{className:"text-slate-500 text-xs font-medium",children:"Stato Tavoli"})]})]})]}),e.jsxs("button",{onClick:()=>_s("kitchen"),className:"group relative h-48 bg-slate-800 rounded-2xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-orange-500/10 hover:border-orange-500/50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-orange-600/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border-2 border-slate-700 group-hover:border-orange-500 group-hover:scale-105 transition-all shadow-inner",children:e.jsx(tt,{size:28,className:"text-slate-400 group-hover:text-orange-500 transition-colors"})}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx("h2",{className:"text-lg font-black text-white mb-0.5 group-hover:text-orange-400 transition-colors",children:"CUCINA"}),e.jsx("p",{className:"text-slate-500 text-xs font-medium",children:"Ordini food"})]})]}),e.jsxs("button",{onClick:()=>_s("pizzeria"),className:"group relative h-48 bg-slate-800 rounded-2xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-red-500/10 hover:border-red-500/50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-red-600/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border-2 border-slate-700 group-hover:border-red-500 group-hover:scale-105 transition-all shadow-inner",children:e.jsx(jn,{size:28,className:"text-slate-400 group-hover:text-red-500 transition-colors"})}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx("h2",{className:"text-lg font-black text-white mb-0.5 group-hover:text-red-400 transition-colors",children:"PIZZERIA"}),e.jsx("p",{className:"text-slate-500 text-xs font-medium",children:"Forno"})]})]}),e.jsxs("button",{onClick:()=>_s("pub"),className:"group relative h-48 bg-slate-800 rounded-2xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-amber-500/10 hover:border-amber-500/50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-amber-600/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border-2 border-slate-700 group-hover:border-amber-500 group-hover:scale-105 transition-all shadow-inner",children:e.jsx(yn,{size:28,className:"text-slate-400 group-hover:text-amber-500 transition-colors"})}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx("h2",{className:"text-lg font-black text-white mb-0.5 group-hover:text-amber-400 transition-colors",children:"PUB/BAR"}),e.jsx("p",{className:"text-slate-500 text-xs font-medium",children:"Bevande"})]})]}),e.jsxs("button",{onClick:()=>_s("delivery"),className:"group relative h-48 bg-slate-800 rounded-2xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-3 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-green-500/10 hover:border-green-500/50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-green-600/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border-2 border-slate-700 group-hover:border-green-500 group-hover:scale-105 transition-all shadow-inner",children:e.jsx(Kt,{size:28,className:"text-slate-400 group-hover:text-green-500 transition-colors"})}),e.jsxs("div",{className:"text-center relative z-10",children:[e.jsx("h2",{className:"text-lg font-black text-white mb-0.5 group-hover:text-green-400 transition-colors",children:"DELIVERY"}),e.jsx("p",{className:"text-slate-500 text-xs font-medium",children:"Asporto"})]})]})]}),H&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 p-8 rounded-[2rem] shadow-2xl w-full max-w-sm relative animate-slide-up",children:[e.jsx("button",{onClick:()=>Y(!1),className:"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors",children:e.jsx(Xe,{size:24})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(bs,{size:32,className:"text-blue-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Chi sei?"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Inserisci il tuo nome per iniziare"})]}),e.jsx("input",{type:"text",value:S,onChange:oe=>K(oe.target.value),placeholder:"Es. Marco",className:"w-full bg-slate-950 border border-slate-700 text-white px-4 py-4 rounded-xl mb-4 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all font-bold text-center text-lg",autoFocus:!0}),e.jsxs("button",{onClick:td,className:"w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-600/20",children:["Inizia Turno ",e.jsx(xs,{size:20})]})]})})]})]})}return Z==="kitchen"?e.jsx(si,{onExit:()=>F(null),department:"Cucina"}):Z==="pizzeria"?e.jsx(si,{onExit:()=>F(null),department:"Pizzeria"}):Z==="pub"?e.jsx(si,{onExit:()=>F(null),department:"Pub"}):Z==="waiter"?e.jsx(nm,{onExit:()=>F(null)}):Z==="delivery"?e.jsx(sm,{onExit:()=>F(null),menuItems:se,showToast:(f,$)=>He(f,$)}):te?e.jsxs(e.Fragment,{children:[ra&&o&&e.jsx(ai,{onClose:()=>ys(!1),onAccept:la,restaurantName:M}),na&&e.jsx(ri,{menuItems:se,restaurantProfile:Oe,publicUrl:Jt,onClose:()=>Ns(!1)}),e.jsxs("div",{className:"min-h-screen bg-slate-950 text-white font-sans flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full md:w-72 bg-slate-900 border-r border-slate-800 flex flex-col shrink-0 h-screen sticky top-0",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(tt,{size:20,className:"text-white"})}),e.jsxs("h1",{className:"font-black text-xl tracking-tight",children:["Risto",e.jsx("span",{className:"text-orange-500",children:"Sync"}),e.jsx("span",{className:"text-blue-500 font-black ml-1",children:"AI"})]})]}),e.jsxs("nav",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>y("profile"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="profile"?"bg-blue-600 text-white shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(Rs,{size:18})," Profilo Ristorante"]}),e.jsxs("button",{onClick:()=>y("menu"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="menu"?"bg-orange-600 text-white shadow-lg shadow-orange-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(gt,{size:18})," Gestione Menu"]}),e.jsxs("button",{onClick:()=>y("share"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="share"?"bg-cyan-600 text-white shadow-lg shadow-cyan-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(Va,{size:18})," Menu Digitale/Cartaceo"]}),e.jsxs("button",{onClick:()=>y("messages"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all relative ${g==="messages"?"bg-indigo-500 text-white shadow-lg shadow-indigo-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(_t,{size:18})," Messaggi / News",X>0&&e.jsx("span",{className:"absolute right-4 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full",children:X})]}),e.jsxs("button",{onClick:()=>y("notif"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="notif"?"bg-purple-600 text-white shadow-lg shadow-purple-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(Sa,{size:18})," Notifiche & Reparti"]}),e.jsxs("button",{onClick:()=>y("subscription"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="subscription"?"bg-green-600 text-white shadow-lg shadow-green-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(Za,{size:18})," Abbonamento"]}),e.jsxs("button",{onClick:()=>y("analytics"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="analytics"?"bg-emerald-600 text-white shadow-lg shadow-emerald-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(fn,{size:18})," Statistiche"]}),e.jsxs("button",{onClick:()=>y("receipts"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="receipts"?"bg-yellow-600 text-white shadow-lg shadow-yellow-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(As,{size:18})," Scontrini Cassa"]}),e.jsxs("button",{onClick:()=>y("ai"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="ai"?"bg-pink-600 text-white shadow-lg shadow-pink-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(Ja,{size:18})," AI Intelligence"]}),e.jsxs("button",{onClick:()=>y("marketing"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="marketing"?"bg-pink-500 text-white shadow-lg shadow-pink-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(Zl,{size:18})," Marketing ",e.jsx("span",{className:"ml-auto bg-blue-600 text-white text-[9px] px-1.5 py-0.5 rounded font-bold uppercase tracking-wider",children:"Beta"})]}),e.jsxs("button",{onClick:()=>y("delivery"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="delivery"?"bg-green-600 text-white shadow-lg shadow-green-900/20":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(Kt,{size:18})," Piattaforme Delivery"]}),e.jsxs("button",{onClick:()=>y("info"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold text-sm transition-all ${g==="info"?"bg-slate-700 text-white":"text-slate-400 hover:bg-slate-800 hover:text-white"}`,children:[e.jsx(cr,{size:18})," Info & Supporto"]})]}),e.jsx("div",{className:"p-4 border-t border-slate-800",children:e.jsxs("button",{onClick:()=>p(!1),className:"w-full flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-300 py-3 rounded-xl font-bold transition-colors",children:[e.jsx(lr,{size:18})," Torna alla Home"]})})]}),e.jsxs("div",{ref:Ge,className:"flex-1 h-screen overflow-y-auto bg-slate-950 p-6 md:p-10 custom-scroll",children:[g==="profile"&&e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsx("h2",{className:"text-3xl font-black text-white mb-8",children:"Profilo Ristorante"}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Rs,{className:"text-blue-500"})," Dati Pubblici"]}),e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Questi dati appariranno nel Menu Digitale."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"shrink-0",children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Logo (Opzionale)"}),e.jsx("div",{onClick:()=>{var f;return(f=_e.current)==null?void 0:f.click()},className:"relative w-24 h-24 bg-slate-950 border-2 border-dashed border-slate-700 rounded-2xl flex items-center justify-center cursor-pointer hover:border-orange-500 transition-all group overflow-hidden",children:Oe.logo?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:Oe.logo,alt:"Logo",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] text-white font-bold uppercase",children:"Cambia"})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),at({...Oe,logo:void 0})},className:"absolute top-1 right-1 w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-500 transition-colors z-50",children:e.jsx(Xe,{size:12})})]}):e.jsxs("div",{className:"text-center p-2",children:[e.jsx(tt,{size:24,className:"mx-auto text-slate-600 group-hover:text-orange-500 transition-colors"}),e.jsx("span",{className:"text-[8px] text-slate-600 mt-1 block",children:"400x400"})]})}),e.jsx("input",{type:"file",ref:_e,onChange:Lr,accept:"image/*",className:"hidden"}),e.jsx("p",{className:"text-[8px] text-slate-600 mt-1 text-center",children:"Formato quadrato"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Insegna (Nome Ristorante)"}),e.jsx("input",{type:"text",value:Oe.name||"",onChange:f=>at({...Oe,name:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white font-bold focus:border-blue-500 outline-none"}),e.jsx("p",{className:"text-[10px] text-slate-600 mt-1",children:"Il nome e il logo appariranno nel Menu Digitale"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block",children:"Bio / Descrizione"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Ve,disabled:we,className:"text-[10px] bg-purple-600/20 text-purple-400 hover:bg-purple-600 hover:text-white px-2 py-1 rounded-lg font-bold flex items-center gap-1 transition-colors disabled:opacity-50",children:[e.jsx(ft,{size:10})," ",we?"...":"AI"]}),e.jsxs("button",{onClick:jt,disabled:z,className:`text-[10px] px-2 py-1 rounded-lg font-bold flex items-center gap-1 transition-colors ${z?"bg-red-600 text-white animate-pulse":"bg-slate-800 text-slate-400 hover:text-white"}`,children:[z?e.jsx(Ti,{size:10}):e.jsx(Ii,{size:10})," REC"]})]})]}),e.jsx("textarea",{value:Oe.description||"",onChange:f=>at({...Oe,description:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white text-sm focus:border-blue-500 outline-none h-24 resize-none",placeholder:"Breve descrizione del locale..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Sito Web (Url)"}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 focus-within:border-blue-500",children:[e.jsx(Ca,{size:16,className:"text-slate-500"}),e.jsx("input",{type:"text",value:Oe.website||"",onChange:f=>at({...Oe,website:f.target.value}),className:"w-full bg-transparent text-white text-sm outline-none",placeholder:"www.ristorante.com"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ia,{className:"text-pink-500"})," Social & Presenza Online"]}),e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Inserisci i link ai tuoi profili social per mostrarli nel menu digitale."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-2 rounded-xl border border-slate-700 focus-within:border-blue-500",children:[e.jsx(ya,{className:"text-pink-500 ml-2",size:18}),e.jsx("input",{type:"text",value:((ho=Oe.socials)==null?void 0:ho.instagram)||"",onChange:f=>ds("instagram",f.target.value),className:"bg-transparent outline-none text-white text-sm w-full placeholder-slate-600",placeholder:"Link Instagram"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-2 rounded-xl border border-slate-700 focus-within:border-blue-500",children:[e.jsx(Na,{className:"text-blue-600 ml-2",size:18}),e.jsx("input",{type:"text",value:((mo=Oe.socials)==null?void 0:mo.facebook)||"",onChange:f=>ds("facebook",f.target.value),className:"bg-transparent outline-none text-white text-sm w-full placeholder-slate-600",placeholder:"Link Facebook"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-2 rounded-xl border border-slate-700 focus-within:border-blue-500",children:[e.jsx(Ql,{className:"text-white ml-2",size:18}),e.jsx("input",{type:"text",value:((xo=Oe.socials)==null?void 0:xo.tiktok)||"",onChange:f=>ds("tiktok",f.target.value),className:"bg-transparent outline-none text-white text-sm w-full placeholder-slate-600",placeholder:"Link TikTok"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-2 rounded-xl border border-slate-700 focus-within:border-blue-500",children:[e.jsx(Rs,{className:"text-blue-400 ml-2",size:18}),e.jsx("input",{type:"text",value:((po=Oe.socials)==null?void 0:po.google)||"",onChange:f=>ds("google",f.target.value),className:"bg-transparent outline-none text-white text-sm w-full placeholder-slate-600",placeholder:"Link Google Business"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-2 rounded-xl border border-slate-700 focus-within:border-blue-500",children:[e.jsx(Ri,{className:"text-green-500 ml-2",size:18}),e.jsx("input",{type:"text",value:((fo=Oe.socials)==null?void 0:fo.tripadvisor)||"",onChange:f=>ds("tripadvisor",f.target.value),className:"bg-transparent outline-none text-white text-sm w-full placeholder-slate-600",placeholder:"Link TripAdvisor"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-2 rounded-xl border border-slate-700 focus-within:border-blue-500",children:[e.jsx(Ea,{className:"text-emerald-500 ml-2",size:18}),e.jsx("input",{type:"text",value:((go=Oe.socials)==null?void 0:go.thefork)||"",onChange:f=>ds("thefork",f.target.value),className:"bg-transparent outline-none text-white text-sm w-full placeholder-slate-600",placeholder:"Link TheFork"})]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(mi,{className:"text-orange-500"})," Dati Aziendali (Fatturazione)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Ragione Sociale Completa"}),e.jsx("input",{type:"text",value:Oe.businessName||"",onChange:f=>at({...Oe,businessName:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"P.IVA / Codice Fiscale"}),e.jsx("input",{type:"text",value:Oe.vatNumber||"",onChange:f=>at({...Oe,vatNumber:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Codice SDI (Destinatario)"}),e.jsx("input",{type:"text",value:Oe.sdiCode||"",onChange:f=>at({...Oe,sdiCode:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white font-mono uppercase",placeholder:"XXXXXXX"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Indirizzo Sede Legale"}),e.jsx("input",{type:"text",value:Oe.address||"",onChange:f=>at({...Oe,address:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Indirizzo PEC"}),e.jsx("input",{type:"email",value:Oe.pecEmail||"",onChange:f=>at({...Oe,pecEmail:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white font-mono"})]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(pn,{className:"text-green-500"})," Contatti Amministrativi"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Email Amministrazione"}),e.jsx("input",{type:"email",value:Oe.email||"",onChange:f=>at({...Oe,email:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Telefono / Cellulare"}),e.jsx("input",{type:"text",value:Oe.phoneNumber||"",onChange:f=>at({...Oe,phoneNumber:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white"})]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-red-500/20 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(hn,{className:"text-red-500"})," Gestione Account"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold block mb-1",children:"Email di Login (Account ID)"}),e.jsxs("div",{className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-slate-400 font-mono text-sm flex items-center gap-2",children:[e.jsx(_t,{size:14}),((bo=o==null?void 0:o.user)==null?void 0:bo.email)||"N/A"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:sd,className:"w-full md:w-1/2 py-3 rounded-xl bg-red-600 hover:bg-red-700 text-white font-bold text-sm transition-all flex items-center justify-center gap-2 shadow-lg shadow-red-900/20",children:[e.jsx(ot,{size:16})," FACTORY RESET"]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:Fr,className:"px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg transition-all flex items-center gap-2",children:[e.jsx(is,{size:18})," Salva Profilo"]})})]}),g==="menu"&&e.jsxs("div",{className:"max-w-6xl mx-auto animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-white mb-2",children:"Gestione Menu"}),e.jsx("p",{className:"text-slate-400",children:"Aggiungi, modifica o rimuovi piatti dal tuo menu digitale."})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:()=>{var f;V({}),ne(!ie),(f=Ge.current)==null||f.scrollTo({top:0,behavior:"smooth"})},className:`px-6 py-3 rounded-xl font-bold flex items-center gap-2 shadow-lg transition-transform active:scale-95 ${ie?"bg-slate-700 text-white":"bg-green-600 hover:bg-green-500 text-white shadow-green-600/20"}`,children:[ie?e.jsx(Xe,{size:20}):e.jsx(gs,{size:20})," ",ie?"Chiudi Editor":"NUOVO PIATTO"]})})]}),e.jsxs("div",{className:"bg-slate-900 p-4 rounded-2xl border border-slate-800 mb-8 flex flex-col sm:flex-row items-center justify-between gap-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-600/20 text-blue-400 rounded-xl",children:e.jsx(ir,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:"Configurazione Sala"}),e.jsx("p",{className:"text-xs text-slate-400 font-medium",children:"Imposta il numero di tavoli attivi nel ristorante."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-950 p-1.5 rounded-xl border border-slate-700",children:[e.jsx("button",{onClick:()=>Gt(-1),className:"w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300 hover:text-white transition-colors",children:e.jsx(Id,{size:18,strokeWidth:3})}),e.jsx("span",{className:"font-black text-3xl w-16 text-center text-white",children:((vo=qe.restaurantProfile)==null?void 0:vo.tableCount)||12}),e.jsx("button",{onClick:()=>Gt(1),className:"w-10 h-10 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-lg text-white shadow-lg shadow-blue-600/20 transition-colors",children:e.jsx(gs,{size:18,strokeWidth:3})})]})]}),e.jsx("div",{className:"bg-slate-900/50 backdrop-blur-sm p-4 rounded-2xl border border-slate-800/50 mb-8",children:e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>{var f;return(f=Ce.current)==null?void 0:f.click()},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg font-semibold text-xs text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Importa menu da file JSON",children:[e.jsx(Td,{size:14})," JSON"]}),e.jsx("input",{type:"file",ref:Ce,onChange:Ie,accept:".json",className:"hidden"}),e.jsxs("button",{onClick:ke,className:"flex items-center gap-1.5 px-3 py-2 rounded-lg font-semibold text-xs text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Esporta menu in JSON",children:[e.jsx(Oi,{size:14})," Esporta"]})]}),e.jsx("div",{className:"w-px h-8 bg-slate-700 hidden sm:block"}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-800/50 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>{var f;return(f=ae.current)==null?void 0:f.click()},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg font-semibold text-xs text-slate-300 hover:bg-pink-600/20 hover:text-pink-400 transition-all",title:"Carica pi foto insieme",children:[e.jsx(xn,{size:14})," Foto Bulk"]}),e.jsx("input",{type:"file",ref:ae,onChange:Mr,accept:"image/*",multiple:!0,className:"hidden"}),e.jsxs("button",{onClick:()=>{var f;return(f=Ls.current)==null?void 0:f.click()},disabled:Ms,className:`flex items-center gap-1.5 px-3 py-2 rounded-lg font-semibold text-xs transition-all ${Ms?"bg-indigo-600/50 text-white animate-pulse":"text-slate-300 hover:bg-indigo-600/20 hover:text-indigo-400"}`,title:"Importa Menu da Foto o CSV con AI",children:[Ms?e.jsx($t,{className:"animate-spin",size:14}):e.jsx(Ad,{size:14})," ",Ms?"Analisi...":"Scan AI"]}),e.jsx("input",{type:"file",ref:Ls,onChange:Ur,accept:"image/*,.csv,.xlsx,.xls",className:"hidden"}),e.jsxs("button",{onClick:async()=>{await Ft("Conferma","Caricare piatti dimostrativi? Verranno sincronizzati automaticamente al cloud per il menu digitale.")&&(await U0(),He(" Menu demo caricato! I piatti sono pronti per la prova.","success"),setTimeout(()=>window.location.reload(),2e3))},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg font-semibold text-xs text-slate-300 hover:bg-purple-600/20 hover:text-purple-400 transition-all",title:"Carica piatti dimostrativi",children:[e.jsx(ft,{size:14})," Demo"]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:async()=>{await Ht("Elimina Menu Completo","Sei sicuro di voler eliminare tutti i piatti dal menu? Questa azione non pu essere annullata.")&&(await M0(),He(" Menu eliminato con successo!","success"),setTimeout(()=>window.location.reload(),2e3))},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg font-semibold text-xs text-red-400 hover:bg-red-600 hover:text-white transition-all border border-red-500/30 hover:border-red-500",title:"Elimina tutti i piatti",children:[e.jsx(Lt,{size:14})," Svuota Menu"]})]})}),(ie||Object.keys(re).length>0)&&e.jsxs("div",{className:"bg-slate-900 p-5 rounded-3xl border border-slate-800 shadow-2xl mb-10 relative overflow-hidden animate-slide-up max-w-5xl mx-auto",children:[e.jsxs("h3",{className:"font-bold text-white mb-5 flex items-center gap-2 text-xl border-b border-slate-800 pb-3",children:[e.jsx(Js,{size:20})," ",re.id?"Modifica Piatto":"Crea Nuovo Piatto"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"relative w-28 h-28 bg-slate-950 rounded-2xl border-2 border-slate-700 border-dashed flex items-center justify-center overflow-hidden shrink-0 group hover:border-blue-500 transition-colors",children:[re.image?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:re.image,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:f=>{f.stopPropagation(),V($=>({...$,image:void 0}))},className:"absolute top-2 right-2 bg-red-600 text-white p-1.5 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-20 hover:scale-110",children:e.jsx(Xe,{size:14})})]}):e.jsx(xn,{className:"text-slate-600",size:28}),e.jsx("input",{type:"file",ref:fe,onChange:$r,className:"hidden",accept:"image/*"}),e.jsx("div",{onClick:()=>{var f;return(f=fe.current)==null?void 0:f.click()},className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity z-10 font-bold text-xs text-white uppercase tracking-wider",children:"Cambia"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:"Nome Piatto"}),e.jsx("input",{type:"text",placeholder:"Es. Spaghetti alla Carbonara",value:re.name||"",onChange:f=>V({...re,name:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2.5 text-white font-bold text-sm focus:border-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:"Prezzo"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-orange-400 font-bold text-base",children:""}),e.jsx("input",{type:"number",placeholder:"0.00",value:re.price||"",onChange:f=>V({...re,price:parseFloat(f.target.value)}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl pl-7 pr-3 py-2.5 text-white font-mono font-bold text-left text-sm focus:border-green-500 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:"Categoria"}),e.jsx("select",{value:re.category||J.ANTIPASTI,onChange:f=>V({...re,category:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2.5 text-white font-bold text-sm focus:border-blue-500 outline-none appearance-none transition-colors cursor-pointer",children:Object.values(J).map(f=>e.jsx("option",{value:f,children:f},f))})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:"Reparto di Destinazione (Opzionale)"}),e.jsxs("select",{value:re.specificDepartment||"",onChange:f=>V({...re,specificDepartment:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2.5 text-slate-300 text-sm outline-none focus:border-purple-500 transition-colors cursor-pointer",children:[e.jsx("option",{value:"",children:"Usa Default della Categoria"}),e.jsx("option",{value:"Cucina",children:"Forza Cucina"}),e.jsx("option",{value:"Pizzeria",children:"Forza Pizzeria"}),e.jsx("option",{value:"Pub",children:"Forza Pub"}),e.jsx("option",{value:"Sala",children:"Forza Sala"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Ingredienti"}),e.jsxs("button",{onClick:Me,disabled:!re.name,className:"text-xs bg-purple-600/10 text-purple-400 hover:bg-purple-600/20 px-2 py-0.5 rounded-lg font-bold flex gap-1 items-center transition-colors disabled:opacity-50",children:[e.jsx(ft,{size:12})," AI"]})]}),e.jsx("textarea",{placeholder:"Elenco ingredienti separati da virgola...",value:re.ingredients||"",onChange:f=>V({...re,ingredients:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2.5 text-white text-sm outline-none focus:border-purple-500 transition-colors resize-none h-24"})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Descrizione Menu"}),e.jsxs("button",{onClick:Be,disabled:!re.name,className:"text-xs bg-purple-600/10 text-purple-400 hover:bg-purple-600/20 px-2 py-0.5 rounded-lg font-bold flex gap-1 items-center transition-colors disabled:opacity-50",children:[e.jsx(ft,{size:12})," AI"]})]}),e.jsx("textarea",{placeholder:"Descrizione accattivante per il menu digitale...",value:re.description||"",onChange:f=>V({...re,description:f.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2.5 text-white text-sm outline-none focus:border-purple-500 transition-colors resize-none h-24"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-2 block",children:"Allergeni"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Tp.map(f=>{var W;const $=f.icon;return e.jsxs("button",{onClick:()=>{const de=re.allergens||[];V({...re,allergens:de.includes(f.id)?de.filter(oe=>oe!==f.id):[...de,f.id]})},className:`px-2.5 py-1.5 rounded-lg text-xs font-bold border transition-all flex items-center gap-1.5 ${(W=re.allergens)!=null&&W.includes(f.id)?"bg-orange-600 border-orange-500 text-white shadow-lg shadow-orange-900/20":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-600 hover:text-slate-200"}`,children:[e.jsx($,{size:14,className:"shrink-0"}),f.label]},f.id)})})]}),e.jsxs("div",{className:"flex gap-3 pt-3 border-t border-slate-800",children:[e.jsx("button",{onClick:()=>{V({}),ne(!1)},className:"flex-1 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold text-sm transition-colors",children:"Annulla"}),e.jsxs("button",{onClick:zr,disabled:!re.name||!re.price,className:"flex-1 py-2.5 rounded-xl bg-green-600 hover:bg-green-500 disabled:opacity-50 text-white font-bold text-sm flex items-center justify-center gap-2 shadow-lg shadow-green-900/20 transition-all hover:scale-[1.02] active:scale-95",children:[e.jsx(is,{size:18})," SALVA"]})]})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[se.length===0&&e.jsxs("div",{className:"text-center py-20 text-slate-600",children:[e.jsx(Ea,{size:64,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"font-bold text-xl",children:"Menu Vuoto"}),e.jsx("p",{className:"text-sm",children:'Aggiungi il tuo primo piatto usando il pulsante "Nuovo Piatto".'})]}),ql.map(f=>{const $=se.filter(W=>W.category===f);return $.length===0?null:e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-3xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-2 h-8 bg-orange-500 rounded-full"}),e.jsx("h3",{className:"text-xl font-bold text-white uppercase tracking-wide",children:f}),e.jsx("span",{className:"text-xs font-mono text-slate-500 bg-slate-800 px-2 py-1 rounded-lg border border-slate-700",children:$.length})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:$.map(W=>e.jsxs("div",{className:"bg-slate-800 p-4 rounded-2xl border border-slate-700 hover:border-blue-500 transition-all group flex flex-col gap-3 shadow-lg hover:shadow-xl cursor-pointer relative",onClick:()=>{var de;V(W),ne(!0),(de=Ge.current)==null||de.scrollTo({top:0,behavior:"smooth"})},children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-900 rounded-xl border border-slate-700 overflow-hidden shrink-0 flex items-center justify-center",children:W.image?e.jsx("img",{src:W.image,className:"w-full h-full object-cover",alt:W.name}):e.jsx(gt,{size:24,className:"text-slate-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-white text-base line-clamp-2 leading-tight mb-1",title:W.name,children:W.name}),e.jsxs("p",{className:"text-orange-400 font-mono font-bold text-sm",children:[" ",W.price.toFixed(2)]}),W.ingredients&&e.jsx("p",{className:"text-[11px] text-slate-500 line-clamp-1 mt-1",children:W.ingredients})]})]}),W.allergens&&W.allergens.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[W.allergens.slice(0,4).map(de=>e.jsx("span",{className:"px-1.5 py-0.5 bg-orange-900/30 text-orange-400 border border-orange-900/50 rounded text-[9px] font-bold uppercase tracking-wide",children:de},de)),W.allergens.length>4&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-slate-700 text-slate-400 rounded text-[9px] font-bold",children:["+",W.allergens.length-4]})]}),e.jsx("button",{onClick:de=>{de.stopPropagation(),Dr(W)},className:"absolute top-3 right-3 w-8 h-8 bg-red-600 hover:bg-red-500 text-white rounded-lg transition-all shadow-lg flex items-center justify-center opacity-0 group-hover:opacity-100",title:"Elimina piatto",children:e.jsx(Lt,{size:16})})]},W.id))})]},f)})]})]}),g==="notif"&&e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Kl,{className:"text-purple-500"})," Smistamento Reparti"]}),e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Decidi in quale monitor inviare gli ordini per ogni categoria."}),e.jsx("div",{className:"space-y-4",children:ql.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950 rounded-xl border border-slate-800",children:[e.jsx("span",{className:"font-bold text-sm text-slate-300",children:f}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:ct[f]||"Cucina",onChange:$=>{const W={...ct,[f]:$.target.value};vt(W),nt(!0)},className:"appearance-none bg-slate-800 text-white text-xs font-bold py-2 pl-3 pr-8 rounded-lg border border-slate-700 outline-none focus:border-purple-500",children:[e.jsx("option",{value:"Cucina",children:"Cucina"}),e.jsx("option",{value:"Pizzeria",children:"Pizzeria"}),e.jsx("option",{value:"Pub",children:"Pub / Bar"}),e.jsx("option",{value:"Sala",children:"Sala (Auto)"})]}),e.jsx(Ha,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",size:12})]})]},f))})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(qs,{className:"text-blue-500"})," Stampa Scontrini (Beta)"]}),e.jsx("div",{className:"space-y-3",children:Object.keys(wt).map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950 rounded-xl border border-slate-800",children:[e.jsxs("span",{className:"font-bold text-sm text-slate-300",children:["Stampa in ",f]}),e.jsx("button",{onClick:()=>{const $={...wt,[f]:!wt[f]};Oa($),nt(!0)},className:`w-12 h-6 rounded-full p-1 transition-colors ${wt[f]?"bg-green-600":"bg-slate-700"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full bg-white transition-transform ${wt[f]?"translate-x-6":""}`})})]},f))})]}),Er&&e.jsx("div",{className:"sticky bottom-6",children:e.jsxs("button",{onClick:Br,className:"w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl shadow-lg animate-bounce flex items-center justify-center gap-2",children:[e.jsx(is,{size:20})," SALVA MODIFICHE"]})})]}),g==="marketing"&&e.jsx(kx,{}),g==="subscription"&&e.jsxs("div",{className:"max-w-6xl mx-auto animate-fade-in pb-20 space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-slate-800 p-6 rounded-3xl border border-slate-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 text-[200px] font-black text-white/5 leading-none",children:A!==null?A:""}),e.jsxs("div",{className:"relative z-10 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-slate-400 font-bold uppercase mb-2 flex items-center gap-2",children:[E?e.jsx(ot,{size:14,className:"text-red-500"}):e.jsx(yt,{size:14,className:"text-green-500"}),"STATO ATTUALE"]}),e.jsxs("h3",{className:"text-4xl font-black text-white mb-1",children:[((wo=qe.restaurantProfile)==null?void 0:wo.planType)||"Trial",e.jsx("span",{className:`ml-4 text-xs px-3 py-1 rounded-full ${E?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:E?"SCADUTO":"ATTIVO"})]}),e.jsxs("p",{className:"text-slate-400 text-sm",children:["Scadenza: ",e.jsx("span",{className:"font-mono",children:(jo=qe.restaurantProfile)!=null&&jo.subscriptionEndDate?new Date(qe.restaurantProfile.subscriptionEndDate).toLocaleDateString():"Non impostato"})]})]}),A!==null&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-6xl font-black text-white",children:A}),e.jsx("p",{className:"text-xs text-slate-400 font-bold uppercase",children:"GIORNI RIMASTI"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black text-white mb-6 text-center flex items-center justify-center gap-2",children:[e.jsx(ft,{className:"text-yellow-500",size:28}),"Scegli il tuo Piano"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-700 hover:border-blue-500 transition-all flex flex-col",children:[e.jsx("h4",{className:"text-sm font-bold text-blue-400 uppercase tracking-wider mb-2",children:"TRIAL"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-4xl font-black text-white",children:"Gratis"}),e.jsx("p",{className:"text-xs text-slate-500",children:"15 Giorni"})]}),e.jsxs("ul",{className:"space-y-2 mb-6 flex-1 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(yt,{size:16,className:"text-blue-500"})," Tutte le funzionalit"]}),e.jsxs("li",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(yt,{size:16,className:"text-blue-500"})," Menu Digitale"]}),e.jsxs("li",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(yt,{size:16,className:"text-blue-500"})," Nessun impegno"]})]}),e.jsx("div",{className:"w-full py-3 text-center text-slate-500 font-bold text-sm bg-slate-900/50 rounded-xl border border-dashed border-slate-700",children:"Piano Attuale"})]}),e.jsxs("div",{className:`bg-slate-900 p-6 rounded-2xl border ${ce?"border-purple-500 relative overflow-hidden":"border-slate-700"} hover:border-cyan-500 transition-all flex flex-col`,children:[ce&&e.jsxs("div",{className:"absolute top-0 right-0 bg-purple-600 text-white text-[10px] font-black px-2 py-1 rounded-bl-xl uppercase tracking-wider animate-pulse z-20",children:[ce.name," ATTIVA"]}),e.jsx("h4",{className:"text-sm font-bold text-cyan-400 uppercase tracking-wider mb-2",children:"STANDARD MESE"}),e.jsxs("div",{className:"mb-4 relative",children:[ce?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("p",{className:"text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400",children:[" ",parseFloat(ce.cost).toFixed(2).replace(".",",")]}),e.jsxs("p",{className:"text-lg font-bold text-slate-500 line-through decoration-red-500 decoration-2",children:[" ",parseFloat(ge).toFixed(2).replace(".",",")]})]}),e.jsxs("p",{className:"text-xs text-purple-300 font-bold mb-1",children:["Offerta valida per ",ce.duration]}),e.jsx(Ip,{deadlineHours:ce.deadlineHours||"72",lastUpdated:ce.lastUpdated})]}):e.jsxs("p",{className:"text-4xl font-black text-white",children:[" ",parseFloat(ge).toFixed(2).replace(".",",")]}),e.jsx("p",{className:"text-xs text-slate-500",children:"/mese"})]}),e.jsxs("ul",{className:"space-y-2 mb-6 flex-1 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(yt,{size:16,className:"text-cyan-500"})," Tutte le funzionalit"]}),e.jsxs("li",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(yt,{size:16,className:"text-cyan-500"})," Multi Device Sync"]}),e.jsxs("li",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(yt,{size:16,className:"text-cyan-500"})," Aggiornamenti inclusi"]})]}),e.jsx("button",{onClick:()=>Ba(ce?`Promo ${ce.name}`:"Standard Mensile",parseFloat(ce?ce.cost:ge).toFixed(2).replace(".",",")),className:`w-full py-3 ${ce?"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 shadow-lg shadow-purple-900/20":"bg-slate-800 hover:bg-cyan-600"} text-white font-bold rounded-xl border ${ce?"border-transparent":"border-slate-700 hover:border-cyan-500"} transition-all`,children:ce?`Attiva ${ce.name}`:"Attiva Mensile"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-600 to-red-600 p-6 rounded-2xl border-2 border-orange-500 flex flex-col relative transform lg:-translate-y-2 shadow-2xl shadow-orange-900/30",children:[e.jsx("div",{className:"absolute -top-3 -right-3 bg-yellow-400 text-black text-xs font-black px-3 py-1.5 rounded-full uppercase tracking-wider shadow-lg",children:"BEST VALUE"}),e.jsx("h4",{className:"text-sm font-bold text-orange-100 uppercase tracking-wider mb-2",children:"STANDARD ANNO"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-4xl font-black text-white",children:[" ",(parseFloat(ge)*10).toFixed(0)]}),e.jsx("p",{className:"text-xs text-orange-100",children:"/anno"})]}),e.jsx("div",{className:"bg-green-500/20 text-green-300 text-xs font-bold px-2 py-1 rounded mb-4 inline-block",children:" 2 MESI GRATIS"}),e.jsxs("ul",{className:"space-y-2 mb-6 flex-1 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2 text-white",children:[e.jsx(yt,{size:16,className:"text-yellow-300"})," Tutte le funzionalit"]}),e.jsxs("li",{className:"flex items-center gap-2 text-white",children:[e.jsx(yt,{size:16,className:"text-yellow-300"})," AI Menu Intelligence"]}),e.jsxs("li",{className:"flex items-center gap-2 text-white",children:[e.jsx(yt,{size:16,className:"text-yellow-300"})," Priorit Supporto"]}),e.jsxs("li",{className:"flex items-center gap-2 text-white",children:[e.jsx(yt,{size:16,className:"text-yellow-300"})," Setup Gratuito"]})]}),e.jsx("button",{onClick:()=>Ba("Standard Annuale",(parseFloat(ge)*10).toFixed(2).replace(".",",")),className:"w-full py-4 bg-white hover:bg-yellow-400 text-orange-600 font-black rounded-xl shadow-lg transition-all transform hover:scale-105 active:scale-95",children:"ATTIVA ANNUALE"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-900 to-purple-800 p-6 rounded-2xl border border-purple-500 hover:border-purple-400 transition-all flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ka,{className:"text-yellow-400",size:20}),e.jsx("h4",{className:"text-sm font-bold text-purple-200 uppercase tracking-wider",children:"VIP"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-3xl font-black text-white",children:"Contattaci"}),e.jsx("p",{className:"text-xs text-purple-300",children:"Soluzioni su misura"})]}),e.jsxs("ul",{className:"space-y-2 mb-6 flex-1 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2 text-purple-200",children:[e.jsx(Ka,{size:16,className:"text-yellow-400"})," Funzioni Maggiori"]}),e.jsxs("li",{className:"flex items-center gap-2 text-purple-200",children:[e.jsx(Ka,{size:16,className:"text-yellow-400"})," Assistenza Dedicata"]}),e.jsxs("li",{className:"flex items-center gap-2 text-purple-200",children:[e.jsx(Ka,{size:16,className:"text-yellow-400"})," Modifiche Custom"]}),e.jsxs("li",{className:"flex items-center gap-2 text-purple-200",children:[e.jsx(Ka,{size:16,className:"text-yellow-400"})," Whitelabel"]})]}),e.jsx("button",{onClick:()=>window.open(`mailto:${Bt}?subject=Richiesta Piano VIP`,"_blank"),className:"w-full py-3 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-xl border border-purple-500 transition-all",children:"Richiedi Info"})]})]})]}),e.jsx("div",{id:"bank-details",className:"bg-slate-900 p-8 rounded-3xl border border-slate-800",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-2 flex items-center gap-2",children:[e.jsx(Za,{className:"text-blue-500"}),"Dati per il Pagamento"]}),e.jsxs("p",{className:"text-slate-400 text-sm mb-6",children:["Per attivare un piano, effettua il bonifico indicando il nome del ristorante nella causale. Invia la distinta a"," ",e.jsx("a",{href:`mailto:${Bt}`,className:"text-blue-400 hover:underline font-bold",children:Bt})," ","per l'attivazione immediata."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"IBAN"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"font-mono text-white text-sm select-all",children:js}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(js),He("IBAN copiato!","success")},className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(_a,{size:16,className:"text-slate-500 hover:text-white"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"INTESTATARIO"}),e.jsx("p",{className:"text-white text-sm font-bold",children:Ds})]}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"CAUSALE"}),e.jsx("p",{className:"text-white text-sm font-bold",children:"Abbonamento Risto demo"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-white p-6 rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("p",{className:"text-slate-900 font-bold text-sm uppercase tracking-wider mb-1",children:"PAGAMENTO SMART"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Inquadra con l'app della banca"})]}),e.jsx("div",{className:"w-40 h-40 bg-white flex items-center justify-center rounded-xl p-2 border-2 border-slate-200",children:e.jsx(wr,{value:`BCD
002
2
SCT

${Ds}
${js}
EUR


Abbonamento ${new Date().toLocaleString("it-IT",{month:"long"})} ${Oe.name||M}`,size:140,style:{height:"auto",maxWidth:"100%",width:"100%"},level:"M"})}),e.jsx("p",{className:"text-xs text-blue-600 font-bold mt-3 uppercase",children:"PAGAMENTO SICURO"})]})]})}),(cs==null?void 0:cs.isOpen)&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 p-8 rounded-[2rem] shadow-2xl w-full max-w-md relative animate-slide-up flex flex-col gap-6",children:[e.jsx("button",{onClick:()=>oa(null),className:"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors",children:e.jsx(Xe,{size:24})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-500/30",children:e.jsx(hi,{size:32,className:"text-green-500"})}),e.jsxs("h3",{className:"text-2xl font-black text-white mb-1",children:["Attiva ",cs.plan]}),e.jsx("p",{className:"text-slate-400",children:"Segui questi passaggi per l'attivazione immediata"})]}),e.jsxs("div",{className:"space-y-4 bg-slate-950/50 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-white shrink-0",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-sm",children:"Inquadra il QR Code"}),e.jsx("p",{className:"text-xs text-slate-400",children:"In basso trovi il QR Code per il pagamento automatico."})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-white shrink-0",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-sm",children:"Effettua il Bonifico"}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Importo da saldare: ",e.jsxs("span",{className:"text-white font-bold",children:[" ",cs.price]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center font-bold text-white shrink-0",children:"3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-sm",children:"Causale Corretta"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Assicurati che la causale includa:"}),e.jsxs("ul",{className:"text-xs text-orange-400 font-bold mt-1 list-disc pl-4",children:[e.jsx("li",{children:"Nome del Ristorante"}),e.jsxs("li",{children:["Tipo Abbonamento (",cs.plan.includes("Mensile")?"Mese":"Annuale",")"]})]})]})]})]}),e.jsx("button",{onClick:()=>oa(null),className:"w-full py-4 bg-white hover:bg-slate-200 text-slate-900 font-black rounded-xl transition-all shadow-lg active:scale-95",children:"HO CAPITO, PROCEDO"})]})})]}),g==="share"&&e.jsxs("div",{className:"space-y-8 pb-24 animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-4xl font-black text-white mb-2",children:"Distribuzione Menu"}),e.jsx("p",{className:"text-slate-400",children:"Gestisci come i tuoi clienti visualizzano il tuo menu: digitale o cartaceo."})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-slate-900 rounded-3xl p-8 border border-slate-800 flex flex-col items-center shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-cyan-500 to-blue-600"}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Va,{className:"text-cyan-400",size:32}),e.jsx("h3",{className:"text-2xl font-black text-white",children:"Versione Digitale"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-center w-full justify-center",children:[e.jsxs("div",{className:"flex flex-col gap-4 items-center",children:[e.jsx("div",{className:"bg-white p-4 rounded-2xl shadow-xl transform hover:scale-105 transition-transform duration-300",children:Ga?e.jsx("img",{src:Ga,alt:"Menu QR",className:"w-48 h-48 mx-auto mix-blend-multiply"}):e.jsx("div",{className:"w-48 h-48 flex items-center justify-center bg-slate-100 text-slate-400 text-xs",children:"QR non disponibile"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full max-w-[200px]",children:[e.jsxs("button",{onClick:Kr,className:"py-2 px-3 bg-slate-800 hover:bg-slate-700 text-white text-xs font-bold rounded-lg flex items-center justify-center gap-2 border border-slate-700 transition-all",children:[e.jsx(_a,{size:14})," Copia"]}),e.jsxs("button",{onClick:Vr,className:"py-2 px-3 bg-cyan-600 hover:bg-cyan-500 text-white text-xs font-bold rounded-lg flex items-center justify-center gap-2 transition-all shadow-lg",children:[e.jsx(qs,{size:14})," Stampa"]})]}),e.jsxs("div",{className:"w-full max-w-[250px] bg-slate-950 p-3 rounded-lg border border-slate-800 flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:Jt,className:"flex-1 bg-transparent text-slate-400 text-[10px] font-mono select-all outline-none"}),e.jsx("button",{onClick:ed,className:"text-cyan-400 hover:text-cyan-300",children:e.jsx(Ia,{size:16})})]})]}),e.jsx("div",{className:"relative transform scale-75 origin-top md:origin-center",children:e.jsxs("div",{className:"h-[500px] w-[240px] bg-slate-950 border-[8px] border-slate-800 rounded-[2.5rem] shadow-2xl relative overflow-hidden pointer-events-none select-none",children:[e.jsx("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 w-20 h-5 bg-black rounded-full z-30"}),e.jsx("div",{className:"absolute inset-0 bg-slate-900 rounded-[2rem] overflow-hidden",children:e.jsx(bl,{restaurantId:(yo=o==null?void 0:o.user)==null?void 0:yo.id,isPreview:!0,activeMenuData:se,activeRestaurantName:Oe.name})})]})})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-3xl p-8 border border-slate-800 flex flex-col items-center shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-orange-500 to-red-600"}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ys,{className:"text-orange-500",size:32}),e.jsx("h3",{className:"text-2xl font-black text-white",children:"Versione Cartacea"})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center items-center gap-8 w-full",children:[e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>Ns(!0),children:[e.jsx("div",{className:"absolute top-2 -right-4 w-[210px] h-[297px] bg-white rounded shadow-md transform rotate-6 opacity-30"}),e.jsx("div",{className:"absolute top-1 -right-2 w-[210px] h-[297px] bg-white rounded shadow-md transform rotate-3 opacity-60"}),e.jsxs("div",{className:"relative w-[210px] h-[297px] bg-white rounded shadow-2xl overflow-hidden flex flex-col items-center pt-8 hover:-translate-y-2 transition-transform duration-300 border border-slate-200",children:[Oe.logo?e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border border-orange-200 mb-4 shadow-sm",children:e.jsx("img",{src:Oe.logo,className:"w-full h-full object-cover"})}):e.jsx(tt,{size:32,className:"text-orange-500 mb-4"}),e.jsx("div",{className:"w-32 h-2 bg-slate-800 rounded mb-2"}),e.jsx("div",{className:"w-24 h-1 bg-slate-300 rounded mb-1"}),e.jsx("div",{className:"w-28 h-1 bg-slate-300 rounded mb-6"}),e.jsx("div",{className:"w-10 h-10 rounded-full border border-orange-100 flex items-center justify-center mb-8",children:e.jsx("span",{className:"text-xs text-orange-500",children:""})}),e.jsxs("div",{className:"mt-auto mb-6 flex flex-col items-center gap-1 opacity-50",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded"}),e.jsx("div",{className:"w-16 h-1 bg-slate-200 rounded"})]}),e.jsx("div",{className:"absolute inset-0 bg-slate-900/0 group-hover:bg-slate-900/10 flex items-center justify-center transition-colors",children:e.jsx("div",{className:"opacity-0 group-hover:opacity-100 bg-white/90 backdrop-blur px-4 py-2 rounded-full font-bold text-slate-900 shadow-xl transform scale-90 group-hover:scale-100 transition-all",children:"Clicca per Anteprima"})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("p",{className:"text-slate-400 text-sm max-w-xs text-center",children:"Genera automaticamente un PDF A5 professionale con copertina, lista piatti e QR code."}),e.jsxs("button",{onClick:()=>Ns(!0),className:"px-8 py-3 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-black rounded-xl shadow-lg shadow-orange-500/20 transform active:scale-95 transition-all flex items-center gap-2 text-lg",children:[e.jsx(qs,{size:20}),"GENERATORE DI MENU"]})]})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-3xl p-8 border border-slate-800 flex flex-col items-center shadow-xl relative overflow-hidden xl:col-span-2 2xl:col-span-1",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-orange-600 to-yellow-500"}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Kt,{className:"text-orange-500",size:32}),e.jsx("h3",{className:"text-2xl font-black text-white",children:"Locandina Delivery"})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center items-center gap-6 w-full py-4 text-center",children:[e.jsxs("div",{className:"w-48 aspect-[148/210] bg-slate-950 border-4 border-slate-800 rounded-lg relative overflow-hidden group cursor-pointer shadow-2xl hover:-translate-y-2 transition-transform",onClick:()=>ia(!0),children:[e.jsxs("div",{className:"absolute inset-0 bg-slate-900 flex flex-col items-center justify-center gap-2 p-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-orange-600 bg-slate-800"}),e.jsx("div",{className:"w-20 h-1 bg-orange-600"}),e.jsx(Va,{className:"text-white opacity-80",size:60})]}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity backdrop-blur-sm",children:e.jsx("span",{className:"bg-orange-600 text-white text-xs font-bold px-2 py-1 rounded",children:"ANTEPRIMA"})})]}),e.jsx("p",{className:"text-slate-400 text-sm max-w-xs",children:'Crea una locandina A5 "aggressiva" ottimizzata per promuovere il tuo servizio di delivery con QR code.'}),e.jsxs("button",{onClick:()=>ia(!0),className:"px-8 py-3 bg-gradient-to-r from-slate-800 to-slate-700 hover:from-slate-700 hover:to-slate-600 border border-slate-600 text-white font-black rounded-xl shadow-lg transform active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(Kt,{size:20,className:"text-orange-500"}),"CREA LOCANDINA"]})]})]})]})]}),g==="analytics"&&e.jsx("div",{className:"w-full min-h-full bg-slate-950 text-white p-6 pb-24 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl font-black text-white mb-2",children:"Business Intelligence"}),e.jsxs("p",{className:"text-slate-400 text-sm flex items-center gap-2",children:[e.jsx(rr,{size:16,className:"text-slate-500"}),Oe.name?Oe.name:"Localit non impostata"]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-slate-900 px-4 py-2 rounded-xl border border-slate-800 shadow-lg",children:[e.jsx("button",{onClick:()=>{const f=new Date(C);f.setDate(f.getDate()-1),L(f)},className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(ar,{size:20})}),e.jsxs("div",{className:"flex items-center gap-3 px-2",children:[e.jsx(wa,{className:"text-orange-500",size:20}),e.jsx("span",{className:"font-bold text-lg capitalize",children:C.toLocaleDateString("it-IT",{weekday:"short",day:"numeric",month:"long"})})]}),e.jsx("button",{onClick:()=>{const f=new Date(C);f.setDate(f.getDate()+1),L(f)},className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(ii,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-slate-900 border border-slate-800 p-5 rounded-2xl relative overflow-hidden group hover:border-slate-700 transition-all shadow-lg",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(Oo,{size:80})}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-400 text-xs font-bold uppercase tracking-wider",children:[e.jsx(Ro,{size:14})," Incasso Netto"]}),e.jsxs("div",{className:"text-xl md:text-2xl font-black text-white whitespace-nowrap",children:[" ",((je==null?void 0:je.revenue)||0).toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 p-5 rounded-2xl relative overflow-hidden group hover:border-slate-700 transition-all shadow-lg",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(gt,{size:80})}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-400 text-xs font-bold uppercase tracking-wider",children:[e.jsx(gt,{size:14})," Piatti Serviti"]}),e.jsx("div",{className:"text-3xl font-black text-white",children:(je==null?void 0:je.totalDishes)||0})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 p-5 rounded-2xl relative overflow-hidden group hover:border-slate-700 transition-all shadow-lg",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(Ze,{size:80})}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-400 text-xs font-bold uppercase tracking-wider",children:[e.jsx(Od,{size:14})," Tempo Medio Attesa"]}),e.jsxs("div",{className:"text-3xl font-black text-white mb-1",children:[(je==null?void 0:je.avgWaitTime)||0," ",e.jsx("span",{className:"text-base font-normal text-slate-500",children:"min"})]}),e.jsx("div",{className:`text-xs ${((je==null?void 0:je.avgWaitTime)||0)<=20?"text-green-500":"text-orange-500"}`,children:"Target: < 20 min"})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 p-5 rounded-2xl relative overflow-hidden group hover:border-slate-700 transition-all shadow-lg",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(rs,{size:80})}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-400 text-xs font-bold uppercase tracking-wider",children:[e.jsx(rs,{size:14})," Tavoli Serviti"]}),e.jsx("div",{className:"text-3xl font-black text-white",children:(je==null?void 0:je.totalOrders)||0})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 p-5 rounded-2xl relative overflow-hidden group hover:border-slate-700 transition-all shadow-lg",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity",children:e.jsx(dr,{size:80})}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-slate-400 text-xs font-bold uppercase tracking-wider",children:[e.jsx(Po,{size:14})," Food Cost (Est. 32%)"]}),e.jsxs("div",{className:"text-3xl font-black text-orange-500 mb-1",children:[" ",((je==null?void 0:je.foodCost)||0).toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Scontrino:  ",((je==null?void 0:je.avgOrder)||0).toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-slate-900 border border-slate-800 p-6 rounded-3xl relative min-h-[300px] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-500/20 p-2 rounded-lg text-blue-400",children:e.jsx(zo,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Consumo Materie Prime"})]}),e.jsx("button",{className:"text-xs bg-slate-800 hover:bg-slate-700 px-3 py-1 rounded text-slate-400 transition-colors",children:"Calcolato su Ingredienti Menu"})]}),e.jsx("div",{className:"flex-1 w-full overflow-y-auto pr-2",children:((No=je==null?void 0:je.topIngredients)==null?void 0:No.length)>0?e.jsx("div",{className:"space-y-3",children:je.topIngredients.map((f,$)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950/50 rounded-xl border border-slate-800 hover:border-slate-700 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-bold text-sm",children:$+1}),e.jsx("span",{className:"font-bold text-slate-200 capitalize",children:f.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-white bg-slate-800 px-2 py-1 rounded",children:f.count}),e.jsx("span",{className:"text-xs text-slate-500",children:"unit"})]})]},$))}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-500 gap-4 opacity-50 h-full",children:[e.jsx(zo,{size:48,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm",children:"Nessun dato ingredienti disponibile."}),e.jsx("p",{className:"text-xs",children:'Assicurati di aver compilato il campo "Ingredienti" nel menu.'})]})]})})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 p-6 rounded-3xl min-h-[300px]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"bg-yellow-500/20 p-2 rounded-lg text-yellow-500",children:e.jsx(Rd,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Top 5 Piatti"})]}),e.jsx("div",{className:"space-y-3",children:((_o=je==null?void 0:je.topItems)==null?void 0:_o.length)>0?je.topItems.map((f,$)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950/50 rounded-xl border border-slate-800 hover:border-slate-700 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${$===0?"bg-yellow-500 text-black":$===1?"bg-slate-400 text-black":$===2?"bg-orange-700 text-white":"bg-slate-700 text-white"}`,children:$+1}),e.jsx("span",{className:"font-medium text-slate-200",children:f[0]})]}),e.jsxs("span",{className:"font-bold text-slate-400",children:[f[1]," ",e.jsx("span",{className:"text-xs font-normal",children:"ordini"})]})]},$)):e.jsx("div",{className:"text-center py-10 text-slate-600 italic",children:"Nessun dato."})})]})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 p-6 rounded-3xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"bg-red-500/20 p-2 rounded-lg text-red-400",children:e.jsx(Po,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Piatti Meno Richiesti"})]}),e.jsx("div",{className:"space-y-3",children:((ko=je==null?void 0:je.bottomItems)==null?void 0:ko.length)>0?je.bottomItems.map((f,$)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-950/50 rounded-xl border border-red-900/30 hover:border-red-800/50 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-900/50 flex items-center justify-center font-bold text-sm text-red-300",children:$+1}),e.jsx("span",{className:"font-medium text-slate-300",children:f[0]})]}),e.jsxs("span",{className:"font-bold text-red-400",children:[f[1]," ",e.jsx("span",{className:"text-xs font-normal text-slate-500",children:"ordini"})]})]},$)):e.jsx("div",{className:"text-center py-10 text-slate-600 italic",children:"Nessun dato sufficiente."})}),e.jsx("p",{className:"text-slate-500 text-xs mt-4 text-center",children:" Considera promozioni o modifiche per questi piatti"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-900 to-purple-900 rounded-3xl p-8 relative overflow-hidden border border-indigo-500/30 shadow-2xl",children:[e.jsx("div",{className:"absolute right-0 bottom-0 opacity-10 translate-y-1/3 translate-x-1/4",children:e.jsx(Pd,{size:400})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"bg-white/10 p-3 rounded-2xl backdrop-blur-md border border-white/20",children:e.jsx(Ja,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black text-white",children:"Supply Chain & Efficienza AI"}),e.jsxs("p",{className:"text-indigo-200",children:["Analisi operativa, fornitori e food cost per ",e.jsx("span",{className:"font-bold text-white",children:"la tua zona"}),"."]})]})]}),e.jsx("div",{className:"mt-8 bg-black/20 backdrop-blur-sm rounded-2xl p-8 border border-white/10 text-center max-w-3xl mx-auto",children:le?e.jsx("div",{className:"text-left space-y-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(ft,{className:"text-yellow-400 shrink-0 mt-1"}),e.jsx("div",{className:"prose prose-invert max-w-none",children:e.jsx("p",{className:"text-lg text-slate-200 leading-relaxed whitespace-pre-line",children:le})})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("p",{className:"text-lg text-slate-300",children:["L'intelligenza artificiale valuter la velocit della cucina (0 min/tavolo),",e.jsx("br",{}),"i flussi di lavoro e i consumi per suggerirti miglioramenti strutturali."]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:Fa,disabled:me,className:"px-8 py-4 bg-white hover:bg-slate-100 text-indigo-900 font-black rounded-xl shadow-lg transition-all flex items-center gap-3 disabled:opacity-70 transform hover:scale-105",children:me?e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"animate-spin",size:20}),"Analisi in corso..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{size:20,className:"text-indigo-600"}),"GENERA CONSULENZA COMPLETA"]})})})]})})]})]})]})}),g==="receipts"&&e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-fade-in pb-24",children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("h2",{className:"text-4xl font-black text-white flex items-center gap-3",children:[e.jsx(As,{className:"text-yellow-500",size:40}),"Movimenti Cassa"]}),e.jsxs("div",{className:"bg-slate-900 p-1.5 rounded-xl border border-slate-800 flex items-center shadow-lg",children:[e.jsx("button",{onClick:()=>{const f=new Date(C);f.setDate(f.getDate()-1),L(f)},className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(ar,{size:20})}),e.jsxs("div",{className:"flex items-center gap-3 px-2",children:[e.jsx(wa,{className:"text-orange-500",size:20}),e.jsx("span",{className:"font-bold text-lg capitalize text-white",children:C.toLocaleDateString("it-IT",{weekday:"short",day:"numeric",month:"long"})})]}),e.jsx("button",{onClick:()=>{const f=new Date(C);f.setDate(f.getDate()+1),L(f)},className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(ii,{size:20})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:(()=>{const f=_.filter(oe=>new Date(oe.timestamp).toDateString()===C.toDateString()),$=f.reduce((oe,be)=>oe+be.items.reduce((De,Re)=>De+Re.menuItem.price*Re.quantity,0),0),W=f.length,de=W>0?$/W:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur border border-slate-800 p-5 rounded-2xl flex items-center gap-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5",children:e.jsx(Oo,{size:80})}),e.jsx("div",{className:"bg-emerald-500/10 p-3 rounded-xl text-emerald-400",children:e.jsx(Ro,{size:32})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider",children:"Incasso Giornaliero"}),e.jsxs("p",{className:"text-3xl font-black text-white",children:[" ",$.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur border border-slate-800 p-5 rounded-2xl flex items-center gap-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5",children:e.jsx(As,{size:80})}),e.jsx("div",{className:"bg-blue-500/10 p-3 rounded-xl text-blue-400",children:e.jsx(qs,{size:32})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider",children:"Scontrini Emessi"}),e.jsx("p",{className:"text-3xl font-black text-white",children:W})]})]}),e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur border border-slate-800 p-5 rounded-2xl flex items-center gap-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-5",children:e.jsx(dr,{size:80})}),e.jsx("div",{className:"bg-purple-500/10 p-3 rounded-xl text-purple-400",children:e.jsx(fn,{size:32})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider",children:"Scontrino Medio"}),e.jsxs("p",{className:"text-3xl font-black text-white",children:[" ",de.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})()})]}),e.jsx("div",{className:"bg-slate-950 rounded-3xl border border-slate-800/50 p-6 shadow-2xl",children:(()=>{const f=_.filter($=>new Date($.timestamp).toDateString()===C.toDateString()).sort(($,W)=>new Date(W.timestamp).getTime()-new Date($.timestamp).getTime());return f.length===0?e.jsxs("div",{className:"text-center py-20 flex flex-col items-center",children:[e.jsx("div",{className:"bg-slate-900 p-6 rounded-full mb-4 opacity-50",children:e.jsx(As,{size:48,className:"text-slate-500"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Nessun movimento"}),e.jsx("p",{className:"text-slate-500 max-w-sm",children:"Non ci sono scontrini emessi per la data selezionata. Gli ordini completati appariranno qui automaticamente."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:f.map($=>{const W=new Date($.timestamp).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),de=$.items.reduce((oe,be)=>oe+be.menuItem.price*be.quantity,0);return e.jsxs("div",{className:"bg-white text-slate-900 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl hover:scale-[1.02] transition-all duration-300 flex flex-col",children:[e.jsxs("div",{className:"bg-slate-100 p-4 border-b border-dashed border-slate-300 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 font-bold uppercase tracking-wider",children:"Tavolo"}),e.jsx("span",{className:"text-2xl font-black text-slate-800",children:$.tableNumber.replace("_HISTORY","")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"block text-xs text-slate-500 font-bold uppercase tracking-wider",children:W}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-1 rounded-full uppercase ${$.status==="Servito"?"bg-green-100 text-green-700":$.status==="Pronto"?"bg-yellow-100 text-yellow-700":"bg-slate-200 text-slate-600"}`,children:$.status})]})]}),e.jsx("div",{className:"p-4 flex-1 max-h-[250px] overflow-y-auto",children:e.jsxs("ul",{className:"space-y-2 text-sm font-mono",children:[e.jsx("li",{className:"text-center text-xs text-slate-400 mb-2",children:"--- INIZIO SCONTRINO ---"}),$.items.map((oe,be)=>e.jsxs("li",{className:"flex justify-between items-start border-b border-slate-100 pb-1 last:border-0",children:[e.jsxs("span",{className:"font-bold w-8",children:[oe.quantity,"x"]}),e.jsx("span",{className:"flex-1 truncate mr-2",children:oe.menuItem.name}),e.jsxs("span",{className:"text-slate-600",children:[" ",(oe.menuItem.price*oe.quantity).toFixed(2)]})]},be))]})}),e.jsxs("div",{className:"bg-slate-50 p-4 border-t border-dashed border-slate-300",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsx("span",{className:"text-slate-500 font-bold uppercase text-xs",children:"Totale Complessivo"}),e.jsxs("span",{className:"text-3xl font-black text-slate-900",children:[" ",de.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{const oe=window.open("","","width=300,height=600");oe&&(oe.document.write(`
                                                                                <html>
                                                                                <head>
                                                                                    <title>Scontrino Tavolo ${$.tableNumber.replace("_HISTORY","")}</title>
                                                                                    <style>
                                                                                        body { font-family: 'Courier New', monospace; padding: 10px; width: 100%; max-width: 300px; margin: 0 auto; color: #000; background: #fff; }
                                                                                        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px dashed #000; padding-bottom: 10px; }
                                                                                        .title { font-size: 20px; font-weight: bold; margin: 0; text-transform: uppercase; }
                                                                                        .info { font-size: 12px; margin: 5px 0; }
                                                                                        .item { display: flex; justify-content: space-between; margin: 8px 0; font-size: 14px; }
                                                                                        .total-section { border-top: 2px dashed #000; margin-top: 15px; padding-top: 10px; }
                                                                                        .total-row { display: flex; justify-content: space-between; font-weight: bold; font-size: 18px; margin-top: 5px; }
                                                                                        .footer { text-align: center; margin-top: 30px; font-size: 10px; text-transform: uppercase; }
                                                                                    </style>
                                                                                </head>
                                                                                <body>
                                                                                    <div class="header">
                                                                                        <p class="title">${M}</p>
                                                                                        <p class="info">Via Roma 123, Italia</p>
                                                                                        <p class="info">P.IVA: 12345678901</p>
                                                                                        <br/>
                                                                                        <p class="info">Scontrino Non Fiscale</p>
                                                                                        <p class="info">Tavolo: ${$.tableNumber.replace("_HISTORY","")}  ${$.waiterName||"Sala"}</p>
                                                                                        <p class="info">${new Date($.timestamp).toLocaleString("it-IT")}</p>
                                                                                    </div>
                                                                                    
                                                                                    ${$.items.map(be=>`
                                                                                        <div class="item">
                                                                                            <span>${be.quantity} x ${be.menuItem.name}</span>
                                                                                            <span>${(be.menuItem.price*be.quantity).toFixed(2)}</span>
                                                                                        </div>
                                                                                    `).join("")}
                                                                                    
                                                                                    <div class="total-section">
                                                                                        <div class="total-row">
                                                                                            <span>TOTALE</span>
                                                                                            <span> ${de.toFixed(2)}</span>
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="footer">
                                                                                        <p>Grazie e Arrivederci</p>
                                                                                        <p>Software: RistoSync AI</p>
                                                                                    </div>
                                                                                    <script>window.onload = () => { window.print(); window.close(); }<\/script>
                                                                                </body>
                                                                                </html>
                                                                            `),oe.document.close())},className:"py-2.5 bg-slate-900 hover:bg-black text-white rounded-lg font-bold text-sm flex items-center justify-center gap-2 transition-all shadow-md hover:shadow-lg",children:[e.jsx(qs,{size:16})," Stampa"]}),e.jsxs("button",{onClick:()=>{const oe=`${M}
Tavolo: ${$.tableNumber.replace("_HISTORY","")}
Data: ${new Date($.timestamp).toLocaleString("it-IT")}
--------------------------------
${$.items.map(be=>`${be.quantity}x ${be.menuItem.name} ...  ${(be.menuItem.price*be.quantity).toFixed(2)}`).join(`
`)}
--------------------------------
TOTALE:  ${de.toFixed(2)}`;alert(oe)},className:"py-2.5 bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 rounded-lg font-bold text-sm flex items-center justify-center gap-2 transition-all shadow-sm hover:shadow-md",children:[e.jsx(Ai,{size:16})," Anteprima"]})]})]})]},$.id)})})})()})]}),g==="ai"&&e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(ec,{className:"text-yellow-500"})," Configurazione API"]}),e.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"Inserisci la tua Google Gemini API Key per abilitare le funzioni intelligenti."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:Wt,onChange:f=>Ra(f.target.value),placeholder:"Incolla la tua API Key qui...",className:"flex-1 bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white outline-none focus:border-yellow-500"}),e.jsx("button",{onClick:Gr,className:"bg-yellow-600 hover:bg-yellow-500 text-white font-bold px-6 py-3 rounded-xl transition-colors",children:"Salva"}),Pn&&e.jsx("button",{onClick:qr,className:"bg-slate-800 hover:bg-red-600/20 hover:text-red-500 text-slate-400 p-3 rounded-xl transition-colors border border-slate-700 hover:border-red-500/50",title:"Rimuovi API Key",children:e.jsx(Lt,{size:20})})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Non hai una chiave? ",e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",className:"text-blue-400 hover:underline",children:"Richiedila qui"}),"."]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800 flex flex-col h-[500px]",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ja,{className:"text-blue-400"})," Chef Assistant"]}),e.jsx("div",{className:"flex-1 bg-slate-950 rounded-xl border border-slate-700 p-4 overflow-y-auto mb-4",children:Cr?e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center shrink-0",children:e.jsx(Ja,{size:16,className:"text-white"})}),e.jsx("div",{className:"bg-slate-800 p-3 rounded-r-xl rounded-bl-xl text-sm leading-relaxed text-slate-200",children:Cr})]}):e.jsx("p",{className:"text-slate-500 text-center text-sm mt-10",children:"Chiedimi qualcosa sul menu, sugli allergeni o per un consiglio!"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:ws,onChange:f=>zn(f.target.value),placeholder:"Fai una domanda allo Chef AI...",className:"flex-1 bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white outline-none focus:border-blue-500",onKeyDown:f=>f.key==="Enter"&&io()}),e.jsx("button",{onClick:io,disabled:Ir,className:"bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-xl transition-colors disabled:opacity-50",children:Ir?e.jsx($t,{className:"animate-spin"}):e.jsx(ts,{size:20})})]})]})]}),g==="messages"&&e.jsx("div",{className:"h-full p-6 animate-fade-in",children:e.jsx("div",{className:"max-w-6xl mx-auto h-[600px] bg-slate-900 rounded-2xl border border-slate-800 overflow-hidden shadow-2xl",children:e.jsx(Mm,{session:o,showToast:He,showConfirm:Ft})})}),g==="info"&&e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsx("h2",{className:"text-3xl font-black text-white mb-4",children:"Benvenuto in RistoSync!"}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-600 to-red-600 p-8 rounded-3xl shadow-2xl text-white",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm",children:e.jsx(tt,{size:32,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black",children:"RistoSync AI"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Il Sistema Gestionale Smart per il Tuo Ristorante"})]})]}),e.jsx("p",{className:"text-white/90 leading-relaxed mb-6",children:"RistoSync  la soluzione completa per gestire ordini, menu e comunicazione tra sala e cucina in tempo reale. Progettato per ristoranti, pizzerie, pub e bar che vogliono digitalizzare il proprio servizio senza complicazioni."}),e.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-2xl p-4 border border-white/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(yt,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:" Prova Gratuita 15 Giorni"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Tutte le funzionalit sbloccate per testare l'app senza limiti!"})]})]})})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-6 flex items-center gap-2 text-xl",children:[e.jsx(zd,{className:"text-yellow-500"})," Come Funziona"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold",children:"1"}),e.jsx("h4",{className:"font-bold text-white",children:"Configura il Menu"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:`Vai in "Gestione Menu" e aggiungi i tuoi piatti con prezzi, ingredienti e allergeni. Puoi anche importare da file JSON o usare l'AI!`})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-600 rounded-lg flex items-center justify-center text-white font-bold",children:"2"}),e.jsx("h4",{className:"font-bold text-white",children:"Imposta le Postazioni"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:'In "Impostazioni" configura dove vanno gli ordini: Cucina, Pizzeria, Pub. Ogni postazione ricever solo i suoi piatti.'})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center text-white font-bold",children:"3"}),e.jsx("h4",{className:"font-bold text-white",children:"Cameriere Prende Ordini"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Il cameriere usa il suo tablet/telefono per inserire gli ordini. Seleziona il tavolo, aggiunge i piatti e invia alla cucina in un tap!"})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center text-white font-bold",children:"4"}),e.jsx("h4",{className:"font-bold text-white",children:"Cucina Riceve e Conferma"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"In cucina vedono l'ordine in tempo reale. Quando  pronto, marcano come completato e il cameriere viene notificato!"})]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-6 flex items-center gap-2 text-xl",children:[e.jsx(Fi,{className:"text-orange-500"})," Funzionalit Principali"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{icon:e.jsx(Va,{size:20}),label:"Menu Digitale QR"},{icon:e.jsx(un,{size:20}),label:"Ordini da Tablet"},{icon:e.jsx(Sa,{size:20}),label:"Notifiche Real-Time"},{icon:e.jsx(Dd,{size:20}),label:"Analytics & Report"},{icon:e.jsx(ft,{size:20}),label:"AI Integrata"},{icon:e.jsx(As,{size:20}),label:"Scontrini Digitali"},{icon:e.jsx(rs,{size:20}),label:"Multi-Postazione"},{icon:e.jsx($d,{size:20}),label:"Sync Cloud"},{icon:e.jsx(qs,{size:20}),label:"Stampa Ordini"}].map((f,$)=>e.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/50 px-3 py-2 rounded-lg text-sm",children:[e.jsx("span",{className:"text-orange-500",children:f.icon}),e.jsx("span",{className:"text-slate-300 font-medium",children:f.label})]},$))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ld,{className:"text-blue-500"})," Contatti Assistenza"]}),e.jsxs("ul",{className:"space-y-4",children:[e.jsxs("li",{className:"flex items-center gap-3 text-slate-300",children:[e.jsx(_t,{className:"text-blue-500"})," ",Bt]}),e.jsxs("li",{className:"flex items-center gap-3 text-slate-300",children:[e.jsx(pn,{className:"text-green-500"})," ",sa]}),e.jsxs("li",{className:"flex items-center gap-3 text-slate-300",children:[e.jsx(Ca,{className:"text-purple-500"})," www.ristosyncai.it"]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(cr,{className:"text-slate-400"})," Informazioni App"]}),e.jsxs("ul",{className:"space-y-4",children:[e.jsxs("li",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Versione"}),e.jsx("span",{className:"text-white font-mono",children:"2.4.0 (Cloud)"})]}),e.jsxs("li",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Stato Sync"}),e.jsxs("span",{className:"text-green-400 font-bold flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"Online"]})]}),e.jsxs("li",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Storage"}),e.jsx("span",{className:"text-white font-mono",children:"Supabase Enterprise"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-900 p-6 rounded-2xl border border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-6 flex items-center gap-2 text-xl",children:[e.jsx(mn,{className:"text-slate-400"})," Informazioni Legali"]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700 mb-6",children:[e.jsxs("h4",{className:"font-bold text-white mb-2 flex items-center gap-2",children:[e.jsx(bs,{className:"text-blue-500",size:16})," Titolare del Trattamento Dati"]}),e.jsxs("p",{className:"text-slate-300 text-sm leading-relaxed",children:[e.jsx("strong",{children:"Castro Massimo"}),e.jsx("br",{}),"Email: ",Bt,e.jsx("br",{}),"Telefono: ",sa,e.jsx("br",{}),"I dati sono conservati su server ",e.jsx("strong",{children:"Supabase"})," (infrastruttura cloud conforme GDPR) e non verranno in alcun modo divulgati, venduti o ceduti a terzi."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("details",{className:"group bg-slate-800/30 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("summary",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-slate-800/50 transition-colors",children:[e.jsxs("span",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(Ys,{size:16,className:"text-orange-500"})," Termini e Condizioni d'Uso"]}),e.jsx(Ha,{size:18,className:"text-slate-400 group-open:rotate-180 transition-transform"})]}),e.jsxs("div",{className:"p-4 pt-0 text-slate-400 text-xs leading-relaxed space-y-3 border-t border-slate-700",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"1. Oggetto del Servizio"}),e.jsx("br",{}),"RistoSync  un software gestionale cloud per la gestione di ordini, menu e comunicazioni interne di attivit ristorative. L'accesso e l'utilizzo del servizio implicano l'accettazione dei presenti termini."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"2. Registrazione e Account"}),e.jsx("br",{}),"L'utente si impegna a fornire dati veritieri durante la registrazione e a mantenere riservate le proprie credenziali. L'account  personale e non cedibile."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"3. Periodo di Prova"}),e.jsx("br",{}),"Il servizio offre un periodo di prova gratuita di 15 giorni con accesso completo a tutte le funzionalit. Al termine, l'utente potr scegliere di sottoscrivere un abbonamento."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"4. Obblighi dell'Utente"}),e.jsx("br",{}),"L'utente si impegna a utilizzare il servizio in conformit alle leggi vigenti, a non tentare accessi non autorizzati ai sistemi e a non utilizzare il software per scopi illeciti."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"5. Propriet Intellettuale"}),e.jsx("br",{}),"Tutti i diritti sul software, marchi, loghi e contenuti sono di propriet esclusiva di Castro Massimo.  vietata la riproduzione non autorizzata."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"6. Limitazione di Responsabilit"}),e.jsx("br",{}),`Il servizio viene fornito "cos com'". Non si garantisce l'assenza di interruzioni o errori. Il titolare non  responsabile per danni indiretti derivanti dall'uso del servizio.`]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"7. Modifiche ai Termini"}),e.jsx("br",{}),"Il titolare si riserva il diritto di modificare i presenti termini con preavviso di 30 giorni tramite comunicazione via email o notifica in-app."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"8. Foro Competente"}),e.jsx("br",{}),"Per qualsiasi controversia sar competente il Foro di residenza del titolare."]})]})]}),e.jsxs("details",{className:"group bg-slate-800/30 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("summary",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-slate-800/50 transition-colors",children:[e.jsxs("span",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(or,{size:16,className:"text-green-500"})," Privacy Policy (GDPR)"]}),e.jsx(Ha,{size:18,className:"text-slate-400 group-open:rotate-180 transition-transform"})]}),e.jsxs("div",{className:"p-4 pt-0 text-slate-400 text-xs leading-relaxed space-y-3 border-t border-slate-700",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Titolare del Trattamento"}),e.jsx("br",{}),"Castro Massimo - Email: ",Bt]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Tipologia di Dati Raccolti"}),e.jsx("br",{}),"Raccogliamo: dati di registrazione (email, nome ristorante), dati operativi (menu, ordini), dati di utilizzo (log, analytics anonimizzati). Non raccogliamo dati sensibili dei clienti finali."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Finalit del Trattamento"}),e.jsx("br",{}),"I dati sono trattati per: erogazione del servizio, assistenza tecnica, miglioramento dell'esperienza utente, comunicazioni di servizio."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Base Giuridica"}),e.jsx("br",{}),"Il trattamento si basa sul consenso espresso al momento della registrazione e sull'esecuzione del contratto di servizio."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Conservazione dei Dati"}),e.jsx("br",{}),"I dati sono conservati su server Supabase (AWS, regione EU) con crittografia at-rest e in-transit. I dati vengono conservati per la durata dell'abbonamento + 12 mesi per obblighi legali."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Condivisione con Terzi"}),e.jsx("br",{}),"I dati NON vengono venduti, ceduti o condivisi con terze parti per finalit commerciali. Possono essere condivisi solo con fornitori tecnici (es. Supabase per hosting) strettamente necessari all'erogazione del servizio."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Diritti dell'Interessato"}),e.jsx("br",{}),`Ai sensi degli artt. 15-22 GDPR, l'utente ha diritto di: accesso, rettifica, cancellazione ("diritto all'oblio"), limitazione, portabilit e opposizione. Per esercitare tali diritti, contattare: `,Bt]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Data Protection Officer (DPO)"}),e.jsx("br",{}),"Per appuntamenti legati al trattamento dati: ",Bt]})]})]}),e.jsxs("details",{className:"group bg-slate-800/30 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("summary",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-slate-800/50 transition-colors",children:[e.jsxs("span",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(Xl,{size:16,className:"text-yellow-500"})," Cookie Policy"]}),e.jsx(Ha,{size:18,className:"text-slate-400 group-open:rotate-180 transition-transform"})]}),e.jsxs("div",{className:"p-4 pt-0 text-slate-400 text-xs leading-relaxed space-y-3 border-t border-slate-700",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Cosa sono i Cookie"}),e.jsx("br",{}),"I cookie sono piccoli file di testo memorizzati sul dispositivo dell'utente per migliorare l'esperienza di navigazione."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Cookie Tecnici (Necessari)"}),e.jsx("br",{}),"Utilizziamo cookie strettamente necessari per: autenticazione utente, mantenimento della sessione, preferenze di utilizzo. Questi cookie non richiedono consenso in quanto essenziali per il funzionamento del servizio."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Cookie Analitici"}),e.jsx("br",{}),"Potremmo utilizzare cookie analitici anonimizzati per comprendere come gli utenti interagiscono con l'applicazione e migliorare il servizio. Nessun dato personale identificabile viene raccolto tramite questi cookie."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Cookie di Terze Parti"}),e.jsx("br",{}),"L'applicazione si integra con servizi di terze parti (es. Supabase per autenticazione) che potrebbero utilizzare propri cookie tecnici. Si rimanda alle rispettive privacy policy."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Gestione dei Cookie"}),e.jsx("br",{}),"L'utente pu gestire le preferenze sui cookie attraverso le impostazioni del proprio browser. La disabilitazione dei cookie tecnici potrebbe compromettere il funzionamento dell'applicazione."]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Durata"}),e.jsx("br",{}),"I cookie di sessione vengono eliminati alla chiusura del browser. I cookie persistenti hanno durata massima di 12 mesi."]})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-700 text-center",children:[e.jsx("p",{className:"text-slate-400 text-xs italic mb-2",children:'"Un grande software fa una grande azienda..."'}),e.jsxs("p",{className:"text-slate-500 text-[10px]",children:[" ",new Date().getFullYear()," RistoSync - Tutti i diritti riservati | Titolare: Castro Massimo | Ultimo aggiornamento: Dicembre 2024"]})]})]})]}),g==="delivery"&&e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in pb-20",children:[e.jsxs("h2",{className:"text-3xl font-black text-white mb-4 flex items-center gap-3",children:[e.jsx(Kt,{size:32,className:"text-green-500"})," Piattaforme Delivery"]}),e.jsx("p",{className:"text-slate-400 mb-8",children:"Gestisci i tuoi account delivery. Attiva/disattiva piattaforme, inserisci dati contrattuali e API per integrazioni future."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(qe.deliveryPlatforms||[]).map((f,$)=>e.jsxs("div",{className:`bg-slate-900 border ${f.enabled?"border-green-500/30":"border-slate-700"} rounded-2xl p-5 relative group transition-all hover:border-slate-500 shadow-lg`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center font-black text-white text-sm ${f.bgClass||"bg-slate-700"}`,children:f.shortCode}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white text-lg",children:f.name}),e.jsx("p",{className:`text-xs font-bold ${f.enabled?"text-green-400":"text-slate-500"}`,children:f.enabled?" Attivo":" Disattivato"})]})]}),e.jsx("button",{onClick:()=>{const W=[...qe.deliveryPlatforms||[]];W[$]={...W[$],enabled:!W[$].enabled};const de={...qe,deliveryPlatforms:W};bt(de),Cs(de),He(`${f.name} ${f.enabled?"disattivato":"attivato"}`,"success")},className:`w-14 h-7 rounded-full relative transition-colors ${f.enabled?"bg-green-600":"bg-slate-700"}`,children:e.jsx("div",{className:`absolute w-5 h-5 bg-white rounded-full top-1 transition-all ${f.enabled?"left-8":"left-1"}`})})]}),e.jsxs("div",{className:"space-y-2 text-sm mb-4 bg-slate-950/50 p-3 rounded-xl border border-slate-800/50",children:[f.merchantId?e.jsxs("p",{className:"text-slate-400 flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Merchant ID:"})," ",e.jsx("span",{className:"font-mono text-slate-300",children:f.merchantId})]}):e.jsx("p",{className:"text-slate-600 italic",children:"Nessun Merchant ID"}),f.contractNumber&&e.jsxs("p",{className:"text-slate-400 flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Contratto:"})," ",e.jsx("span",{className:"font-mono text-slate-300",children:f.contractNumber})]}),f.commissionPercent!==void 0&&e.jsxs("p",{className:"text-slate-400 flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Commissione:"})," ",e.jsxs("span",{className:"font-bold text-orange-400",children:[f.commissionPercent,"%"]})]}),f.apiKey&&e.jsxs("p",{className:"text-slate-400 flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"API Key:"})," ",e.jsxs("span",{className:"font-mono text-slate-300",children:["***",f.apiKey.slice(-4)]})]}),f.notes&&e.jsxs("p",{className:"text-slate-500 italic text-xs mt-2 border-t border-slate-800 pt-2",children:['"',f.notes,'"']})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{$s(f),Ua(!1)},className:"flex-1 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white py-2.5 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-colors border border-slate-700 hover:border-slate-500",children:[e.jsx(Js,{size:14})," Modifica"]}),e.jsx("button",{onClick:()=>{if(confirm(`Eliminare ${f.name}?`)){const W=(qe.deliveryPlatforms||[]).filter((oe,be)=>be!==$),de={...qe,deliveryPlatforms:W};bt(de),Cs(de),He("Piattaforma eliminata","info")}},className:"bg-red-900/20 hover:bg-red-600 text-red-400 hover:text-white py-2.5 px-4 rounded-xl text-xs font-bold flex items-center justify-center gap-1 transition-colors border border-red-500/20 hover:border-red-500",children:e.jsx(Lt,{size:14})})]})]},f.id)),e.jsxs("button",{onClick:()=>{$s({id:`custom_${Date.now()}`,name:"",shortCode:"",color:"#6b7280",bgClass:"bg-slate-600",borderClass:"border-slate-600",enabled:!0}),Ua(!0)},className:"bg-slate-900/50 border-2 border-dashed border-slate-700 hover:border-green-500 rounded-2xl p-8 flex flex-col items-center justify-center gap-3 transition-all text-slate-500 hover:text-green-400 group h-full min-h-[250px]",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 group-hover:bg-green-500/20 flex items-center justify-center transition-colors",children:e.jsx(gs,{size:32})}),e.jsx("span",{className:"font-bold text-sm",children:"Aggiungi Piattaforma"})]})]}),(!qe.deliveryPlatforms||qe.deliveryPlatforms.length===0)&&e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl p-6 text-center",children:[e.jsx(Kt,{size:48,className:"mx-auto text-slate-600 mb-4"}),e.jsx("h3",{className:"text-white font-bold mb-2",children:"Nessuna piattaforma configurata"}),e.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"Inizia aggiungendo le piattaforme delivery che utilizzi."}),e.jsx("button",{onClick:()=>{const $={...qe,deliveryPlatforms:[{id:"just-eat",name:"Just Eat",shortCode:"JE",color:"#ff8000",bgClass:"bg-orange-500",borderClass:"border-orange-500",enabled:!0},{id:"glovo",name:"Glovo",shortCode:"GL",color:"#facd3d",bgClass:"bg-yellow-400",borderClass:"border-yellow-400",enabled:!0},{id:"deliveroo",name:"Deliveroo",shortCode:"DE",color:"#00ccbc",bgClass:"bg-teal-500",borderClass:"border-teal-500",enabled:!0},{id:"uber-eats",name:"Uber Eats",shortCode:"UE",color:"#06c167",bgClass:"bg-green-500",borderClass:"border-green-500",enabled:!1},{id:"phone",name:"Telefono",shortCode:"TEL",color:"#3b82f6",bgClass:"bg-blue-500",borderClass:"border-blue-500",enabled:!0},{id:"takeaway",name:"Asporto",shortCode:"ASP",color:"#8b5cf6",bgClass:"bg-purple-500",borderClass:"border-purple-500",enabled:!0}]};bt($),Cs($),He("Piattaforme predefinite aggiunte!","success")},className:"bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-xl font-bold transition-all",children:"Carica Piattaforme Predefinite"})]})]})]})]}),e.jsx(vl,{isOpen:At.isOpen,title:At.title,message:At.message,type:At.type,onConfirm:At.onConfirm,onCancel:za}),e.jsx(wl,{isOpen:ls.isOpen,message:ls.message,type:ls.type,onClose:$a}),na&&e.jsx(ri,{menuItems:se,restaurantProfile:Oe,publicUrl:Jt,onClose:()=>Ns(!1)}),Rr&&e.jsx(Cx,{restaurantProfile:Oe,publicUrl:Jt,onClose:()=>ia(!1)}),La&&e.jsx(Ix,{platform:La,isNew:Ma,onClose:()=>$s(null),onSave:f=>{const $=qe.deliveryPlatforms||[];let W;Ma?(W=[...$,f],He(`${f.name} creata!`,"success")):(W=$.map(oe=>oe.id===f.id?f:oe),He(`${f.name} aggiornata!`,"success"));const de={...qe,deliveryPlatforms:W};bt(de),Cs(de),$s(null)}})]}):e.jsxs(e.Fragment,{children:[e.jsx(vl,{isOpen:At.isOpen,title:At.title,message:At.message,type:At.type,onConfirm:At.onConfirm,onCancel:za}),e.jsx(wl,{isOpen:ls.isOpen,message:ls.message,type:ls.type,onClose:$a}),ra&&o&&e.jsx(ai,{onClose:()=>ys(!1),onAccept:la,restaurantName:M}),na&&e.jsx(ri,{menuItems:se,restaurantProfile:Oe,onClose:()=>Ns(!1)})]})}function Op(){return e.jsx(yx,{children:e.jsx(Ap,{})})}const Zc=document.getElementById("root");if(!Zc)throw new Error("Could not find root element to mount to");const Rp=xi.createRoot(Zc);Rp.render(e.jsx(od.StrictMode,{children:e.jsx(Op,{})}));
